import{j as s,L as v,R as y,h as w,r as o,a as b}from"./index-CxzMjhE-.js";import{f as N,b as C}from"./quest-3nETprwz.js";import{c as S}from"./post-BFgSlzkn.js";import{c as T}from"./GridLayout-DEWRpfJd.js";import{t as k}from"./displayUtils-C2lD-HWY.js";import{B as j}from"./Button-BBg8DJkg.js";import"./useGraph-Br1XlEWj.js";import"./AvatarStack-DgfcvvW3.js";const E=({quest:e})=>{var t,a,c,p;const d=(t=e.tags)==null?void 0:t.find(r=>r.toLowerCase().startsWith("rank:")),i=(a=e.tags)==null?void 0:a.find(r=>r.toLowerCase().startsWith("difficulty:")),m=(c=e.tags)==null?void 0:c.find(r=>r.toLowerCase().startsWith("reward:")),u=((p=e.tags)==null?void 0:p.filter(r=>r.toLowerCase().startsWith("role:")))||[],h=d?d.split(":")[1]:"Unrated",g=i?i.split(":")[1]:"Unknown",l=m?m.split(":")[1]:"Unknown",x=u.map(r=>r.split(":")[1]).join(", "),n=e.description||"",f=n.length>120?n.slice(0,117)+"â€¦":n;return s.jsxs("div",{className:"border border-secondary rounded bg-surface p-4 space-y-2 shadow",children:[s.jsx("h3",{className:"text-lg font-bold text-primary",children:k(e.title)}),f&&s.jsx("p",{className:"text-sm text-secondary",children:f}),s.jsxs("div",{className:"text-xs text-secondary space-y-0.5",children:[s.jsxs("div",{children:["Rank: ",h]}),s.jsxs("div",{children:["Difficulty: ",g]}),s.jsxs("div",{children:["Reward: ",l]}),x&&s.jsxs("div",{children:["Roles Needed: ",x]})]}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx(v,{to:y.QUEST(e.id),className:"text-sm text-blue-600 underline",children:"Details"}),s.jsx(j,{size:"sm",variant:"contrast",children:"Join Quest"})]})]})},L=12,B=()=>{const{boardType:e}=w(),[d,i]=o.useState([]),[m,u]=o.useState(!0),[h,g]=o.useState(1),[l,x]=o.useState(!1),n=o.useRef(null);o.useEffect(()=>{(async()=>{if(e){u(!0);try{if(e==="quests"||e==="active")if(e==="active"){const a=await N();i(a)}else{const a=await C();i(a)}else if(e==="requests"){const a=await S();i(a.filter(c=>c.type==="request"||c.helpRequest))}else i([])}finally{u(!1)}}})()},[e]),o.useEffect(()=>{const t=n.current;if(!t)return;const a=new IntersectionObserver(c=>{c[0].isIntersecting&&g(p=>p+1)});return a.observe(t),()=>a.disconnect()},[n.current]);const f=d.slice(0,h*L);return m?s.jsx(b,{}):["quests","requests","active"].includes(e||"")?s.jsxs("main",{className:"container mx-auto p-4 space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold capitalize",children:e}),s.jsx(j,{variant:"secondary",size:"sm",onClick:()=>x(t=>!t),children:l?"Grid View":"List View"})]}),s.jsx("div",{className:l?"flex flex-col gap-4":"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:f.map(t=>!l&&t.headPostId?s.jsx(E,{quest:t},t.id):s.jsx(T,{contribution:t,compact:l},t.id))}),f.length<d.length&&s.jsx("div",{ref:n,className:"h-4"})]}):s.jsx("div",{className:"p-6 text-red-500",children:"Invalid board type."})};export{B as default};
