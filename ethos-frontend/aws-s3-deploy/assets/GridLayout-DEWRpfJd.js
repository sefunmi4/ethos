var La=e=>{throw TypeError(e)};var Gi=(e,n,r)=>n.has(e)||La("Cannot "+r);var U=(e,n,r)=>(Gi(e,n,"read from private field"),r?r.call(e):n.get(e)),Me=(e,n,r)=>n.has(e)?La("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,r),me=(e,n,r,i)=>(Gi(e,n,"write to private field"),i?i.call(e,r):n.set(e,r),r),ke=(e,n,r)=>(Gi(e,n,"access private method"),r);import{z as Ru,j as c,x as ze,r as v,C as Eu,G as Mu,H as Pu,J as Au,K as Qi,M as Iu,N as Sl,O as za,P as yn,Q as Ou,U as Du,V as Fu,W as Lu,X as hs,Y as zu,Z as Nl,_ as $u,$ as qu,a0 as Xr,F as ea,a1 as Hu,a2 as Bu,a3 as Wu,L as Vt,a4 as Tl,a5 as $a,a6 as kt,a7 as oi,a8 as fr,a9 as li,aa as ps,ab as qa,ac as Uu,ad as Vu,ae as Gu,af as Ha,ag as Ei,ah as Ba,ai as Qu,aj as Rl,ak as ta,al as Xu,a as St,S as Ue,c as Er,b as Tn,I as Nt,s as xn,o as El,p as Ml,am as Xe,an as Yu,R as ye,ao as Pl,ap as Ku,aq as Ju,ar as Zu,as as ef,at as tf,au as nf,av as rf,aw as ci,ax as ui,ay as sf,E as na}from"./index-CxzMjhE-.js";import{r as af,i as ra,c as of,a as gs,h as Mi,u as Tt,j as Yr,k as Mr,l as Al,m as lf,n as cf,o as uf,p as ff,q as df,t as hf,v as pf,w as gf,x as mf,y as yf,z as xf,A as vf}from"./post-BFgSlzkn.js";import{r as bf,g as wf,b as _f,h as Il,a as Pr,u as Ol,l as dr,i as kf,j as Cf,k as Dl}from"./quest-3nETprwz.js";import{s as jf,b as Fl,f as Sf,u as ia,c as ms,d as Nf,e as Tf}from"./useGraph-Br1XlEWj.js";import{B as $e}from"./Button-BBg8DJkg.js";import{t as Ll,g as Rf,b as sa,a as zl,P as Ef}from"./displayUtils-C2lD-HWY.js";import{A as Mf}from"./AvatarStack-DgfcvvW3.js";var sr=Ru();const aa="inline-flex items-center gap-1 text-xs font-semibold px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",Pf=`${aa} max-w-[150px] whitespace-nowrap overflow-hidden text-ellipsis`;function Af(e=0){return e>=5e3?"S":e>=3e3?"A":e>=1500?"B":e>=700?"C":e>=300?"D":"E"}const gt=({title:e,className:n,children:r})=>c.jsxs("section",{className:ze("mb-6",n),children:[c.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3",children:e}),c.jsx("div",{className:"space-y-4",children:r})]}),De=({htmlFor:e,className:n,children:r,...i})=>c.jsx("label",{htmlFor:e,className:ze("block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",n),...i,children:r}),oa=({id:e,name:n,value:r,placeholder:i="",rows:s=4,className:a,disabled:o=!1,required:l=!1,readOnly:u=!1,helperText:d,error:h,onChange:f})=>c.jsxs("div",{className:"w-full space-y-1",children:[c.jsx("textarea",{id:e,name:n,value:r,placeholder:i,rows:s,disabled:o,required:l,readOnly:u,onChange:f,className:ze("w-full p-3 rounded-md border shadow-sm resize-y text-sm text-primary dark:text-primary bg-surface dark:bg-surface focus:outline-none",h?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 dark:border-gray-600 focus:ring-accent focus:border-accent",{"bg-gray-100 dark:bg-gray-600 cursor-not-allowed":o||u},a)}),d&&c.jsx("p",{className:ze("text-xs",h?"text-red-600":"text-gray-500 dark:text-gray-400"),children:d})]}),ys=({type:e,id:n,canEdit:r=!1,onEdit:i,onDelete:s,onArchived:a,onEditLinks:o,permalink:l,content:u,boardId:d,className:h="",onJoin:f,joinLabel:p="Request to Join",allowDelete:g=!0})=>{const[m,b]=v.useState(!1),[x,y]=v.useState(!1),w=v.useRef(null);v.useEffect(()=>{const S=T=>{w.current&&!w.current.contains(T.target)&&b(!1)};return m&&document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[m]);const N=async()=>{if(window.confirm("Archive this item?"))try{y(!0),e==="post"?await ra(n):await wf(n),d&&await za(d,n),a==null||a()}catch(S){console.error(`[ActionMenu] Archive ${e} failed:`,S),alert(`Failed to archive ${e}.`)}finally{y(!1),b(!1)}},k=async()=>{if(window.confirm(`Delete this ${e} permanently?`))try{e==="post"?await af(n):await bf(n),d&&await za(d,n),s==null||s()}catch(S){console.error(`[ActionMenu] Delete ${e} failed:`,S),alert(`Failed to delete ${e}.`)}finally{b(!1)}},C=()=>{l&&(navigator.clipboard.writeText(l),alert("Link copied!"),b(!1))},_=()=>{u&&(navigator.clipboard.writeText(u),alert("Quote copied!"),b(!1))},j=()=>{l&&(navigator.clipboard.writeText(l),alert(`Link to post ${n} copied!`),b(!1))};return c.jsxs("div",{ref:w,className:`relative ${h}`,children:[c.jsx("button",{onClick:()=>b(!m),"aria-label":"More options",children:c.jsx(Eu,{})}),m&&c.jsxs("div",{className:"absolute right-0 mt-1 w-48 z-10 border rounded bg-surface dark:bg-background shadow text-sm",children:[r&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:i,className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Mu,{className:"inline mr-2"})," Edit"]}),g&&c.jsxs("button",{onClick:k,className:"block w-full text-left px-4 py-2 text-red-600 hover:bg-red-100 dark:hover:bg-gray-700 focus:bg-red-100 dark:focus:bg-gray-700",children:[c.jsx(Pu,{className:"inline mr-2"})," Delete"]}),c.jsxs("button",{onClick:N,disabled:x,className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Au,{className:"inline mr-2"})," ",x?"Archiving…":"Archive"]}),o&&c.jsxs("button",{onClick:()=>{o(),b(!1)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Qi,{className:"inline mr-2"})," Edit Links"]})]}),u&&c.jsxs("button",{onClick:_,className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Iu,{className:"inline mr-2"})," Copy Quote"]}),l&&e==="post"&&c.jsxs("button",{onClick:j,className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Qi,{className:"inline mr-2"})," Link to This Post"]}),f&&c.jsxs("button",{onClick:()=>{f(),b(!1)},className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Sl,{className:"inline mr-2"})," ",p]}),c.jsxs("button",{onClick:C,className:"block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 focus:bg-gray-100 dark:focus:bg-gray-700",children:[c.jsx(Qi,{className:"inline mr-2"})," Copy Link"]})]})]})},If={"To Do":"bg-soft text-secondary","In Progress":"bg-warning text-warning",Blocked:"bg-error text-error",Done:"bg-success text-success"},xs=({status:e,className:n})=>{const r=If[e]||"bg-soft text-secondary";return c.jsx("span",{className:ze("inline-block text-xs font-semibold px-2 py-1 rounded",r,n),children:e})},fi=({id:e,value:n,placeholder:r="",rows:i=6,onChange:s})=>{const[a,o]=v.useState(!1),l=(h,f=h)=>{const p=document.getElementById(e||"");if(!p)return;const{selectionStart:g,selectionEnd:m}=p,b=n.slice(0,g),x=n.slice(g,m),y=n.slice(m),w=b+h+x+f+y;s(w),requestAnimationFrame(()=>{p.focus(),p.selectionStart=g+h.length,p.selectionEnd=m+h.length})},u=h=>{const f=document.getElementById(e||"");if(!f)return;const{selectionStart:p,selectionEnd:g}=f,m=n.slice(0,p),b=n.slice(p,g)||"",x=n.slice(g),y=b.split(`
`),w=y.map(k=>h+k),N=m+w.join(`
`)+x;s(N),requestAnimationFrame(()=>{f.focus(),f.selectionStart=p,f.selectionEnd=g+h.length*y.length})},d=()=>{const h=prompt("Language for code block?")||"",f=document.getElementById(e||"");if(!f)return;const{selectionStart:p,selectionEnd:g}=f,m=n.slice(0,p),b=n.slice(p,g),x=n.slice(g),y=`${m}
\`\`\`${h}
${b}
\`\`\`
${x}`;s(y),requestAnimationFrame(()=>{f.focus(),f.selectionStart=p+4,f.selectionEnd=p+4+h.length})};return c.jsxs("div",{children:[c.jsxs("div",{className:"flex gap-2 mb-1 text-sm",children:[c.jsx("button",{type:"button",className:"px-1",onClick:()=>l("**"),children:c.jsx("strong",{children:"B"})}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>l("*"),children:c.jsx("em",{children:"I"})}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>l("`"),children:"`</>`"}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>l("[","](url)"),children:"link"}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>l("## "),children:"H"}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>u("- [ ] "),children:"✓"}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>u("- "),children:"•"}),c.jsx("button",{type:"button",className:"px-1",onClick:()=>u("1. "),children:"1."}),c.jsx("button",{type:"button",className:"px-1",onClick:d,children:"code"}),c.jsx("button",{type:"button",className:"ml-auto underline",onClick:()=>o(h=>!h),children:a?"Edit":"Preview"})]}),a?c.jsx("div",{className:"border rounded p-2",children:c.jsx(yn,{content:n})}):c.jsx(oa,{id:e,value:n,onChange:h=>s(h.target.value),placeholder:r,rows:i})]})},Of={quest:Wu,task:Bu,issue:Hu,log:Xr,review:ea,category:Xr,status:Xr,free_speech:qu,type:$u,request:Nl,party_request:zu,quest_task:hs,commit:Lu,meta_system:Fu,meta_announcement:Du,solved:Ou},Wa={quest:"bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-200",task:"bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-200",issue:"bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-200",log:"bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200",review:"bg-teal-100 text-teal-800 dark:bg-teal-800 dark:text-teal-200",category:"bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-200",status:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-200",free_speech:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200",type:"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300",request:"bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-200",party_request:"bg-pink-100 text-pink-800 dark:bg-pink-800 dark:text-pink-200",quest_task:"bg-cyan-100 text-cyan-800 dark:bg-cyan-800 dark:text-cyan-200",commit:"bg-pink-100 text-pink-800 dark:bg-pink-800 dark:text-pink-200",meta_system:"bg-red-100 text-red-700 dark:bg-red-700 dark:text-red-200",meta_announcement:"bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-200",solved:"bg-lime-100 text-lime-800 dark:bg-lime-800 dark:text-lime-200"},Sn=({type:e,label:n,link:r,className:i,username:s,usernameLink:a,detailLink:o,truncate:l=!0})=>{const u=Of[e]||Xr,d=Wa[e]||Wa.type,h=l?Pf:aa;if(s&&a&&o)return c.jsxs("span",{className:ze(h,d,i),children:[c.jsx(u,{className:"w-3 h-3 flex-shrink-0"}),c.jsx(Vt,{to:o,className:"underline text-inherit",children:n})," ",c.jsxs(Vt,{to:a,className:"text-inherit",children:["@",s]})]});const f=c.jsxs(c.Fragment,{children:[c.jsx(u,{className:"w-3 h-3 flex-shrink-0"}),n]});return r?c.jsx(Vt,{to:r,className:ze(h,d,i),children:f}):o?c.jsx(Vt,{to:o,className:ze(h,d,i),children:f}):c.jsx("span",{className:ze(h,d,i),children:f})};var tt,ce,Tr,Qe,bn,Fn,on,ln,Rr,Ln,zn,wn,_n,cn,$n,pe,ar,vs,bs,ws,_s,ks,Cs,js,$l,Cl,Df=(Cl=class extends Tl{constructor(n,r){super();Me(this,pe);Me(this,tt);Me(this,ce);Me(this,Tr);Me(this,Qe);Me(this,bn);Me(this,Fn);Me(this,on);Me(this,ln);Me(this,Rr);Me(this,Ln);Me(this,zn);Me(this,wn);Me(this,_n);Me(this,cn);Me(this,$n,new Set);this.options=r,me(this,tt,n),me(this,ln,null),me(this,on,$a()),this.options.experimental_prefetchInRender||U(this,on).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(U(this,ce).addObserver(this),Ua(U(this,ce),this.options)?ke(this,pe,ar).call(this):this.updateResult(),ke(this,pe,_s).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ss(U(this,ce),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ss(U(this,ce),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ke(this,pe,ks).call(this),ke(this,pe,Cs).call(this),U(this,ce).removeObserver(this)}setOptions(n){const r=this.options,i=U(this,ce);if(this.options=U(this,tt).defaultQueryOptions(n),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof kt(this.options.enabled,U(this,ce))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ke(this,pe,js).call(this),U(this,ce).setOptions(this.options),r._defaulted&&!oi(this.options,r)&&U(this,tt).getQueryCache().notify({type:"observerOptionsUpdated",query:U(this,ce),observer:this});const s=this.hasListeners();s&&Va(U(this,ce),i,this.options,r)&&ke(this,pe,ar).call(this),this.updateResult(),s&&(U(this,ce)!==i||kt(this.options.enabled,U(this,ce))!==kt(r.enabled,U(this,ce))||fr(this.options.staleTime,U(this,ce))!==fr(r.staleTime,U(this,ce)))&&ke(this,pe,vs).call(this);const a=ke(this,pe,bs).call(this);s&&(U(this,ce)!==i||kt(this.options.enabled,U(this,ce))!==kt(r.enabled,U(this,ce))||a!==U(this,cn))&&ke(this,pe,ws).call(this,a)}getOptimisticResult(n){const r=U(this,tt).getQueryCache().build(U(this,tt),n),i=this.createResult(r,n);return Lf(this,i)&&(me(this,Qe,i),me(this,Fn,this.options),me(this,bn,U(this,ce).state)),i}getCurrentResult(){return U(this,Qe)}trackResult(n,r){return new Proxy(n,{get:(i,s)=>(this.trackProp(s),r==null||r(s),Reflect.get(i,s))})}trackProp(n){U(this,$n).add(n)}getCurrentQuery(){return U(this,ce)}refetch({...n}={}){return this.fetch({...n})}fetchOptimistic(n){const r=U(this,tt).defaultQueryOptions(n),i=U(this,tt).getQueryCache().build(U(this,tt),r);return i.fetch().then(()=>this.createResult(i,r))}fetch(n){return ke(this,pe,ar).call(this,{...n,cancelRefetch:n.cancelRefetch??!0}).then(()=>(this.updateResult(),U(this,Qe)))}createResult(n,r){var T;const i=U(this,ce),s=this.options,a=U(this,Qe),o=U(this,bn),l=U(this,Fn),d=n!==i?n.state:U(this,Tr),{state:h}=n;let f={...h},p=!1,g;if(r._optimisticResults){const P=this.hasListeners(),I=!P&&Ua(n,r),L=P&&Va(n,i,r,s);(I||L)&&(f={...f,...Gu(h.data,n.options)}),r._optimisticResults==="isRestoring"&&(f.fetchStatus="idle")}let{error:m,errorUpdatedAt:b,status:x}=f;g=f.data;let y=!1;if(r.placeholderData!==void 0&&g===void 0&&x==="pending"){let P;a!=null&&a.isPlaceholderData&&r.placeholderData===(l==null?void 0:l.placeholderData)?(P=a.data,y=!0):P=typeof r.placeholderData=="function"?r.placeholderData((T=U(this,zn))==null?void 0:T.state.data,U(this,zn)):r.placeholderData,P!==void 0&&(x="success",g=Ha(a==null?void 0:a.data,P,r),p=!0)}if(r.select&&g!==void 0&&!y)if(a&&g===(o==null?void 0:o.data)&&r.select===U(this,Rr))g=U(this,Ln);else try{me(this,Rr,r.select),g=r.select(g),g=Ha(a==null?void 0:a.data,g,r),me(this,Ln,g),me(this,ln,null)}catch(P){me(this,ln,P)}U(this,ln)&&(m=U(this,ln),g=U(this,Ln),b=Date.now(),x="error");const w=f.fetchStatus==="fetching",N=x==="pending",k=x==="error",C=N&&w,_=g!==void 0,S={status:x,fetchStatus:f.fetchStatus,isPending:N,isSuccess:x==="success",isError:k,isInitialLoading:C,isLoading:C,data:g,dataUpdatedAt:f.dataUpdatedAt,error:m,errorUpdatedAt:b,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>d.dataUpdateCount||f.errorUpdateCount>d.errorUpdateCount,isFetching:w,isRefetching:w&&!N,isLoadingError:k&&!_,isPaused:f.fetchStatus==="paused",isPlaceholderData:p,isRefetchError:k&&_,isStale:la(n,r),refetch:this.refetch,promise:U(this,on),isEnabled:kt(r.enabled,n)!==!1};if(this.options.experimental_prefetchInRender){const P=V=>{S.status==="error"?V.reject(S.error):S.data!==void 0&&V.resolve(S.data)},I=()=>{const V=me(this,on,S.promise=$a());P(V)},L=U(this,on);switch(L.status){case"pending":n.queryHash===i.queryHash&&P(L);break;case"fulfilled":(S.status==="error"||S.data!==L.value)&&I();break;case"rejected":(S.status!=="error"||S.error!==L.reason)&&I();break}}return S}updateResult(){const n=U(this,Qe),r=this.createResult(U(this,ce),this.options);if(me(this,bn,U(this,ce).state),me(this,Fn,this.options),U(this,bn).data!==void 0&&me(this,zn,U(this,ce)),oi(r,n))return;me(this,Qe,r);const i=()=>{if(!n)return!0;const{notifyOnChangeProps:s}=this.options,a=typeof s=="function"?s():s;if(a==="all"||!a&&!U(this,$n).size)return!0;const o=new Set(a??U(this,$n));return this.options.throwOnError&&o.add("error"),Object.keys(U(this,Qe)).some(l=>{const u=l;return U(this,Qe)[u]!==n[u]&&o.has(u)})};ke(this,pe,$l).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ke(this,pe,_s).call(this)}},tt=new WeakMap,ce=new WeakMap,Tr=new WeakMap,Qe=new WeakMap,bn=new WeakMap,Fn=new WeakMap,on=new WeakMap,ln=new WeakMap,Rr=new WeakMap,Ln=new WeakMap,zn=new WeakMap,wn=new WeakMap,_n=new WeakMap,cn=new WeakMap,$n=new WeakMap,pe=new WeakSet,ar=function(n){ke(this,pe,js).call(this);let r=U(this,ce).fetch(this.options,n);return n!=null&&n.throwOnError||(r=r.catch(li)),r},vs=function(){ke(this,pe,ks).call(this);const n=fr(this.options.staleTime,U(this,ce));if(ps||U(this,Qe).isStale||!qa(n))return;const i=Uu(U(this,Qe).dataUpdatedAt,n)+1;me(this,wn,setTimeout(()=>{U(this,Qe).isStale||this.updateResult()},i))},bs=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(U(this,ce)):this.options.refetchInterval)??!1},ws=function(n){ke(this,pe,Cs).call(this),me(this,cn,n),!(ps||kt(this.options.enabled,U(this,ce))===!1||!qa(U(this,cn))||U(this,cn)===0)&&me(this,_n,setInterval(()=>{(this.options.refetchIntervalInBackground||Vu.isFocused())&&ke(this,pe,ar).call(this)},U(this,cn)))},_s=function(){ke(this,pe,vs).call(this),ke(this,pe,ws).call(this,ke(this,pe,bs).call(this))},ks=function(){U(this,wn)&&(clearTimeout(U(this,wn)),me(this,wn,void 0))},Cs=function(){U(this,_n)&&(clearInterval(U(this,_n)),me(this,_n,void 0))},js=function(){const n=U(this,tt).getQueryCache().build(U(this,tt),this.options);if(n===U(this,ce))return;const r=U(this,ce);me(this,ce,n),me(this,Tr,n.state),this.hasListeners()&&(r==null||r.removeObserver(this),n.addObserver(this))},$l=function(n){Ei.batch(()=>{n.listeners&&this.listeners.forEach(r=>{r(U(this,Qe))}),U(this,tt).getQueryCache().notify({query:U(this,ce),type:"observerResultsUpdated"})})},Cl);function Ff(e,n){return kt(n.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&n.retryOnMount===!1)}function Ua(e,n){return Ff(e,n)||e.state.data!==void 0&&Ss(e,n,n.refetchOnMount)}function Ss(e,n,r){if(kt(n.enabled,e)!==!1&&fr(n.staleTime,e)!=="static"){const i=typeof r=="function"?r(e):r;return i==="always"||i!==!1&&la(e,n)}return!1}function Va(e,n,r,i){return(e!==n||kt(i.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&la(e,r)}function la(e,n){return kt(n.enabled,e)!==!1&&e.isStaleByTime(fr(n.staleTime,e))}function Lf(e,n){return!oi(e.getCurrentResult(),n)}var un,fn,nt,Ut,Yt,Kr,Ns,jl,zf=(jl=class extends Tl{constructor(n,r){super();Me(this,Yt);Me(this,un);Me(this,fn);Me(this,nt);Me(this,Ut);me(this,un,n),this.setOptions(r),this.bindMethods(),ke(this,Yt,Kr).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var i;const r=this.options;this.options=U(this,un).defaultMutationOptions(n),oi(this.options,r)||U(this,un).getMutationCache().notify({type:"observerOptionsUpdated",mutation:U(this,nt),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&Ba(r.mutationKey)!==Ba(this.options.mutationKey)?this.reset():((i=U(this,nt))==null?void 0:i.state.status)==="pending"&&U(this,nt).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=U(this,nt))==null||n.removeObserver(this)}onMutationUpdate(n){ke(this,Yt,Kr).call(this),ke(this,Yt,Ns).call(this,n)}getCurrentResult(){return U(this,fn)}reset(){var n;(n=U(this,nt))==null||n.removeObserver(this),me(this,nt,void 0),ke(this,Yt,Kr).call(this),ke(this,Yt,Ns).call(this)}mutate(n,r){var i;return me(this,Ut,r),(i=U(this,nt))==null||i.removeObserver(this),me(this,nt,U(this,un).getMutationCache().build(U(this,un),this.options)),U(this,nt).addObserver(this),U(this,nt).execute(n)}},un=new WeakMap,fn=new WeakMap,nt=new WeakMap,Ut=new WeakMap,Yt=new WeakSet,Kr=function(){var r;const n=((r=U(this,nt))==null?void 0:r.state)??Qu();me(this,fn,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},Ns=function(n){Ei.batch(()=>{var r,i,s,a,o,l,u,d;if(U(this,Ut)&&this.hasListeners()){const h=U(this,fn).variables,f=U(this,fn).context;(n==null?void 0:n.type)==="success"?((i=(r=U(this,Ut)).onSuccess)==null||i.call(r,n.data,h,f),(a=(s=U(this,Ut)).onSettled)==null||a.call(s,n.data,null,h,f)):(n==null?void 0:n.type)==="error"&&((l=(o=U(this,Ut)).onError)==null||l.call(o,n.error,h,f),(d=(u=U(this,Ut)).onSettled)==null||d.call(u,void 0,n.error,h,f))}this.listeners.forEach(h=>{h(U(this,fn))})})},jl),ql=v.createContext(!1),$f=()=>v.useContext(ql);ql.Provider;function qf(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Hf=v.createContext(qf()),Bf=()=>v.useContext(Hf),Wf=(e,n)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(n.isReset()||(e.retryOnMount=!1))},Uf=e=>{v.useEffect(()=>{e.clearReset()},[e])},Vf=({result:e,errorResetBoundary:n,throwOnError:r,query:i,suspense:s})=>e.isError&&!n.isReset()&&!e.isFetching&&i&&(s&&e.data===void 0||Rl(r,[e.error,i])),Gf=e=>{if(e.suspense){const n=i=>i==="static"?i:Math.max(i??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...i)=>n(r(...i)):n(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Qf=(e,n)=>e.isLoading&&e.isFetching&&!n,Xf=(e,n)=>(e==null?void 0:e.suspense)&&n.isPending,Ga=(e,n,r)=>n.fetchOptimistic(e).catch(()=>{r.clearReset()});function Yf(e,n,r){var f,p,g,m,b;const i=$f(),s=Bf(),a=ta(),o=a.defaultQueryOptions(e);(p=(f=a.getDefaultOptions().queries)==null?void 0:f._experimental_beforeQuery)==null||p.call(f,o),o._optimisticResults=i?"isRestoring":"optimistic",Gf(o),Wf(o,s),Uf(s);const l=!a.getQueryCache().get(o.queryHash),[u]=v.useState(()=>new n(a,o)),d=u.getOptimisticResult(o),h=!i&&e.subscribed!==!1;if(v.useSyncExternalStore(v.useCallback(x=>{const y=h?u.subscribe(Ei.batchCalls(x)):li;return u.updateResult(),y},[u,h]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),v.useEffect(()=>{u.setOptions(o)},[o,u]),Xf(o,d))throw Ga(o,u,s);if(Vf({result:d,errorResetBoundary:s,throwOnError:o.throwOnError,query:a.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw d.error;if((m=(g=a.getDefaultOptions().queries)==null?void 0:g._experimental_afterQuery)==null||m.call(g,o,d),o.experimental_prefetchInRender&&!ps&&Qf(d,i)){const x=l?Ga(o,u,s):(b=a.getQueryCache().get(o.queryHash))==null?void 0:b.promise;x==null||x.catch(li).finally(()=>{u.updateResult()})}return o.notifyOnChangeProps?d:u.trackResult(d)}function Hl(e,n){return Yf(e,Df)}function Kf(e,n){const r=ta(),[i]=v.useState(()=>new zf(r,e));v.useEffect(()=>{i.setOptions(e)},[i,e]);const s=v.useSyncExternalStore(v.useCallback(o=>i.subscribe(Ei.batchCalls(o)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),a=v.useCallback((o,l)=>{i.mutate(o,l).catch(li)},[i]);if(s.error&&Rl(i.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:a,mutateAsync:s.mutate}}const Pw=[{value:"grid",label:"Grid"},{value:"list",label:"List"},{value:"horizontal",label:"Horizontal"},{value:"kanban",label:"Kanban"},{value:"graph",label:"Graph"},{value:"graph-condensed",label:"Graph (Condensed)"},{value:"map-graph",label:"Map Graph"}],Aw=[{value:"public",label:"Public"},{value:"private",label:"Private"}],Iw=[{value:"post",label:"Post"},{value:"quest",label:"Quest"},{value:"map",label:"Map"},{value:"log",label:"Log"},{value:"custom",label:"Custom"}],Jr=[{value:"free_speech",label:"Free Speech"},{value:"request",label:"Request"},{value:"quest",label:"Quest"},{value:"task",label:"Quest Task"},{value:"log",label:"Quest Log"},{value:"commit",label:"Commit"},{value:"issue",label:"Issue"},{value:"review",label:"Review"}],Ow=[{value:"draft",label:"Draft"},{value:"submitted",label:"Submitted"},{value:"accepted",label:"Accepted"}],Kt=[{value:"To Do",label:"To Do"},{value:"In Progress",label:"In Progress"},{value:"Blocked",label:"Blocked"},{value:"Done",label:"Done"}],di=[{value:"abstract",label:"Planner"},{value:"file",label:"File"},{value:"folder",label:"Folder"}],Jf=["Leader","Developer","Designer","Writer","Analyst","Caster","Creator","Merchant","Tester","Strategist"],Pi=({value:e,onChange:n})=>{const[r,i]=v.useState(""),[s,a]=v.useState(null),[o,l]=v.useState([]),[u,d]=v.useState([]);v.useEffect(()=>{if(r.trim().length<2){l([]);return}const g=setTimeout(()=>{Xu(r.trim()).then(l).catch(()=>l([]))},300);return()=>clearTimeout(g)},[r]);const h=()=>{const g=r.trim(),m=g?{userId:(s==null?void 0:s.id)??crypto.randomUUID(),username:g,roles:u}:{roles:u};n([...e,m]),i(""),a(null),d([])},f=g=>{const m=e.filter((b,x)=>x!==g);n(m)},p=g=>{d(m=>m.includes(g)?m.filter(b=>b!==g):[...m,g])};return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start sm:items-end",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Collaborator Username"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",value:r,onChange:g=>{i(g.target.value),a(null)},className:"w-full px-3 py-2 border rounded-md text-sm",placeholder:"e.g. alice, bob123"}),o.length>0&&c.jsx("ul",{className:"absolute z-10 mt-1 bg-surface border border-secondary rounded shadow w-full text-sm max-h-40 overflow-y-auto",children:o.map(g=>c.jsxs("li",{className:"px-2 py-1 cursor-pointer hover:bg-background",onClick:()=>{i(g.username),a(g),l([])},children:["@",g.username]},g.id))})]})]}),c.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"Add"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Roles for this collaborator"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:Jf.map(g=>c.jsx("button",{type:"button",onClick:()=>p(g),className:`px-3 py-1 rounded-full border text-sm ${u.includes(g)?"bg-indigo-600 text-white border-indigo-600":"bg-surface text-gray-700 border-gray-300 dark:bg-background dark:text-gray-200 dark:border-gray-600"}`,children:g},g))})]}),e.length>0&&c.jsxs("div",{className:"mt-4",children:[c.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Assigned Collaborators:"}),c.jsx("ul",{className:"space-y-2 text-sm",children:e.map((g,m)=>c.jsxs("li",{className:"flex justify-between items-start bg-background dark:bg-surface p-2 rounded-md border",children:[c.jsxs("div",{children:[c.jsxs("strong",{children:["@",g.username]}),c.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Roles: ",(g.roles||[]).join(", ")||"None"]})]}),c.jsx("button",{type:"button",onClick:()=>f(m),className:"text-red-500 text-xs hover:underline",children:"Remove"})]},m))})]})]})},Ai=({value:e=[],onChange:n,allowCreateNew:r=!0,label:i="Linked Item",currentPostId:s=null,itemTypes:a=["quest"]})=>{const[o,l]=v.useState([]),[u,d]=v.useState([]),[h,f]=v.useState(!0),[p,g]=v.useState(!1),[m,b]=v.useState(""),[x,y]=v.useState(""),[w,N]=v.useState("all"),[k,C]=v.useState("label"),_=[{value:"solution",label:"solution"},{value:"duplicate",label:"duplicate"},{value:"related",label:"related"},{value:"quote",label:"quote"},{value:"reference",label:"reference"},{value:"task_edge",label:"Link to parent / mark as sub-problem"}],j=["active","solved","pending","private"];v.useEffect(()=>{(async()=>{f(!0);const q=[];a.includes("quest")&&q.push(_f()),a.includes("post")&&q.push(of());const D=await Promise.allSettled(q);let F=0;if(a.includes("quest")){const z=D[F++];if(z.status==="fulfilled"){const H=z.value||[];l(H)}}if(a.includes("post")){const z=D[F++];if(z.status==="fulfilled"){const H=z.value||[];d(H)}}f(!1)})()},[a]);const S=M=>{const[q,D]=M.target.value.split(":");if(!e.find(z=>z.itemId===D&&z.itemType===q)){let z="";if(q==="post"){const H=u.find(B=>B.id===D),Y=(H==null?void 0:H.content.trim())||"";z=Y.length<=50?Y:Y.slice(0,50)+"…"}n([...e,{itemId:D,itemType:q,nodeId:"",title:z,linkType:"related",linkStatus:"active",cascadeSolution:!1,notifyOnChange:!1}])}},T=M=>{n(e.filter(q=>q.itemId!==M.itemId||q.itemType!==M.itemType))},P=async()=>{if(!m.trim())return;const M=await Il({title:m,fromPostId:s||void 0}),q={itemId:M.id,itemType:"quest",nodeId:"",linkType:"related",linkStatus:"active",cascadeSolution:!1,notifyOnChange:!1};l(D=>[...D,M]),n([...e,q]),b(""),g(!1)},I=(M,q,D)=>{const F=[...e];F[M]={...F[M],[q]:D},n(F)},L=(M,q)=>{const D=[...e];D[M]={...D[M],[q]:!D[M][q]},n(D)},V=u.filter(M=>w==="all"||M.type===w),O=[...[...a.includes("quest")?o.map(M=>({value:`quest:${M.id}`,label:`🧭 Quest: ${Ll(M.title)}`,nodeId:M.title,type:"quest"})):[],...a.includes("post")?V.map(M=>({value:`post:${M.id}`,label:`${M.content.slice(0,30)} - ${M.nodeId||M.type}`,nodeId:M.nodeId,type:M.type})):[]].filter(M=>M.label.toLowerCase().includes(x.toLowerCase())||(M.nodeId||"").toLowerCase().includes(x.toLowerCase())||M.value.includes(x))].sort((M,q)=>k==="node"?(M.nodeId||"").localeCompare(q.nodeId||""):M.label.localeCompare(q.label));return c.jsx("div",{className:"space-y-2",children:h?c.jsx("div",{className:"flex justify-center py-2",children:c.jsx(St,{})}):c.jsxs(c.Fragment,{children:[a.includes("post")&&c.jsx("div",{className:"flex gap-1 mb-1 flex-wrap",children:["all","request","task","log","commit","issue","meta_system"].map(M=>c.jsx("button",{type:"button",onClick:()=>N(M),className:`text-xs px-2 py-0.5 rounded ${w===M?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 dark:text-gray-200"}`,children:M},M))}),c.jsx("input",{type:"text",value:x,onChange:M=>y(M.target.value),placeholder:"Search items...",className:"border rounded px-2 py-1 text-sm w-full"}),c.jsxs("div",{className:"flex items-center gap-2 my-1",children:[c.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Sort by:"}),c.jsxs("select",{value:k,onChange:M=>C(M.target.value),className:"border rounded px-1 py-0.5 text-xs",children:[c.jsx("option",{value:"label",children:"Title"}),c.jsx("option",{value:"node",children:"Node ID"})]})]}),c.jsx(Ue,{value:"",onChange:S,options:[{value:"",label:`-- Select ${i} --`,disabled:!0},...O]}),r&&a.includes("quest")&&!p&&c.jsx("button",{type:"button",className:"text-blue-600 text-xs underline",onClick:()=>g(!0),children:"+ Create new quest"}),p&&a.includes("quest")&&c.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[c.jsx("input",{type:"text",className:"border rounded px-2 py-1 text-sm",placeholder:"New quest title",value:m,onChange:M=>b(M.target.value)}),c.jsx("button",{type:"button",className:"text-xs bg-indigo-600 text-white px-3 py-1 rounded",onClick:P,children:"Create"})]}),e.map((M,q)=>c.jsxs("div",{className:"p-2 border rounded space-y-1",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("span",{className:"text-sm",children:["🔗 ",M.itemType,": ",M.itemId,M.nodeId&&` (${M.nodeId})`]}),c.jsx("button",{type:"button",onClick:()=>T(M),className:"text-red-500 text-xs underline",children:"Unlink"})]}),c.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[c.jsx("label",{className:"text-gray-600 dark:text-gray-400",children:"Type:"}),c.jsx("select",{value:M.linkType||"related",onChange:D=>I(q,"linkType",D.target.value),className:"border rounded px-1 py-0.5",children:_.map(D=>c.jsx("option",{value:D.value,children:D.label},D.value))}),c.jsx("label",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),c.jsx("select",{value:M.linkStatus||"active",onChange:D=>I(q,"linkStatus",D.target.value),className:"border rounded px-1 py-0.5",children:j.map(D=>c.jsx("option",{value:D,children:D},D))}),c.jsxs("label",{className:"text-gray-600 dark:text-gray-400",children:[c.jsx("input",{type:"checkbox",checked:M.cascadeSolution||!1,onChange:()=>L(q,"cascadeSolution")})," 🔁 Cascade"]}),c.jsxs("label",{className:"text-gray-600 dark:text-gray-400",children:[c.jsx("input",{type:"checkbox",checked:M.notifyOnChange||!1,onChange:()=>L(q,"notifyOnChange")})," 🔔 Notify"]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Header"}),c.jsx("input",{type:"text",className:"border rounded px-1 py-0.5 text-xs w-full",value:M.title||"",onChange:D=>I(q,"title",D.target.value)})]})]},q))]})})},Zf=()=>{const e=ta();return Kf({mutationFn:n=>jf(n),onSuccess:(n,r)=>{e.invalidateQueries({queryKey:["gitStatus",r]})}})},Ii=({questId:e,filePath:n,commitId:r})=>Hl({queryKey:["gitDiff",e,n,r],queryFn:()=>Fl(e,n,r),enabled:!!e&&(!!n||!!r)}),ed=e=>Hl({queryKey:["gitFileTree",e],queryFn:()=>Sf(e),enabled:!!e}),td=({onSave:e,onCancel:n,mode:r="inline",fromPost:i=null,boardId:s})=>{var I;const a=Er(),[o,l]=v.useState(((I=i==null?void 0:i.content)==null?void 0:I.slice(0,80))||""),[u,d]=v.useState(""),[h,f]=v.useState(""),[p,g]=v.useState(""),[m,b]=v.useState([]),[x,y]=v.useState(!1),[w,N]=v.useState(!0),[k,C]=v.useState(s==="quest-board"),_=Zf(),{selectedBoard:j,appendToBoard:S,boards:T}=Tn()||{},P=async L=>{var R;if(L.preventDefault(),x)return;y(!0);const V={title:o.trim(),description:u.trim(),tags:h.split(",").map(A=>A.trim()).filter(Boolean),repoUrl:p.trim()||void 0,collaberatorRoles:m,fromPostId:i==null?void 0:i.id,helpRequest:k||void 0};try{const A=await Il(V);if(p&&w&&await _.mutateAsync(A.id),j){S(j,A);const O=[A.id,...((R=T==null?void 0:T[j])==null?void 0:R.items)||[]];xn(j,{items:O}).catch(M=>console.error("[CreateQuest] Failed to persist board items:",M))}if(T!=null&&T["my-quests"]&&j!=="my-quests"){S("my-quests",A);const O=[A.id,...T["my-quests"].items||[]];xn("my-quests",{items:O}).catch(M=>console.error("[CreateQuest] Failed to update my-quests board:",M))}try{const O=await gs(A.headPostId);if(T!=null&&T["my-posts"]){S("my-posts",O);const M=[O.id,...T["my-posts"].items||[]];xn("my-posts",{items:M}).catch(q=>console.error("[CreateQuest] Failed to update my-posts board:",q))}if(T!=null&&T["timeline-board"]){S("timeline-board",O);const M=[O.id,...T["timeline-board"].items||[]];xn("timeline-board",{items:M}).catch(q=>console.error("[CreateQuest] Failed to update timeline board:",q))}}catch(O){console.error("[CreateQuest] Failed to fetch head post:",O)}e==null||e(A),r==="modal"&&a(`/quest/${A.id}`)}catch(A){console.error("[CreateQuest] Failed to create quest:",A),alert("Failed to create quest. Please try again.")}finally{y(!1)}};return c.jsxs("form",{onSubmit:P,className:"space-y-6",children:[c.jsxs(gt,{title:"Quest Details",children:[c.jsx(De,{htmlFor:"quest-title",children:"Title"}),c.jsx(Nt,{id:"quest-title",value:o,onChange:L=>l(L.target.value),placeholder:"Enter quest title",required:!0}),c.jsx(De,{htmlFor:"quest-description",children:"Description"}),c.jsx(oa,{id:"quest-description",value:u,onChange:L=>d(L.target.value),placeholder:"Describe the goal, challenge, or mission"}),c.jsx(De,{htmlFor:"quest-tags",children:"Tags"}),c.jsx(Nt,{id:"quest-tags",value:h,onChange:L=>f(L.target.value),placeholder:"e.g. bugfix, collab, frontend"}),c.jsx(De,{htmlFor:"repo-link",children:"GitHub Repo (optional)"}),c.jsx(Nt,{id:"repo-link",type:"url",value:p,onChange:L=>g(L.target.value),placeholder:"https://github.com/your/project"}),p&&c.jsxs("label",{className:"inline-flex items-center mt-2 space-x-2",children:[c.jsx("input",{type:"checkbox",checked:w,onChange:L=>N(L.target.checked),className:"form-checkbox"}),c.jsx("span",{children:"Initialize Git sync on create"})]}),(s||j)==="quest-board"&&c.jsxs("label",{className:"inline-flex items-center mt-2 space-x-2",children:[c.jsx("input",{type:"checkbox",checked:k,onChange:L=>C(L.target.checked),className:"form-checkbox"}),c.jsx("span",{children:"Ask for help"})]})]}),c.jsx(gt,{title:"Assign Roles (optional)",children:c.jsx(Pi,{value:m,onChange:b})}),c.jsxs("div",{className:"flex justify-end gap-3",children:[c.jsx($e,{type:"button",variant:"ghost",onClick:n,children:"Cancel"}),c.jsx($e,{type:"submit",variant:"contrast",disabled:x,children:x?"Creating...":"Create Quest"})]})]})},kn=({onSave:e,onCancel:n,replyTo:r=null,repostSource:i=null,initialType:s="free_speech",questId:a,boardId:o,initialGitFilePath:l,initialLinkedNodeId:u,initialContent:d})=>{var H,Y,B,Q;const h=r&&["task","log","commit","issue"].includes(r.type),[f,p]=v.useState(h?"log":s),[g,m]=v.useState("To Do"),[b,x]=v.useState(""),[y,w]=v.useState(d||""),[N,k]=v.useState(""),[C,_]=v.useState([]),[j,S]=v.useState([]),[T,P]=v.useState(!1),[I,L]=v.useState(o==="quest-board"),[V,R]=v.useState(0),{selectedBoard:A,appendToBoard:O,boards:M}=Tn()||{},q=o?(H=M==null?void 0:M[o])==null?void 0:H.boardType:(Y=M==null?void 0:M[A||""])==null?void 0:Y.boardType,D=h?["log"]:o==="quest-board"?["request"]:q==="quest"?["quest","task","log"]:q==="post"?["quest","free_speech","request","review"]:Jr.map(W=>W.value),F=f==="quest",z=async W=>{var de,je;if(W.preventDefault(),T)return;P(!0);const X=o||A,Z=X==null?void 0:X.match(/^(?:log|map)-(.+)$/),te=Z?Z[1]:a||(r==null?void 0:r.questId)||null;if(nd(f)&&!(C.some(le=>le.itemType==="quest")||!!te)){alert("Please link a quest before submitting."),P(!1);return}if(f==="review"&&V===0){alert("Please provide a rating."),P(!1);return}const ne=[...C];te&&!ne.some(se=>se.itemId===te)&&ne.push({itemId:te,itemType:"quest"});const ue={type:f,title:f==="task"?y:b||void 0,content:y,...f==="task"&&N?{details:N}:{},visibility:"public",linkedItems:ne,helpRequest:f==="request"||I||void 0,...f==="task"||f==="issue"?{status:g}:{},...te?{questId:te}:{},...X?{boardId:X}:{},...r?{replyTo:r.id,parentPostId:r.id,linkType:"reply"}:{},...i?{parentPostId:i.id,linkType:"repost",repostedFrom:{originalPostId:i.id,username:(de=i.author)==null?void 0:de.username,originalContent:i.content,originalTimestamp:i.timestamp}}:{},...Qa(f)&&{collaborators:j},...f==="commit"&&l?{gitFilePath:l}:{},...f==="commit"&&u?{linkedNodeId:u}:{},...f==="review"&&V?{rating:V}:{}};try{const se=await Mi(ue);if(X){O(X,se);const le=[se.id,...((je=M==null?void 0:M[X])==null?void 0:je.items)||[]];xn(X,{items:le}).catch(Pe=>console.error("[CreatePost] Failed to persist board items:",Pe))}if(M!=null&&M["my-posts"]&&X!=="my-posts"){O("my-posts",se);const le=[se.id,...M["my-posts"].items||[]];xn("my-posts",{items:le}).catch(Pe=>console.error("[CreatePost] Failed to update my-posts board:",Pe))}if(M!=null&&M["timeline-board"]){O("timeline-board",se);const le=[se.id,...M["timeline-board"].items||[]];xn("timeline-board",{items:le}).catch(Pe=>console.error("[CreatePost] Failed to update timeline board:",Pe))}e==null||e(se)}catch(se){console.error("[CreatePost] Error creating post:",se),alert("Failed to create post. Please try again later.")}finally{P(!1)}};return F?c.jsxs("div",{className:"space-y-6",children:[c.jsxs(gt,{title:"Item Details",children:[c.jsx(De,{htmlFor:"post-type",children:"Item Type"}),c.jsx(Ue,{id:"post-type",value:f,onChange:W=>{const X=W.target.value;p(X),["task","issue"].includes(X)&&m("To Do")},options:D.map(W=>{const X=Jr.find(Z=>Z.value===W);return{value:X.value,label:X.label}})}),(o||A)==="quest-board"&&c.jsxs("label",{className:"inline-flex items-center mt-2 space-x-2",children:[c.jsx("input",{type:"checkbox",checked:I,onChange:W=>L(W.target.checked),className:"form-checkbox"}),c.jsx("span",{children:"Ask for help"})]})]}),c.jsx(td,{onSave:W=>e==null?void 0:e(W),onCancel:n,boardId:o||A||void 0})]}):c.jsxs("form",{onSubmit:z,className:"space-y-6",children:[c.jsxs(gt,{title:"Item Details",children:[c.jsx(De,{htmlFor:"post-type",children:"Item Type"}),c.jsx(Ue,{id:"post-type",value:f,onChange:W=>{const X=W.target.value;p(X),["task","issue"].includes(X)&&m("To Do")},options:D.map(W=>{const X=Jr.find(Z=>Z.value===W);return{value:X.value,label:X.label}})}),["task","issue"].includes(f)&&c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"task-status",children:"Status"}),c.jsx(Ue,{id:"task-status",value:g,onChange:W=>m(W.target.value),options:Kt.map(({value:W,label:X})=>({value:W,label:X}))})]}),f!=="task"&&c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"title",children:"Title"}),c.jsx(Nt,{id:"title",value:b,onChange:W=>x(W.target.value),required:f!=="free_speech"}),f==="review"&&c.jsxs("div",{className:"mt-2",children:[c.jsx(De,{children:"Rating"}),c.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(W=>{const X=V>=W,Z=!X&&V>=W-.5;return c.jsx("button",{type:"button",onClick:te=>{const ne=te.currentTarget.getBoundingClientRect(),ue=te.clientX-ne.left<ne.width/2;R(ue?W-.5:W)},className:"text-xl focus:outline-none text-yellow-400",children:X?c.jsx(ea,{}):Z?c.jsx(El,{}):c.jsx(Ml,{})},W)})})]})]}),f==="task"?c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"content",children:"Task Title"}),c.jsx(Nt,{id:"content",value:y,onChange:W=>w(W.target.value),placeholder:"Short task summary",required:!0}),c.jsx(De,{htmlFor:"details",children:"Details"}),c.jsx(fi,{id:"details",value:N,onChange:k,placeholder:"Additional information (optional)"})]}):c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"content",children:"Description"}),c.jsx(fi,{id:"content",value:y,onChange:w,placeholder:r?"Reply to this post...":i?"Add a comment to your repost...":"Share your thoughts or progress..."})]}),(o||A)==="quest-board"&&c.jsxs("label",{className:"inline-flex items-center mt-2 space-x-2",children:[c.jsx("input",{type:"checkbox",checked:I,onChange:W=>L(W.target.checked),className:"form-checkbox"}),c.jsx("span",{children:"Ask for help"})]})]}),rd(f)&&!r&&c.jsx(gt,{title:"Linked Items",children:c.jsx(Ai,{label:"Item",value:C,onChange:_,allowCreateNew:!0,allowNodeSelection:!0,itemTypes:["quest","post"]})}),Qa(f)&&!r&&c.jsx(gt,{title:"Collaborators",children:c.jsx(Pi,{value:j,onChange:S})}),i&&c.jsx(gt,{title:"Repost Info",children:c.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Reposting from ",c.jsxs("strong",{children:["@",((B=i.author)==null?void 0:B.username)||"anonymous"]})]})}),r&&c.jsx(gt,{title:"Replying To",children:c.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Replying to ",c.jsx("strong",{children:((Q=r.content)==null?void 0:Q.slice(0,80))||r.id})]})}),c.jsxs("div",{className:"flex justify-end gap-3",children:[c.jsx($e,{type:"button",variant:"ghost",onClick:n,children:"Cancel"}),c.jsx($e,{type:"submit",variant:"contrast",disabled:T,children:T?"Posting...":"Create Post"})]})]})};function nd(e){return["log","task"].includes(e)}function Qa(e){return["log","task"].includes(e)}function rd(e){return["request","quest","task","log","commit","issue","meta_system"].includes(e)}const $r=43200,Xa=1440,Ya=Symbol.for("constructDateFrom");function ca(e,n){return typeof e=="function"?e(n):e&&typeof e=="object"&&Ya in e?e[Ya](n):e instanceof Date?new e.constructor(n):new Date(n)}function dn(e,n){return ca(e,e)}let id={};function sd(){return id}function Ka(e){const n=dn(e),r=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return r.setUTCFullYear(n.getFullYear()),+e-+r}function ua(e,...n){const r=ca.bind(null,e||n.find(i=>typeof i=="object"));return n.map(r)}function Zr(e,n){const r=+dn(e)-+dn(n);return r<0?-1:r>0?1:r}function ad(e){return ca(e,Date.now())}function od(e,n,r){const[i,s]=ua(r==null?void 0:r.in,e,n),a=i.getFullYear()-s.getFullYear(),o=i.getMonth()-s.getMonth();return a*12+o}function ld(e){return n=>{const i=(e?Math[e]:Math.trunc)(n);return i===0?0:i}}function cd(e,n){return+dn(e)-+dn(n)}function ud(e,n){const r=dn(e);return r.setHours(23,59,59,999),r}function fd(e,n){const r=dn(e),i=r.getMonth();return r.setFullYear(r.getFullYear(),i+1,0),r.setHours(23,59,59,999),r}function dd(e,n){const r=dn(e);return+ud(r)==+fd(r)}function hd(e,n,r){const[i,s,a]=ua(r==null?void 0:r.in,e,e,n),o=Zr(s,a),l=Math.abs(od(s,a));if(l<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-o*l);let u=Zr(s,a)===-o;dd(i)&&l===1&&Zr(i,a)===1&&(u=!1);const d=o*(l-+u);return d===0?0:d}function pd(e,n,r){const i=cd(e,n)/1e3;return ld(r==null?void 0:r.roundingMethod)(i)}const gd={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},md=(e,n,r)=>{let i;const s=gd[e];return typeof s=="string"?i=s:n===1?i=s.one:i=s.other.replace("{{count}}",n.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i};function Xi(e){return(n={})=>{const r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const yd={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xd={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},vd={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},bd={date:Xi({formats:yd,defaultWidth:"full"}),time:Xi({formats:xd,defaultWidth:"full"}),dateTime:Xi({formats:vd,defaultWidth:"full"})},wd={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},_d=(e,n,r,i)=>wd[e];function Xn(e){return(n,r)=>{const i=r!=null&&r.context?String(r.context):"standalone";let s;if(i==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,l=r!=null&&r.width?String(r.width):o;s=e.formattingValues[l]||e.formattingValues[o]}else{const o=e.defaultWidth,l=r!=null&&r.width?String(r.width):e.defaultWidth;s=e.values[l]||e.values[o]}const a=e.argumentCallback?e.argumentCallback(n):n;return s[a]}}const kd={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Cd={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},jd={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Sd={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Nd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Td={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Rd=(e,n)=>{const r=Number(e),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Ed={ordinalNumber:Rd,era:Xn({values:kd,defaultWidth:"wide"}),quarter:Xn({values:Cd,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Xn({values:jd,defaultWidth:"wide"}),day:Xn({values:Sd,defaultWidth:"wide"}),dayPeriod:Xn({values:Nd,defaultWidth:"wide",formattingValues:Td,defaultFormattingWidth:"wide"})};function Yn(e){return(n,r={})=>{const i=r.width,s=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],a=n.match(s);if(!a)return null;const o=a[0],l=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],u=Array.isArray(l)?Pd(l,f=>f.test(o)):Md(l,f=>f.test(o));let d;d=e.valueCallback?e.valueCallback(u):u,d=r.valueCallback?r.valueCallback(d):d;const h=n.slice(o.length);return{value:d,rest:h}}}function Md(e,n){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n(e[r]))return r}function Pd(e,n){for(let r=0;r<e.length;r++)if(n(e[r]))return r}function Ad(e){return(n,r={})=>{const i=n.match(e.matchPattern);if(!i)return null;const s=i[0],a=n.match(e.parsePattern);if(!a)return null;let o=e.valueCallback?e.valueCallback(a[0]):a[0];o=r.valueCallback?r.valueCallback(o):o;const l=n.slice(s.length);return{value:o,rest:l}}}const Id=/^(\d+)(th|st|nd|rd)?/i,Od=/\d+/i,Dd={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Fd={any:[/^b/i,/^(a|c)/i]},Ld={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zd={any:[/1/i,/2/i,/3/i,/4/i]},$d={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},qd={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Hd={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Bd={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Wd={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ud={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Vd={ordinalNumber:Ad({matchPattern:Id,parsePattern:Od,valueCallback:e=>parseInt(e,10)}),era:Yn({matchPatterns:Dd,defaultMatchWidth:"wide",parsePatterns:Fd,defaultParseWidth:"any"}),quarter:Yn({matchPatterns:Ld,defaultMatchWidth:"wide",parsePatterns:zd,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Yn({matchPatterns:$d,defaultMatchWidth:"wide",parsePatterns:qd,defaultParseWidth:"any"}),day:Yn({matchPatterns:Hd,defaultMatchWidth:"wide",parsePatterns:Bd,defaultParseWidth:"any"}),dayPeriod:Yn({matchPatterns:Wd,defaultMatchWidth:"any",parsePatterns:Ud,defaultParseWidth:"any"})},Gd={code:"en-US",formatDistance:md,formatLong:bd,formatRelative:_d,localize:Ed,match:Vd,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Qd(e,n,r){const i=sd(),s=(r==null?void 0:r.locale)??i.locale??Gd,a=2520,o=Zr(e,n);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:o}),[u,d]=ua(r==null?void 0:r.in,...o>0?[n,e]:[e,n]),h=pd(d,u),f=(Ka(d)-Ka(u))/1e3,p=Math.round((h-f)/60);let g;if(p<2)return r!=null&&r.includeSeconds?h<5?s.formatDistance("lessThanXSeconds",5,l):h<10?s.formatDistance("lessThanXSeconds",10,l):h<20?s.formatDistance("lessThanXSeconds",20,l):h<40?s.formatDistance("halfAMinute",0,l):h<60?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",1,l):p===0?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",p,l);if(p<45)return s.formatDistance("xMinutes",p,l);if(p<90)return s.formatDistance("aboutXHours",1,l);if(p<Xa){const m=Math.round(p/60);return s.formatDistance("aboutXHours",m,l)}else{if(p<a)return s.formatDistance("xDays",1,l);if(p<$r){const m=Math.round(p/Xa);return s.formatDistance("xDays",m,l)}else if(p<$r*2)return g=Math.round(p/$r),s.formatDistance("aboutXMonths",g,l)}if(g=hd(d,u),g<12){const m=Math.round(p/$r);return s.formatDistance("xMonths",m,l)}else{const m=g%12,b=Math.trunc(g/12);return m<3?s.formatDistance("aboutXYears",b,l):m<9?s.formatDistance("overXYears",b,l):s.formatDistance("almostXYears",b+1,l)}}function Bl(e,n){return Qd(e,ad(e),n)}function Xd(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function Yd(e,n,r){return n=ih(n),n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function Ja(e,n){return Zd(e)||Xd(e,n)||Wl(e,n)||nh()}function Kd(e){return Jd(e)||eh(e)||Wl(e)||th()}function Jd(e){if(Array.isArray(e))return Ts(e)}function Zd(e){if(Array.isArray(e))return e}function eh(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wl(e,n){if(e){if(typeof e=="string")return Ts(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ts(e,n)}}function Ts(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function th(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rh(e,n){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function ih(e){var n=rh(e,"string");return typeof n=="symbol"?n:String(n)}var sh=function(n,r){var i=new Set(r);return Object.assign.apply(Object,[{}].concat(Kd(Object.entries(n).filter(function(s){var a=Ja(s,1),o=a[0];return!i.has(o)}).map(function(s){var a=Ja(s,2),o=a[0],l=a[1];return Yd({},o,l)}))))};function Rs(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function ah(e){if(Array.isArray(e))return e}function oh(e){if(Array.isArray(e))return Rs(e)}function lh(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ch(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n!==0)for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function uh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fh(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dh(e,n){return ah(e)||ch(e,n)||Ul(e,n)||uh()}function Za(e){return oh(e)||lh(e)||Ul(e)||fh()}function Ul(e,n){if(e){if(typeof e=="string")return Rs(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rs(e,n):void 0}}function hh(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.wrapperElementType,i=r===void 0?"div":r,s=n.nodeMapper,a=s===void 0?function(h){return h}:s,o=n.methodNames,l=o===void 0?[]:o,u=n.initPropNames,d=u===void 0?[]:u;return v.forwardRef(function(h,f){var p=v.useRef(),g=v.useMemo(function(){var x=Object.fromEntries(d.filter(function(y){return h.hasOwnProperty(y)}).map(function(y){return[y,h[y]]}));return e(x)},[]);eo(function(){g(a(p.current))},v.useLayoutEffect),eo(function(){return g._destructor instanceof Function?g._destructor:void 0});var m=v.useCallback(function(x){for(var y=arguments.length,w=new Array(y>1?y-1:0),N=1;N<y;N++)w[N-1]=arguments[N];return g[x]instanceof Function?g[x].apply(g,w):void 0},[g]),b=v.useRef({});return Object.keys(sh(h,[].concat(Za(l),Za(d)))).filter(function(x){return b.current[x]!==h[x]}).forEach(function(x){return m(x,h[x])}),b.current=h,v.useImperativeHandle(f,function(){return Object.fromEntries(l.map(function(x){return[x,function(){for(var y=arguments.length,w=new Array(y),N=0;N<y;N++)w[N]=arguments[N];return m.apply(void 0,[x].concat(w))}]}))},[m]),Xe.createElement(i,{ref:p})})}function eo(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v.useEffect,r=v.useRef(),i=v.useRef(!1),s=v.useRef(!1),a=v.useState(0),o=dh(a,2);o[0];var l=o[1];i.current&&(s.current=!0),n(function(){return i.current||(r.current=e(),i.current=!0),l(function(u){return u+1}),function(){s.current&&r.current&&r.current()}},[])}var Es="http://www.w3.org/1999/xhtml";const to={svg:"http://www.w3.org/2000/svg",xhtml:Es,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Oi(e){var n=e+="",r=n.indexOf(":");return r>=0&&(n=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),to.hasOwnProperty(n)?{space:to[n],local:e}:e}function ph(e){return function(){var n=this.ownerDocument,r=this.namespaceURI;return r===Es&&n.documentElement.namespaceURI===Es?n.createElement(e):n.createElementNS(r,e)}}function gh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Vl(e){var n=Oi(e);return(n.local?gh:ph)(n)}function mh(){}function fa(e){return e==null?mh:function(){return this.querySelector(e)}}function yh(e){typeof e!="function"&&(e=fa(e));for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s)for(var a=n[s],o=a.length,l=i[s]=new Array(o),u,d,h=0;h<o;++h)(u=a[h])&&(d=e.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new ct(i,this._parents)}function xh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function vh(){return[]}function Gl(e){return e==null?vh:function(){return this.querySelectorAll(e)}}function bh(e){return function(){return xh(e.apply(this,arguments))}}function wh(e){typeof e=="function"?e=bh(e):e=Gl(e);for(var n=this._groups,r=n.length,i=[],s=[],a=0;a<r;++a)for(var o=n[a],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(i.push(e.call(u,u.__data__,d,o)),s.push(u));return new ct(i,s)}function Ql(e){return function(){return this.matches(e)}}function Xl(e){return function(n){return n.matches(e)}}var _h=Array.prototype.find;function kh(e){return function(){return _h.call(this.children,e)}}function Ch(){return this.firstElementChild}function jh(e){return this.select(e==null?Ch:kh(typeof e=="function"?e:Xl(e)))}var Sh=Array.prototype.filter;function Nh(){return Array.from(this.children)}function Th(e){return function(){return Sh.call(this.children,e)}}function Rh(e){return this.selectAll(e==null?Nh:Th(typeof e=="function"?e:Xl(e)))}function Eh(e){typeof e!="function"&&(e=Ql(e));for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s)for(var a=n[s],o=a.length,l=i[s]=[],u,d=0;d<o;++d)(u=a[d])&&e.call(u,u.__data__,d,a)&&l.push(u);return new ct(i,this._parents)}function Yl(e){return new Array(e.length)}function Mh(){return new ct(this._enter||this._groups.map(Yl),this._parents)}function hi(e,n){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=n}hi.prototype={constructor:hi,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,n){return this._parent.insertBefore(e,n)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ph(e){return function(){return e}}function Ah(e,n,r,i,s,a){for(var o=0,l,u=n.length,d=a.length;o<d;++o)(l=n[o])?(l.__data__=a[o],i[o]=l):r[o]=new hi(e,a[o]);for(;o<u;++o)(l=n[o])&&(s[o]=l)}function Ih(e,n,r,i,s,a,o){var l,u,d=new Map,h=n.length,f=a.length,p=new Array(h),g;for(l=0;l<h;++l)(u=n[l])&&(p[l]=g=o.call(u,u.__data__,l,n)+"",d.has(g)?s[l]=u:d.set(g,u));for(l=0;l<f;++l)g=o.call(e,a[l],l,a)+"",(u=d.get(g))?(i[l]=u,u.__data__=a[l],d.delete(g)):r[l]=new hi(e,a[l]);for(l=0;l<h;++l)(u=n[l])&&d.get(p[l])===u&&(s[l]=u)}function Oh(e){return e.__data__}function Dh(e,n){if(!arguments.length)return Array.from(this,Oh);var r=n?Ih:Ah,i=this._parents,s=this._groups;typeof e!="function"&&(e=Ph(e));for(var a=s.length,o=new Array(a),l=new Array(a),u=new Array(a),d=0;d<a;++d){var h=i[d],f=s[d],p=f.length,g=Fh(e.call(h,h&&h.__data__,d,i)),m=g.length,b=l[d]=new Array(m),x=o[d]=new Array(m),y=u[d]=new Array(p);r(h,f,b,x,y,g,n);for(var w=0,N=0,k,C;w<m;++w)if(k=b[w]){for(w>=N&&(N=w+1);!(C=x[N])&&++N<m;);k._next=C||null}}return o=new ct(o,i),o._enter=l,o._exit=u,o}function Fh(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Lh(){return new ct(this._exit||this._groups.map(Yl),this._parents)}function zh(e,n,r){var i=this.enter(),s=this,a=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),n!=null&&(s=n(s),s&&(s=s.selection())),r==null?a.remove():r(a),i&&s?i.merge(s).order():s}function $h(e){for(var n=e.selection?e.selection():e,r=this._groups,i=n._groups,s=r.length,a=i.length,o=Math.min(s,a),l=new Array(s),u=0;u<o;++u)for(var d=r[u],h=i[u],f=d.length,p=l[u]=new Array(f),g,m=0;m<f;++m)(g=d[m]||h[m])&&(p[m]=g);for(;u<s;++u)l[u]=r[u];return new ct(l,this._parents)}function qh(){for(var e=this._groups,n=-1,r=e.length;++n<r;)for(var i=e[n],s=i.length-1,a=i[s],o;--s>=0;)(o=i[s])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function Hh(e){e||(e=Bh);function n(f,p){return f&&p?e(f.__data__,p.__data__):!f-!p}for(var r=this._groups,i=r.length,s=new Array(i),a=0;a<i;++a){for(var o=r[a],l=o.length,u=s[a]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(n)}return new ct(s,this._parents).order()}function Bh(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function Wh(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Uh(){return Array.from(this)}function Vh(){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,a=i.length;s<a;++s){var o=i[s];if(o)return o}return null}function Gh(){let e=0;for(const n of this)++e;return e}function Qh(){return!this.node()}function Xh(e){for(var n=this._groups,r=0,i=n.length;r<i;++r)for(var s=n[r],a=0,o=s.length,l;a<o;++a)(l=s[a])&&e.call(l,l.__data__,a,s);return this}function Yh(e){return function(){this.removeAttribute(e)}}function Kh(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Jh(e,n){return function(){this.setAttribute(e,n)}}function Zh(e,n){return function(){this.setAttributeNS(e.space,e.local,n)}}function ep(e,n){return function(){var r=n.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function tp(e,n){return function(){var r=n.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function np(e,n){var r=Oi(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((n==null?r.local?Kh:Yh:typeof n=="function"?r.local?tp:ep:r.local?Zh:Jh)(r,n))}function Kl(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function rp(e){return function(){this.style.removeProperty(e)}}function ip(e,n,r){return function(){this.style.setProperty(e,n,r)}}function sp(e,n,r){return function(){var i=n.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function ap(e,n,r){return arguments.length>1?this.each((n==null?rp:typeof n=="function"?sp:ip)(e,n,r??"")):qn(this.node(),e)}function qn(e,n){return e.style.getPropertyValue(n)||Kl(e).getComputedStyle(e,null).getPropertyValue(n)}function op(e){return function(){delete this[e]}}function lp(e,n){return function(){this[e]=n}}function cp(e,n){return function(){var r=n.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function up(e,n){return arguments.length>1?this.each((n==null?op:typeof n=="function"?cp:lp)(e,n)):this.node()[e]}function Jl(e){return e.trim().split(/^|\s+/)}function da(e){return e.classList||new Zl(e)}function Zl(e){this._node=e,this._names=Jl(e.getAttribute("class")||"")}Zl.prototype={add:function(e){var n=this._names.indexOf(e);n<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var n=this._names.indexOf(e);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function ec(e,n){for(var r=da(e),i=-1,s=n.length;++i<s;)r.add(n[i])}function tc(e,n){for(var r=da(e),i=-1,s=n.length;++i<s;)r.remove(n[i])}function fp(e){return function(){ec(this,e)}}function dp(e){return function(){tc(this,e)}}function hp(e,n){return function(){(n.apply(this,arguments)?ec:tc)(this,e)}}function pp(e,n){var r=Jl(e+"");if(arguments.length<2){for(var i=da(this.node()),s=-1,a=r.length;++s<a;)if(!i.contains(r[s]))return!1;return!0}return this.each((typeof n=="function"?hp:n?fp:dp)(r,n))}function gp(){this.textContent=""}function mp(e){return function(){this.textContent=e}}function yp(e){return function(){var n=e.apply(this,arguments);this.textContent=n??""}}function xp(e){return arguments.length?this.each(e==null?gp:(typeof e=="function"?yp:mp)(e)):this.node().textContent}function vp(){this.innerHTML=""}function bp(e){return function(){this.innerHTML=e}}function wp(e){return function(){var n=e.apply(this,arguments);this.innerHTML=n??""}}function _p(e){return arguments.length?this.each(e==null?vp:(typeof e=="function"?wp:bp)(e)):this.node().innerHTML}function kp(){this.nextSibling&&this.parentNode.appendChild(this)}function Cp(){return this.each(kp)}function jp(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Sp(){return this.each(jp)}function Np(e){var n=typeof e=="function"?e:Vl(e);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function Tp(){return null}function Rp(e,n){var r=typeof e=="function"?e:Vl(e),i=n==null?Tp:typeof n=="function"?n:fa(n);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function Ep(){var e=this.parentNode;e&&e.removeChild(this)}function Mp(){return this.each(Ep)}function Pp(){var e=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function Ap(){var e=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function Ip(e){return this.select(e?Ap:Pp)}function Op(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Dp(e){return function(n){e.call(this,n,this.__data__)}}function Fp(e){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");return i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),{type:n,name:r}})}function Lp(e){return function(){var n=this.__on;if(n){for(var r=0,i=-1,s=n.length,a;r<s;++r)a=n[r],(!e.type||a.type===e.type)&&a.name===e.name?this.removeEventListener(a.type,a.listener,a.options):n[++i]=a;++i?n.length=i:delete this.__on}}}function zp(e,n,r){return function(){var i=this.__on,s,a=Dp(n);if(i){for(var o=0,l=i.length;o<l;++o)if((s=i[o]).type===e.type&&s.name===e.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=r),s.value=n;return}}this.addEventListener(e.type,a,r),s={type:e.type,name:e.name,value:n,listener:a,options:r},i?i.push(s):this.__on=[s]}}function $p(e,n,r){var i=Fp(e+""),s,a=i.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(s=0,h=l[u];s<a;++s)if((o=i[s]).type===h.type&&o.name===h.name)return h.value}return}for(l=n?zp:Lp,s=0;s<a;++s)this.each(l(i[s],n,r));return this}function nc(e,n,r){var i=Kl(e),s=i.CustomEvent;typeof s=="function"?s=new s(n,r):(s=i.document.createEvent("Event"),r?(s.initEvent(n,r.bubbles,r.cancelable),s.detail=r.detail):s.initEvent(n,!1,!1)),e.dispatchEvent(s)}function qp(e,n){return function(){return nc(this,e,n)}}function Hp(e,n){return function(){return nc(this,e,n.apply(this,arguments))}}function Bp(e,n){return this.each((typeof n=="function"?Hp:qp)(e,n))}function*Wp(){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,a=i.length,o;s<a;++s)(o=i[s])&&(yield o)}var rc=[null];function ct(e,n){this._groups=e,this._parents=n}function Ar(){return new ct([[document.documentElement]],rc)}function Up(){return this}ct.prototype=Ar.prototype={constructor:ct,select:yh,selectAll:wh,selectChild:jh,selectChildren:Rh,filter:Eh,data:Dh,enter:Mh,exit:Lh,join:zh,merge:$h,selection:Up,order:qh,sort:Hh,call:Wh,nodes:Uh,node:Vh,size:Gh,empty:Qh,each:Xh,attr:np,style:ap,property:up,classed:pp,text:xp,html:_p,raise:Cp,lower:Sp,append:Np,insert:Rp,remove:Mp,clone:Ip,datum:Op,on:$p,dispatch:Bp,[Symbol.iterator]:Wp};function mt(e){return typeof e=="string"?new ct([[document.querySelector(e)]],[document.documentElement]):new ct([[e]],rc)}function Vp(e){let n;for(;n=e.sourceEvent;)e=n;return e}function At(e,n){if(e=Vp(e),n===void 0&&(n=e.currentTarget),n){var r=n.ownerSVGElement||n;if(r.createSVGPoint){var i=r.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,i=i.matrixTransform(n.getScreenCTM().inverse()),[i.x,i.y]}if(n.getBoundingClientRect){var s=n.getBoundingClientRect();return[e.clientX-s.left-n.clientLeft,e.clientY-s.top-n.clientTop]}}return[e.pageX,e.pageY]}var Gp={value:()=>{}};function Ir(){for(var e=0,n=arguments.length,r={},i;e<n;++e){if(!(i=arguments[e]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new ei(r)}function ei(e){this._=e}function Qp(e,n){return e.trim().split(/^|\s+/).map(function(r){var i="",s=r.indexOf(".");if(s>=0&&(i=r.slice(s+1),r=r.slice(0,s)),r&&!n.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}ei.prototype=Ir.prototype={constructor:ei,on:function(e,n){var r=this._,i=Qp(e+"",r),s,a=-1,o=i.length;if(arguments.length<2){for(;++a<o;)if((s=(e=i[a]).type)&&(s=Xp(r[s],e.name)))return s;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++a<o;)if(s=(e=i[a]).type)r[s]=no(r[s],e.name,n);else if(n==null)for(s in r)r[s]=no(r[s],e.name,null);return this},copy:function(){var e={},n=this._;for(var r in n)e[r]=n[r].slice();return new ei(e)},call:function(e,n){if((s=arguments.length-2)>0)for(var r=new Array(s),i=0,s,a;i<s;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],i=0,s=a.length;i<s;++i)a[i].value.apply(n,r)},apply:function(e,n,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],s=0,a=i.length;s<a;++s)i[s].value.apply(n,r)}};function Xp(e,n){for(var r=0,i=e.length,s;r<i;++r)if((s=e[r]).name===n)return s.value}function no(e,n,r){for(var i=0,s=e.length;i<s;++i)if(e[i].name===n){e[i]=Gp,e=e.slice(0,i).concat(e.slice(i+1));break}return r!=null&&e.push({name:n,value:r}),e}const Yp={passive:!1},vr={capture:!0,passive:!1};function Yi(e){e.stopImmediatePropagation()}function In(e){e.preventDefault(),e.stopImmediatePropagation()}function ic(e){var n=e.document.documentElement,r=mt(e).on("dragstart.drag",In,vr);"onselectstart"in n?r.on("selectstart.drag",In,vr):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function sc(e,n){var r=e.document.documentElement,i=mt(e).on("dragstart.drag",null);n&&(i.on("click.drag",In,vr),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in r?i.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}const qr=e=>()=>e;function Ms(e,{sourceEvent:n,subject:r,target:i,identifier:s,active:a,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}Ms.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Kp(e){return!e.ctrlKey&&!e.button}function Jp(){return this.parentNode}function Zp(e,n){return n??{x:e.x,y:e.y}}function eg(){return navigator.maxTouchPoints||"ontouchstart"in this}function tg(){var e=Kp,n=Jp,r=Zp,i=eg,s={},a=Ir("start","drag","end"),o=0,l,u,d,h,f=0;function p(k){k.on("mousedown.drag",g).filter(i).on("touchstart.drag",x).on("touchmove.drag",y,Yp).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(k,C){if(!(h||!e.call(this,k,C))){var _=N(this,n.call(this,k,C),k,C,"mouse");_&&(mt(k.view).on("mousemove.drag",m,vr).on("mouseup.drag",b,vr),ic(k.view),Yi(k),d=!1,l=k.clientX,u=k.clientY,_("start",k))}}function m(k){if(In(k),!d){var C=k.clientX-l,_=k.clientY-u;d=C*C+_*_>f}s.mouse("drag",k)}function b(k){mt(k.view).on("mousemove.drag mouseup.drag",null),sc(k.view,d),In(k),s.mouse("end",k)}function x(k,C){if(e.call(this,k,C)){var _=k.changedTouches,j=n.call(this,k,C),S=_.length,T,P;for(T=0;T<S;++T)(P=N(this,j,k,C,_[T].identifier,_[T]))&&(Yi(k),P("start",k,_[T]))}}function y(k){var C=k.changedTouches,_=C.length,j,S;for(j=0;j<_;++j)(S=s[C[j].identifier])&&(In(k),S("drag",k,C[j]))}function w(k){var C=k.changedTouches,_=C.length,j,S;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),j=0;j<_;++j)(S=s[C[j].identifier])&&(Yi(k),S("end",k,C[j]))}function N(k,C,_,j,S,T){var P=a.copy(),I=At(T||_,C),L,V,R;if((R=r.call(k,new Ms("beforestart",{sourceEvent:_,target:p,identifier:S,active:o,x:I[0],y:I[1],dx:0,dy:0,dispatch:P}),j))!=null)return L=R.x-I[0]||0,V=R.y-I[1]||0,function A(O,M,q){var D=I,F;switch(O){case"start":s[S]=A,F=o++;break;case"end":delete s[S],--o;case"drag":I=At(q||M,C),F=o;break}P.call(O,k,new Ms(O,{sourceEvent:M,subject:R,target:p,identifier:S,active:F,x:I[0]+L,y:I[1]+V,dx:I[0]-D[0],dy:I[1]-D[1],dispatch:P}),j)}}return p.filter=function(k){return arguments.length?(e=typeof k=="function"?k:qr(!!k),p):e},p.container=function(k){return arguments.length?(n=typeof k=="function"?k:qr(k),p):n},p.subject=function(k){return arguments.length?(r=typeof k=="function"?k:qr(k),p):r},p.touchable=function(k){return arguments.length?(i=typeof k=="function"?k:qr(!!k),p):i},p.on=function(){var k=a.on.apply(a,arguments);return k===a?p:k},p.clickDistance=function(k){return arguments.length?(f=(k=+k)*k,p):Math.sqrt(f)},p}function ha(e,n,r){e.prototype=n.prototype=r,r.constructor=e}function ac(e,n){var r=Object.create(e.prototype);for(var i in n)r[i]=n[i];return r}function Or(){}var br=.7,pi=1/br,On="\\s*([+-]?\\d+)\\s*",wr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ng=/^#([0-9a-f]{3,8})$/,rg=new RegExp(`^rgb\\(${On},${On},${On}\\)$`),ig=new RegExp(`^rgb\\(${Ot},${Ot},${Ot}\\)$`),sg=new RegExp(`^rgba\\(${On},${On},${On},${wr}\\)$`),ag=new RegExp(`^rgba\\(${Ot},${Ot},${Ot},${wr}\\)$`),og=new RegExp(`^hsl\\(${wr},${Ot},${Ot}\\)$`),lg=new RegExp(`^hsla\\(${wr},${Ot},${Ot},${wr}\\)$`),ro={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ha(Or,_r,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:io,formatHex:io,formatHex8:cg,formatHsl:ug,formatRgb:so,toString:so});function io(){return this.rgb().formatHex()}function cg(){return this.rgb().formatHex8()}function ug(){return oc(this).formatHsl()}function so(){return this.rgb().formatRgb()}function _r(e){var n,r;return e=(e+"").trim().toLowerCase(),(n=ng.exec(e))?(r=n[1].length,n=parseInt(n[1],16),r===6?ao(n):r===3?new rt(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):r===8?Hr(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):r===4?Hr(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=rg.exec(e))?new rt(n[1],n[2],n[3],1):(n=ig.exec(e))?new rt(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=sg.exec(e))?Hr(n[1],n[2],n[3],n[4]):(n=ag.exec(e))?Hr(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=og.exec(e))?co(n[1],n[2]/100,n[3]/100,1):(n=lg.exec(e))?co(n[1],n[2]/100,n[3]/100,n[4]):ro.hasOwnProperty(e)?ao(ro[e]):e==="transparent"?new rt(NaN,NaN,NaN,0):null}function ao(e){return new rt(e>>16&255,e>>8&255,e&255,1)}function Hr(e,n,r,i){return i<=0&&(e=n=r=NaN),new rt(e,n,r,i)}function fg(e){return e instanceof Or||(e=_r(e)),e?(e=e.rgb(),new rt(e.r,e.g,e.b,e.opacity)):new rt}function Ps(e,n,r,i){return arguments.length===1?fg(e):new rt(e,n,r,i??1)}function rt(e,n,r,i){this.r=+e,this.g=+n,this.b=+r,this.opacity=+i}ha(rt,Ps,ac(Or,{brighter(e){return e=e==null?pi:Math.pow(pi,e),new rt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?br:Math.pow(br,e),new rt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new rt(Cn(this.r),Cn(this.g),Cn(this.b),gi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:oo,formatHex:oo,formatHex8:dg,formatRgb:lo,toString:lo}));function oo(){return`#${vn(this.r)}${vn(this.g)}${vn(this.b)}`}function dg(){return`#${vn(this.r)}${vn(this.g)}${vn(this.b)}${vn((isNaN(this.opacity)?1:this.opacity)*255)}`}function lo(){const e=gi(this.opacity);return`${e===1?"rgb(":"rgba("}${Cn(this.r)}, ${Cn(this.g)}, ${Cn(this.b)}${e===1?")":`, ${e})`}`}function gi(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Cn(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function vn(e){return e=Cn(e),(e<16?"0":"")+e.toString(16)}function co(e,n,r,i){return i<=0?e=n=r=NaN:r<=0||r>=1?e=n=NaN:n<=0&&(e=NaN),new Ct(e,n,r,i)}function oc(e){if(e instanceof Ct)return new Ct(e.h,e.s,e.l,e.opacity);if(e instanceof Or||(e=_r(e)),!e)return new Ct;if(e instanceof Ct)return e;e=e.rgb();var n=e.r/255,r=e.g/255,i=e.b/255,s=Math.min(n,r,i),a=Math.max(n,r,i),o=NaN,l=a-s,u=(a+s)/2;return l?(n===a?o=(r-i)/l+(r<i)*6:r===a?o=(i-n)/l+2:o=(n-r)/l+4,l/=u<.5?a+s:2-a-s,o*=60):l=u>0&&u<1?0:o,new Ct(o,l,u,e.opacity)}function hg(e,n,r,i){return arguments.length===1?oc(e):new Ct(e,n,r,i??1)}function Ct(e,n,r,i){this.h=+e,this.s=+n,this.l=+r,this.opacity=+i}ha(Ct,hg,ac(Or,{brighter(e){return e=e==null?pi:Math.pow(pi,e),new Ct(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?br:Math.pow(br,e),new Ct(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*n,s=2*r-i;return new rt(Ki(e>=240?e-240:e+120,s,i),Ki(e,s,i),Ki(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new Ct(uo(this.h),Br(this.s),Br(this.l),gi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=gi(this.opacity);return`${e===1?"hsl(":"hsla("}${uo(this.h)}, ${Br(this.s)*100}%, ${Br(this.l)*100}%${e===1?")":`, ${e})`}`}}));function uo(e){return e=(e||0)%360,e<0?e+360:e}function Br(e){return Math.max(0,Math.min(1,e||0))}function Ki(e,n,r){return(e<60?n+(r-n)*e/60:e<180?r:e<240?n+(r-n)*(240-e)/60:n)*255}const lc=e=>()=>e;function pg(e,n){return function(r){return e+r*n}}function gg(e,n,r){return e=Math.pow(e,r),n=Math.pow(n,r)-e,r=1/r,function(i){return Math.pow(e+i*n,r)}}function mg(e){return(e=+e)==1?cc:function(n,r){return r-n?gg(n,r,e):lc(isNaN(n)?r:n)}}function cc(e,n){var r=n-e;return r?pg(e,r):lc(isNaN(e)?n:e)}const fo=function e(n){var r=mg(n);function i(s,a){var o=r((s=Ps(s)).r,(a=Ps(a)).r),l=r(s.g,a.g),u=r(s.b,a.b),d=cc(s.opacity,a.opacity);return function(h){return s.r=o(h),s.g=l(h),s.b=u(h),s.opacity=d(h),s+""}}return i.gamma=e,i}(1);function sn(e,n){return e=+e,n=+n,function(r){return e*(1-r)+n*r}}var As=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ji=new RegExp(As.source,"g");function yg(e){return function(){return e}}function xg(e){return function(n){return e(n)+""}}function vg(e,n){var r=As.lastIndex=Ji.lastIndex=0,i,s,a,o=-1,l=[],u=[];for(e=e+"",n=n+"";(i=As.exec(e))&&(s=Ji.exec(n));)(a=s.index)>r&&(a=n.slice(r,a),l[o]?l[o]+=a:l[++o]=a),(i=i[0])===(s=s[0])?l[o]?l[o]+=s:l[++o]=s:(l[++o]=null,u.push({i:o,x:sn(i,s)})),r=Ji.lastIndex;return r<n.length&&(a=n.slice(r),l[o]?l[o]+=a:l[++o]=a),l.length<2?u[0]?xg(u[0].x):yg(n):(n=u.length,function(d){for(var h=0,f;h<n;++h)l[(f=u[h]).i]=f.x(d);return l.join("")})}var ho=180/Math.PI,Is={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function uc(e,n,r,i,s,a){var o,l,u;return(o=Math.sqrt(e*e+n*n))&&(e/=o,n/=o),(u=e*r+n*i)&&(r-=e*u,i-=n*u),(l=Math.sqrt(r*r+i*i))&&(r/=l,i/=l,u/=l),e*i<n*r&&(e=-e,n=-n,u=-u,o=-o),{translateX:s,translateY:a,rotate:Math.atan2(n,e)*ho,skewX:Math.atan(u)*ho,scaleX:o,scaleY:l}}var Wr;function bg(e){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return n.isIdentity?Is:uc(n.a,n.b,n.c,n.d,n.e,n.f)}function wg(e){return e==null||(Wr||(Wr=document.createElementNS("http://www.w3.org/2000/svg","g")),Wr.setAttribute("transform",e),!(e=Wr.transform.baseVal.consolidate()))?Is:(e=e.matrix,uc(e.a,e.b,e.c,e.d,e.e,e.f))}function fc(e,n,r,i){function s(d){return d.length?d.pop()+" ":""}function a(d,h,f,p,g,m){if(d!==f||h!==p){var b=g.push("translate(",null,n,null,r);m.push({i:b-4,x:sn(d,f)},{i:b-2,x:sn(h,p)})}else(f||p)&&g.push("translate("+f+n+p+r)}function o(d,h,f,p){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),p.push({i:f.push(s(f)+"rotate(",null,i)-2,x:sn(d,h)})):h&&f.push(s(f)+"rotate("+h+i)}function l(d,h,f,p){d!==h?p.push({i:f.push(s(f)+"skewX(",null,i)-2,x:sn(d,h)}):h&&f.push(s(f)+"skewX("+h+i)}function u(d,h,f,p,g,m){if(d!==f||h!==p){var b=g.push(s(g)+"scale(",null,",",null,")");m.push({i:b-4,x:sn(d,f)},{i:b-2,x:sn(h,p)})}else(f!==1||p!==1)&&g.push(s(g)+"scale("+f+","+p+")")}return function(d,h){var f=[],p=[];return d=e(d),h=e(h),a(d.translateX,d.translateY,h.translateX,h.translateY,f,p),o(d.rotate,h.rotate,f,p),l(d.skewX,h.skewX,f,p),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,f,p),d=h=null,function(g){for(var m=-1,b=p.length,x;++m<b;)f[(x=p[m]).i]=x.x(g);return f.join("")}}}var _g=fc(bg,"px, ","px)","deg)"),kg=fc(wg,", ",")",")"),Cg=1e-12;function po(e){return((e=Math.exp(e))+1/e)/2}function jg(e){return((e=Math.exp(e))-1/e)/2}function Sg(e){return((e=Math.exp(2*e))-1)/(e+1)}const Ng=function e(n,r,i){function s(a,o){var l=a[0],u=a[1],d=a[2],h=o[0],f=o[1],p=o[2],g=h-l,m=f-u,b=g*g+m*m,x,y;if(b<Cg)y=Math.log(p/d)/n,x=function(j){return[l+j*g,u+j*m,d*Math.exp(n*j*y)]};else{var w=Math.sqrt(b),N=(p*p-d*d+i*b)/(2*d*r*w),k=(p*p-d*d-i*b)/(2*p*r*w),C=Math.log(Math.sqrt(N*N+1)-N),_=Math.log(Math.sqrt(k*k+1)-k);y=(_-C)/n,x=function(j){var S=j*y,T=po(C),P=d/(r*w)*(T*Sg(n*S+C)-jg(C));return[l+P*g,u+P*m,d*T/po(n*S+C)]}}return x.duration=y*1e3*n/Math.SQRT2,x}return s.rho=function(a){var o=Math.max(.001,+a),l=o*o,u=l*l;return e(o,l,u)},s}(Math.SQRT2,2,4);var Hn=0,or=0,Kn=0,dc=1e3,mi,lr,yi=0,Nn=0,Di=0,kr=typeof performance=="object"&&performance.now?performance:Date,hc=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function pa(){return Nn||(hc(Tg),Nn=kr.now()+Di)}function Tg(){Nn=0}function xi(){this._call=this._time=this._next=null}xi.prototype=ga.prototype={constructor:xi,restart:function(e,n,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?pa():+r)+(n==null?0:+n),!this._next&&lr!==this&&(lr?lr._next=this:mi=this,lr=this),this._call=e,this._time=r,Os()},stop:function(){this._call&&(this._call=null,this._time=1/0,Os())}};function ga(e,n,r){var i=new xi;return i.restart(e,n,r),i}function Rg(){pa(),++Hn;for(var e=mi,n;e;)(n=Nn-e._time)>=0&&e._call.call(void 0,n),e=e._next;--Hn}function go(){Nn=(yi=kr.now())+Di,Hn=or=0;try{Rg()}finally{Hn=0,Mg(),Nn=0}}function Eg(){var e=kr.now(),n=e-yi;n>dc&&(Di-=n,yi=e)}function Mg(){for(var e,n=mi,r,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(r=n._next,n._next=null,n=e?e._next=r:mi=r);lr=e,Os(i)}function Os(e){if(!Hn){or&&(or=clearTimeout(or));var n=e-Nn;n>24?(e<1/0&&(or=setTimeout(go,e-kr.now()-Di)),Kn&&(Kn=clearInterval(Kn))):(Kn||(yi=kr.now(),Kn=setInterval(Eg,dc)),Hn=1,hc(go))}}function mo(e,n,r){var i=new xi;return n=n==null?0:+n,i.restart(s=>{i.stop(),e(s+n)},n,r),i}var Pg=Ir("start","end","cancel","interrupt"),Ag=[],pc=0,yo=1,Ds=2,ti=3,xo=4,Fs=5,ni=6;function Fi(e,n,r,i,s,a){var o=e.__transition;if(!o)e.__transition={};else if(r in o)return;Ig(e,r,{name:n,index:i,group:s,on:Pg,tween:Ag,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:pc})}function ma(e,n){var r=Et(e,n);if(r.state>pc)throw new Error("too late; already scheduled");return r}function Ft(e,n){var r=Et(e,n);if(r.state>ti)throw new Error("too late; already running");return r}function Et(e,n){var r=e.__transition;if(!r||!(r=r[n]))throw new Error("transition not found");return r}function Ig(e,n,r){var i=e.__transition,s;i[n]=r,r.timer=ga(a,0,r.time);function a(d){r.state=yo,r.timer.restart(o,r.delay,r.time),r.delay<=d&&o(d-r.delay)}function o(d){var h,f,p,g;if(r.state!==yo)return u();for(h in i)if(g=i[h],g.name===r.name){if(g.state===ti)return mo(o);g.state===xo?(g.state=ni,g.timer.stop(),g.on.call("interrupt",e,e.__data__,g.index,g.group),delete i[h]):+h<n&&(g.state=ni,g.timer.stop(),g.on.call("cancel",e,e.__data__,g.index,g.group),delete i[h])}if(mo(function(){r.state===ti&&(r.state=xo,r.timer.restart(l,r.delay,r.time),l(d))}),r.state=Ds,r.on.call("start",e,e.__data__,r.index,r.group),r.state===Ds){for(r.state=ti,s=new Array(p=r.tween.length),h=0,f=-1;h<p;++h)(g=r.tween[h].value.call(e,e.__data__,r.index,r.group))&&(s[++f]=g);s.length=f+1}}function l(d){for(var h=d<r.duration?r.ease.call(null,d/r.duration):(r.timer.restart(u),r.state=Fs,1),f=-1,p=s.length;++f<p;)s[f].call(e,h);r.state===Fs&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=ni,r.timer.stop(),delete i[n];for(var d in i)return;delete e.__transition}}function ri(e,n){var r=e.__transition,i,s,a=!0,o;if(r){n=n==null?null:n+"";for(o in r){if((i=r[o]).name!==n){a=!1;continue}s=i.state>Ds&&i.state<Fs,i.state=ni,i.timer.stop(),i.on.call(s?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete r[o]}a&&delete e.__transition}}function Og(e){return this.each(function(){ri(this,e)})}function Dg(e,n){var r,i;return function(){var s=Ft(this,e),a=s.tween;if(a!==r){i=r=a;for(var o=0,l=i.length;o<l;++o)if(i[o].name===n){i=i.slice(),i.splice(o,1);break}}s.tween=i}}function Fg(e,n,r){var i,s;if(typeof r!="function")throw new Error;return function(){var a=Ft(this,e),o=a.tween;if(o!==i){s=(i=o).slice();for(var l={name:n,value:r},u=0,d=s.length;u<d;++u)if(s[u].name===n){s[u]=l;break}u===d&&s.push(l)}a.tween=s}}function Lg(e,n){var r=this._id;if(e+="",arguments.length<2){for(var i=Et(this.node(),r).tween,s=0,a=i.length,o;s<a;++s)if((o=i[s]).name===e)return o.value;return null}return this.each((n==null?Dg:Fg)(r,e,n))}function ya(e,n,r){var i=e._id;return e.each(function(){var s=Ft(this,i);(s.value||(s.value={}))[n]=r.apply(this,arguments)}),function(s){return Et(s,i).value[n]}}function gc(e,n){var r;return(typeof n=="number"?sn:n instanceof _r?fo:(r=_r(n))?(n=r,fo):vg)(e,n)}function zg(e){return function(){this.removeAttribute(e)}}function $g(e){return function(){this.removeAttributeNS(e.space,e.local)}}function qg(e,n,r){var i,s=r+"",a;return function(){var o=this.getAttribute(e);return o===s?null:o===i?a:a=n(i=o,r)}}function Hg(e,n,r){var i,s=r+"",a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===s?null:o===i?a:a=n(i=o,r)}}function Bg(e,n,r){var i,s,a;return function(){var o,l=r(this),u;return l==null?void this.removeAttribute(e):(o=this.getAttribute(e),u=l+"",o===u?null:o===i&&u===s?a:(s=u,a=n(i=o,l)))}}function Wg(e,n,r){var i,s,a;return function(){var o,l=r(this),u;return l==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),u=l+"",o===u?null:o===i&&u===s?a:(s=u,a=n(i=o,l)))}}function Ug(e,n){var r=Oi(e),i=r==="transform"?kg:gc;return this.attrTween(e,typeof n=="function"?(r.local?Wg:Bg)(r,i,ya(this,"attr."+e,n)):n==null?(r.local?$g:zg)(r):(r.local?Hg:qg)(r,i,n))}function Vg(e,n){return function(r){this.setAttribute(e,n.call(this,r))}}function Gg(e,n){return function(r){this.setAttributeNS(e.space,e.local,n.call(this,r))}}function Qg(e,n){var r,i;function s(){var a=n.apply(this,arguments);return a!==i&&(r=(i=a)&&Gg(e,a)),r}return s._value=n,s}function Xg(e,n){var r,i;function s(){var a=n.apply(this,arguments);return a!==i&&(r=(i=a)&&Vg(e,a)),r}return s._value=n,s}function Yg(e,n){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(n==null)return this.tween(r,null);if(typeof n!="function")throw new Error;var i=Oi(e);return this.tween(r,(i.local?Qg:Xg)(i,n))}function Kg(e,n){return function(){ma(this,e).delay=+n.apply(this,arguments)}}function Jg(e,n){return n=+n,function(){ma(this,e).delay=n}}function Zg(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?Kg:Jg)(n,e)):Et(this.node(),n).delay}function em(e,n){return function(){Ft(this,e).duration=+n.apply(this,arguments)}}function tm(e,n){return n=+n,function(){Ft(this,e).duration=n}}function nm(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?em:tm)(n,e)):Et(this.node(),n).duration}function rm(e,n){if(typeof n!="function")throw new Error;return function(){Ft(this,e).ease=n}}function im(e){var n=this._id;return arguments.length?this.each(rm(n,e)):Et(this.node(),n).ease}function sm(e,n){return function(){var r=n.apply(this,arguments);if(typeof r!="function")throw new Error;Ft(this,e).ease=r}}function am(e){if(typeof e!="function")throw new Error;return this.each(sm(this._id,e))}function om(e){typeof e!="function"&&(e=Ql(e));for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s)for(var a=n[s],o=a.length,l=i[s]=[],u,d=0;d<o;++d)(u=a[d])&&e.call(u,u.__data__,d,a)&&l.push(u);return new Jt(i,this._parents,this._name,this._id)}function lm(e){if(e._id!==this._id)throw new Error;for(var n=this._groups,r=e._groups,i=n.length,s=r.length,a=Math.min(i,s),o=new Array(i),l=0;l<a;++l)for(var u=n[l],d=r[l],h=u.length,f=o[l]=new Array(h),p,g=0;g<h;++g)(p=u[g]||d[g])&&(f[g]=p);for(;l<i;++l)o[l]=n[l];return new Jt(o,this._parents,this._name,this._id)}function cm(e){return(e+"").trim().split(/^|\s+/).every(function(n){var r=n.indexOf(".");return r>=0&&(n=n.slice(0,r)),!n||n==="start"})}function um(e,n,r){var i,s,a=cm(n)?ma:Ft;return function(){var o=a(this,e),l=o.on;l!==i&&(s=(i=l).copy()).on(n,r),o.on=s}}function fm(e,n){var r=this._id;return arguments.length<2?Et(this.node(),r).on.on(e):this.each(um(r,e,n))}function dm(e){return function(){var n=this.parentNode;for(var r in this.__transition)if(+r!==e)return;n&&n.removeChild(this)}}function hm(){return this.on("end.remove",dm(this._id))}function pm(e){var n=this._name,r=this._id;typeof e!="function"&&(e=fa(e));for(var i=this._groups,s=i.length,a=new Array(s),o=0;o<s;++o)for(var l=i[o],u=l.length,d=a[o]=new Array(u),h,f,p=0;p<u;++p)(h=l[p])&&(f=e.call(h,h.__data__,p,l))&&("__data__"in h&&(f.__data__=h.__data__),d[p]=f,Fi(d[p],n,r,p,d,Et(h,r)));return new Jt(a,this._parents,n,r)}function gm(e){var n=this._name,r=this._id;typeof e!="function"&&(e=Gl(e));for(var i=this._groups,s=i.length,a=[],o=[],l=0;l<s;++l)for(var u=i[l],d=u.length,h,f=0;f<d;++f)if(h=u[f]){for(var p=e.call(h,h.__data__,f,u),g,m=Et(h,r),b=0,x=p.length;b<x;++b)(g=p[b])&&Fi(g,n,r,b,p,m);a.push(p),o.push(h)}return new Jt(a,o,n,r)}var mm=Ar.prototype.constructor;function ym(){return new mm(this._groups,this._parents)}function xm(e,n){var r,i,s;return function(){var a=qn(this,e),o=(this.style.removeProperty(e),qn(this,e));return a===o?null:a===r&&o===i?s:s=n(r=a,i=o)}}function mc(e){return function(){this.style.removeProperty(e)}}function vm(e,n,r){var i,s=r+"",a;return function(){var o=qn(this,e);return o===s?null:o===i?a:a=n(i=o,r)}}function bm(e,n,r){var i,s,a;return function(){var o=qn(this,e),l=r(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(e),qn(this,e))),o===u?null:o===i&&u===s?a:(s=u,a=n(i=o,l))}}function wm(e,n){var r,i,s,a="style."+n,o="end."+a,l;return function(){var u=Ft(this,e),d=u.on,h=u.value[a]==null?l||(l=mc(n)):void 0;(d!==r||s!==h)&&(i=(r=d).copy()).on(o,s=h),u.on=i}}function _m(e,n,r){var i=(e+="")=="transform"?_g:gc;return n==null?this.styleTween(e,xm(e,i)).on("end.style."+e,mc(e)):typeof n=="function"?this.styleTween(e,bm(e,i,ya(this,"style."+e,n))).each(wm(this._id,e)):this.styleTween(e,vm(e,i,n),r).on("end.style."+e,null)}function km(e,n,r){return function(i){this.style.setProperty(e,n.call(this,i),r)}}function Cm(e,n,r){var i,s;function a(){var o=n.apply(this,arguments);return o!==s&&(i=(s=o)&&km(e,o,r)),i}return a._value=n,a}function jm(e,n,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(n==null)return this.tween(i,null);if(typeof n!="function")throw new Error;return this.tween(i,Cm(e,n,r??""))}function Sm(e){return function(){this.textContent=e}}function Nm(e){return function(){var n=e(this);this.textContent=n??""}}function Tm(e){return this.tween("text",typeof e=="function"?Nm(ya(this,"text",e)):Sm(e==null?"":e+""))}function Rm(e){return function(n){this.textContent=e.call(this,n)}}function Em(e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&Rm(s)),n}return i._value=e,i}function Mm(e){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Em(e))}function Pm(){for(var e=this._name,n=this._id,r=yc(),i=this._groups,s=i.length,a=0;a<s;++a)for(var o=i[a],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=Et(u,n);Fi(u,e,r,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new Jt(i,this._parents,e,r)}function Am(){var e,n,r=this,i=r._id,s=r.size();return new Promise(function(a,o){var l={value:o},u={value:function(){--s===0&&a()}};r.each(function(){var d=Ft(this,i),h=d.on;h!==e&&(n=(e=h).copy(),n._.cancel.push(l),n._.interrupt.push(l),n._.end.push(u)),d.on=n}),s===0&&a()})}var Im=0;function Jt(e,n,r,i){this._groups=e,this._parents=n,this._name=r,this._id=i}function yc(){return++Im}var $t=Ar.prototype;Jt.prototype={constructor:Jt,select:pm,selectAll:gm,selectChild:$t.selectChild,selectChildren:$t.selectChildren,filter:om,merge:lm,selection:ym,transition:Pm,call:$t.call,nodes:$t.nodes,node:$t.node,size:$t.size,empty:$t.empty,each:$t.each,on:fm,attr:Ug,attrTween:Yg,style:_m,styleTween:jm,text:Tm,textTween:Mm,remove:hm,tween:Lg,delay:Zg,duration:nm,ease:im,easeVarying:am,end:Am,[Symbol.iterator]:$t[Symbol.iterator]};function Om(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Dm={time:null,delay:0,duration:250,ease:Om};function Fm(e,n){for(var r;!(r=e.__transition)||!(r=r[n]);)if(!(e=e.parentNode))throw new Error(`transition ${n} not found`);return r}function Lm(e){var n,r;e instanceof Jt?(n=e._id,e=e._name):(n=yc(),(r=Dm).time=pa(),e=e==null?null:e+"");for(var i=this._groups,s=i.length,a=0;a<s;++a)for(var o=i[a],l=o.length,u,d=0;d<l;++d)(u=o[d])&&Fi(u,e,n,d,o,r||Fm(u,n));return new Jt(i,this._parents,e,n)}Ar.prototype.interrupt=Og;Ar.prototype.transition=Lm;const Ur=e=>()=>e;function zm(e,{sourceEvent:n,target:r,transform:i,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Gt(e,n,r){this.k=e,this.x=n,this.y=r}Gt.prototype={constructor:Gt,scale:function(e){return e===1?this:new Gt(this.k*e,this.x,this.y)},translate:function(e,n){return e===0&n===0?this:new Gt(this.k,this.x+this.k*e,this.y+this.k*n)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var xa=new Gt(1,0,0);Pt.prototype=Gt.prototype;function Pt(e){for(;!e.__zoom;)if(!(e=e.parentNode))return xa;return e.__zoom}function Zi(e){e.stopImmediatePropagation()}function Jn(e){e.preventDefault(),e.stopImmediatePropagation()}function $m(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function qm(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function vo(){return this.__zoom||xa}function Hm(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Bm(){return navigator.maxTouchPoints||"ontouchstart"in this}function Wm(e,n,r){var i=e.invertX(n[0][0])-r[0][0],s=e.invertX(n[1][0])-r[1][0],a=e.invertY(n[0][1])-r[0][1],o=e.invertY(n[1][1])-r[1][1];return e.translate(s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Um(){var e=$m,n=qm,r=Wm,i=Hm,s=Bm,a=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=Ng,d=Ir("start","zoom","end"),h,f,p,g=500,m=150,b=0,x=10;function y(R){R.property("__zoom",vo).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",P).filter(s).on("touchstart.zoom",I).on("touchmove.zoom",L).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(R,A,O,M){var q=R.selection?R.selection():R;q.property("__zoom",vo),R!==q?C(R,A,O,M):q.interrupt().each(function(){_(this,arguments).event(M).start().zoom(null,typeof A=="function"?A.apply(this,arguments):A).end()})},y.scaleBy=function(R,A,O,M){y.scaleTo(R,function(){var q=this.__zoom.k,D=typeof A=="function"?A.apply(this,arguments):A;return q*D},O,M)},y.scaleTo=function(R,A,O,M){y.transform(R,function(){var q=n.apply(this,arguments),D=this.__zoom,F=O==null?k(q):typeof O=="function"?O.apply(this,arguments):O,z=D.invert(F),H=typeof A=="function"?A.apply(this,arguments):A;return r(N(w(D,H),F,z),q,o)},O,M)},y.translateBy=function(R,A,O,M){y.transform(R,function(){return r(this.__zoom.translate(typeof A=="function"?A.apply(this,arguments):A,typeof O=="function"?O.apply(this,arguments):O),n.apply(this,arguments),o)},null,M)},y.translateTo=function(R,A,O,M,q){y.transform(R,function(){var D=n.apply(this,arguments),F=this.__zoom,z=M==null?k(D):typeof M=="function"?M.apply(this,arguments):M;return r(xa.translate(z[0],z[1]).scale(F.k).translate(typeof A=="function"?-A.apply(this,arguments):-A,typeof O=="function"?-O.apply(this,arguments):-O),D,o)},M,q)};function w(R,A){return A=Math.max(a[0],Math.min(a[1],A)),A===R.k?R:new Gt(A,R.x,R.y)}function N(R,A,O){var M=A[0]-O[0]*R.k,q=A[1]-O[1]*R.k;return M===R.x&&q===R.y?R:new Gt(R.k,M,q)}function k(R){return[(+R[0][0]+ +R[1][0])/2,(+R[0][1]+ +R[1][1])/2]}function C(R,A,O,M){R.on("start.zoom",function(){_(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(M).end()}).tween("zoom",function(){var q=this,D=arguments,F=_(q,D).event(M),z=n.apply(q,D),H=O==null?k(z):typeof O=="function"?O.apply(q,D):O,Y=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),B=q.__zoom,Q=typeof A=="function"?A.apply(q,D):A,W=u(B.invert(H).concat(Y/B.k),Q.invert(H).concat(Y/Q.k));return function(X){if(X===1)X=Q;else{var Z=W(X),te=Y/Z[2];X=new Gt(te,H[0]-Z[0]*te,H[1]-Z[1]*te)}F.zoom(null,X)}})}function _(R,A,O){return!O&&R.__zooming||new j(R,A)}function j(R,A){this.that=R,this.args=A,this.active=0,this.sourceEvent=null,this.extent=n.apply(R,A),this.taps=0}j.prototype={event:function(R){return R&&(this.sourceEvent=R),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(R,A){return this.mouse&&R!=="mouse"&&(this.mouse[1]=A.invert(this.mouse[0])),this.touch0&&R!=="touch"&&(this.touch0[1]=A.invert(this.touch0[0])),this.touch1&&R!=="touch"&&(this.touch1[1]=A.invert(this.touch1[0])),this.that.__zoom=A,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(R){var A=mt(this.that).datum();d.call(R,this.that,new zm(R,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:d}),A)}};function S(R,...A){if(!e.apply(this,arguments))return;var O=_(this,A).event(R),M=this.__zoom,q=Math.max(a[0],Math.min(a[1],M.k*Math.pow(2,i.apply(this,arguments)))),D=At(R);if(O.wheel)(O.mouse[0][0]!==D[0]||O.mouse[0][1]!==D[1])&&(O.mouse[1]=M.invert(O.mouse[0]=D)),clearTimeout(O.wheel);else{if(M.k===q)return;O.mouse=[D,M.invert(D)],ri(this),O.start()}Jn(R),O.wheel=setTimeout(F,m),O.zoom("mouse",r(N(w(M,q),O.mouse[0],O.mouse[1]),O.extent,o));function F(){O.wheel=null,O.end()}}function T(R,...A){if(p||!e.apply(this,arguments))return;var O=R.currentTarget,M=_(this,A,!0).event(R),q=mt(R.view).on("mousemove.zoom",H,!0).on("mouseup.zoom",Y,!0),D=At(R,O),F=R.clientX,z=R.clientY;ic(R.view),Zi(R),M.mouse=[D,this.__zoom.invert(D)],ri(this),M.start();function H(B){if(Jn(B),!M.moved){var Q=B.clientX-F,W=B.clientY-z;M.moved=Q*Q+W*W>b}M.event(B).zoom("mouse",r(N(M.that.__zoom,M.mouse[0]=At(B,O),M.mouse[1]),M.extent,o))}function Y(B){q.on("mousemove.zoom mouseup.zoom",null),sc(B.view,M.moved),Jn(B),M.event(B).end()}}function P(R,...A){if(e.apply(this,arguments)){var O=this.__zoom,M=At(R.changedTouches?R.changedTouches[0]:R,this),q=O.invert(M),D=O.k*(R.shiftKey?.5:2),F=r(N(w(O,D),M,q),n.apply(this,A),o);Jn(R),l>0?mt(this).transition().duration(l).call(C,F,M,R):mt(this).call(y.transform,F,M,R)}}function I(R,...A){if(e.apply(this,arguments)){var O=R.touches,M=O.length,q=_(this,A,R.changedTouches.length===M).event(R),D,F,z,H;for(Zi(R),F=0;F<M;++F)z=O[F],H=At(z,this),H=[H,this.__zoom.invert(H),z.identifier],q.touch0?!q.touch1&&q.touch0[2]!==H[2]&&(q.touch1=H,q.taps=0):(q.touch0=H,D=!0,q.taps=1+!!h);h&&(h=clearTimeout(h)),D&&(q.taps<2&&(f=H[0],h=setTimeout(function(){h=null},g)),ri(this),q.start())}}function L(R,...A){if(this.__zooming){var O=_(this,A).event(R),M=R.changedTouches,q=M.length,D,F,z,H;for(Jn(R),D=0;D<q;++D)F=M[D],z=At(F,this),O.touch0&&O.touch0[2]===F.identifier?O.touch0[0]=z:O.touch1&&O.touch1[2]===F.identifier&&(O.touch1[0]=z);if(F=O.that.__zoom,O.touch1){var Y=O.touch0[0],B=O.touch0[1],Q=O.touch1[0],W=O.touch1[1],X=(X=Q[0]-Y[0])*X+(X=Q[1]-Y[1])*X,Z=(Z=W[0]-B[0])*Z+(Z=W[1]-B[1])*Z;F=w(F,Math.sqrt(X/Z)),z=[(Y[0]+Q[0])/2,(Y[1]+Q[1])/2],H=[(B[0]+W[0])/2,(B[1]+W[1])/2]}else if(O.touch0)z=O.touch0[0],H=O.touch0[1];else return;O.zoom("touch",r(N(F,z,H),O.extent,o))}}function V(R,...A){if(this.__zooming){var O=_(this,A).event(R),M=R.changedTouches,q=M.length,D,F;for(Zi(R),p&&clearTimeout(p),p=setTimeout(function(){p=null},g),D=0;D<q;++D)F=M[D],O.touch0&&O.touch0[2]===F.identifier?delete O.touch0:O.touch1&&O.touch1[2]===F.identifier&&delete O.touch1;if(O.touch1&&!O.touch0&&(O.touch0=O.touch1,delete O.touch1),O.touch0)O.touch0[1]=this.__zoom.invert(O.touch0[0]);else if(O.end(),O.taps===2&&(F=At(F,this),Math.hypot(f[0]-F[0],f[1]-F[1])<x)){var z=mt(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return y.wheelDelta=function(R){return arguments.length?(i=typeof R=="function"?R:Ur(+R),y):i},y.filter=function(R){return arguments.length?(e=typeof R=="function"?R:Ur(!!R),y):e},y.touchable=function(R){return arguments.length?(s=typeof R=="function"?R:Ur(!!R),y):s},y.extent=function(R){return arguments.length?(n=typeof R=="function"?R:Ur([[+R[0][0],+R[0][1]],[+R[1][0],+R[1][1]]]),y):n},y.scaleExtent=function(R){return arguments.length?(a[0]=+R[0],a[1]=+R[1],y):[a[0],a[1]]},y.translateExtent=function(R){return arguments.length?(o[0][0]=+R[0][0],o[1][0]=+R[1][0],o[0][1]=+R[0][1],o[1][1]=+R[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(R){return arguments.length?(r=R,y):r},y.duration=function(R){return arguments.length?(l=+R,y):l},y.interpolate=function(R){return arguments.length?(u=R,y):u},y.on=function(){var R=d.on.apply(d,arguments);return R===d?y:R},y.clickDistance=function(R){return arguments.length?(b=(R=+R)*R,y):Math.sqrt(b)},y.tapDistance=function(R){return arguments.length?(x=+R,y):x},y}class bo extends Map{constructor(n,r=Qm){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),n!=null)for(const[i,s]of n)this.set(i,s)}get(n){return super.get(wo(this,n))}has(n){return super.has(wo(this,n))}set(n,r){return super.set(Vm(this,n),r)}delete(n){return super.delete(Gm(this,n))}}function wo({_intern:e,_key:n},r){const i=n(r);return e.has(i)?e.get(i):r}function Vm({_intern:e,_key:n},r){const i=n(r);return e.has(i)?e.get(i):(e.set(i,r),r)}function Gm({_intern:e,_key:n},r){const i=n(r);return e.has(i)&&(r=e.get(i),e.delete(i)),r}function Qm(e){return e!==null&&typeof e=="object"?e.valueOf():e}function _o(e,n){let r;if(n===void 0)for(const i of e)i!=null&&(r<i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of e)(s=n(s,++i,e))!=null&&(r<s||r===void 0&&s>=s)&&(r=s)}return r}function ko(e,n){let r;if(n===void 0)for(const i of e)i!=null&&(r>i||r===void 0&&i>=i)&&(r=i);else{let i=-1;for(let s of e)(s=n(s,++i,e))!=null&&(r>s||r===void 0&&s>=s)&&(r=s)}return r}function Xm(e,n){let r=0;for(let i of e)(i=+i)&&(r+=i);return r}var Ym=typeof global=="object"&&global&&global.Object===Object&&global,Km=typeof self=="object"&&self&&self.Object===Object&&self,xc=Ym||Km||Function("return this")(),vi=xc.Symbol,vc=Object.prototype,Jm=vc.hasOwnProperty,Zm=vc.toString,Zn=vi?vi.toStringTag:void 0;function e0(e){var n=Jm.call(e,Zn),r=e[Zn];try{e[Zn]=void 0;var i=!0}catch{}var s=Zm.call(e);return i&&(n?e[Zn]=r:delete e[Zn]),s}var t0=Object.prototype,n0=t0.toString;function r0(e){return n0.call(e)}var i0="[object Null]",s0="[object Undefined]",Co=vi?vi.toStringTag:void 0;function a0(e){return e==null?e===void 0?s0:i0:Co&&Co in Object(e)?e0(e):r0(e)}function o0(e){return e!=null&&typeof e=="object"}var l0="[object Symbol]";function c0(e){return typeof e=="symbol"||o0(e)&&a0(e)==l0}var u0=/\s/;function f0(e){for(var n=e.length;n--&&u0.test(e.charAt(n)););return n}var d0=/^\s+/;function h0(e){return e&&e.slice(0,f0(e)+1).replace(d0,"")}function bi(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var jo=NaN,p0=/^[-+]0x[0-9a-f]+$/i,g0=/^0b[01]+$/i,m0=/^0o[0-7]+$/i,y0=parseInt;function So(e){if(typeof e=="number")return e;if(c0(e))return jo;if(bi(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=bi(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=h0(e);var r=g0.test(e);return r||m0.test(e)?y0(e.slice(2),r?2:8):p0.test(e)?jo:+e}var es=function(){return xc.Date.now()},x0="Expected a function",v0=Math.max,b0=Math.min;function bc(e,n,r){var i,s,a,o,l,u,d=0,h=!1,f=!1,p=!0;if(typeof e!="function")throw new TypeError(x0);n=So(n)||0,bi(r)&&(h=!!r.leading,f="maxWait"in r,a=f?v0(So(r.maxWait)||0,n):a,p="trailing"in r?!!r.trailing:p);function g(_){var j=i,S=s;return i=s=void 0,d=_,o=e.apply(S,j),o}function m(_){return d=_,l=setTimeout(y,n),h?g(_):o}function b(_){var j=_-u,S=_-d,T=n-j;return f?b0(T,a-S):T}function x(_){var j=_-u,S=_-d;return u===void 0||j>=n||j<0||f&&S>=a}function y(){var _=es();if(x(_))return w(_);l=setTimeout(y,b(_))}function w(_){return l=void 0,p&&i?g(_):(i=s=void 0,o)}function N(){l!==void 0&&clearTimeout(l),d=0,i=u=s=l=void 0}function k(){return l===void 0?o:w(es())}function C(){var _=es(),j=x(_);if(i=arguments,s=this,u=_,j){if(l===void 0)return m(u);if(f)return clearTimeout(l),l=setTimeout(y,n),g(u)}return l===void 0&&(l=setTimeout(y,n)),o}return C.cancel=N,C.flush=k,C}var w0="Expected a function";function _0(e,n,r){var i=!0,s=!0;if(typeof e!="function")throw new TypeError(w0);return bi(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),bc(e,n,{leading:i,maxWait:n,trailing:s})}var jn=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(e){var n=1.70158;return e===1?1:e*e*((n+1)*e-n)},Out:function(e){var n=1.70158;return e===0?0:--e*e*((n+1)*e+n)+1},InOut:function(e){var n=2.5949095;return(e*=2)<1?.5*(e*e*((n+1)*e-n)):.5*((e-=2)*e*((n+1)*e+n)+2)}}),Bounce:Object.freeze({In:function(e){return 1-jn.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?jn.Bounce.In(e*2)*.5:jn.Bounce.Out(e*2-1)*.5+.5}}),generatePow:function(e){return e===void 0&&(e=4),e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(n){return Math.pow(n,e)},Out:function(n){return 1-Math.pow(1-n,e)},InOut:function(n){return n<.5?Math.pow(n*2,e)/2:(1-Math.pow(2-n*2,e))/2+.5}}}}),cr=function(){return performance.now()},wc=function(){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,n)}return e.prototype.getAll=function(){var n=this;return Object.keys(this._tweens).map(function(r){return n._tweens[r]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];for(var s=0,a=r;s<a.length;s++){var o=a[s];(n=o._group)===null||n===void 0||n.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},e.prototype.remove=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=0,s=n;i<s.length;i++){var a=s[i];a._group=void 0,delete this._tweens[a.getId()],delete this._tweensAddedDuringUpdate[a.getId()]}},e.prototype.allStopped=function(){return this.getAll().every(function(n){return!n.isPlaying()})},e.prototype.update=function(n,r){n===void 0&&(n=cr()),r===void 0&&(r=!0);var i=Object.keys(this._tweens);if(i.length!==0)for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var a=this._tweens[i[s]],o=!r;a&&a.update(n,o)===!1&&!r&&this.remove(a)}i=Object.keys(this._tweensAddedDuringUpdate)}},e}(),Ls={Linear:function(e,n){var r=e.length-1,i=r*n,s=Math.floor(i),a=Ls.Utils.Linear;return n<0?a(e[0],e[1],i):n>1?a(e[r],e[r-1],r-i):a(e[s],e[s+1>r?r:s+1],i-s)},Utils:{Linear:function(e,n,r){return(n-e)*r+e}}},_c=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),zs=new wc,No=function(){function e(n,r){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=jn.Linear.None,this._interpolationFunction=Ls.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=_c.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=n,typeof r=="object"?(this._group=r,r.add(this)):r===!0&&(this._group=zs,zs.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(n,r){if(r===void 0&&(r=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=n,this._propertiesAreSetUp=!1,this._duration=r<0?0:r,this},e.prototype.duration=function(n){return n===void 0&&(n=1e3),this._duration=n<0?0:n,this},e.prototype.dynamic=function(n){return n===void 0&&(n=!1),this._isDynamic=n,this},e.prototype.start=function(n,r){if(n===void 0&&(n=cr()),r===void 0&&(r=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=n,this._startTime+=this._delayTime,!this._propertiesAreSetUp||r){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var a in this._valuesEnd)s[a]=this._valuesEnd[a];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,r)}return this},e.prototype.startFromCurrentValues=function(n){return this.start(n,!0)},e.prototype._setupProperties=function(n,r,i,s,a){for(var o in i){var l=n[o],u=Array.isArray(l),d=u?"array":typeof l,h=!u&&Array.isArray(i[o]);if(!(d==="undefined"||d==="function")){if(h){var f=i[o];if(f.length===0)continue;for(var p=[l],g=0,m=f.length;g<m;g+=1){var b=this._handleRelativeValue(l,f[g]);if(isNaN(b)){h=!1,console.warn("Found invalid interpolation list. Skipping.");break}p.push(b)}h&&(i[o]=p)}if((d==="object"||u)&&l&&!h){r[o]=u?[]:{};var x=l;for(var y in x)r[o][y]=x[y];s[o]=u?[]:{};var f=i[o];if(!this._isDynamic){var w={};for(var y in f)w[y]=f[y];i[o]=f=w}this._setupProperties(x,r[o],f,s[o],a)}else(typeof r[o]>"u"||a)&&(r[o]=l),u||(r[o]*=1),h?s[o]=i[o].slice().reverse():s[o]=r[o]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(n){return n===void 0&&(n=cr()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=n,this)},e.prototype.resume=function(n){return n===void 0&&(n=cr()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=n-this._pauseStart,this._pauseStart=0,this)},e.prototype.stopChainedTweens=function(){for(var n=0,r=this._chainedTweens.length;n<r;n++)this._chainedTweens[n].stop();return this},e.prototype.group=function(n){return n?(n.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var n;return(n=this._group)===null||n===void 0||n.remove(this),this},e.prototype.delay=function(n){return n===void 0&&(n=0),this._delayTime=n,this},e.prototype.repeat=function(n){return n===void 0&&(n=0),this._initialRepeat=n,this._repeat=n,this},e.prototype.repeatDelay=function(n){return this._repeatDelayTime=n,this},e.prototype.yoyo=function(n){return n===void 0&&(n=!1),this._yoyo=n,this},e.prototype.easing=function(n){return n===void 0&&(n=jn.Linear.None),this._easingFunction=n,this},e.prototype.interpolation=function(n){return n===void 0&&(n=Ls.Linear),this._interpolationFunction=n,this},e.prototype.chain=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return this._chainedTweens=n,this},e.prototype.onStart=function(n){return this._onStartCallback=n,this},e.prototype.onEveryStart=function(n){return this._onEveryStartCallback=n,this},e.prototype.onUpdate=function(n){return this._onUpdateCallback=n,this},e.prototype.onRepeat=function(n){return this._onRepeatCallback=n,this},e.prototype.onComplete=function(n){return this._onCompleteCallback=n,this},e.prototype.onStop=function(n){return this._onStopCallback=n,this},e.prototype.update=function(n,r){var i=this,s;if(n===void 0&&(n=cr()),r===void 0&&(r=e.autoStartOnUpdate),this._isPaused)return!0;var a;if(!this._goToEnd&&!this._isPlaying)if(r)this.start(n,!0);else return!1;if(this._goToEnd=!1,n<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=n-this._startTime,l=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),u=this._duration+this._repeat*l,d=function(){if(i._duration===0||o>u)return 1;var b=Math.trunc(o/l),x=o-b*l,y=Math.min(x/i._duration,1);return y===0&&o===i._duration?1:y},h=d(),f=this._easingFunction(h);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,f),this._onUpdateCallback&&this._onUpdateCallback(this._object,h),this._duration===0||o>=this._duration)if(this._repeat>0){var p=Math.min(Math.trunc((o-this._duration)/l)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(a in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[a]=="string"&&(this._valuesStartRepeat[a]=this._valuesStartRepeat[a]+parseFloat(this._valuesEnd[a])),this._yoyo&&this._swapEndStartRepeatValues(a),this._valuesStart[a]=this._valuesStartRepeat[a];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var g=0,m=this._chainedTweens.length;g<m;g++)this._chainedTweens[g].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(n,r,i,s){for(var a in i)if(r[a]!==void 0){var o=r[a]||0,l=i[a],u=Array.isArray(n[a]),d=Array.isArray(l),h=!u&&d;h?n[a]=this._interpolationFunction(l,s):typeof l=="object"&&l?this._updateProperties(n[a],o,l,s):(l=this._handleRelativeValue(o,l),typeof l=="number"&&(n[a]=o+(l-o)*s))}},e.prototype._handleRelativeValue=function(n,r){return typeof r!="string"?r:r.charAt(0)==="+"||r.charAt(0)==="-"?n+parseFloat(r):parseFloat(r)},e.prototype._swapEndStartRepeatValues=function(n){var r=this._valuesStartRepeat[n],i=this._valuesEnd[n];typeof i=="string"?this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(i):this._valuesStartRepeat[n]=this._valuesEnd[n],this._valuesEnd[n]=r},e.autoStartOnUpdate=!1,e}();_c.nextId;var Dt=zs;Dt.getAll.bind(Dt);Dt.removeAll.bind(Dt);Dt.add.bind(Dt);Dt.remove.bind(Dt);Dt.update.bind(Dt);function To(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function k0(e){if(Array.isArray(e))return e}function C0(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function j0(e,n,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}function S0(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n!==0)for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function N0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T0(e,n){return k0(e)||S0(e,n)||R0(e,n)||N0()}function R0(e,n){if(e){if(typeof e=="string")return To(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?To(e,n):void 0}}var E0=j0(function e(n,r){var i=r.default,s=i===void 0?null:i,a=r.triggerUpdate,o=a===void 0?!0:a,l=r.onChange,u=l===void 0?function(d,h){}:l;C0(this,e),this.name=n,this.defaultVal=s,this.triggerUpdate=o,this.onChange=u});function va(e){var n=e.stateInit,r=n===void 0?function(){return{}}:n,i=e.props,s=i===void 0?{}:i,a=e.methods,o=a===void 0?{}:a,l=e.aliases,u=l===void 0?{}:l,d=e.init,h=d===void 0?function(){}:d,f=e.update,p=f===void 0?function(){}:f,g=Object.keys(s).map(function(m){return new E0(m,s[m])});return function m(){for(var b=arguments.length,x=new Array(b),y=0;y<b;y++)x[y]=arguments[y];var w=!!(this instanceof m&&this.constructor),N=w?x.shift():void 0,k=x[0],C=k===void 0?{}:k,_=Object.assign({},r instanceof Function?r(C):r,{initialised:!1}),j={};function S(I){return T(I,C),P(),S}var T=function(L,V){h.call(S,L,_,V),_.initialised=!0},P=bc(function(){_.initialised&&(p.call(S,_,j),j={})},1);return g.forEach(function(I){S[I.name]=L(I);function L(V){var R=V.name,A=V.triggerUpdate,O=A===void 0?!1:A,M=V.onChange,q=M===void 0?function(z,H){}:M,D=V.defaultVal,F=D===void 0?null:D;return function(z){var H=_[R];if(!arguments.length)return H;var Y=z===void 0?F:z;return _[R]=Y,q.call(S,Y,_,H),!j.hasOwnProperty(R)&&(j[R]=H),O&&P(),S}}}),Object.keys(o).forEach(function(I){S[I]=function(){for(var L,V=arguments.length,R=new Array(V),A=0;A<V;A++)R[A]=arguments[A];return(L=o[I]).call.apply(L,[S,_].concat(R))}}),Object.entries(u).forEach(function(I){var L=T0(I,2),V=L[0],R=L[1];return S[V]=S[R]}),S.resetProps=function(){return g.forEach(function(I){S[I.name](I.defaultVal)}),S},S.resetProps(),_._rerender=P,w&&N&&S(N),S}}var ge=function(e){return typeof e=="function"?e:typeof e=="string"?function(n){return n[e]}:function(n){return e}};function wi(e){"@babel/helpers - typeof";return wi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wi(e)}var M0=/^\s+/,P0=/\s+$/;function ee(e,n){if(e=e||"",n=n||{},e instanceof ee)return e;if(!(this instanceof ee))return new ee(e,n);var r=A0(e);this._originalInput=e,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=n.format||r.format,this._gradientType=n.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}ee.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(n.r*299+n.g*587+n.b*114)/1e3},getLuminance:function(){var n=this.toRgb(),r,i,s,a,o,l;return r=n.r/255,i=n.g/255,s=n.b/255,r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),s<=.03928?l=s/12.92:l=Math.pow((s+.055)/1.055,2.4),.2126*a+.7152*o+.0722*l},setAlpha:function(n){return this._a=kc(n),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var n=Eo(this._r,this._g,this._b);return{h:n.h*360,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=Eo(this._r,this._g,this._b),r=Math.round(n.h*360),i=Math.round(n.s*100),s=Math.round(n.v*100);return this._a==1?"hsv("+r+", "+i+"%, "+s+"%)":"hsva("+r+", "+i+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var n=Ro(this._r,this._g,this._b);return{h:n.h*360,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=Ro(this._r,this._g,this._b),r=Math.round(n.h*360),i=Math.round(n.s*100),s=Math.round(n.l*100);return this._a==1?"hsl("+r+", "+i+"%, "+s+"%)":"hsla("+r+", "+i+"%, "+s+"%, "+this._roundA+")"},toHex:function(n){return Mo(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(n){return F0(this._r,this._g,this._b,this._a,n)},toHex8String:function(n){return"#"+this.toHex8(n)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ne(this._r,255)*100)+"%",g:Math.round(Ne(this._g,255)*100)+"%",b:Math.round(Ne(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ne(this._r,255)*100)+"%, "+Math.round(Ne(this._g,255)*100)+"%, "+Math.round(Ne(this._b,255)*100)+"%)":"rgba("+Math.round(Ne(this._r,255)*100)+"%, "+Math.round(Ne(this._g,255)*100)+"%, "+Math.round(Ne(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:X0[Mo(this._r,this._g,this._b,!0)]||!1},toFilter:function(n){var r="#"+Po(this._r,this._g,this._b,this._a),i=r,s=this._gradientType?"GradientType = 1, ":"";if(n){var a=ee(n);i="#"+Po(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+r+",endColorstr="+i+")"},toString:function(n){var r=!!n;n=n||this._format;var i=!1,s=this._a<1&&this._a>=0,a=!r&&s&&(n==="hex"||n==="hex6"||n==="hex3"||n==="hex4"||n==="hex8"||n==="name");return a?n==="name"&&this._a===0?this.toName():this.toRgbString():(n==="rgb"&&(i=this.toRgbString()),n==="prgb"&&(i=this.toPercentageRgbString()),(n==="hex"||n==="hex6")&&(i=this.toHexString()),n==="hex3"&&(i=this.toHexString(!0)),n==="hex4"&&(i=this.toHex8String(!0)),n==="hex8"&&(i=this.toHex8String()),n==="name"&&(i=this.toName()),n==="hsl"&&(i=this.toHslString()),n==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return ee(this.toString())},_applyModification:function(n,r){var i=n.apply(null,[this].concat([].slice.call(r)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(q0,arguments)},brighten:function(){return this._applyModification(H0,arguments)},darken:function(){return this._applyModification(B0,arguments)},desaturate:function(){return this._applyModification(L0,arguments)},saturate:function(){return this._applyModification(z0,arguments)},greyscale:function(){return this._applyModification($0,arguments)},spin:function(){return this._applyModification(W0,arguments)},_applyCombination:function(n,r){return n.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(G0,arguments)},complement:function(){return this._applyCombination(U0,arguments)},monochromatic:function(){return this._applyCombination(Q0,arguments)},splitcomplement:function(){return this._applyCombination(V0,arguments)},triad:function(){return this._applyCombination(Ao,[3])},tetrad:function(){return this._applyCombination(Ao,[4])}};ee.fromRatio=function(e,n){if(wi(e)=="object"){var r={};for(var i in e)e.hasOwnProperty(i)&&(i==="a"?r[i]=e[i]:r[i]=ur(e[i]));e=r}return ee(e,n)};function A0(e){var n={r:0,g:0,b:0},r=1,i=null,s=null,a=null,o=!1,l=!1;return typeof e=="string"&&(e=Z0(e)),wi(e)=="object"&&(qt(e.r)&&qt(e.g)&&qt(e.b)?(n=I0(e.r,e.g,e.b),o=!0,l=String(e.r).substr(-1)==="%"?"prgb":"rgb"):qt(e.h)&&qt(e.s)&&qt(e.v)?(i=ur(e.s),s=ur(e.v),n=D0(e.h,i,s),o=!0,l="hsv"):qt(e.h)&&qt(e.s)&&qt(e.l)&&(i=ur(e.s),a=ur(e.l),n=O0(e.h,i,a),o=!0,l="hsl"),e.hasOwnProperty("a")&&(r=e.a)),r=kc(r),{ok:o,format:e.format||l,r:Math.min(255,Math.max(n.r,0)),g:Math.min(255,Math.max(n.g,0)),b:Math.min(255,Math.max(n.b,0)),a:r}}function I0(e,n,r){return{r:Ne(e,255)*255,g:Ne(n,255)*255,b:Ne(r,255)*255}}function Ro(e,n,r){e=Ne(e,255),n=Ne(n,255),r=Ne(r,255);var i=Math.max(e,n,r),s=Math.min(e,n,r),a,o,l=(i+s)/2;if(i==s)a=o=0;else{var u=i-s;switch(o=l>.5?u/(2-i-s):u/(i+s),i){case e:a=(n-r)/u+(n<r?6:0);break;case n:a=(r-e)/u+2;break;case r:a=(e-n)/u+4;break}a/=6}return{h:a,s:o,l}}function O0(e,n,r){var i,s,a;e=Ne(e,360),n=Ne(n,100),r=Ne(r,100);function o(d,h,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(h-d)*6*f:f<1/2?h:f<2/3?d+(h-d)*(2/3-f)*6:d}if(n===0)i=s=a=r;else{var l=r<.5?r*(1+n):r+n-r*n,u=2*r-l;i=o(u,l,e+1/3),s=o(u,l,e),a=o(u,l,e-1/3)}return{r:i*255,g:s*255,b:a*255}}function Eo(e,n,r){e=Ne(e,255),n=Ne(n,255),r=Ne(r,255);var i=Math.max(e,n,r),s=Math.min(e,n,r),a,o,l=i,u=i-s;if(o=i===0?0:u/i,i==s)a=0;else{switch(i){case e:a=(n-r)/u+(n<r?6:0);break;case n:a=(r-e)/u+2;break;case r:a=(e-n)/u+4;break}a/=6}return{h:a,s:o,v:l}}function D0(e,n,r){e=Ne(e,360)*6,n=Ne(n,100),r=Ne(r,100);var i=Math.floor(e),s=e-i,a=r*(1-n),o=r*(1-s*n),l=r*(1-(1-s)*n),u=i%6,d=[r,o,a,a,l,r][u],h=[l,r,r,o,a,a][u],f=[a,a,l,r,r,o][u];return{r:d*255,g:h*255,b:f*255}}function Mo(e,n,r,i){var s=[jt(Math.round(e).toString(16)),jt(Math.round(n).toString(16)),jt(Math.round(r).toString(16))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function F0(e,n,r,i,s){var a=[jt(Math.round(e).toString(16)),jt(Math.round(n).toString(16)),jt(Math.round(r).toString(16)),jt(Cc(i))];return s&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function Po(e,n,r,i){var s=[jt(Cc(i)),jt(Math.round(e).toString(16)),jt(Math.round(n).toString(16)),jt(Math.round(r).toString(16))];return s.join("")}ee.equals=function(e,n){return!e||!n?!1:ee(e).toRgbString()==ee(n).toRgbString()};ee.random=function(){return ee.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function L0(e,n){n=n===0?0:n||10;var r=ee(e).toHsl();return r.s-=n/100,r.s=Li(r.s),ee(r)}function z0(e,n){n=n===0?0:n||10;var r=ee(e).toHsl();return r.s+=n/100,r.s=Li(r.s),ee(r)}function $0(e){return ee(e).desaturate(100)}function q0(e,n){n=n===0?0:n||10;var r=ee(e).toHsl();return r.l+=n/100,r.l=Li(r.l),ee(r)}function H0(e,n){n=n===0?0:n||10;var r=ee(e).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(n/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(n/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(n/100)))),ee(r)}function B0(e,n){n=n===0?0:n||10;var r=ee(e).toHsl();return r.l-=n/100,r.l=Li(r.l),ee(r)}function W0(e,n){var r=ee(e).toHsl(),i=(r.h+n)%360;return r.h=i<0?360+i:i,ee(r)}function U0(e){var n=ee(e).toHsl();return n.h=(n.h+180)%360,ee(n)}function Ao(e,n){if(isNaN(n)||n<=0)throw new Error("Argument to polyad must be a positive number");for(var r=ee(e).toHsl(),i=[ee(e)],s=360/n,a=1;a<n;a++)i.push(ee({h:(r.h+a*s)%360,s:r.s,l:r.l}));return i}function V0(e){var n=ee(e).toHsl(),r=n.h;return[ee(e),ee({h:(r+72)%360,s:n.s,l:n.l}),ee({h:(r+216)%360,s:n.s,l:n.l})]}function G0(e,n,r){n=n||6,r=r||30;var i=ee(e).toHsl(),s=360/r,a=[ee(e)];for(i.h=(i.h-(s*n>>1)+720)%360;--n;)i.h=(i.h+s)%360,a.push(ee(i));return a}function Q0(e,n){n=n||6;for(var r=ee(e).toHsv(),i=r.h,s=r.s,a=r.v,o=[],l=1/n;n--;)o.push(ee({h:i,s,v:a})),a=(a+l)%1;return o}ee.mix=function(e,n,r){r=r===0?0:r||50;var i=ee(e).toRgb(),s=ee(n).toRgb(),a=r/100,o={r:(s.r-i.r)*a+i.r,g:(s.g-i.g)*a+i.g,b:(s.b-i.b)*a+i.b,a:(s.a-i.a)*a+i.a};return ee(o)};ee.readability=function(e,n){var r=ee(e),i=ee(n);return(Math.max(r.getLuminance(),i.getLuminance())+.05)/(Math.min(r.getLuminance(),i.getLuminance())+.05)};ee.isReadable=function(e,n,r){var i=ee.readability(e,n),s,a;switch(a=!1,s=ey(r),s.level+s.size){case"AAsmall":case"AAAlarge":a=i>=4.5;break;case"AAlarge":a=i>=3;break;case"AAAsmall":a=i>=7;break}return a};ee.mostReadable=function(e,n,r){var i=null,s=0,a,o,l,u;r=r||{},o=r.includeFallbackColors,l=r.level,u=r.size;for(var d=0;d<n.length;d++)a=ee.readability(e,n[d]),a>s&&(s=a,i=ee(n[d]));return ee.isReadable(e,i,{level:l,size:u})||!o?i:(r.includeFallbackColors=!1,ee.mostReadable(e,["#fff","#000"],r))};var $s=ee.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},X0=ee.hexNames=Y0($s);function Y0(e){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[e[r]]=r);return n}function kc(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Ne(e,n){K0(e)&&(e="100%");var r=J0(e);return e=Math.min(n,Math.max(0,parseFloat(e))),r&&(e=parseInt(e*n,10)/100),Math.abs(e-n)<1e-6?1:e%n/parseFloat(n)}function Li(e){return Math.min(1,Math.max(0,e))}function lt(e){return parseInt(e,16)}function K0(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function J0(e){return typeof e=="string"&&e.indexOf("%")!=-1}function jt(e){return e.length==1?"0"+e:""+e}function ur(e){return e<=1&&(e=e*100+"%"),e}function Cc(e){return Math.round(parseFloat(e)*255).toString(16)}function Io(e){return lt(e)/255}var _t=function(){var e="[-\\+]?\\d+%?",n="[-\\+]?\\d*\\.\\d+%?",r="(?:"+n+")|(?:"+e+")",i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",s="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{CSS_UNIT:new RegExp(r),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function qt(e){return!!_t.CSS_UNIT.exec(e)}function Z0(e){e=e.replace(M0,"").replace(P0,"").toLowerCase();var n=!1;if($s[e])e=$s[e],n=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=_t.rgb.exec(e))?{r:r[1],g:r[2],b:r[3]}:(r=_t.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=_t.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=_t.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=_t.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=_t.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=_t.hex8.exec(e))?{r:lt(r[1]),g:lt(r[2]),b:lt(r[3]),a:Io(r[4]),format:n?"name":"hex8"}:(r=_t.hex6.exec(e))?{r:lt(r[1]),g:lt(r[2]),b:lt(r[3]),format:n?"name":"hex"}:(r=_t.hex4.exec(e))?{r:lt(r[1]+""+r[1]),g:lt(r[2]+""+r[2]),b:lt(r[3]+""+r[3]),a:Io(r[4]+""+r[4]),format:n?"name":"hex8"}:(r=_t.hex3.exec(e))?{r:lt(r[1]+""+r[1]),g:lt(r[2]+""+r[2]),b:lt(r[3]+""+r[3]),format:n?"name":"hex"}:!1}function ey(e){var n,r;return e=e||{level:"AA",size:"small"},n=(e.level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),n!=="AA"&&n!=="AAA"&&(n="AA"),r!=="small"&&r!=="large"&&(r="small"),{level:n,size:r}}function qs(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function ty(e){if(Array.isArray(e))return qs(e)}function jc(e,n,r){if(typeof e=="function"?e===n:e.has(n))return arguments.length<3?n:r;throw new TypeError("Private element is not present on this object")}function ny(e,n){if(n.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ry(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function dt(e,n){return e.get(jc(e,n))}function Oo(e,n,r){ny(e,n),n.set(e,r)}function Do(e,n,r){return e.set(jc(e,n),r),r}function iy(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,uy(i.key),i)}}function sy(e,n,r){return n&&iy(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ay(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function oy(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ly(e){return ty(e)||ay(e)||fy(e)||oy()}function cy(e,n){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function uy(e){var n=cy(e,"string");return typeof n=="symbol"?n:n+""}function fy(e,n){if(e){if(typeof e=="string")return qs(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qs(e,n):void 0}}var dy=123,hy=function(n){return"#".concat(Math.min(n,Math.pow(2,24)).toString(16).padStart(6,"0"))},Sc=function(n,r,i){return(n<<16)+(r<<8)+i},py=function(n){var r=ee(n).toRgb(),i=r.r,s=r.g,a=r.b;return Sc(i,s,a)},Fo=function(n,r){return n*dy%Math.pow(2,r)},gn=new WeakMap,Ht=new WeakMap,gy=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6;ry(this,e),Oo(this,gn,void 0),Oo(this,Ht,void 0),Do(Ht,this,n),this.reset()}return sy(e,[{key:"reset",value:function(){Do(gn,this,["__reserved for background__"])}},{key:"register",value:function(r){if(dt(gn,this).length>=Math.pow(2,24-dt(Ht,this)))return null;var i=dt(gn,this).length,s=Fo(i,dt(Ht,this)),a=hy(i+(s<<24-dt(Ht,this)));return dt(gn,this).push(r),a}},{key:"lookup",value:function(r){if(!r)return null;var i=typeof r=="string"?py(r):Sc.apply(void 0,ly(r));if(!i)return null;var s=i&Math.pow(2,24-dt(Ht,this))-1,a=i>>24-dt(Ht,this)&Math.pow(2,dt(Ht,this))-1;return Fo(s,dt(Ht,this))!==a||s>=dt(gn,this).length?null:dt(gn,this)[s]}}])}(),Dr,Te,Nc,Tc,mn,Lo,Rc,Ec,Mc,ba,Hs,Bs,Cr={},Pc=[],my=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,zi=Array.isArray;function It(e,n){for(var r in n)e[r]=n[r];return e}function wa(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function yy(e,n,r){var i,s,a,o={};for(a in n)a=="key"?i=n[a]:a=="ref"?s=n[a]:o[a]=n[a];if(arguments.length>2&&(o.children=arguments.length>3?Dr.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)o[a]===void 0&&(o[a]=e.defaultProps[a]);return hr(e,o,i,s,null)}function hr(e,n,r,i,s){var a={type:e,props:n,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Nc,__i:-1,__u:0};return s==null&&Te.vnode!=null&&Te.vnode(a),a}function $i(e){return e.children}function ii(e,n){this.props=e,this.context=n}function Bn(e,n){if(n==null)return e.__?Bn(e.__,e.__i+1):null;for(var r;n<e.__k.length;n++)if((r=e.__k[n])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?Bn(e):null}function Ac(e){var n,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,n=0;n<e.__k.length;n++)if((r=e.__k[n])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return Ac(e)}}function zo(e){(!e.__d&&(e.__d=!0)&&mn.push(e)&&!_i.__r++||Lo!=Te.debounceRendering)&&((Lo=Te.debounceRendering)||Rc)(_i)}function _i(){for(var e,n,r,i,s,a,o,l=1;mn.length;)mn.length>l&&mn.sort(Ec),e=mn.shift(),l=mn.length,e.__d&&(r=void 0,s=(i=(n=e).__v).__e,a=[],o=[],n.__P&&((r=It({},i)).__v=i.__v+1,Te.vnode&&Te.vnode(r),_a(n.__P,r,i,n.__n,n.__P.namespaceURI,32&i.__u?[s]:null,a,s??Bn(i),!!(32&i.__u),o),r.__v=i.__v,r.__.__k[r.__i]=r,Dc(a,r,o),r.__e!=s&&Ac(r)));_i.__r=0}function Ic(e,n,r,i,s,a,o,l,u,d,h){var f,p,g,m,b,x,y=i&&i.__k||Pc,w=n.length;for(u=xy(r,n,y,u,w),f=0;f<w;f++)(g=r.__k[f])!=null&&(p=g.__i==-1?Cr:y[g.__i]||Cr,g.__i=f,x=_a(e,g,p,s,a,o,l,u,d,h),m=g.__e,g.ref&&p.ref!=g.ref&&(p.ref&&ka(p.ref,null,g),h.push(g.ref,g.__c||m,g)),b==null&&m!=null&&(b=m),4&g.__u||p.__k===g.__k?u=Oc(g,u,e):typeof g.type=="function"&&x!==void 0?u=x:m&&(u=m.nextSibling),g.__u&=-7);return r.__e=b,u}function xy(e,n,r,i,s){var a,o,l,u,d,h=r.length,f=h,p=0;for(e.__k=new Array(s),a=0;a<s;a++)(o=n[a])!=null&&typeof o!="boolean"&&typeof o!="function"?(u=a+p,(o=e.__k[a]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?hr(null,o,null,null,null):zi(o)?hr($i,{children:o},null,null,null):o.constructor==null&&o.__b>0?hr(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=e,o.__b=e.__b+1,l=null,(d=o.__i=vy(o,r,u,f))!=-1&&(f--,(l=r[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(s>h?p--:s<h&&p++),typeof o.type!="function"&&(o.__u|=4)):d!=u&&(d==u-1?p--:d==u+1?p++:(d>u?p--:p++,o.__u|=4))):e.__k[a]=null;if(f)for(a=0;a<h;a++)(l=r[a])!=null&&(2&l.__u)==0&&(l.__e==i&&(i=Bn(l)),Lc(l,l));return i}function Oc(e,n,r){var i,s;if(typeof e.type=="function"){for(i=e.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=e,n=Oc(i[s],n,r));return n}e.__e!=n&&(n&&e.type&&!r.contains(n)&&(n=Bn(e)),r.insertBefore(e.__e,n||null),n=e.__e);do n=n&&n.nextSibling;while(n!=null&&n.nodeType==8);return n}function vy(e,n,r,i){var s,a,o=e.key,l=e.type,u=n[r];if(u===null&&e.key==null||u&&o==u.key&&l==u.type&&(2&u.__u)==0)return r;if(i>(u!=null&&(2&u.__u)==0?1:0))for(s=r-1,a=r+1;s>=0||a<n.length;){if(s>=0){if((u=n[s])&&(2&u.__u)==0&&o==u.key&&l==u.type)return s;s--}if(a<n.length){if((u=n[a])&&(2&u.__u)==0&&o==u.key&&l==u.type)return a;a++}}return-1}function $o(e,n,r){n[0]=="-"?e.setProperty(n,r??""):e[n]=r==null?"":typeof r!="number"||my.test(n)?r:r+"px"}function Vr(e,n,r,i,s){var a,o;e:if(n=="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(n in i)r&&n in r||$o(e.style,n,"");if(r)for(n in r)i&&r[n]==i[n]||$o(e.style,n,r[n])}else if(n[0]=="o"&&n[1]=="n")a=n!=(n=n.replace(Mc,"$1")),o=n.toLowerCase(),n=o in e||n=="onFocusOut"||n=="onFocusIn"?o.slice(2):n.slice(2),e.l||(e.l={}),e.l[n+a]=r,r?i?r.u=i.u:(r.u=ba,e.addEventListener(n,a?Bs:Hs,a)):e.removeEventListener(n,a?Bs:Hs,a);else{if(s=="http://www.w3.org/2000/svg")n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(n!="width"&&n!="height"&&n!="href"&&n!="list"&&n!="form"&&n!="tabIndex"&&n!="download"&&n!="rowSpan"&&n!="colSpan"&&n!="role"&&n!="popover"&&n in e)try{e[n]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&n[4]!="-"?e.removeAttribute(n):e.setAttribute(n,n=="popover"&&r==1?"":r))}}function qo(e){return function(n){if(this.l){var r=this.l[n.type+e];if(n.t==null)n.t=ba++;else if(n.t<r.u)return;return r(Te.event?Te.event(n):n)}}}function _a(e,n,r,i,s,a,o,l,u,d){var h,f,p,g,m,b,x,y,w,N,k,C,_,j,S,T,P,I=n.type;if(n.constructor!=null)return null;128&r.__u&&(u=!!(32&r.__u),a=[l=n.__e=r.__e]),(h=Te.__b)&&h(n);e:if(typeof I=="function")try{if(y=n.props,w="prototype"in I&&I.prototype.render,N=(h=I.contextType)&&i[h.__c],k=h?N?N.props.value:h.__:i,r.__c?x=(f=n.__c=r.__c).__=f.__E:(w?n.__c=f=new I(y,k):(n.__c=f=new ii(y,k),f.constructor=I,f.render=wy),N&&N.sub(f),f.props=y,f.state||(f.state={}),f.context=k,f.__n=i,p=f.__d=!0,f.__h=[],f._sb=[]),w&&f.__s==null&&(f.__s=f.state),w&&I.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=It({},f.__s)),It(f.__s,I.getDerivedStateFromProps(y,f.__s))),g=f.props,m=f.state,f.__v=n,p)w&&I.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),w&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(w&&I.getDerivedStateFromProps==null&&y!==g&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(y,k),!f.__e&&f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(y,f.__s,k)===!1||n.__v==r.__v){for(n.__v!=r.__v&&(f.props=y,f.state=f.__s,f.__d=!1),n.__e=r.__e,n.__k=r.__k,n.__k.some(function(L){L&&(L.__=n)}),C=0;C<f._sb.length;C++)f.__h.push(f._sb[C]);f._sb=[],f.__h.length&&o.push(f);break e}f.componentWillUpdate!=null&&f.componentWillUpdate(y,f.__s,k),w&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(g,m,b)})}if(f.context=k,f.props=y,f.__P=e,f.__e=!1,_=Te.__r,j=0,w){for(f.state=f.__s,f.__d=!1,_&&_(n),h=f.render(f.props,f.state,f.context),S=0;S<f._sb.length;S++)f.__h.push(f._sb[S]);f._sb=[]}else do f.__d=!1,_&&_(n),h=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++j<25);f.state=f.__s,f.getChildContext!=null&&(i=It(It({},i),f.getChildContext())),w&&!p&&f.getSnapshotBeforeUpdate!=null&&(b=f.getSnapshotBeforeUpdate(g,m)),T=h,h!=null&&h.type===$i&&h.key==null&&(T=Fc(h.props.children)),l=Ic(e,zi(T)?T:[T],n,r,i,s,a,o,l,u,d),f.base=n.__e,n.__u&=-161,f.__h.length&&o.push(f),x&&(f.__E=f.__=null)}catch(L){if(n.__v=null,u||a!=null)if(L.then){for(n.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,n.__e=l}else for(P=a.length;P--;)wa(a[P]);else n.__e=r.__e,n.__k=r.__k;Te.__e(L,n,r)}else a==null&&n.__v==r.__v?(n.__k=r.__k,n.__e=r.__e):l=n.__e=by(r.__e,n,r,i,s,a,o,u,d);return(h=Te.diffed)&&h(n),128&n.__u?void 0:l}function Dc(e,n,r){for(var i=0;i<r.length;i++)ka(r[i],r[++i],r[++i]);Te.__c&&Te.__c(n,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(a){a.call(s)})}catch(a){Te.__e(a,s.__v)}})}function Fc(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:zi(e)?e.map(Fc):It({},e)}function by(e,n,r,i,s,a,o,l,u){var d,h,f,p,g,m,b,x=r.props,y=n.props,w=n.type;if(w=="svg"?s="http://www.w3.org/2000/svg":w=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),a!=null){for(d=0;d<a.length;d++)if((g=a[d])&&"setAttribute"in g==!!w&&(w?g.localName==w:g.nodeType==3)){e=g,a[d]=null;break}}if(e==null){if(w==null)return document.createTextNode(y);e=document.createElementNS(s,w,y.is&&y),l&&(Te.__m&&Te.__m(n,a),l=!1),a=null}if(w==null)x===y||l&&e.data==y||(e.data=y);else{if(a=a&&Dr.call(e.childNodes),x=r.props||Cr,!l&&a!=null)for(x={},d=0;d<e.attributes.length;d++)x[(g=e.attributes[d]).name]=g.value;for(d in x)if(g=x[d],d!="children"){if(d=="dangerouslySetInnerHTML")f=g;else if(!(d in y)){if(d=="value"&&"defaultValue"in y||d=="checked"&&"defaultChecked"in y)continue;Vr(e,d,null,g,s)}}for(d in y)g=y[d],d=="children"?p=g:d=="dangerouslySetInnerHTML"?h=g:d=="value"?m=g:d=="checked"?b=g:l&&typeof g!="function"||x[d]===g||Vr(e,d,g,x[d],s);if(h)l||f&&(h.__html==f.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),n.__k=[];else if(f&&(e.innerHTML=""),Ic(n.type=="template"?e.content:e,zi(p)?p:[p],n,r,i,w=="foreignObject"?"http://www.w3.org/1999/xhtml":s,a,o,a?a[0]:r.__k&&Bn(r,0),l,u),a!=null)for(d=a.length;d--;)wa(a[d]);l||(d="value",w=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[d]||w=="progress"&&!m||w=="option"&&m!=x[d])&&Vr(e,d,m,x[d],s),d="checked",b!=null&&b!=e[d]&&Vr(e,d,b,x[d],s))}return e}function ka(e,n,r){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&n==null||(e.__u=e(n))}else e.current=n}catch(s){Te.__e(s,r)}}function Lc(e,n,r){var i,s;if(Te.unmount&&Te.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||ka(i,null,n)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(a){Te.__e(a,n)}i.base=i.__P=null}if(i=e.__k)for(s=0;s<i.length;s++)i[s]&&Lc(i[s],n,r||typeof e.type!="function");r||wa(e.__e),e.__c=e.__=e.__e=void 0}function wy(e,n,r){return this.constructor(e,r)}function _y(e,n,r){var i,s,a,o;n==document&&(n=document.documentElement),Te.__&&Te.__(e,n),s=(i=!1)?null:n.__k,a=[],o=[],_a(n,e=n.__k=yy($i,null,[e]),s||Cr,Cr,n.namespaceURI,s?null:n.firstChild?Dr.call(n.childNodes):null,a,s?s.__e:n.firstChild,i,o),Dc(a,e,o)}function zc(e,n,r){var i,s,a,o,l=It({},e.props);for(a in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),n)a=="key"?i=n[a]:a=="ref"?s=n[a]:l[a]=n[a]===void 0&&o!=null?o[a]:n[a];return arguments.length>2&&(l.children=arguments.length>3?Dr.call(arguments,2):r),hr(e.type,l,i||e.key,s||e.ref,null)}Dr=Pc.slice,Te={__e:function(e,n,r,i){for(var s,a,o;n=n.__;)if((s=n.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(e)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,i||{}),o=s.__d),o)return s.__E=s}catch(l){e=l}throw e}},Nc=0,Tc=function(e){return e!=null&&e.constructor==null},ii.prototype.setState=function(e,n){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=It({},this.state),typeof e=="function"&&(e=e(It({},r),this.props)),e&&It(r,e),e!=null&&this.__v&&(n&&this._sb.push(n),zo(this))},ii.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),zo(this))},ii.prototype.render=$i,mn=[],Rc=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ec=function(e,n){return e.__v.__b-n.__v.__b},_i.__r=0,Mc=/(PointerCapture)$|Capture$/i,ba=0,Hs=qo(!1),Bs=qo(!0);function Ho(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function ky(e){if(Array.isArray(e))return e}function Cy(e,n,r){return(n=Ey(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function jy(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n!==0)for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function Sy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bo(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Ny(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Bo(Object(r),!0).forEach(function(i){Cy(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bo(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ty(e,n){return ky(e)||jy(e,n)||My(e,n)||Sy()}function Ry(e,n){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Ey(e){var n=Ry(e,"string");return typeof n=="symbol"?n:n+""}function ki(e){"@babel/helpers - typeof";return ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ki(e)}function My(e,n){if(e){if(typeof e=="string")return Ho(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ho(e,n):void 0}}var Ws=function(n){if(ki(n)!=="object")return n;var r=zc(n);if(r.props){var i;r.props=Ny({},r.props),r!=null&&(i=r.props)!==null&&i!==void 0&&i.children&&(r.props.children=Array.isArray(r.props.children)?r.props.children.map(Ws):Ws(r.props.children))}return r},Py=function(n){return Tc(zc(n))},Ay=function(n,r){delete r.__k,_y(Ws(n),r)};function Iy(e,n){n===void 0&&(n={});var r=n.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}var Oy=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;Iy(Oy);var Dy=va({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(n,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.style,a=s===void 0?{}:s,o=!!n&&ki(n)==="object"&&!!n.node&&typeof n.node=="function",l=mt(o?n.node():n);l.style("position")==="static"&&l.style("position","relative"),r.tooltipEl=l.append("div").attr("class","float-tooltip-kap"),Object.entries(a).forEach(function(d){var h=Ty(d,2),f=h[0],p=h[1];return r.tooltipEl.style(f,p)}),r.tooltipEl.style("left","-10000px").style("display","none");var u="tooltip-".concat(Math.round(Math.random()*1e12));r.mouseInside=!1,l.on("mousemove.".concat(u),function(d){r.mouseInside=!0;var h=At(d),f=l.node(),p=f.offsetWidth,g=f.offsetHeight,m=[r.offsetX===null||r.offsetX===void 0?"-".concat(h[0]/p*100,"%"):typeof r.offsetX=="number"?"calc(-50% + ".concat(r.offsetX,"px)"):r.offsetX,r.offsetY===null||r.offsetY===void 0?g>130&&g-h[1]<100?"calc(-100% - 6px)":"21px":typeof r.offsetY=="number"?r.offsetY<0?"calc(-100% - ".concat(Math.abs(r.offsetY),"px)"):"".concat(r.offsetY,"px"):r.offsetY];r.tooltipEl.style("left",h[0]+"px").style("top",h[1]+"px").style("transform","translate(".concat(m.join(","),")")),r.content&&r.tooltipEl.style("display","inline")}),l.on("mouseover.".concat(u),function(){r.mouseInside=!0,r.content&&r.tooltipEl.style("display","inline")}),l.on("mouseout.".concat(u),function(){r.mouseInside=!1,r.tooltipEl.style("display","none")})},update:function(n){n.tooltipEl.style("display",n.content&&n.mouseInside?"inline":"none"),n.content?n.content instanceof HTMLElement?(n.tooltipEl.text(""),n.tooltipEl.append(function(){return n.content})):typeof n.content=="string"?n.tooltipEl.html(n.content):Py(n.content)?(n.tooltipEl.text(""),Ay(n.content,n.tooltipEl.node())):(n.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",n.content,n.content.toString())):n.tooltipEl.text("")}});function Fy(e,n,r){var i,s=1;e==null&&(e=0),n==null&&(n=0),r==null&&(r=0);function a(){var o,l=i.length,u,d=0,h=0,f=0;for(o=0;o<l;++o)u=i[o],d+=u.x||0,h+=u.y||0,f+=u.z||0;for(d=(d/l-e)*s,h=(h/l-n)*s,f=(f/l-r)*s,o=0;o<l;++o)u=i[o],d&&(u.x-=d),h&&(u.y-=h),f&&(u.z-=f)}return a.initialize=function(o){i=o},a.x=function(o){return arguments.length?(e=+o,a):e},a.y=function(o){return arguments.length?(n=+o,a):n},a.z=function(o){return arguments.length?(r=+o,a):r},a.strength=function(o){return arguments.length?(s=+o,a):s},a}function Ly(e){const n=+this._x.call(null,e);return $c(this.cover(n),n,e)}function $c(e,n,r){if(isNaN(n))return e;var i,s=e._root,a={data:r},o=e._x0,l=e._x1,u,d,h,f,p;if(!s)return e._root=a,e;for(;s.length;)if((h=n>=(u=(o+l)/2))?o=u:l=u,i=s,!(s=s[f=+h]))return i[f]=a,e;if(d=+e._x.call(null,s.data),n===d)return a.next=s,i?i[f]=a:e._root=a,e;do i=i?i[f]=new Array(2):e._root=new Array(2),(h=n>=(u=(o+l)/2))?o=u:l=u;while((f=+h)==(p=+(d>=u)));return i[p]=s,i[f]=a,e}function zy(e){Array.isArray(e)||(e=Array.from(e));const n=e.length,r=new Float64Array(n);let i=1/0,s=-1/0;for(let a=0,o;a<n;++a)isNaN(o=+this._x.call(null,e[a]))||(r[a]=o,o<i&&(i=o),o>s&&(s=o));if(i>s)return this;this.cover(i).cover(s);for(let a=0;a<n;++a)$c(this,r[a],e[a]);return this}function $y(e){if(isNaN(e=+e))return this;var n=this._x0,r=this._x1;if(isNaN(n))r=(n=Math.floor(e))+1;else{for(var i=r-n||1,s=this._root,a,o;n>e||e>=r;)switch(o=+(e<n),a=new Array(2),a[o]=s,s=a,i*=2,o){case 0:r=n+i;break;case 1:n=r-i;break}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._x1=r,this}function qy(){var e=[];return this.visit(function(n){if(!n.length)do e.push(n.data);while(n=n.next)}),e}function Hy(e){return arguments.length?this.cover(+e[0][0]).cover(+e[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Xt(e,n,r){this.node=e,this.x0=n,this.x1=r}function By(e,n){var r,i=this._x0,s,a,o=this._x1,l=[],u=this._root,d,h;for(u&&l.push(new Xt(u,i,o)),n==null?n=1/0:(i=e-n,o=e+n);d=l.pop();)if(!(!(u=d.node)||(s=d.x0)>o||(a=d.x1)<i))if(u.length){var f=(s+a)/2;l.push(new Xt(u[1],f,a),new Xt(u[0],s,f)),(h=+(e>=f))&&(d=l[l.length-1],l[l.length-1]=l[l.length-1-h],l[l.length-1-h]=d)}else{var p=Math.abs(e-+this._x.call(null,u.data));p<n&&(n=p,i=e-p,o=e+p,r=u.data)}return r}function Wy(e){if(isNaN(u=+this._x.call(null,e)))return this;var n,r=this._root,i,s,a,o=this._x0,l=this._x1,u,d,h,f,p;if(!r)return this;if(r.length)for(;;){if((h=u>=(d=(o+l)/2))?o=d:l=d,n=r,!(r=r[f=+h]))return this;if(!r.length)break;n[f+1&1]&&(i=n,p=f)}for(;r.data!==e;)if(s=r,!(r=r.next))return this;return(a=r.next)&&delete r.next,s?(a?s.next=a:delete s.next,this):n?(a?n[f]=a:delete n[f],(r=n[0]||n[1])&&r===(n[1]||n[0])&&!r.length&&(i?i[p]=r:this._root=r),this):(this._root=a,this)}function Uy(e){for(var n=0,r=e.length;n<r;++n)this.remove(e[n]);return this}function Vy(){return this._root}function Gy(){var e=0;return this.visit(function(n){if(!n.length)do++e;while(n=n.next)}),e}function Qy(e){var n=[],r,i=this._root,s,a,o;for(i&&n.push(new Xt(i,this._x0,this._x1));r=n.pop();)if(!e(i=r.node,a=r.x0,o=r.x1)&&i.length){var l=(a+o)/2;(s=i[1])&&n.push(new Xt(s,l,o)),(s=i[0])&&n.push(new Xt(s,a,l))}return this}function Xy(e){var n=[],r=[],i;for(this._root&&n.push(new Xt(this._root,this._x0,this._x1));i=n.pop();){var s=i.node;if(s.length){var a,o=i.x0,l=i.x1,u=(o+l)/2;(a=s[0])&&n.push(new Xt(a,o,u)),(a=s[1])&&n.push(new Xt(a,u,l))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.x1);return this}function Yy(e){return e[0]}function Ky(e){return arguments.length?(this._x=e,this):this._x}function qc(e,n){var r=new Ca(n??Yy,NaN,NaN);return e==null?r:r.addAll(e)}function Ca(e,n,r){this._x=e,this._x0=n,this._x1=r,this._root=void 0}function Wo(e){for(var n={data:e.data},r=n;e=e.next;)r=r.next={data:e.data};return n}var it=qc.prototype=Ca.prototype;it.copy=function(){var e=new Ca(this._x,this._x0,this._x1),n=this._root,r,i;if(!n)return e;if(!n.length)return e._root=Wo(n),e;for(r=[{source:n,target:e._root=new Array(2)}];n=r.pop();)for(var s=0;s<2;++s)(i=n.source[s])&&(i.length?r.push({source:i,target:n.target[s]=new Array(2)}):n.target[s]=Wo(i));return e};it.add=Ly;it.addAll=zy;it.cover=$y;it.data=qy;it.extent=Hy;it.find=By;it.remove=Wy;it.removeAll=Uy;it.root=Vy;it.size=Gy;it.visit=Qy;it.visitAfter=Xy;it.x=Ky;function Jy(e){const n=+this._x.call(null,e),r=+this._y.call(null,e);return Hc(this.cover(n,r),n,r,e)}function Hc(e,n,r,i){if(isNaN(n)||isNaN(r))return e;var s,a=e._root,o={data:i},l=e._x0,u=e._y0,d=e._x1,h=e._y1,f,p,g,m,b,x,y,w;if(!a)return e._root=o,e;for(;a.length;)if((b=n>=(f=(l+d)/2))?l=f:d=f,(x=r>=(p=(u+h)/2))?u=p:h=p,s=a,!(a=a[y=x<<1|b]))return s[y]=o,e;if(g=+e._x.call(null,a.data),m=+e._y.call(null,a.data),n===g&&r===m)return o.next=a,s?s[y]=o:e._root=o,e;do s=s?s[y]=new Array(4):e._root=new Array(4),(b=n>=(f=(l+d)/2))?l=f:d=f,(x=r>=(p=(u+h)/2))?u=p:h=p;while((y=x<<1|b)===(w=(m>=p)<<1|g>=f));return s[w]=a,s[y]=o,e}function Zy(e){var n,r,i=e.length,s,a,o=new Array(i),l=new Array(i),u=1/0,d=1/0,h=-1/0,f=-1/0;for(r=0;r<i;++r)isNaN(s=+this._x.call(null,n=e[r]))||isNaN(a=+this._y.call(null,n))||(o[r]=s,l[r]=a,s<u&&(u=s),s>h&&(h=s),a<d&&(d=a),a>f&&(f=a));if(u>h||d>f)return this;for(this.cover(u,d).cover(h,f),r=0;r<i;++r)Hc(this,o[r],l[r],e[r]);return this}function ex(e,n){if(isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._x1,a=this._y1;if(isNaN(r))s=(r=Math.floor(e))+1,a=(i=Math.floor(n))+1;else{for(var o=s-r||1,l=this._root,u,d;r>e||e>=s||i>n||n>=a;)switch(d=(n<i)<<1|e<r,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:s=r+o,a=i+o;break;case 1:r=s-o,a=i+o;break;case 2:s=r+o,i=a-o;break;case 3:r=s-o,i=a-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=r,this._y0=i,this._x1=s,this._y1=a,this}function tx(){var e=[];return this.visit(function(n){if(!n.length)do e.push(n.data);while(n=n.next)}),e}function nx(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Ye(e,n,r,i,s){this.node=e,this.x0=n,this.y0=r,this.x1=i,this.y1=s}function rx(e,n,r){var i,s=this._x0,a=this._y0,o,l,u,d,h=this._x1,f=this._y1,p=[],g=this._root,m,b;for(g&&p.push(new Ye(g,s,a,h,f)),r==null?r=1/0:(s=e-r,a=n-r,h=e+r,f=n+r,r*=r);m=p.pop();)if(!(!(g=m.node)||(o=m.x0)>h||(l=m.y0)>f||(u=m.x1)<s||(d=m.y1)<a))if(g.length){var x=(o+u)/2,y=(l+d)/2;p.push(new Ye(g[3],x,y,u,d),new Ye(g[2],o,y,x,d),new Ye(g[1],x,l,u,y),new Ye(g[0],o,l,x,y)),(b=(n>=y)<<1|e>=x)&&(m=p[p.length-1],p[p.length-1]=p[p.length-1-b],p[p.length-1-b]=m)}else{var w=e-+this._x.call(null,g.data),N=n-+this._y.call(null,g.data),k=w*w+N*N;if(k<r){var C=Math.sqrt(r=k);s=e-C,a=n-C,h=e+C,f=n+C,i=g.data}}return i}function ix(e){if(isNaN(h=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var n,r=this._root,i,s,a,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,f,p,g,m,b,x,y;if(!r)return this;if(r.length)for(;;){if((m=h>=(p=(o+u)/2))?o=p:u=p,(b=f>=(g=(l+d)/2))?l=g:d=g,n=r,!(r=r[x=b<<1|m]))return this;if(!r.length)break;(n[x+1&3]||n[x+2&3]||n[x+3&3])&&(i=n,y=x)}for(;r.data!==e;)if(s=r,!(r=r.next))return this;return(a=r.next)&&delete r.next,s?(a?s.next=a:delete s.next,this):n?(a?n[x]=a:delete n[x],(r=n[0]||n[1]||n[2]||n[3])&&r===(n[3]||n[2]||n[1]||n[0])&&!r.length&&(i?i[y]=r:this._root=r),this):(this._root=a,this)}function sx(e){for(var n=0,r=e.length;n<r;++n)this.remove(e[n]);return this}function ax(){return this._root}function ox(){var e=0;return this.visit(function(n){if(!n.length)do++e;while(n=n.next)}),e}function lx(e){var n=[],r,i=this._root,s,a,o,l,u;for(i&&n.push(new Ye(i,this._x0,this._y0,this._x1,this._y1));r=n.pop();)if(!e(i=r.node,a=r.x0,o=r.y0,l=r.x1,u=r.y1)&&i.length){var d=(a+l)/2,h=(o+u)/2;(s=i[3])&&n.push(new Ye(s,d,h,l,u)),(s=i[2])&&n.push(new Ye(s,a,h,d,u)),(s=i[1])&&n.push(new Ye(s,d,o,l,h)),(s=i[0])&&n.push(new Ye(s,a,o,d,h))}return this}function cx(e){var n=[],r=[],i;for(this._root&&n.push(new Ye(this._root,this._x0,this._y0,this._x1,this._y1));i=n.pop();){var s=i.node;if(s.length){var a,o=i.x0,l=i.y0,u=i.x1,d=i.y1,h=(o+u)/2,f=(l+d)/2;(a=s[0])&&n.push(new Ye(a,o,l,h,f)),(a=s[1])&&n.push(new Ye(a,h,l,u,f)),(a=s[2])&&n.push(new Ye(a,o,f,h,d)),(a=s[3])&&n.push(new Ye(a,h,f,u,d))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ux(e){return e[0]}function fx(e){return arguments.length?(this._x=e,this):this._x}function dx(e){return e[1]}function hx(e){return arguments.length?(this._y=e,this):this._y}function Bc(e,n,r){var i=new ja(n??ux,r??dx,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function ja(e,n,r,i,s,a){this._x=e,this._y=n,this._x0=r,this._y0=i,this._x1=s,this._y1=a,this._root=void 0}function Uo(e){for(var n={data:e.data},r=n;e=e.next;)r=r.next={data:e.data};return n}var Ke=Bc.prototype=ja.prototype;Ke.copy=function(){var e=new ja(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,r,i;if(!n)return e;if(!n.length)return e._root=Uo(n),e;for(r=[{source:n,target:e._root=new Array(4)}];n=r.pop();)for(var s=0;s<4;++s)(i=n.source[s])&&(i.length?r.push({source:i,target:n.target[s]=new Array(4)}):n.target[s]=Uo(i));return e};Ke.add=Jy;Ke.addAll=Zy;Ke.cover=ex;Ke.data=tx;Ke.extent=nx;Ke.find=rx;Ke.remove=ix;Ke.removeAll=sx;Ke.root=ax;Ke.size=ox;Ke.visit=lx;Ke.visitAfter=cx;Ke.x=fx;Ke.y=hx;function px(e){const n=+this._x.call(null,e),r=+this._y.call(null,e),i=+this._z.call(null,e);return Wc(this.cover(n,r,i),n,r,i,e)}function Wc(e,n,r,i,s){if(isNaN(n)||isNaN(r)||isNaN(i))return e;var a,o=e._root,l={data:s},u=e._x0,d=e._y0,h=e._z0,f=e._x1,p=e._y1,g=e._z1,m,b,x,y,w,N,k,C,_,j,S;if(!o)return e._root=l,e;for(;o.length;)if((k=n>=(m=(u+f)/2))?u=m:f=m,(C=r>=(b=(d+p)/2))?d=b:p=b,(_=i>=(x=(h+g)/2))?h=x:g=x,a=o,!(o=o[j=_<<2|C<<1|k]))return a[j]=l,e;if(y=+e._x.call(null,o.data),w=+e._y.call(null,o.data),N=+e._z.call(null,o.data),n===y&&r===w&&i===N)return l.next=o,a?a[j]=l:e._root=l,e;do a=a?a[j]=new Array(8):e._root=new Array(8),(k=n>=(m=(u+f)/2))?u=m:f=m,(C=r>=(b=(d+p)/2))?d=b:p=b,(_=i>=(x=(h+g)/2))?h=x:g=x;while((j=_<<2|C<<1|k)===(S=(N>=x)<<2|(w>=b)<<1|y>=m));return a[S]=o,a[j]=l,e}function gx(e){Array.isArray(e)||(e=Array.from(e));const n=e.length,r=new Float64Array(n),i=new Float64Array(n),s=new Float64Array(n);let a=1/0,o=1/0,l=1/0,u=-1/0,d=-1/0,h=-1/0;for(let f=0,p,g,m,b;f<n;++f)isNaN(g=+this._x.call(null,p=e[f]))||isNaN(m=+this._y.call(null,p))||isNaN(b=+this._z.call(null,p))||(r[f]=g,i[f]=m,s[f]=b,g<a&&(a=g),g>u&&(u=g),m<o&&(o=m),m>d&&(d=m),b<l&&(l=b),b>h&&(h=b));if(a>u||o>d||l>h)return this;this.cover(a,o,l).cover(u,d,h);for(let f=0;f<n;++f)Wc(this,r[f],i[f],s[f],e[f]);return this}function mx(e,n,r){if(isNaN(e=+e)||isNaN(n=+n)||isNaN(r=+r))return this;var i=this._x0,s=this._y0,a=this._z0,o=this._x1,l=this._y1,u=this._z1;if(isNaN(i))o=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1,u=(a=Math.floor(r))+1;else{for(var d=o-i||1,h=this._root,f,p;i>e||e>=o||s>n||n>=l||a>r||r>=u;)switch(p=(r<a)<<2|(n<s)<<1|e<i,f=new Array(8),f[p]=h,h=f,d*=2,p){case 0:o=i+d,l=s+d,u=a+d;break;case 1:i=o-d,l=s+d,u=a+d;break;case 2:o=i+d,s=l-d,u=a+d;break;case 3:i=o-d,s=l-d,u=a+d;break;case 4:o=i+d,l=s+d,a=u-d;break;case 5:i=o-d,l=s+d,a=u-d;break;case 6:o=i+d,s=l-d,a=u-d;break;case 7:i=o-d,s=l-d,a=u-d;break}this._root&&this._root.length&&(this._root=h)}return this._x0=i,this._y0=s,this._z0=a,this._x1=o,this._y1=l,this._z1=u,this}function yx(){var e=[];return this.visit(function(n){if(!n.length)do e.push(n.data);while(n=n.next)}),e}function xx(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function be(e,n,r,i,s,a,o){this.node=e,this.x0=n,this.y0=r,this.z0=i,this.x1=s,this.y1=a,this.z1=o}function vx(e,n,r,i){var s,a=this._x0,o=this._y0,l=this._z0,u,d,h,f,p,g,m=this._x1,b=this._y1,x=this._z1,y=[],w=this._root,N,k;for(w&&y.push(new be(w,a,o,l,m,b,x)),i==null?i=1/0:(a=e-i,o=n-i,l=r-i,m=e+i,b=n+i,x=r+i,i*=i);N=y.pop();)if(!(!(w=N.node)||(u=N.x0)>m||(d=N.y0)>b||(h=N.z0)>x||(f=N.x1)<a||(p=N.y1)<o||(g=N.z1)<l))if(w.length){var C=(u+f)/2,_=(d+p)/2,j=(h+g)/2;y.push(new be(w[7],C,_,j,f,p,g),new be(w[6],u,_,j,C,p,g),new be(w[5],C,d,j,f,_,g),new be(w[4],u,d,j,C,_,g),new be(w[3],C,_,h,f,p,j),new be(w[2],u,_,h,C,p,j),new be(w[1],C,d,h,f,_,j),new be(w[0],u,d,h,C,_,j)),(k=(r>=j)<<2|(n>=_)<<1|e>=C)&&(N=y[y.length-1],y[y.length-1]=y[y.length-1-k],y[y.length-1-k]=N)}else{var S=e-+this._x.call(null,w.data),T=n-+this._y.call(null,w.data),P=r-+this._z.call(null,w.data),I=S*S+T*T+P*P;if(I<i){var L=Math.sqrt(i=I);a=e-L,o=n-L,l=r-L,m=e+L,b=n+L,x=r+L,s=w.data}}return s}const bx=(e,n,r,i,s,a)=>Math.sqrt((e-i)**2+(n-s)**2+(r-a)**2);function wx(e,n,r,i){const s=[],a=e-i,o=n-i,l=r-i,u=e+i,d=n+i,h=r+i;return this.visit((f,p,g,m,b,x,y)=>{if(!f.length)do{const w=f.data;bx(e,n,r,this._x(w),this._y(w),this._z(w))<=i&&s.push(w)}while(f=f.next);return p>u||g>d||m>h||b<a||x<o||y<l}),s}function _x(e){if(isNaN(p=+this._x.call(null,e))||isNaN(g=+this._y.call(null,e))||isNaN(m=+this._z.call(null,e)))return this;var n,r=this._root,i,s,a,o=this._x0,l=this._y0,u=this._z0,d=this._x1,h=this._y1,f=this._z1,p,g,m,b,x,y,w,N,k,C,_;if(!r)return this;if(r.length)for(;;){if((w=p>=(b=(o+d)/2))?o=b:d=b,(N=g>=(x=(l+h)/2))?l=x:h=x,(k=m>=(y=(u+f)/2))?u=y:f=y,n=r,!(r=r[C=k<<2|N<<1|w]))return this;if(!r.length)break;(n[C+1&7]||n[C+2&7]||n[C+3&7]||n[C+4&7]||n[C+5&7]||n[C+6&7]||n[C+7&7])&&(i=n,_=C)}for(;r.data!==e;)if(s=r,!(r=r.next))return this;return(a=r.next)&&delete r.next,s?(a?s.next=a:delete s.next,this):n?(a?n[C]=a:delete n[C],(r=n[0]||n[1]||n[2]||n[3]||n[4]||n[5]||n[6]||n[7])&&r===(n[7]||n[6]||n[5]||n[4]||n[3]||n[2]||n[1]||n[0])&&!r.length&&(i?i[_]=r:this._root=r),this):(this._root=a,this)}function kx(e){for(var n=0,r=e.length;n<r;++n)this.remove(e[n]);return this}function Cx(){return this._root}function jx(){var e=0;return this.visit(function(n){if(!n.length)do++e;while(n=n.next)}),e}function Sx(e){var n=[],r,i=this._root,s,a,o,l,u,d,h;for(i&&n.push(new be(i,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=n.pop();)if(!e(i=r.node,a=r.x0,o=r.y0,l=r.z0,u=r.x1,d=r.y1,h=r.z1)&&i.length){var f=(a+u)/2,p=(o+d)/2,g=(l+h)/2;(s=i[7])&&n.push(new be(s,f,p,g,u,d,h)),(s=i[6])&&n.push(new be(s,a,p,g,f,d,h)),(s=i[5])&&n.push(new be(s,f,o,g,u,p,h)),(s=i[4])&&n.push(new be(s,a,o,g,f,p,h)),(s=i[3])&&n.push(new be(s,f,p,l,u,d,g)),(s=i[2])&&n.push(new be(s,a,p,l,f,d,g)),(s=i[1])&&n.push(new be(s,f,o,l,u,p,g)),(s=i[0])&&n.push(new be(s,a,o,l,f,p,g))}return this}function Nx(e){var n=[],r=[],i;for(this._root&&n.push(new be(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=n.pop();){var s=i.node;if(s.length){var a,o=i.x0,l=i.y0,u=i.z0,d=i.x1,h=i.y1,f=i.z1,p=(o+d)/2,g=(l+h)/2,m=(u+f)/2;(a=s[0])&&n.push(new be(a,o,l,u,p,g,m)),(a=s[1])&&n.push(new be(a,p,l,u,d,g,m)),(a=s[2])&&n.push(new be(a,o,g,u,p,h,m)),(a=s[3])&&n.push(new be(a,p,g,u,d,h,m)),(a=s[4])&&n.push(new be(a,o,l,m,p,g,f)),(a=s[5])&&n.push(new be(a,p,l,m,d,g,f)),(a=s[6])&&n.push(new be(a,o,g,m,p,h,f)),(a=s[7])&&n.push(new be(a,p,g,m,d,h,f))}r.push(i)}for(;i=r.pop();)e(i.node,i.x0,i.y0,i.z0,i.x1,i.y1,i.z1);return this}function Tx(e){return e[0]}function Rx(e){return arguments.length?(this._x=e,this):this._x}function Ex(e){return e[1]}function Mx(e){return arguments.length?(this._y=e,this):this._y}function Px(e){return e[2]}function Ax(e){return arguments.length?(this._z=e,this):this._z}function Uc(e,n,r,i){var s=new Sa(n??Tx,r??Ex,i??Px,NaN,NaN,NaN,NaN,NaN,NaN);return e==null?s:s.addAll(e)}function Sa(e,n,r,i,s,a,o,l,u){this._x=e,this._y=n,this._z=r,this._x0=i,this._y0=s,this._z0=a,this._x1=o,this._y1=l,this._z1=u,this._root=void 0}function Vo(e){for(var n={data:e.data},r=n;e=e.next;)r=r.next={data:e.data};return n}var qe=Uc.prototype=Sa.prototype;qe.copy=function(){var e=new Sa(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),n=this._root,r,i;if(!n)return e;if(!n.length)return e._root=Vo(n),e;for(r=[{source:n,target:e._root=new Array(8)}];n=r.pop();)for(var s=0;s<8;++s)(i=n.source[s])&&(i.length?r.push({source:i,target:n.target[s]=new Array(8)}):n.target[s]=Vo(i));return e};qe.add=px;qe.addAll=gx;qe.cover=mx;qe.data=yx;qe.extent=xx;qe.find=vx;qe.findAllWithinRadius=wx;qe.remove=_x;qe.removeAll=kx;qe.root=Cx;qe.size=jx;qe.visit=Sx;qe.visitAfter=Nx;qe.x=Rx;qe.y=Mx;qe.z=Ax;function Qt(e){return function(){return e}}function Wt(e){return(e()-.5)*1e-6}function Ix(e){return e.index}function Go(e,n){var r=e.get(n);if(!r)throw new Error("node not found: "+n);return r}function Ox(e){var n=Ix,r=p,i,s=Qt(30),a,o,l,u,d,h,f=1;e==null&&(e=[]);function p(y){return 1/Math.min(u[y.source.index],u[y.target.index])}function g(y){for(var w=0,N=e.length;w<f;++w)for(var k=0,C,_,j,S=0,T=0,P=0,I,L;k<N;++k)C=e[k],_=C.source,j=C.target,S=j.x+j.vx-_.x-_.vx||Wt(h),l>1&&(T=j.y+j.vy-_.y-_.vy||Wt(h)),l>2&&(P=j.z+j.vz-_.z-_.vz||Wt(h)),I=Math.sqrt(S*S+T*T+P*P),I=(I-a[k])/I*y*i[k],S*=I,T*=I,P*=I,j.vx-=S*(L=d[k]),l>1&&(j.vy-=T*L),l>2&&(j.vz-=P*L),_.vx+=S*(L=1-L),l>1&&(_.vy+=T*L),l>2&&(_.vz+=P*L)}function m(){if(o){var y,w=o.length,N=e.length,k=new Map(o.map((_,j)=>[n(_,j,o),_])),C;for(y=0,u=new Array(w);y<N;++y)C=e[y],C.index=y,typeof C.source!="object"&&(C.source=Go(k,C.source)),typeof C.target!="object"&&(C.target=Go(k,C.target)),u[C.source.index]=(u[C.source.index]||0)+1,u[C.target.index]=(u[C.target.index]||0)+1;for(y=0,d=new Array(N);y<N;++y)C=e[y],d[y]=u[C.source.index]/(u[C.source.index]+u[C.target.index]);i=new Array(N),b(),a=new Array(N),x()}}function b(){if(o)for(var y=0,w=e.length;y<w;++y)i[y]=+r(e[y],y,e)}function x(){if(o)for(var y=0,w=e.length;y<w;++y)a[y]=+s(e[y],y,e)}return g.initialize=function(y,...w){o=y,h=w.find(N=>typeof N=="function")||Math.random,l=w.find(N=>[1,2,3].includes(N))||2,m()},g.links=function(y){return arguments.length?(e=y,m(),g):e},g.id=function(y){return arguments.length?(n=y,g):n},g.iterations=function(y){return arguments.length?(f=+y,g):f},g.strength=function(y){return arguments.length?(r=typeof y=="function"?y:Qt(+y),b(),g):r},g.distance=function(y){return arguments.length?(s=typeof y=="function"?y:Qt(+y),x(),g):s},g}const Dx=1664525,Fx=1013904223,Qo=4294967296;function Lx(){let e=1;return()=>(e=(Dx*e+Fx)%Qo)/Qo}var Xo=3;function ts(e){return e.x}function Yo(e){return e.y}function zx(e){return e.z}var $x=10,qx=Math.PI*(3-Math.sqrt(5)),Hx=Math.PI*20/(9+Math.sqrt(221));function Bx(e,n){n=n||2;var r=Math.min(Xo,Math.max(1,Math.round(n))),i,s=1,a=.001,o=1-Math.pow(a,1/300),l=0,u=.6,d=new Map,h=ga(g),f=Ir("tick","end"),p=Lx();e==null&&(e=[]);function g(){m(),f.call("tick",i),s<a&&(h.stop(),f.call("end",i))}function m(y){var w,N=e.length,k;y===void 0&&(y=1);for(var C=0;C<y;++C)for(s+=(l-s)*o,d.forEach(function(_){_(s)}),w=0;w<N;++w)k=e[w],k.fx==null?k.x+=k.vx*=u:(k.x=k.fx,k.vx=0),r>1&&(k.fy==null?k.y+=k.vy*=u:(k.y=k.fy,k.vy=0)),r>2&&(k.fz==null?k.z+=k.vz*=u:(k.z=k.fz,k.vz=0));return i}function b(){for(var y=0,w=e.length,N;y<w;++y){if(N=e[y],N.index=y,N.fx!=null&&(N.x=N.fx),N.fy!=null&&(N.y=N.fy),N.fz!=null&&(N.z=N.fz),isNaN(N.x)||r>1&&isNaN(N.y)||r>2&&isNaN(N.z)){var k=$x*(r>2?Math.cbrt(.5+y):r>1?Math.sqrt(.5+y):y),C=y*qx,_=y*Hx;r===1?N.x=k:r===2?(N.x=k*Math.cos(C),N.y=k*Math.sin(C)):(N.x=k*Math.sin(C)*Math.cos(_),N.y=k*Math.cos(C),N.z=k*Math.sin(C)*Math.sin(_))}(isNaN(N.vx)||r>1&&isNaN(N.vy)||r>2&&isNaN(N.vz))&&(N.vx=0,r>1&&(N.vy=0),r>2&&(N.vz=0))}}function x(y){return y.initialize&&y.initialize(e,p,r),y}return b(),i={tick:m,restart:function(){return h.restart(g),i},stop:function(){return h.stop(),i},numDimensions:function(y){return arguments.length?(r=Math.min(Xo,Math.max(1,Math.round(y))),d.forEach(x),i):r},nodes:function(y){return arguments.length?(e=y,b(),d.forEach(x),i):e},alpha:function(y){return arguments.length?(s=+y,i):s},alphaMin:function(y){return arguments.length?(a=+y,i):a},alphaDecay:function(y){return arguments.length?(o=+y,i):+o},alphaTarget:function(y){return arguments.length?(l=+y,i):l},velocityDecay:function(y){return arguments.length?(u=1-y,i):1-u},randomSource:function(y){return arguments.length?(p=y,d.forEach(x),i):p},force:function(y,w){return arguments.length>1?(w==null?d.delete(y):d.set(y,x(w)),i):d.get(y)},find:function(){var y=Array.prototype.slice.call(arguments),w=y.shift()||0,N=(r>1?y.shift():null)||0,k=(r>2?y.shift():null)||0,C=y.shift()||1/0,_=0,j=e.length,S,T,P,I,L,V;for(C*=C,_=0;_<j;++_)L=e[_],S=w-L.x,T=N-(L.y||0),P=k-(L.z||0),I=S*S+T*T+P*P,I<C&&(V=L,C=I);return V},on:function(y,w){return arguments.length>1?(f.on(y,w),i):f.on(y)}}}function Wx(){var e,n,r,i,s,a=Qt(-30),o,l=1,u=1/0,d=.81;function h(m){var b,x=e.length,y=(n===1?qc(e,ts):n===2?Bc(e,ts,Yo):n===3?Uc(e,ts,Yo,zx):null).visitAfter(p);for(s=m,b=0;b<x;++b)r=e[b],y.visit(g)}function f(){if(e){var m,b=e.length,x;for(o=new Array(b),m=0;m<b;++m)x=e[m],o[x.index]=+a(x,m,e)}}function p(m){var b=0,x,y,w=0,N,k,C,_,j=m.length;if(j){for(N=k=C=_=0;_<j;++_)(x=m[_])&&(y=Math.abs(x.value))&&(b+=x.value,w+=y,N+=y*(x.x||0),k+=y*(x.y||0),C+=y*(x.z||0));b*=Math.sqrt(4/j),m.x=N/w,n>1&&(m.y=k/w),n>2&&(m.z=C/w)}else{x=m,x.x=x.data.x,n>1&&(x.y=x.data.y),n>2&&(x.z=x.data.z);do b+=o[x.data.index];while(x=x.next)}m.value=b}function g(m,b,x,y,w){if(!m.value)return!0;var N=[x,y,w][n-1],k=m.x-r.x,C=n>1?m.y-r.y:0,_=n>2?m.z-r.z:0,j=N-b,S=k*k+C*C+_*_;if(j*j/d<S)return S<u&&(k===0&&(k=Wt(i),S+=k*k),n>1&&C===0&&(C=Wt(i),S+=C*C),n>2&&_===0&&(_=Wt(i),S+=_*_),S<l&&(S=Math.sqrt(l*S)),r.vx+=k*m.value*s/S,n>1&&(r.vy+=C*m.value*s/S),n>2&&(r.vz+=_*m.value*s/S)),!0;if(m.length||S>=u)return;(m.data!==r||m.next)&&(k===0&&(k=Wt(i),S+=k*k),n>1&&C===0&&(C=Wt(i),S+=C*C),n>2&&_===0&&(_=Wt(i),S+=_*_),S<l&&(S=Math.sqrt(l*S)));do m.data!==r&&(j=o[m.data.index]*s/S,r.vx+=k*j,n>1&&(r.vy+=C*j),n>2&&(r.vz+=_*j));while(m=m.next)}return h.initialize=function(m,...b){e=m,i=b.find(x=>typeof x=="function")||Math.random,n=b.find(x=>[1,2,3].includes(x))||2,f()},h.strength=function(m){return arguments.length?(a=typeof m=="function"?m:Qt(+m),f(),h):a},h.distanceMin=function(m){return arguments.length?(l=m*m,h):Math.sqrt(l)},h.distanceMax=function(m){return arguments.length?(u=m*m,h):Math.sqrt(u)},h.theta=function(m){return arguments.length?(d=m*m,h):Math.sqrt(d)},h}function Ux(e,n,r,i){var s,a,o=Qt(.1),l,u;typeof e!="function"&&(e=Qt(+e)),n==null&&(n=0),r==null&&(r=0),i==null&&(i=0);function d(f){for(var p=0,g=s.length;p<g;++p){var m=s[p],b=m.x-n||1e-6,x=(m.y||0)-r||1e-6,y=(m.z||0)-i||1e-6,w=Math.sqrt(b*b+x*x+y*y),N=(u[p]-w)*l[p]*f/w;m.vx+=b*N,a>1&&(m.vy+=x*N),a>2&&(m.vz+=y*N)}}function h(){if(s){var f,p=s.length;for(l=new Array(p),u=new Array(p),f=0;f<p;++f)u[f]=+e(s[f],f,s),l[f]=isNaN(u[f])?0:+o(s[f],f,s)}}return d.initialize=function(f,...p){s=f,a=p.find(g=>[1,2,3].includes(g))||2,h()},d.strength=function(f){return arguments.length?(o=typeof f=="function"?f:Qt(+f),h(),d):o},d.radius=function(f){return arguments.length?(e=typeof f=="function"?f:Qt(+f),h(),d):e},d.x=function(f){return arguments.length?(n=+f,d):n},d.y=function(f){return arguments.length?(r=+f,d):r},d.z=function(f){return arguments.length?(i=+f,d):i},d}const{abs:er,cos:Bt,sin:Mn,acos:Vx,atan2:tr,sqrt:nn,pow:ht}=Math;function nr(e){return e<0?-ht(-e,1/3):ht(e,1/3)}const Vc=Math.PI,Gr=2*Vc,rn=Vc/2,Gx=1e-6,ns=Number.MAX_SAFE_INTEGER||9007199254740991,rs=Number.MIN_SAFE_INTEGER||-9007199254740991,Qx={x:0,y:0,z:0},G={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,n){const r=n(e);let i=r.x*r.x+r.y*r.y;return typeof r.z<"u"&&(i+=r.z*r.z),nn(i)},compute:function(e,n,r){if(e===0)return n[0].t=0,n[0];const i=n.length-1;if(e===1)return n[i].t=1,n[i];const s=1-e;let a=n;if(i===0)return n[0].t=e,n[0];if(i===1){const l={x:s*a[0].x+e*a[1].x,y:s*a[0].y+e*a[1].y,t:e};return r&&(l.z=s*a[0].z+e*a[1].z),l}if(i<4){let l=s*s,u=e*e,d,h,f,p=0;i===2?(a=[a[0],a[1],a[2],Qx],d=l,h=s*e*2,f=u):i===3&&(d=l*s,h=l*e*3,f=s*u*3,p=e*u);const g={x:d*a[0].x+h*a[1].x+f*a[2].x+p*a[3].x,y:d*a[0].y+h*a[1].y+f*a[2].y+p*a[3].y,t:e};return r&&(g.z=d*a[0].z+h*a[1].z+f*a[2].z+p*a[3].z),g}const o=JSON.parse(JSON.stringify(n));for(;o.length>1;){for(let l=0;l<o.length-1;l++)o[l]={x:o[l].x+(o[l+1].x-o[l].x)*e,y:o[l].y+(o[l+1].y-o[l].y)*e},typeof o[l].z<"u"&&(o[l].z=o[l].z+(o[l+1].z-o[l].z)*e);o.splice(o.length-1,1)}return o[0].t=e,o[0]},computeWithRatios:function(e,n,r,i){const s=1-e,a=r,o=n;let l=a[0],u=a[1],d=a[2],h=a[3],f;if(l*=s,u*=e,o.length===2)return f=l+u,{x:(l*o[0].x+u*o[1].x)/f,y:(l*o[0].y+u*o[1].y)/f,z:i?(l*o[0].z+u*o[1].z)/f:!1,t:e};if(l*=s,u*=2*s,d*=e*e,o.length===3)return f=l+u+d,{x:(l*o[0].x+u*o[1].x+d*o[2].x)/f,y:(l*o[0].y+u*o[1].y+d*o[2].y)/f,z:i?(l*o[0].z+u*o[1].z+d*o[2].z)/f:!1,t:e};if(l*=s,u*=1.5*s,d*=3*s,h*=e*e*e,o.length===4)return f=l+u+d+h,{x:(l*o[0].x+u*o[1].x+d*o[2].x+h*o[3].x)/f,y:(l*o[0].y+u*o[1].y+d*o[2].y+h*o[3].y)/f,z:i?(l*o[0].z+u*o[1].z+d*o[2].z+h*o[3].z)/f:!1,t:e}},derive:function(e,n){const r=[];for(let i=e,s=i.length,a=s-1;s>1;s--,a--){const o=[];for(let l=0,u;l<a;l++)u={x:a*(i[l+1].x-i[l].x),y:a*(i[l+1].y-i[l].y)},n&&(u.z=a*(i[l+1].z-i[l].z)),o.push(u);r.push(o),i=o}return r},between:function(e,n,r){return n<=e&&e<=r||G.approximately(e,n)||G.approximately(e,r)},approximately:function(e,n,r){return er(e-n)<=(r||Gx)},length:function(e){const r=G.Tvalues.length;let i=0;for(let s=0,a;s<r;s++)a=.5*G.Tvalues[s]+.5,i+=G.Cvalues[s]*G.arcfn(a,e);return .5*i},map:function(e,n,r,i,s){const a=r-n,o=s-i,l=e-n,u=l/a;return i+o*u},lerp:function(e,n,r){const i={x:n.x+e*(r.x-n.x),y:n.y+e*(r.y-n.y)};return n.z!==void 0&&r.z!==void 0&&(i.z=n.z+e*(r.z-n.z)),i},pointToString:function(e){let n=e.x+"/"+e.y;return typeof e.z<"u"&&(n+="/"+e.z),n},pointsToString:function(e){return"["+e.map(G.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,n,r){const i=n.x-e.x,s=n.y-e.y,a=r.x-e.x,o=r.y-e.y,l=i*o-s*a,u=i*a+s*o;return tr(l,u)},round:function(e,n){const r=""+e,i=r.indexOf(".");return parseFloat(r.substring(0,i+1+n))},dist:function(e,n){const r=e.x-n.x,i=e.y-n.y;return nn(r*r+i*i)},closest:function(e,n){let r=ht(2,63),i,s;return e.forEach(function(a,o){s=G.dist(n,a),s<r&&(r=s,i=o)}),{mdist:r,mpos:i}},abcratio:function(e,n){if(n!==2&&n!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const r=ht(e,n)+ht(1-e,n),i=r-1;return er(i/r)},projectionratio:function(e,n){if(n!==2&&n!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const r=ht(1-e,n),i=ht(e,n)+r;return r/i},lli8:function(e,n,r,i,s,a,o,l){const u=(e*i-n*r)*(s-o)-(e-r)*(s*l-a*o),d=(e*i-n*r)*(a-l)-(n-i)*(s*l-a*o),h=(e-r)*(a-l)-(n-i)*(s-o);return h==0?!1:{x:u/h,y:d/h}},lli4:function(e,n,r,i){const s=e.x,a=e.y,o=n.x,l=n.y,u=r.x,d=r.y,h=i.x,f=i.y;return G.lli8(s,a,o,l,u,d,h,f)},lli:function(e,n){return G.lli4(e,e.c,n,n.c)},makeline:function(e,n){return new Ce(e.x,e.y,(e.x+n.x)/2,(e.y+n.y)/2,n.x,n.y)},findbbox:function(e){let n=ns,r=ns,i=rs,s=rs;return e.forEach(function(a){const o=a.bbox();n>o.x.min&&(n=o.x.min),r>o.y.min&&(r=o.y.min),i<o.x.max&&(i=o.x.max),s<o.y.max&&(s=o.y.max)}),{x:{min:n,mid:(n+i)/2,max:i,size:i-n},y:{min:r,mid:(r+s)/2,max:s,size:s-r}}},shapeintersections:function(e,n,r,i,s){if(!G.bboxoverlap(n,i))return[];const a=[],o=[e.startcap,e.forward,e.back,e.endcap],l=[r.startcap,r.forward,r.back,r.endcap];return o.forEach(function(u){u.virtual||l.forEach(function(d){if(d.virtual)return;const h=u.intersects(d,s);h.length>0&&(h.c1=u,h.c2=d,h.s1=e,h.s2=r,a.push(h))})}),a},makeshape:function(e,n,r){const i=n.points.length,s=e.points.length,a=G.makeline(n.points[i-1],e.points[0]),o=G.makeline(e.points[s-1],n.points[0]),l={startcap:a,forward:e,back:n,endcap:o,bbox:G.findbbox([a,e,n,o])};return l.intersections=function(u){return G.shapeintersections(l,l.bbox,u,u.bbox,r)},l},getminmax:function(e,n,r){if(!r)return{min:0,max:0};let i=ns,s=rs,a,o;r.indexOf(0)===-1&&(r=[0].concat(r)),r.indexOf(1)===-1&&r.push(1);for(let l=0,u=r.length;l<u;l++)a=r[l],o=e.get(a),o[n]<i&&(i=o[n]),o[n]>s&&(s=o[n]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(e,n){const r=n.p1.x,i=n.p1.y,s=-tr(n.p2.y-i,n.p2.x-r),a=function(o){return{x:(o.x-r)*Bt(s)-(o.y-i)*Mn(s),y:(o.x-r)*Mn(s)+(o.y-i)*Bt(s)}};return e.map(a)},roots:function(e,n){n=n||{p1:{x:0,y:0},p2:{x:1,y:0}};const r=e.length-1,i=G.align(e,n),s=function(j){return 0<=j&&j<=1};if(r===2){const j=i[0].y,S=i[1].y,T=i[2].y,P=j-2*S+T;if(P!==0){const I=-nn(S*S-j*T),L=-j+S,V=-(I+L)/P,R=-(-I+L)/P;return[V,R].filter(s)}else if(S!==T&&P===0)return[(2*S-T)/(2*S-2*T)].filter(s);return[]}const a=i[0].y,o=i[1].y,l=i[2].y,u=i[3].y;let d=-a+3*o-3*l+u,h=3*a-6*o+3*l,f=-3*a+3*o,p=a;if(G.approximately(d,0)){if(G.approximately(h,0))return G.approximately(f,0)?[]:[-p/f].filter(s);const j=nn(f*f-4*h*p),S=2*h;return[(j-f)/S,(-f-j)/S].filter(s)}h/=d,f/=d,p/=d;const g=(3*f-h*h)/3,m=g/3,b=(2*h*h*h-9*h*f+27*p)/27,x=b/2,y=x*x+m*m*m;let w,N,k,C,_;if(y<0){const j=-g/3,S=j*j*j,T=nn(S),P=-b/(2*T),I=P<-1?-1:P>1?1:P,L=Vx(I),V=nr(T),R=2*V;return k=R*Bt(L/3)-h/3,C=R*Bt((L+Gr)/3)-h/3,_=R*Bt((L+2*Gr)/3)-h/3,[k,C,_].filter(s)}else{if(y===0)return w=x<0?nr(-x):-nr(x),k=2*w-h/3,C=-w-h/3,[k,C].filter(s);{const j=nn(y);return w=nr(-x+j),N=nr(x+j),[w-N-h/3].filter(s)}}},droots:function(e){if(e.length===3){const n=e[0],r=e[1],i=e[2],s=n-2*r+i;if(s!==0){const a=-nn(r*r-n*i),o=-n+r,l=-(a+o)/s,u=-(-a+o)/s;return[l,u]}else if(r!==i&&s===0)return[(2*r-i)/(2*(r-i))];return[]}if(e.length===2){const n=e[0],r=e[1];return n!==r?[n/(n-r)]:[]}return[]},curvature:function(e,n,r,i,s){let a,o,l,u,d=0,h=0;const f=G.compute(e,n),p=G.compute(e,r),g=f.x*f.x+f.y*f.y;if(i?(a=nn(ht(f.y*p.z-p.y*f.z,2)+ht(f.z*p.x-p.z*f.x,2)+ht(f.x*p.y-p.x*f.y,2)),o=ht(g+f.z*f.z,3/2)):(a=f.x*p.y-f.y*p.x,o=ht(g,3/2)),a===0||o===0)return{k:0,r:0};if(d=a/o,h=o/a,!s){const m=G.curvature(e-.001,n,r,i,!0).k,b=G.curvature(e+.001,n,r,i,!0).k;u=(b-d+(d-m))/2,l=(er(b-d)+er(d-m))/2}return{k:d,r:h,dk:u,adk:l}},inflections:function(e){if(e.length<4)return[];const n=G.align(e,{p1:e[0],p2:e.slice(-1)[0]}),r=n[2].x*n[1].y,i=n[3].x*n[1].y,s=n[1].x*n[2].y,a=n[3].x*n[2].y,o=18*(-3*r+2*i+3*s-a),l=18*(3*r-i-3*s),u=18*(s-r);if(G.approximately(o,0)){if(!G.approximately(l,0)){let p=-u/l;if(0<=p&&p<=1)return[p]}return[]}const d=2*o;if(G.approximately(d,0))return[];const h=l*l-4*o*u;if(h<0)return[];const f=Math.sqrt(h);return[(f-l)/d,-(l+f)/d].filter(function(p){return 0<=p&&p<=1})},bboxoverlap:function(e,n){const r=["x","y"],i=r.length;for(let s=0,a,o,l,u;s<i;s++)if(a=r[s],o=e[a].mid,l=n[a].mid,u=(e[a].size+n[a].size)/2,er(o-l)>=u)return!1;return!0},expandbox:function(e,n){n.x.min<e.x.min&&(e.x.min=n.x.min),n.y.min<e.y.min&&(e.y.min=n.y.min),n.z&&n.z.min<e.z.min&&(e.z.min=n.z.min),n.x.max>e.x.max&&(e.x.max=n.x.max),n.y.max>e.y.max&&(e.y.max=n.y.max),n.z&&n.z.max>e.z.max&&(e.z.max=n.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,n,r){const i=e.bbox(),s=n.bbox(),a=1e5,o=r||.5;if(i.x.size+i.y.size<o&&s.x.size+s.y.size<o)return[(a*(e._t1+e._t2)/2|0)/a+"/"+(a*(n._t1+n._t2)/2|0)/a];let l=e.split(.5),u=n.split(.5),d=[{left:l.left,right:u.left},{left:l.left,right:u.right},{left:l.right,right:u.right},{left:l.right,right:u.left}];d=d.filter(function(f){return G.bboxoverlap(f.left.bbox(),f.right.bbox())});let h=[];return d.length===0||(d.forEach(function(f){h=h.concat(G.pairiteration(f.left,f.right,o))}),h=h.filter(function(f,p){return h.indexOf(f)===p})),h},getccenter:function(e,n,r){const i=n.x-e.x,s=n.y-e.y,a=r.x-n.x,o=r.y-n.y,l=i*Bt(rn)-s*Mn(rn),u=i*Mn(rn)+s*Bt(rn),d=a*Bt(rn)-o*Mn(rn),h=a*Mn(rn)+o*Bt(rn),f=(e.x+n.x)/2,p=(e.y+n.y)/2,g=(n.x+r.x)/2,m=(n.y+r.y)/2,b=f+l,x=p+u,y=g+d,w=m+h,N=G.lli8(f,p,b,x,g,m,y,w),k=G.dist(N,e);let C=tr(e.y-N.y,e.x-N.x),_=tr(n.y-N.y,n.x-N.x),j=tr(r.y-N.y,r.x-N.x),S;return C<j?((C>_||_>j)&&(C+=Gr),C>j&&(S=j,j=C,C=S)):j<_&&_<C?(S=j,j=C,C=S):j+=Gr,N.s=C,N.e=j,N.r=k,N},numberSort:function(e,n){return e-n}};class pr{constructor(n){this.curves=[],this._3d=!1,n&&(this.curves=n,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(n){return G.pointsToString(n.points)}).join(", ")+"]"}addCurve(n){this.curves.push(n),this._3d=this._3d||n._3d}length(){return this.curves.map(function(n){return n.length()}).reduce(function(n,r){return n+r})}curve(n){return this.curves[n]}bbox(){const n=this.curves;for(var r=n[0].bbox(),i=1;i<n.length;i++)G.expandbox(r,n[i].bbox());return r}offset(n){const r=[];return this.curves.forEach(function(i){r.push(...i.offset(n))}),new pr(r)}}const{abs:rr,min:Ko,max:Jo,cos:Xx,sin:Yx,acos:Kx,sqrt:ir}=Math,Jx=Math.PI;class Ce{constructor(n){let r=n&&n.forEach?n:Array.from(arguments).slice(),i=!1;if(typeof r[0]=="object"){i=r.length;const g=[];r.forEach(function(m){["x","y","z"].forEach(function(b){typeof m[b]<"u"&&g.push(m[b])})}),r=g}let s=!1;const a=r.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(a!==6&&a!==8&&a!==9&&a!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!s&&(a===9||a===12)||n&&n[0]&&typeof n[0].z<"u",l=this.points=[];for(let g=0,m=o?3:2;g<a;g+=m){var u={x:r[g],y:r[g+1]};o&&(u.z=r[g+2]),l.push(u)}const d=this.order=l.length-1,h=this.dims=["x","y"];o&&h.push("z"),this.dimlen=h.length;const f=G.align(l,{p1:l[0],p2:l[d]}),p=G.dist(l[0],l[d]);this._linear=f.reduce((g,m)=>g+rr(m.y),0)<p/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(n,r,i,s){if(typeof s>"u"&&(s=.5),s===0)return new Ce(r,r,i);if(s===1)return new Ce(n,r,r);const a=Ce.getABC(2,n,r,i,s);return new Ce(n,a.A,i)}static cubicFromPoints(n,r,i,s,a){typeof s>"u"&&(s=.5);const o=Ce.getABC(3,n,r,i,s);typeof a>"u"&&(a=G.dist(r,o.C));const l=a*(1-s)/s,u=G.dist(n,i),d=(i.x-n.x)/u,h=(i.y-n.y)/u,f=a*d,p=a*h,g=l*d,m=l*h,b={x:r.x-f,y:r.y-p},x={x:r.x+g,y:r.y+m},y=o.A,w={x:y.x+(b.x-y.x)/(1-s),y:y.y+(b.y-y.y)/(1-s)},N={x:y.x+(x.x-y.x)/s,y:y.y+(x.y-y.y)/s},k={x:n.x+(w.x-n.x)/s,y:n.y+(w.y-n.y)/s},C={x:i.x+(N.x-i.x)/(1-s),y:i.y+(N.y-i.y)/(1-s)};return new Ce(n,k,C,i)}static getUtils(){return G}getUtils(){return Ce.getUtils()}static get PolyBezier(){return pr}valueOf(){return this.toString()}toString(){return G.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const n=this.points,r=n[0].x,i=n[0].y,s=["M",r,i,this.order===2?"Q":"C"];for(let a=1,o=n.length;a<o;a++)s.push(n[a].x),s.push(n[a].y);return s.join(" ")}setRatios(n){if(n.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=n,this._lut=[]}verify(){const n=this.coordDigest();n!==this._print&&(this._print=n,this.update())}coordDigest(){return this.points.map(function(n,r){return""+r+n.x+n.y+(n.z?n.z:0)}).join("")}update(){this._lut=[],this.dpoints=G.derive(this.points,this._3d),this.computedirection()}computedirection(){const n=this.points,r=G.angle(n[0],n[this.order],n[1]);this.clockwise=r>0}length(){return G.length(this.derivative.bind(this))}static getABC(n=2,r,i,s,a=.5){const o=G.projectionratio(a,n),l=1-o,u={x:o*r.x+l*s.x,y:o*r.y+l*s.y},d=G.abcratio(a,n);return{A:{x:i.x+(i.x-u.x)/d,y:i.y+(i.y-u.y)/d},B:i,C:u,S:r,E:s}}getABC(n,r){r=r||this.get(n);let i=this.points[0],s=this.points[this.order];return Ce.getABC(this.order,i,r,s,n)}getLUT(n){if(this.verify(),n=n||100,this._lut.length===n+1)return this._lut;this._lut=[],n++,this._lut=[];for(let r=0,i,s;r<n;r++)s=r/(n-1),i=this.compute(s),i.t=s,this._lut.push(i);return this._lut}on(n,r){r=r||5;const i=this.getLUT(),s=[];for(let a=0,o,l=0;a<i.length;a++)o=i[a],G.dist(o,n)<r&&(s.push(o),l+=a/i.length);return s.length?t/=s.length:!1}project(n){const r=this.getLUT(),i=r.length-1,s=G.closest(r,n),a=s.mpos,o=(a-1)/i,l=(a+1)/i,u=.1/i;let d=s.mdist,h=o,f=h,p;d+=1;for(let g;h<l+u;h+=u)p=this.compute(h),g=G.dist(n,p),g<d&&(d=g,f=h);return f=f<0?0:f>1?1:f,p=this.compute(f),p.t=f,p.d=d,p}get(n){return this.compute(n)}point(n){return this.points[n]}compute(n){return this.ratios?G.computeWithRatios(n,this.points,this.ratios,this._3d):G.compute(n,this.points,this._3d,this.ratios)}raise(){const n=this.points,r=[n[0]],i=n.length;for(let s=1,a,o;s<i;s++)a=n[s],o=n[s-1],r[s]={x:(i-s)/i*a.x+s/i*o.x,y:(i-s)/i*a.y+s/i*o.y};return r[i]=n[i-1],new Ce(r)}derivative(n){return G.compute(n,this.dpoints[0],this._3d)}dderivative(n){return G.compute(n,this.dpoints[1],this._3d)}align(){let n=this.points;return new Ce(G.align(n,{p1:n[0],p2:n[n.length-1]}))}curvature(n){return G.curvature(n,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return G.inflections(this.points)}normal(n){return this._3d?this.__normal3(n):this.__normal2(n)}__normal2(n){const r=this.derivative(n),i=ir(r.x*r.x+r.y*r.y);return{t:n,x:-r.y/i,y:r.x/i}}__normal3(n){const r=this.derivative(n),i=this.derivative(n+.01),s=ir(r.x*r.x+r.y*r.y+r.z*r.z),a=ir(i.x*i.x+i.y*i.y+i.z*i.z);r.x/=s,r.y/=s,r.z/=s,i.x/=a,i.y/=a,i.z/=a;const o={x:i.y*r.z-i.z*r.y,y:i.z*r.x-i.x*r.z,z:i.x*r.y-i.y*r.x},l=ir(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=l,o.y/=l,o.z/=l;const u=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{t:n,x:u[0]*r.x+u[1]*r.y+u[2]*r.z,y:u[3]*r.x+u[4]*r.y+u[5]*r.z,z:u[6]*r.x+u[7]*r.y+u[8]*r.z}}hull(n){let r=this.points,i=[],s=[],a=0;for(s[a++]=r[0],s[a++]=r[1],s[a++]=r[2],this.order===3&&(s[a++]=r[3]);r.length>1;){i=[];for(let o=0,l,u=r.length-1;o<u;o++)l=G.lerp(n,r[o],r[o+1]),s[a++]=l,i.push(l);r=i}return s}split(n,r){if(n===0&&r)return this.split(r).left;if(r===1)return this.split(n).right;const i=this.hull(n),s={left:this.order===2?new Ce([i[0],i[3],i[5]]):new Ce([i[0],i[4],i[7],i[9]]),right:this.order===2?new Ce([i[5],i[4],i[2]]):new Ce([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=G.map(0,0,1,this._t1,this._t2),s.left._t2=G.map(n,0,1,this._t1,this._t2),s.right._t1=G.map(n,0,1,this._t1,this._t2),s.right._t2=G.map(1,0,1,this._t1,this._t2),r?(r=G.map(r,n,1,0,1),s.right.split(r).left):s}extrema(){const n={};let r=[];return this.dims.forEach((function(i){let s=function(o){return o[i]},a=this.dpoints[0].map(s);n[i]=G.droots(a),this.order===3&&(a=this.dpoints[1].map(s),n[i]=n[i].concat(G.droots(a))),n[i]=n[i].filter(function(o){return o>=0&&o<=1}),r=r.concat(n[i].sort(G.numberSort))}).bind(this)),n.values=r.sort(G.numberSort).filter(function(i,s){return r.indexOf(i)===s}),n}bbox(){const n=this.extrema(),r={};return this.dims.forEach((function(i){r[i]=G.getminmax(this,i,n[i])}).bind(this)),r}overlaps(n){const r=this.bbox(),i=n.bbox();return G.bboxoverlap(r,i)}offset(n,r){if(typeof r<"u"){const i=this.get(n),s=this.normal(n),a={c:i,n:s,x:i.x+s.x*r,y:i.y+s.y*r};return this._3d&&(a.z=i.z+s.z*r),a}if(this._linear){const i=this.normal(0),s=this.points.map(function(a){const o={x:a.x+n*i.x,y:a.y+n*i.y};return a.z&&i.z&&(o.z=a.z+n*i.z),o});return[new Ce(s)]}return this.reduce().map(function(i){return i._linear?i.offset(n)[0]:i.scale(n)})}simple(){if(this.order===3){const s=G.angle(this.points[0],this.points[3],this.points[1]),a=G.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&a<0||s<0&&a>0)return!1}const n=this.normal(0),r=this.normal(1);let i=n.x*r.x+n.y*r.y;return this._3d&&(i+=n.z*r.z),rr(Kx(i))<Jx/3}reduce(){let n,r=0,i=0,s=.01,a,o=[],l=[],u=this.extrema().values;for(u.indexOf(0)===-1&&(u=[0].concat(u)),u.indexOf(1)===-1&&u.push(1),r=u[0],n=1;n<u.length;n++)i=u[n],a=this.split(r,i),a._t1=r,a._t2=i,o.push(a),r=i;return o.forEach(function(d){for(r=0,i=0;i<=1;)for(i=r+s;i<=1+s;i+=s)if(a=d.split(r,i),!a.simple()){if(i-=s,rr(r-i)<s)return[];a=d.split(r,i),a._t1=G.map(r,0,1,d._t1,d._t2),a._t2=G.map(i,0,1,d._t1,d._t2),l.push(a),r=i;break}r<1&&(a=d.split(r,1),a._t1=G.map(r,0,1,d._t1,d._t2),a._t2=d._t2,l.push(a))}),l}translate(n,r,i){i=typeof i=="number"?i:r;const s=this.order;let a=this.points.map((o,l)=>(1-l/s)*r+l/s*i);return new Ce(this.points.map((o,l)=>({x:o.x+n.x*a[l],y:o.y+n.y*a[l]})))}scale(n){const r=this.order;let i=!1;if(typeof n=="function"&&(i=n),i&&r===2)return this.raise().scale(i);const s=this.clockwise,a=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):n,i?i(1):n);const o=i?i(0):n,l=i?i(1):n,u=[this.offset(0,10),this.offset(1,10)],d=[],h=G.lli4(u[0],u[0].c,u[1],u[1].c);if(!h)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(f){const p=d[f*r]=G.copy(a[f*r]);p.x+=(f?l:o)*u[f].n.x,p.y+=(f?l:o)*u[f].n.y}),i?([0,1].forEach(function(f){if(!(r===2&&f)){var p=a[f+1],g={x:p.x-h.x,y:p.y-h.y},m=i?i((f+1)/r):n;i&&!s&&(m=-m);var b=ir(g.x*g.x+g.y*g.y);g.x/=b,g.y/=b,d[f+1]={x:p.x+m*g.x,y:p.y+m*g.y}}}),new Ce(d)):([0,1].forEach(f=>{if(r===2&&f)return;const p=d[f*r],g=this.derivative(f),m={x:p.x+g.x,y:p.y+g.y};d[f+1]=G.lli4(p,m,h,a[f+1])}),new Ce(d))}outline(n,r,i,s){if(r=r===void 0?n:r,this._linear){const C=this.normal(0),_=this.points[0],j=this.points[this.points.length-1];let S,T,P;i===void 0&&(i=n,s=r),S={x:_.x+C.x*n,y:_.y+C.y*n},P={x:j.x+C.x*i,y:j.y+C.y*i},T={x:(S.x+P.x)/2,y:(S.y+P.y)/2};const I=[S,T,P];S={x:_.x-C.x*r,y:_.y-C.y*r},P={x:j.x-C.x*s,y:j.y-C.y*s},T={x:(S.x+P.x)/2,y:(S.y+P.y)/2};const L=[P,T,S],V=G.makeline(L[2],I[0]),R=G.makeline(I[2],L[0]),A=[V,new Ce(I),R,new Ce(L)];return new pr(A)}const a=this.reduce(),o=a.length,l=[];let u=[],d,h=0,f=this.length();const p=typeof i<"u"&&typeof s<"u";function g(C,_,j,S,T){return function(P){const I=S/j,L=(S+T)/j,V=_-C;return G.map(P,0,1,C+I*V,C+L*V)}}a.forEach(function(C){const _=C.length();p?(l.push(C.scale(g(n,i,f,h,_))),u.push(C.scale(g(-r,-s,f,h,_)))):(l.push(C.scale(n)),u.push(C.scale(-r))),h+=_}),u=u.map(function(C){return d=C.points,d[3]?C.points=[d[3],d[2],d[1],d[0]]:C.points=[d[2],d[1],d[0]],C}).reverse();const m=l[0].points[0],b=l[o-1].points[l[o-1].points.length-1],x=u[o-1].points[u[o-1].points.length-1],y=u[0].points[0],w=G.makeline(x,m),N=G.makeline(b,y),k=[w].concat(l).concat([N]).concat(u);return new pr(k)}outlineshapes(n,r,i){r=r||n;const s=this.outline(n,r).curves,a=[];for(let o=1,l=s.length;o<l/2;o++){const u=G.makeshape(s[o],s[l-o],i);u.startcap.virtual=o>1,u.endcap.virtual=o<l/2-1,a.push(u)}return a}intersects(n,r){return n?n.p1&&n.p2?this.lineIntersects(n):(n instanceof Ce&&(n=n.reduce()),this.curveintersects(this.reduce(),n,r)):this.selfintersects(r)}lineIntersects(n){const r=Ko(n.p1.x,n.p2.x),i=Ko(n.p1.y,n.p2.y),s=Jo(n.p1.x,n.p2.x),a=Jo(n.p1.y,n.p2.y);return G.roots(this.points,n).filter(o=>{var l=this.get(o);return G.between(l.x,r,s)&&G.between(l.y,i,a)})}selfintersects(n){const r=this.reduce(),i=r.length-2,s=[];for(let a=0,o,l,u;a<i;a++)l=r.slice(a,a+1),u=r.slice(a+2),o=this.curveintersects(l,u,n),s.push(...o);return s}curveintersects(n,r,i){const s=[];n.forEach(function(o){r.forEach(function(l){o.overlaps(l)&&s.push({left:o,right:l})})});let a=[];return s.forEach(function(o){const l=G.pairiteration(o.left,o.right,i);l.length>0&&(a=a.concat(l))}),a}arcs(n){return n=n||.5,this._iterate(n,[])}_error(n,r,i,s){const a=(s-i)/4,o=this.get(i+a),l=this.get(s-a),u=G.dist(n,r),d=G.dist(n,o),h=G.dist(n,l);return rr(d-u)+rr(h-u)}_iterate(n,r){let i=0,s=1,a;do{a=0,s=1;let o=this.get(i),l,u,d,h,f=!1,p=!1,g,m=s,b=1;do if(p=f,h=d,m=(i+s)/2,l=this.get(m),u=this.get(s),d=G.getccenter(o,l,u),d.interval={start:i,end:s},f=this._error(d,o,i,s)<=n,g=p&&!f,g||(b=s),f){if(s>=1){if(d.interval.end=b=1,h=d,s>1){let y={x:d.x+d.r*Xx(d.e),y:d.y+d.r*Yx(d.e)};d.e+=G.angle({x:d.x,y:d.y},y,this.get(1))}break}s=s+(s-i)/2}else s=m;while(!g&&a++<100);if(a>=100)break;h=h||d,r.push(h),i=b}while(s<1);return r}}function Us(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function Zx(e){if(Array.isArray(e))return e}function ev(e){if(Array.isArray(e))return Us(e)}function tv(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nv(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n!==0)for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function rv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iv(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sv(e,n){if(e==null)return{};var r,i,s=av(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],n.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function av(e,n){if(e==null)return{};var r={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(n.includes(i))continue;r[i]=e[i]}return r}function ov(e,n){return Zx(e)||nv(e,n)||Gc(e,n)||rv()}function lv(e){return ev(e)||tv(e)||Gc(e)||iv()}function cv(e,n){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function uv(e){var n=cv(e,"string");return typeof n=="symbol"?n:n+""}function Gc(e,n){if(e){if(typeof e=="string")return Us(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Us(e,n):void 0}}var fv=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=(n instanceof Array?n.length?n:[void 0]:[n]).map(function(l){return{keyAccessor:l,isProp:!(l instanceof Function)}}),a=e.reduce(function(l,u){var d=l,h=u;return s.forEach(function(f,p){var g=f.keyAccessor,m=f.isProp,b;if(m){var x=h,y=x[g],w=sv(x,[g].map(uv));b=y,h=w}else b=g(h,p);p+1<s.length?(d.hasOwnProperty(b)||(d[b]={}),d=d[b]):r?(d.hasOwnProperty(b)||(d[b]=[]),d[b].push(h)):d[b]=h}),l},{});r instanceof Function&&function l(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;d===s.length?Object.keys(u).forEach(function(h){return u[h]=r(u[h])}):Object.values(u).forEach(function(h){return l(h,d+1)})}(a);var o=a;return i&&(o=[],function l(u){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];d.length===s.length?o.push({keys:d,vals:u}):Object.entries(u).forEach(function(h){var f=ov(h,2),p=f[0],g=f[1];return l(g,[].concat(lv(d),[p]))})}(a),n instanceof Array&&n.length===0&&o.length===1&&(o[0].keys=[])),o};function dv(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}const Zo=Symbol("implicit");function Qc(){var e=new bo,n=[],r=[],i=Zo;function s(a){let o=e.get(a);if(o===void 0){if(i!==Zo)return i;e.set(a,o=n.push(a)-1)}return r[o%r.length]}return s.domain=function(a){if(!arguments.length)return n.slice();n=[],e=new bo;for(const o of a)e.has(o)||e.set(o,n.push(o)-1);return s},s.range=function(a){return arguments.length?(r=Array.from(a),s):r.slice()},s.unknown=function(a){return arguments.length?(i=a,s):i},s.copy=function(){return Qc(n,r).unknown(i)},dv.apply(s,arguments),s}function hv(e){for(var n=e.length/6|0,r=new Array(n),i=0;i<n;)r[i]="#"+e.slice(i*6,++i*6);return r}const pv=hv("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function gv(e,n){n===void 0&&(n={});var r=n.insertAt;if(!(typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}var mv=`.force-graph-container canvas {
  display: block;
  user-select: none;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.force-graph-container .clickable {
  cursor: pointer;
}

.force-graph-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.force-graph-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}
`;gv(mv);function Vs(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=Array(n);r<n;r++)i[r]=e[r];return i}function yv(e){if(Array.isArray(e))return e}function xv(e){if(Array.isArray(e))return Vs(e)}function el(e,n,r){if(Xc())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,n);var s=new(e.bind.apply(e,i));return s}function jr(e,n,r){return(n=Cv(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function Xc(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xc=function(){return!!e})()}function vv(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bv(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,s,a,o,l=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,n!==0)for(;!(u=(i=a.call(r)).done)&&(l.push(i.value),l.length!==n);u=!0);}catch(h){d=!0,s=h}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(d)throw s}}return l}}function wv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _v(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function Pn(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?tl(Object(r),!0).forEach(function(i){jr(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function gr(e,n){return yv(e)||bv(e,n)||Yc(e,n)||wv()}function yt(e){return xv(e)||vv(e)||Yc(e)||_v()}function kv(e,n){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Cv(e){var n=kv(e,"string");return typeof n=="symbol"?n:n+""}function Gs(e){"@babel/helpers - typeof";return Gs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Gs(e)}function Yc(e,n){if(e){if(typeof e=="string")return Vs(e,n);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vs(e,n):void 0}}var jv=Qc(pv);function nl(e,n,r){!n||typeof r!="string"||e.filter(function(i){return!i[r]}).forEach(function(i){i[r]=jv(n(i))})}function Sv(e,n){var r=e.nodes,i=e.links,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=s.nodeFilter,o=a===void 0?function(){return!0}:a,l=s.onLoopError,u=l===void 0?function(g){throw"Invalid DAG structure! Found cycle in node path: ".concat(g.join(" -> "),".")}:l,d={};r.forEach(function(g){return d[n(g)]={data:g,out:[],depth:-1,skip:!o(g)}}),i.forEach(function(g){var m=g.source,b=g.target,x=k(m),y=k(b);if(!d.hasOwnProperty(x))throw"Missing source node with id: ".concat(x);if(!d.hasOwnProperty(y))throw"Missing target node with id: ".concat(y);var w=d[x],N=d[y];w.out.push(N);function k(C){return Gs(C)==="object"?n(C):C}});var h=[];p(Object.values(d));var f=Object.assign.apply(Object,[{}].concat(yt(Object.entries(d).filter(function(g){var m=gr(g,2),b=m[1];return!b.skip}).map(function(g){var m=gr(g,2),b=m[0],x=m[1];return jr({},b,x.depth)}))));return f;function p(g){for(var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,x=function(){var k=g[y];if(m.indexOf(k)!==-1){var C=[].concat(yt(m.slice(m.indexOf(k))),[k]).map(function(_){return n(_.data)});return h.some(function(_){return _.length===C.length&&_.every(function(j,S){return j===C[S]})})||(h.push(C),u(C)),1}b>k.depth&&(k.depth=b,p(k.out,[].concat(yt(m),[k]),b+(k.skip?0:1)))},y=0,w=g.length;y<w;y++)x()}}var Nv=2,We=function(n,r){return r.onNeedsRedraw&&r.onNeedsRedraw()},rl=function(n,r){if(!r.isShadow){var i=ge(r.linkDirectionalParticles);r.graphData.links.forEach(function(s){var a=Math.round(Math.abs(i(s)));a?s.__photons=yt(Array(a)).map(function(){return{}}):delete s.__photons})}},Ci=va({props:{graphData:{default:{nodes:[],links:[]},onChange:function(n,r){r.engineRunning=!1,rl(n,r)}},dagMode:{onChange:function(n,r){!n&&(r.graphData.nodes||[]).forEach(function(i){return i.fx=i.fy=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(n){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:We},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:We},nodeColor:{default:"color",triggerUpdate:!1,onChange:We},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:We},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:We},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:We},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:We},linkColor:{default:"color",triggerUpdate:!1,onChange:We},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:We},linkWidth:{default:1,triggerUpdate:!1,onChange:We},linkCurvature:{default:0,triggerUpdate:!1,onChange:We},linkCanvasObject:{triggerUpdate:!1,onChange:We},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:We},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:We},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:We},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:We},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:rl},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleOffset:{default:0,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},linkDirectionalParticleCanvasObject:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(n,r){r.forceLayout.alphaDecay(n)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(n,r){r.forceLayout.alphaTarget(n)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(n,r){r.forceLayout.velocityDecay(n)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(n,r,i){return i===void 0?n.forceLayout.force(r):(n.forceLayout.force(r,i),this)},d3ReheatSimulation:function(n){return n.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(n){return n.cntTicks=0,n.startTickTime=new Date,n.engineRunning=!0,this},isEngineRunning:function(n){return!!n.engineRunning},tickFrame:function(n){return!n.isShadow&&r(),s(),!n.isShadow&&a(),!n.isShadow&&o(),i(),this;function r(){n.engineRunning&&(++n.cntTicks>n.cooldownTicks||new Date-n.startTickTime>n.cooldownTime||n.d3AlphaMin>0&&n.forceLayout.alpha()<n.d3AlphaMin?(n.engineRunning=!1,n.onEngineStop()):(n.forceLayout.tick(),n.onEngineTick()))}function i(){var l=ge(n.nodeVisibility),u=ge(n.nodeVal),d=ge(n.nodeColor),h=ge(n.nodeCanvasObjectMode),f=n.ctx,p=n.isShadow/n.globalScale,g=n.graphData.nodes.filter(l);f.save(),g.forEach(function(m){var b=h(m);if(n.nodeCanvasObject&&(b==="before"||b==="replace")&&(n.nodeCanvasObject(m,f,n.globalScale),b==="replace")){f.restore();return}var x=Math.sqrt(Math.max(0,u(m)||1))*n.nodeRelSize+p;f.beginPath(),f.arc(m.x,m.y,x,0,2*Math.PI,!1),f.fillStyle=d(m)||"rgba(31, 120, 180, 0.92)",f.fill(),n.nodeCanvasObject&&b==="after"&&n.nodeCanvasObject(m,n.ctx,n.globalScale)}),f.restore()}function s(){var l=ge(n.linkVisibility),u=ge(n.linkColor),d=ge(n.linkWidth),h=ge(n.linkLineDash),f=ge(n.linkCurvature),p=ge(n.linkCanvasObjectMode),g=n.ctx,m=n.isShadow*2,b=n.graphData.links.filter(l);b.forEach(_);var x=[],y=[],w=b;if(n.linkCanvasObject){var N=[],k=[];b.forEach(function(j){return({before:x,after:y,replace:N}[p(j)]||k).push(j)}),w=[].concat(yt(x),y,k),x=x.concat(N)}g.save(),x.forEach(function(j){return n.linkCanvasObject(j,g,n.globalScale)}),g.restore();var C=fv(w,[u,d,h]);g.save(),Object.entries(C).forEach(function(j){var S=gr(j,2),T=S[0],P=S[1],I=!T||T==="undefined"?"rgba(0,0,0,0.15)":T;Object.entries(P).forEach(function(L){var V=gr(L,2),R=V[0],A=V[1],O=(R||1)/n.globalScale+m;Object.entries(A).forEach(function(M){var q=gr(M,2);q[0];var D=q[1],F=h(D[0]);g.beginPath(),D.forEach(function(z){var H=z.source,Y=z.target;if(!(!H||!Y||!H.hasOwnProperty("x")||!Y.hasOwnProperty("x"))){g.moveTo(H.x,H.y);var B=z.__controlPoints;B?g[B.length===2?"quadraticCurveTo":"bezierCurveTo"].apply(g,yt(B).concat([Y.x,Y.y])):g.lineTo(Y.x,Y.y)}}),g.strokeStyle=I,g.lineWidth=O,g.setLineDash(F||[]),g.stroke()})})}),g.restore(),g.save(),y.forEach(function(j){return n.linkCanvasObject(j,g,n.globalScale)}),g.restore();function _(j){var S=f(j);if(!S){j.__controlPoints=null;return}var T=j.source,P=j.target;if(!(!T||!P||!T.hasOwnProperty("x")||!P.hasOwnProperty("x"))){var I=Math.sqrt(Math.pow(P.x-T.x,2)+Math.pow(P.y-T.y,2));if(I>0){var L=Math.atan2(P.y-T.y,P.x-T.x),V=I*S,R={x:(T.x+P.x)/2+V*Math.cos(L-Math.PI/2),y:(T.y+P.y)/2+V*Math.sin(L-Math.PI/2)};j.__controlPoints=[R.x,R.y]}else{var A=S*70;j.__controlPoints=[P.x,P.y-A,P.x+A,P.y]}}}}function a(){var l=1.6,u=.2,d=ge(n.linkDirectionalArrowLength),h=ge(n.linkDirectionalArrowRelPos),f=ge(n.linkVisibility),p=ge(n.linkDirectionalArrowColor||n.linkColor),g=ge(n.nodeVal),m=n.ctx;m.save(),n.graphData.links.filter(f).forEach(function(b){var x=d(b);if(!(!x||x<0)){var y=b.source,w=b.target;if(!(!y||!w||!y.hasOwnProperty("x")||!w.hasOwnProperty("x"))){var N=Math.sqrt(Math.max(0,g(y)||1))*n.nodeRelSize,k=Math.sqrt(Math.max(0,g(w)||1))*n.nodeRelSize,C=Math.min(1,Math.max(0,h(b))),_=p(b)||"rgba(0,0,0,0.28)",j=x/l/2,S=b.__controlPoints&&el(Ce,[y.x,y.y].concat(yt(b.__controlPoints),[w.x,w.y])),T=S?function(O){return S.get(O)}:function(O){return{x:y.x+(w.x-y.x)*O||0,y:y.y+(w.y-y.y)*O||0}},P=S?S.length():Math.sqrt(Math.pow(w.x-y.x,2)+Math.pow(w.y-y.y,2)),I=N+x+(P-N-k-x)*C,L=T(I/P),V=T((I-x)/P),R=T((I-x*(1-u))/P),A=Math.atan2(L.y-V.y,L.x-V.x)-Math.PI/2;m.beginPath(),m.moveTo(L.x,L.y),m.lineTo(V.x+j*Math.cos(A),V.y+j*Math.sin(A)),m.lineTo(R.x,R.y),m.lineTo(V.x-j*Math.cos(A),V.y-j*Math.sin(A)),m.fillStyle=_,m.fill()}}}),m.restore()}function o(){var l=ge(n.linkDirectionalParticles),u=ge(n.linkDirectionalParticleSpeed),d=ge(n.linkDirectionalParticleOffset),h=ge(n.linkDirectionalParticleWidth),f=ge(n.linkVisibility),p=ge(n.linkDirectionalParticleColor||n.linkColor),g=n.ctx;g.save(),n.graphData.links.filter(f).forEach(function(m){var b=l(m);if(!(!m.hasOwnProperty("__photons")||!m.__photons.length)){var x=m.source,y=m.target;if(!(!x||!y||!x.hasOwnProperty("x")||!y.hasOwnProperty("x"))){var w=u(m),N=Math.abs(d(m)),k=m.__photons||[],C=Math.max(0,h(m)/2)/Math.sqrt(n.globalScale),_=p(m)||"rgba(0,0,0,0.28)";g.fillStyle=_;var j=m.__controlPoints?el(Ce,[x.x,x.y].concat(yt(m.__controlPoints),[y.x,y.y])):null,S=0,T=!1;k.forEach(function(P){var I=!!P.__singleHop;if(P.hasOwnProperty("__progressRatio")||(P.__progressRatio=I?0:(S+N)/b),!I&&S++,P.__progressRatio+=w,P.__progressRatio>=1)if(!I)P.__progressRatio=P.__progressRatio%1;else{T=!0;return}var L=P.__progressRatio,V=j?j.get(L):{x:x.x+(y.x-x.x)*L||0,y:x.y+(y.y-x.y)*L||0};n.linkDirectionalParticleCanvasObject?n.linkDirectionalParticleCanvasObject(V.x,V.y,m,g,n.globalScale):(g.beginPath(),g.arc(V.x,V.y,C,0,2*Math.PI,!1),g.fill())}),T&&(m.__photons=m.__photons.filter(function(P){return!P.__singleHop||P.__progressRatio<=1}))}}}),g.restore()}},emitParticle:function(n,r){return r&&(!r.__photons&&(r.__photons=[]),r.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:Bx().force("link",Ox()).force("charge",Wx()).force("center",Fy()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(n,r){r.ctx=n},update:function(n,r){n.engineRunning=!1,n.onUpdate(),n.nodeAutoColorBy!==null&&nl(n.graphData.nodes,ge(n.nodeAutoColorBy),n.nodeColor),n.linkAutoColorBy!==null&&nl(n.graphData.links,ge(n.linkAutoColorBy),n.linkColor),n.graphData.links.forEach(function(p){p.source=p[n.linkSource],p.target=p[n.linkTarget]}),n.forceLayout.stop().alpha(1).nodes(n.graphData.nodes);var i=n.forceLayout.force("link");i&&i.id(function(p){return p[n.nodeId]}).links(n.graphData.links);var s=n.dagMode&&Sv(n.graphData,function(p){return p[n.nodeId]},{nodeFilter:n.dagNodeFilter,onLoopError:n.onDagError||void 0}),a=Math.max.apply(Math,yt(Object.values(s||[]))),o=n.dagLevelDistance||n.graphData.nodes.length/(a||1)*Nv*(["radialin","radialout"].indexOf(n.dagMode)!==-1?.7:1);if(["lr","rl","td","bu"].includes(r.dagMode)){var l=["lr","rl"].includes(r.dagMode)?"fx":"fy";n.graphData.nodes.filter(n.dagNodeFilter).forEach(function(p){return delete p[l]})}if(["lr","rl","td","bu"].includes(n.dagMode)){var u=["rl","bu"].includes(n.dagMode),d=function(g){return(s[g[n.nodeId]]-a/2)*o*(u?-1:1)},h=["lr","rl"].includes(n.dagMode)?"fx":"fy";n.graphData.nodes.filter(n.dagNodeFilter).forEach(function(p){return p[h]=d(p)})}n.forceLayout.force("dagRadial",["radialin","radialout"].indexOf(n.dagMode)!==-1?Ux(function(p){var g=s[p[n.nodeId]]||-1;return(n.dagMode==="radialin"?a-g:g)*o}).strength(function(p){return n.dagNodeFilter(p)?1:0}):null);for(var f=0;f<n.warmupTicks&&!(n.d3AlphaMin>0&&n.forceLayout.alpha()<n.d3AlphaMin);f++)n.forceLayout.tick();this.resetCountdown(),n.onFinishUpdate()}});function Kc(e,n){var r=e instanceof Array?e:[e],i=new n;return i._destructor&&i._destructor(),{linkProp:function(a){return{default:i[a](),onChange:function(l,u){r.forEach(function(d){return u[d][a](l)})},triggerUpdate:!1}},linkMethod:function(a){return function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),d=1;d<l;d++)u[d-1]=arguments[d];var h=[];return r.forEach(function(f){var p=o[f],g=p[a].apply(p,u);g!==p&&h.push(g)}),h.length?h[0]:this}}}}var Tv=800,Rv=4,Ev=5,Jc=Kc("forceGraph",Ci),Mv=Kc(["forceGraph","shadowGraph"],Ci),Pv=Object.assign.apply(Object,yt(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleOffset","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleCanvasObject","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(e){return jr({},e,Jc.linkProp(e))})).concat(yt(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map(function(e){return jr({},e,Mv.linkProp(e))})))),Av=Object.assign.apply(Object,yt(["d3Force","d3ReheatSimulation","emitParticle"].map(function(e){return jr({},e,Jc.linkMethod(e))})));function is(e){if(e.canvas){var n=e.canvas.width,r=e.canvas.height;n===300&&r===150&&(n=r=0);var i=window.devicePixelRatio;n/=i,r/=i,[e.canvas,e.shadowCanvas].forEach(function(a){a.style.width="".concat(e.width,"px"),a.style.height="".concat(e.height,"px"),a.width=e.width*i,a.height=e.height*i,!n&&!r&&a.getContext("2d").scale(i,i)});var s=Pt(e.canvas).k;e.zoom.translateBy(e.zoom.__baseElem,(e.width-n)/2/s,(e.height-r)/2/s),e.needsRedraw=!0}}function Zc(e){var n=window.devicePixelRatio;e.setTransform(n,0,0,n,0,0)}function il(e,n,r){e.save(),Zc(e),e.clearRect(0,0,n,r),e.restore()}var Iv=va({props:Pn({width:{default:window.innerWidth,onChange:function(n,r){return is(r)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(n,r){return is(r)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(n,r){[n.nodes,n.links].every(function(s){return(s||[]).every(function(a){return!a.hasOwnProperty("__indexColor")})})&&r.colorTracker.reset(),[{type:"Node",objs:n.nodes},{type:"Link",objs:n.links}].forEach(i),r.forceGraph.graphData(n),r.shadowGraph.graphData(n);function i(s){var a=s.type,o=s.objs;o.filter(function(l){if(!l.hasOwnProperty("__indexColor"))return!0;var u=r.colorTracker.lookup(l.__indexColor);return!u||!u.hasOwnProperty("d")||u.d!==l}).forEach(function(l){l.__indexColor=r.colorTracker.register({type:a,d:l})})}},triggerUpdate:!1},backgroundColor:{onChange:function(n,r){r.canvas&&n&&(r.canvas.style.background=n)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(n,r){r.shadowGraph.nodeCanvasObject(n?function(i,s,a){return n(i,i.__indexColor,s,a)}:null),r.flushShadowCanvas&&r.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(n,r){r.shadowGraph.linkCanvasObject(n?function(i,s,a){return n(i,i.__indexColor,s,a)}:null),r.flushShadowCanvas&&r.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(n,r){r.zoom.scaleExtent([n,r.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(n,r){r.zoom.scaleExtent([r.zoom.scaleExtent()[0],n])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(n,r){r.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},Pv),aliases:{stopAnimation:"pauseAnimation"},methods:Pn({graph2ScreenCoords:function(n,r,i){var s=Pt(n.canvas);return{x:r*s.k+s.x,y:i*s.k+s.y}},screen2GraphCoords:function(n,r,i){var s=Pt(n.canvas);return{x:(r-s.x)/s.k,y:(i-s.y)/s.k}},centerAt:function(n,r,i,s){if(!n.canvas)return null;if(r!==void 0||i!==void 0){var a=Object.assign({},r!==void 0?{x:r}:{},i!==void 0?{y:i}:{});return s?n.tweenGroup.add(new No(o()).to(a,s).easing(jn.Quadratic.Out).onUpdate(l).start()):l(a),this}return o();function o(){var u=Pt(n.canvas);return{x:(n.width/2-u.x)/u.k,y:(n.height/2-u.y)/u.k}}function l(u){var d=u.x,h=u.y;n.zoom.translateTo(n.zoom.__baseElem,d===void 0?o().x:d,h===void 0?o().y:h),n.needsRedraw=!0}},zoom:function(n,r,i){if(!n.canvas)return null;if(r!==void 0)return i?n.tweenGroup.add(new No({k:s()}).to({k:r},i).easing(jn.Quadratic.Out).onUpdate(function(o){var l=o.k;return a(l)}).start()):a(r),this;return s();function s(){return Pt(n.canvas).k}function a(o){n.zoom.scaleTo(n.zoom.__baseElem,o),n.needsRedraw=!0}},zoomToFit:function(n){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,s=arguments.length,a=new Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];var l=this.getGraphBbox.apply(this,a);if(l){var u={x:(l.x[0]+l.x[1])/2,y:(l.y[0]+l.y[1])/2},d=Math.max(1e-12,Math.min(1e12,(n.width-i*2)/(l.x[1]-l.x[0]),(n.height-i*2)/(l.y[1]-l.y[0])));this.centerAt(u.x,u.y,r),this.zoom(d,r)}return this},getGraphBbox:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},i=ge(n.nodeVal),s=function(l){return Math.sqrt(Math.max(0,i(l)||1))*n.nodeRelSize},a=n.graphData.nodes.filter(r).map(function(o){return{x:o.x,y:o.y,r:s(o)}});return a.length?{x:[ko(a,function(o){return o.x-o.r}),_o(a,function(o){return o.x+o.r})],y:[ko(a,function(o){return o.y-o.r}),_o(a,function(o){return o.y+o.r})]}:null},pauseAnimation:function(n){return n.animationFrameRequestId&&(cancelAnimationFrame(n.animationFrameRequestId),n.animationFrameRequestId=null),this},resumeAnimation:function(n){return n.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Av),stateInit:function(){return{lastSetZoom:1,zoom:Um(),forceGraph:new Ci,shadowGraph:new Ci().cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new gy,tweenGroup:new wc}},init:function(n,r){var i=this;n.innerHTML="";var s=document.createElement("div");s.classList.add("force-graph-container"),s.style.position="relative",n.appendChild(s),r.canvas=document.createElement("canvas"),r.backgroundColor&&(r.canvas.style.background=r.backgroundColor),s.appendChild(r.canvas),r.shadowCanvas=document.createElement("canvas");var a=r.canvas.getContext("2d"),o=r.shadowCanvas.getContext("2d",{willReadFrequently:!0}),l={x:-1e12,y:-1e12},u=function(){var f=null,p=window.devicePixelRatio,g=l.x>0&&l.y>0?o.getImageData(l.x*p,l.y*p,1,1):null;return g&&(f=r.colorTracker.lookup(g.data)),f};mt(r.canvas).call(tg().subject(function(){if(!r.enableNodeDrag)return null;var h=u();return h&&h.type==="Node"?h.d:null}).on("start",function(h){var f=h.subject;f.__initialDragPos={x:f.x,y:f.y,fx:f.fx,fy:f.fy},h.active||(f.fx=f.x,f.fy=f.y),r.canvas.classList.add("grabbable")}).on("drag",function(h){var f=h.subject,p=f.__initialDragPos,g=h,m=Pt(r.canvas).k,b={x:p.x+(g.x-p.x)/m-f.x,y:p.y+(g.y-p.y)/m-f.y};["x","y"].forEach(function(x){return f["f".concat(x)]=f[x]=p[x]+(g[x]-p[x])/m}),!(!f.__dragged&&Ev>=Math.sqrt(Xm(["x","y"].map(function(x){return Math.pow(h[x]-p[x],2)}))))&&(r.forceGraph.d3AlphaTarget(.3).resetCountdown(),r.isPointerDragging=!0,f.__dragged=!0,r.onNodeDrag(f,b))}).on("end",function(h){var f=h.subject,p=f.__initialDragPos,g={x:f.x-p.x,y:f.y-p.y};p.fx===void 0&&(f.fx=void 0),p.fy===void 0&&(f.fy=void 0),delete f.__initialDragPos,r.forceGraph.d3AlphaTarget()&&r.forceGraph.d3AlphaTarget(0).resetCountdown(),r.canvas.classList.remove("grabbable"),r.isPointerDragging=!1,f.__dragged&&(delete f.__dragged,r.onNodeDragEnd(f,g))})),r.zoom(r.zoom.__baseElem=mt(r.canvas)),r.zoom.__baseElem.on("dblclick.zoom",null),r.zoom.filter(function(h){return!h.button&&r.enableZoomPanInteraction&&(h.type!=="wheel"||ge(r.enableZoomInteraction)(h))&&(h.type==="wheel"||ge(r.enablePanInteraction)(h))}).on("zoom",function(h){var f=h.transform;[a,o].forEach(function(p){Zc(p),p.translate(f.x,f.y),p.scale(f.k,f.k)}),r.isPointerDragging=!0,r.onZoom&&r.onZoom(Pn(Pn({},f),i.centerAt())),r.needsRedraw=!0}).on("end",function(h){r.isPointerDragging=!1,r.onZoomEnd&&r.onZoomEnd(Pn(Pn({},h.transform),i.centerAt()))}),is(r),r.forceGraph.onNeedsRedraw(function(){return r.needsRedraw=!0}).onFinishUpdate(function(){Pt(r.canvas).k===r.lastSetZoom&&r.graphData.nodes.length&&(r.zoom.scaleTo(r.zoom.__baseElem,r.lastSetZoom=Rv/Math.cbrt(r.graphData.nodes.length)),r.needsRedraw=!0)}),r.tooltip=new Dy(s),["pointermove","pointerdown"].forEach(function(h){return s.addEventListener(h,function(f){h==="pointerdown"&&(r.isPointerPressed=!0,r.pointerDownEvent=f),!r.isPointerDragging&&f.type==="pointermove"&&r.onBackgroundClick&&(f.pressure>0||r.isPointerPressed)&&(f.pointerType==="mouse"||f.movementX===void 0||[f.movementX,f.movementY].some(function(m){return Math.abs(m)>1}))&&(r.isPointerDragging=!0);var p=g(s);l.x=f.pageX-p.left,l.y=f.pageY-p.top;function g(m){var b=m.getBoundingClientRect(),x=window.pageXOffset||document.documentElement.scrollLeft,y=window.pageYOffset||document.documentElement.scrollTop;return{top:b.top+y,left:b.left+x}}},{passive:!0})}),s.addEventListener("pointerup",function(h){if(r.isPointerPressed){if(r.isPointerPressed=!1,r.isPointerDragging){r.isPointerDragging=!1;return}var f=[h,r.pointerDownEvent];requestAnimationFrame(function(){if(h.button===0)if(r.hoverObj){var p=r["on".concat(r.hoverObj.type,"Click")];p&&p.apply(void 0,[r.hoverObj.d].concat(f))}else r.onBackgroundClick&&r.onBackgroundClick.apply(r,f);if(h.button===2)if(r.hoverObj){var g=r["on".concat(r.hoverObj.type,"RightClick")];g&&g.apply(void 0,[r.hoverObj.d].concat(f))}else r.onBackgroundRightClick&&r.onBackgroundRightClick.apply(r,f)})}},{passive:!0}),s.addEventListener("contextmenu",function(h){return!r.onBackgroundRightClick&&!r.onNodeRightClick&&!r.onLinkRightClick?!0:(h.preventDefault(),!1)}),r.forceGraph(a),r.shadowGraph(o);var d=_0(function(){il(o,r.width,r.height),r.shadowGraph.linkWidth(function(f){return ge(r.linkWidth)(f)+r.linkHoverPrecision});var h=Pt(r.canvas);r.shadowGraph.globalScale(h.k).tickFrame()},Tv);r.flushShadowCanvas=d.flush,(this._animationCycle=function h(){var f=!r.autoPauseRedraw||!!r.needsRedraw||r.forceGraph.isEngineRunning()||r.graphData.links.some(function(N){return N.__photons&&N.__photons.length});if(r.needsRedraw=!1,r.enablePointerInteraction){var p=r.isPointerDragging?null:u();if(p!==r.hoverObj){var g=r.hoverObj,m=g?g.type:null,b=p?p.type:null;if(m&&m!==b){var x=r["on".concat(m,"Hover")];x&&x(null,g.d)}if(b){var y=r["on".concat(b,"Hover")];y&&y(p.d,m===b?g.d:null)}r.tooltip.content(p&&ge(r["".concat(p.type.toLowerCase(),"Label")])(p.d)||null),r.canvas.classList[p&&r["on".concat(b,"Click")]||!p&&r.onBackgroundClick?"add":"remove"]("clickable"),r.hoverObj=p}f&&d()}if(f){il(a,r.width,r.height);var w=Pt(r.canvas).k;r.onRenderFramePre&&r.onRenderFramePre(a,w),r.forceGraph.globalScale(w).tickFrame(),r.onRenderFramePost&&r.onRenderFramePost(a,w)}r.tweenGroup.update(),r.animationFrameRequestId=requestAnimationFrame(h)})()},update:function(n){}}),ss={exports:{}},as,sl;function Ov(){if(sl)return as;sl=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return as=e,as}var os,al;function Dv(){if(al)return os;al=1;var e=Ov();function n(){}function r(){}return r.resetWarningCache=n,os=function(){function i(o,l,u,d,h,f){if(f!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}i.isRequired=i;function s(){return i}var a={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:s,element:i,elementType:i,instanceOf:s,node:i,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:r,resetWarningCache:n};return a.PropTypes=a,a},os}var ol;function Fv(){return ol||(ol=1,ss.exports=Dv()()),ss.exports}var Lv=Fv();const E=Yu(Lv),qi={width:E.number,height:E.number,graphData:E.shape({nodes:E.arrayOf(E.object).isRequired,links:E.arrayOf(E.object).isRequired}),backgroundColor:E.string,nodeRelSize:E.number,nodeId:E.string,nodeLabel:E.oneOfType([E.string,E.func]),nodeVal:E.oneOfType([E.number,E.string,E.func]),nodeVisibility:E.oneOfType([E.bool,E.string,E.func]),nodeColor:E.oneOfType([E.string,E.func]),nodeAutoColorBy:E.oneOfType([E.string,E.func]),onNodeHover:E.func,onNodeClick:E.func,linkSource:E.string,linkTarget:E.string,linkLabel:E.oneOfType([E.string,E.func]),linkVisibility:E.oneOfType([E.bool,E.string,E.func]),linkColor:E.oneOfType([E.string,E.func]),linkAutoColorBy:E.oneOfType([E.string,E.func]),linkWidth:E.oneOfType([E.number,E.string,E.func]),linkCurvature:E.oneOfType([E.number,E.string,E.func]),linkDirectionalArrowLength:E.oneOfType([E.number,E.string,E.func]),linkDirectionalArrowColor:E.oneOfType([E.string,E.func]),linkDirectionalArrowRelPos:E.oneOfType([E.number,E.string,E.func]),linkDirectionalParticles:E.oneOfType([E.number,E.string,E.func]),linkDirectionalParticleSpeed:E.oneOfType([E.number,E.string,E.func]),linkDirectionalParticleOffset:E.oneOfType([E.number,E.string,E.func]),linkDirectionalParticleWidth:E.oneOfType([E.number,E.string,E.func]),linkDirectionalParticleColor:E.oneOfType([E.string,E.func]),onLinkHover:E.func,onLinkClick:E.func,dagMode:E.oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:E.number,dagNodeFilter:E.func,onDagError:E.func,d3AlphaMin:E.number,d3AlphaDecay:E.number,d3VelocityDecay:E.number,warmupTicks:E.number,cooldownTicks:E.number,cooldownTime:E.number,onEngineTick:E.func,onEngineStop:E.func,getGraphBbox:E.func},eu={zoomToFit:E.func,onNodeRightClick:E.func,onNodeDrag:E.func,onNodeDragEnd:E.func,onLinkRightClick:E.func,linkHoverPrecision:E.number,onBackgroundClick:E.func,onBackgroundRightClick:E.func,enablePointerInteraction:E.bool,enableNodeDrag:E.bool},Na={showNavInfo:E.bool,nodeOpacity:E.number,nodeResolution:E.number,nodeThreeObject:E.oneOfType([E.object,E.string,E.func]),nodeThreeObjectExtend:E.oneOfType([E.bool,E.string,E.func]),nodePositionUpdate:E.func,linkOpacity:E.number,linkResolution:E.number,linkCurveRotation:E.oneOfType([E.number,E.string,E.func]),linkMaterial:E.oneOfType([E.object,E.string,E.func]),linkThreeObject:E.oneOfType([E.object,E.string,E.func]),linkThreeObjectExtend:E.oneOfType([E.bool,E.string,E.func]),linkPositionUpdate:E.func,linkDirectionalArrowResolution:E.number,linkDirectionalParticleResolution:E.number,linkDirectionalParticleThreeObject:E.oneOfType([E.object,E.string,E.func]),forceEngine:E.oneOf(["d3","ngraph"]),ngraphPhysics:E.object,numDimensions:E.oneOf([1,2,3])},zv=Object.assign({},qi,eu,{linkLineDash:E.oneOfType([E.arrayOf(E.number),E.string,E.func]),nodeCanvasObjectMode:E.oneOfType([E.string,E.func]),nodeCanvasObject:E.func,nodePointerAreaPaint:E.func,linkCanvasObjectMode:E.oneOfType([E.string,E.func]),linkCanvasObject:E.func,linkPointerAreaPaint:E.func,linkDirectionalParticleCanvasObject:E.func,autoPauseRedraw:E.bool,minZoom:E.number,maxZoom:E.number,enableZoomInteraction:E.oneOfType([E.bool,E.func]),enablePanInteraction:E.oneOfType([E.bool,E.func]),onZoom:E.func,onZoomEnd:E.func,onRenderFramePre:E.func,onRenderFramePost:E.func});Object.assign({},qi,eu,Na,{enableNavigationControls:E.bool,controlType:E.oneOf(["trackball","orbit","fly"]),rendererConfig:E.object,extraRenderers:E.arrayOf(E.shape({render:E.func.isRequired}))});Object.assign({},qi,Na,{nodeDesc:E.oneOfType([E.string,E.func]),linkDesc:E.oneOfType([E.string,E.func])});Object.assign({},qi,Na,{markerAttrs:E.object,yOffset:E.number,glScale:E.number});const Ta=hh(Iv,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});Ta.displayName="ForceGraph2D";Ta.propTypes=zv;const tu=({items:e,edges:n=[],onNodeClick:r})=>{var h,f;const i=v.useRef(void 0),s=v.useRef(null),[a,o]=v.useState(n);v.useEffect(()=>{o(n)},[n]),v.useEffect(()=>{var p;(p=i.current)==null||p.zoomToFit(200,20)},[]);const l=v.useMemo(()=>{const p=new Set(e.map(m=>m.id)),g=a.filter(m=>p.has(m.from)&&p.has(m.to)).map(m=>({source:m.from,target:m.to}));return{nodes:e.map(m=>({...m,id:m.id,val:4})),links:g}},[e,a]),u=p=>{const g=p;r?r(g):window.dispatchEvent(new CustomEvent("questTaskOpen",{detail:{taskId:g.id}}))},d=()=>{var p;(p=i.current)==null||p.d3ReheatSimulation()};return c.jsxs("div",{ref:s,className:"overflow-auto w-full h-full p-2 max-w-7xl mx-auto",style:{minHeight:"24vh",maxHeight:"40vh",border:"1px solid #ccc",position:"relative"},children:[c.jsx("button",{type:"button",onClick:()=>{var p;return(p=i.current)==null?void 0:p.zoomToFit(200,20)},className:"absolute right-2 top-2 z-10 bg-surface hover:bg-background rounded shadow px-2 py-1 text-xs",children:"Center Graph"}),c.jsx(Ta,{ref:i,width:((h=s.current)==null?void 0:h.clientWidth)||void 0,height:((f=s.current)==null?void 0:f.clientHeight)||void 0,enableNodeDrag:!0,graphData:l,nodeId:"id",nodeRelSize:6,linkDirectionalArrowLength:6,linkDirectionalArrowRelPos:1,nodeLabel:p=>Rf(p),onNodeClick:u,onNodeDragEnd:d})]})},Hi=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Vn(e){const n=Object.prototype.toString.call(e);return n==="[object Window]"||n==="[object global]"}function Ra(e){return"nodeType"in e}function st(e){var n,r;return e?Vn(e)?e:Ra(e)&&(n=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?n:window:window}function Ea(e){const{Document:n}=st(e);return e instanceof n}function Fr(e){return Vn(e)?!1:e instanceof st(e).HTMLElement}function nu(e){return e instanceof st(e).SVGElement}function Gn(e){return e?Vn(e)?e.document:Ra(e)?Ea(e)?e:Fr(e)||nu(e)?e.ownerDocument:document:document:document}const hn=Hi?v.useLayoutEffect:v.useEffect;function Ma(e){const n=v.useRef(e);return hn(()=>{n.current=e}),v.useCallback(function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return n.current==null?void 0:n.current(...i)},[])}function $v(){const e=v.useRef(null),n=v.useCallback((i,s)=>{e.current=setInterval(i,s)},[]),r=v.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[n,r]}function Sr(e,n){n===void 0&&(n=[e]);const r=v.useRef(e);return hn(()=>{r.current!==e&&(r.current=e)},n),r}function Lr(e,n){const r=v.useRef();return v.useMemo(()=>{const i=e(r.current);return r.current=i,i},[...n])}function ji(e){const n=Ma(e),r=v.useRef(null),i=v.useCallback(s=>{s!==r.current&&(n==null||n(s,r.current)),r.current=s},[]);return[r,i]}function Qs(e){const n=v.useRef();return v.useEffect(()=>{n.current=e},[e]),n.current}let ls={};function Bi(e,n){return v.useMemo(()=>{if(n)return n;const r=ls[e]==null?0:ls[e]+1;return ls[e]=r,e+"-"+r},[e,n])}function ru(e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.reduce((a,o)=>{const l=Object.entries(o);for(const[u,d]of l){const h=a[u];h!=null&&(a[u]=h+e*d)}return a},{...n})}}const Dn=ru(1),Si=ru(-1);function qv(e){return"clientX"in e&&"clientY"in e}function iu(e){if(!e)return!1;const{KeyboardEvent:n}=st(e.target);return n&&e instanceof n}function Hv(e){if(!e)return!1;const{TouchEvent:n}=st(e.target);return n&&e instanceof n}function Xs(e){if(Hv(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:r}=e.touches[0];return{x:n,y:r}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:r}=e.changedTouches[0];return{x:n,y:r}}}return qv(e)?{x:e.clientX,y:e.clientY}:null}const Ni=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:r}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:r}=e;return"scaleX("+n+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[Ni.Translate.toString(e),Ni.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:r,easing:i}=e;return n+" "+r+"ms "+i}}}),ll="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Bv(e){return e.matches(ll)?e:e.querySelector(ll)}const Wv={display:"none"};function Uv(e){let{id:n,value:r}=e;return Xe.createElement("div",{id:n,style:Wv},r)}function Vv(e){let{id:n,announcement:r,ariaLiveType:i="assertive"}=e;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Xe.createElement("div",{id:n,style:s,role:"status","aria-live":i,"aria-atomic":!0},r)}function Gv(){const[e,n]=v.useState("");return{announce:v.useCallback(i=>{i!=null&&n(i)},[]),announcement:e}}const su=v.createContext(null);function Qv(e){const n=v.useContext(su);v.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}function Xv(){const[e]=v.useState(()=>new Set),n=v.useCallback(i=>(e.add(i),()=>e.delete(i)),[e]);return[v.useCallback(i=>{let{type:s,event:a}=i;e.forEach(o=>{var l;return(l=o[s])==null?void 0:l.call(o,a)})},[e]),n]}const Yv={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Kv={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was moved over droppable area "+r.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was dropped over droppable area "+r.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function Jv(e){let{announcements:n=Kv,container:r,hiddenTextDescribedById:i,screenReaderInstructions:s=Yv}=e;const{announce:a,announcement:o}=Gv(),l=Bi("DndLiveRegion"),[u,d]=v.useState(!1);if(v.useEffect(()=>{d(!0)},[]),Qv(v.useMemo(()=>({onDragStart(f){let{active:p}=f;a(n.onDragStart({active:p}))},onDragMove(f){let{active:p,over:g}=f;n.onDragMove&&a(n.onDragMove({active:p,over:g}))},onDragOver(f){let{active:p,over:g}=f;a(n.onDragOver({active:p,over:g}))},onDragEnd(f){let{active:p,over:g}=f;a(n.onDragEnd({active:p,over:g}))},onDragCancel(f){let{active:p,over:g}=f;a(n.onDragCancel({active:p,over:g}))}}),[a,n])),!u)return null;const h=Xe.createElement(Xe.Fragment,null,Xe.createElement(Uv,{id:i,value:s.draggable}),Xe.createElement(Vv,{id:l,announcement:o}));return r?sr.createPortal(h,r):h}var Oe;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Oe||(Oe={}));function Ti(){}function Zv(e,n){return v.useMemo(()=>({sensor:e,options:n??{}}),[e,n])}function eb(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return v.useMemo(()=>[...n].filter(i=>i!=null),[...n])}const Rt=Object.freeze({x:0,y:0});function tb(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function nb(e,n){let{data:{value:r}}=e,{data:{value:i}}=n;return r-i}function rb(e,n){let{data:{value:r}}=e,{data:{value:i}}=n;return i-r}function ib(e,n){if(!e||e.length===0)return null;const[r]=e;return r[n]}function cl(e,n,r){return n===void 0&&(n=e.left),r===void 0&&(r=e.top),{x:n+e.width*.5,y:r+e.height*.5}}const sb=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:i}=e;const s=cl(n,n.left,n.top),a=[];for(const o of i){const{id:l}=o,u=r.get(l);if(u){const d=tb(cl(u),s);a.push({id:l,data:{droppableContainer:o,value:d}})}}return a.sort(nb)};function ab(e,n){const r=Math.max(n.top,e.top),i=Math.max(n.left,e.left),s=Math.min(n.left+n.width,e.left+e.width),a=Math.min(n.top+n.height,e.top+e.height),o=s-i,l=a-r;if(i<s&&r<a){const u=n.width*n.height,d=e.width*e.height,h=o*l,f=h/(u+d-h);return Number(f.toFixed(4))}return 0}const ob=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:i}=e;const s=[];for(const a of i){const{id:o}=a,l=r.get(o);if(l){const u=ab(l,n);u>0&&s.push({id:o,data:{droppableContainer:a,value:u}})}}return s.sort(rb)};function lb(e,n,r){return{...e,scaleX:n&&r?n.width/r.width:1,scaleY:n&&r?n.height/r.height:1}}function au(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:Rt}function cb(e){return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];return s.reduce((o,l)=>({...o,top:o.top+e*l.y,bottom:o.bottom+e*l.y,left:o.left+e*l.x,right:o.right+e*l.x}),{...r})}}const ub=cb(1);function fb(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}else if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}function db(e,n,r){const i=fb(n);if(!i)return e;const{scaleX:s,scaleY:a,x:o,y:l}=i,u=e.left-o-(1-s)*parseFloat(r),d=e.top-l-(1-a)*parseFloat(r.slice(r.indexOf(" ")+1)),h=s?e.width/s:e.width,f=a?e.height/a:e.height;return{width:h,height:f,top:d,right:u+h,bottom:d+f,left:u}}const hb={ignoreTransform:!1};function zr(e,n){n===void 0&&(n=hb);let r=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:d,transformOrigin:h}=st(e).getComputedStyle(e);d&&(r=db(r,d,h))}const{top:i,left:s,width:a,height:o,bottom:l,right:u}=r;return{top:i,left:s,width:a,height:o,bottom:l,right:u}}function ul(e){return zr(e,{ignoreTransform:!0})}function pb(e){const n=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:n,bottom:r,width:n,height:r}}function gb(e,n){return n===void 0&&(n=st(e).getComputedStyle(e)),n.position==="fixed"}function mb(e,n){n===void 0&&(n=st(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const a=n[s];return typeof a=="string"?r.test(a):!1})}function Pa(e,n){const r=[];function i(s){if(n!=null&&r.length>=n||!s)return r;if(Ea(s)&&s.scrollingElement!=null&&!r.includes(s.scrollingElement))return r.push(s.scrollingElement),r;if(!Fr(s)||nu(s)||r.includes(s))return r;const a=st(e).getComputedStyle(s);return s!==e&&mb(s,a)&&r.push(s),gb(s,a)?r:i(s.parentNode)}return e?i(e):r}function ou(e){const[n]=Pa(e,1);return n??null}function cs(e){return!Hi||!e?null:Vn(e)?e:Ra(e)?Ea(e)||e===Gn(e).scrollingElement?window:Fr(e)?e:null:null}function lu(e){return Vn(e)?e.scrollX:e.scrollLeft}function cu(e){return Vn(e)?e.scrollY:e.scrollTop}function Ys(e){return{x:lu(e),y:cu(e)}}var Fe;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Fe||(Fe={}));function uu(e){return!Hi||!e?!1:e===document.scrollingElement}function fu(e){const n={x:0,y:0},r=uu(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},i={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},s=e.scrollTop<=n.y,a=e.scrollLeft<=n.x,o=e.scrollTop>=i.y,l=e.scrollLeft>=i.x;return{isTop:s,isLeft:a,isBottom:o,isRight:l,maxScroll:i,minScroll:n}}const yb={x:.2,y:.2};function xb(e,n,r,i,s){let{top:a,left:o,right:l,bottom:u}=r;i===void 0&&(i=10),s===void 0&&(s=yb);const{isTop:d,isBottom:h,isLeft:f,isRight:p}=fu(e),g={x:0,y:0},m={x:0,y:0},b={height:n.height*s.y,width:n.width*s.x};return!d&&a<=n.top+b.height?(g.y=Fe.Backward,m.y=i*Math.abs((n.top+b.height-a)/b.height)):!h&&u>=n.bottom-b.height&&(g.y=Fe.Forward,m.y=i*Math.abs((n.bottom-b.height-u)/b.height)),!p&&l>=n.right-b.width?(g.x=Fe.Forward,m.x=i*Math.abs((n.right-b.width-l)/b.width)):!f&&o<=n.left+b.width&&(g.x=Fe.Backward,m.x=i*Math.abs((n.left+b.width-o)/b.width)),{direction:g,speed:m}}function vb(e){if(e===document.scrollingElement){const{innerWidth:a,innerHeight:o}=window;return{top:0,left:0,right:a,bottom:o,width:a,height:o}}const{top:n,left:r,right:i,bottom:s}=e.getBoundingClientRect();return{top:n,left:r,right:i,bottom:s,width:e.clientWidth,height:e.clientHeight}}function du(e){return e.reduce((n,r)=>Dn(n,Ys(r)),Rt)}function bb(e){return e.reduce((n,r)=>n+lu(r),0)}function wb(e){return e.reduce((n,r)=>n+cu(r),0)}function _b(e,n){if(n===void 0&&(n=zr),!e)return;const{top:r,left:i,bottom:s,right:a}=n(e);ou(e)&&(s<=0||a<=0||r>=window.innerHeight||i>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const kb=[["x",["left","right"],bb],["y",["top","bottom"],wb]];class Aa{constructor(n,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=Pa(r),s=du(i);this.rect={...n},this.width=n.width,this.height=n.height;for(const[a,o,l]of kb)for(const u of o)Object.defineProperty(this,u,{get:()=>{const d=l(i),h=s[a]-d;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class mr{constructor(n){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...r)})},this.target=n}add(n,r,i){var s;(s=this.target)==null||s.addEventListener(n,r,i),this.listeners.push([n,r,i])}}function Cb(e){const{EventTarget:n}=st(e);return e instanceof n?e:Gn(e)}function us(e,n){const r=Math.abs(e.x),i=Math.abs(e.y);return typeof n=="number"?Math.sqrt(r**2+i**2)>n:"x"in n&&"y"in n?r>n.x&&i>n.y:"x"in n?r>n.x:"y"in n?i>n.y:!1}var pt;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(pt||(pt={}));function fl(e){e.preventDefault()}function jb(e){e.stopPropagation()}var ve;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ve||(ve={}));const hu={start:[ve.Space,ve.Enter],cancel:[ve.Esc],end:[ve.Space,ve.Enter,ve.Tab]},Sb=(e,n)=>{let{currentCoordinates:r}=n;switch(e.code){case ve.Right:return{...r,x:r.x+25};case ve.Left:return{...r,x:r.x-25};case ve.Down:return{...r,y:r.y+25};case ve.Up:return{...r,y:r.y-25}}};class pu{constructor(n){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=n;const{event:{target:r}}=n;this.props=n,this.listeners=new mr(Gn(r)),this.windowListeners=new mr(st(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(pt.Resize,this.handleCancel),this.windowListeners.add(pt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(pt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:n,onStart:r}=this.props,i=n.node.current;i&&_b(i),r(Rt)}handleKeyDown(n){if(iu(n)){const{active:r,context:i,options:s}=this.props,{keyboardCodes:a=hu,coordinateGetter:o=Sb,scrollBehavior:l="smooth"}=s,{code:u}=n;if(a.end.includes(u)){this.handleEnd(n);return}if(a.cancel.includes(u)){this.handleCancel(n);return}const{collisionRect:d}=i.current,h=d?{x:d.left,y:d.top}:Rt;this.referenceCoordinates||(this.referenceCoordinates=h);const f=o(n,{active:r,context:i.current,currentCoordinates:h});if(f){const p=Si(f,h),g={x:0,y:0},{scrollableAncestors:m}=i.current;for(const b of m){const x=n.code,{isTop:y,isRight:w,isLeft:N,isBottom:k,maxScroll:C,minScroll:_}=fu(b),j=vb(b),S={x:Math.min(x===ve.Right?j.right-j.width/2:j.right,Math.max(x===ve.Right?j.left:j.left+j.width/2,f.x)),y:Math.min(x===ve.Down?j.bottom-j.height/2:j.bottom,Math.max(x===ve.Down?j.top:j.top+j.height/2,f.y))},T=x===ve.Right&&!w||x===ve.Left&&!N,P=x===ve.Down&&!k||x===ve.Up&&!y;if(T&&S.x!==f.x){const I=b.scrollLeft+p.x,L=x===ve.Right&&I<=C.x||x===ve.Left&&I>=_.x;if(L&&!p.y){b.scrollTo({left:I,behavior:l});return}L?g.x=b.scrollLeft-I:g.x=x===ve.Right?b.scrollLeft-C.x:b.scrollLeft-_.x,g.x&&b.scrollBy({left:-g.x,behavior:l});break}else if(P&&S.y!==f.y){const I=b.scrollTop+p.y,L=x===ve.Down&&I<=C.y||x===ve.Up&&I>=_.y;if(L&&!p.x){b.scrollTo({top:I,behavior:l});return}L?g.y=b.scrollTop-I:g.y=x===ve.Down?b.scrollTop-C.y:b.scrollTop-_.y,g.y&&b.scrollBy({top:-g.y,behavior:l});break}}this.handleMove(n,Dn(Si(f,this.referenceCoordinates),g))}}}handleMove(n,r){const{onMove:i}=this.props;n.preventDefault(),i(r)}handleEnd(n){const{onEnd:r}=this.props;n.preventDefault(),this.detach(),r()}handleCancel(n){const{onCancel:r}=this.props;n.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}pu.activators=[{eventName:"onKeyDown",handler:(e,n,r)=>{let{keyboardCodes:i=hu,onActivation:s}=n,{active:a}=r;const{code:o}=e.nativeEvent;if(i.start.includes(o)){const l=a.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),s==null||s({event:e.nativeEvent}),!0)}return!1}}];function dl(e){return!!(e&&"distance"in e)}function hl(e){return!!(e&&"delay"in e)}class Ia{constructor(n,r,i){var s;i===void 0&&(i=Cb(n.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=n,this.events=r;const{event:a}=n,{target:o}=a;this.props=n,this.events=r,this.document=Gn(o),this.documentListeners=new mr(this.document),this.listeners=new mr(i),this.windowListeners=new mr(st(o)),this.initialCoordinates=(s=Xs(a))!=null?s:Rt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:n,props:{options:{activationConstraint:r,bypassActivationConstraint:i}}}=this;if(this.listeners.add(n.move.name,this.handleMove,{passive:!1}),this.listeners.add(n.end.name,this.handleEnd),n.cancel&&this.listeners.add(n.cancel.name,this.handleCancel),this.windowListeners.add(pt.Resize,this.handleCancel),this.windowListeners.add(pt.DragStart,fl),this.windowListeners.add(pt.VisibilityChange,this.handleCancel),this.windowListeners.add(pt.ContextMenu,fl),this.documentListeners.add(pt.Keydown,this.handleKeydown),r){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(hl(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(dl(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(n,r){const{active:i,onPending:s}=this.props;s(i,n,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:n}=this,{onStart:r}=this.props;n&&(this.activated=!0,this.documentListeners.add(pt.Click,jb,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(pt.SelectionChange,this.removeTextSelection),r(n))}handleMove(n){var r;const{activated:i,initialCoordinates:s,props:a}=this,{onMove:o,options:{activationConstraint:l}}=a;if(!s)return;const u=(r=Xs(n))!=null?r:Rt,d=Si(s,u);if(!i&&l){if(dl(l)){if(l.tolerance!=null&&us(d,l.tolerance))return this.handleCancel();if(us(d,l.distance))return this.handleStart()}if(hl(l)&&us(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}n.cancelable&&n.preventDefault(),o(u)}handleEnd(){const{onAbort:n,onEnd:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleCancel(){const{onAbort:n,onCancel:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleKeydown(n){n.code===ve.Esc&&this.handleCancel()}removeTextSelection(){var n;(n=this.document.getSelection())==null||n.removeAllRanges()}}const Nb={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Oa extends Ia{constructor(n){const{event:r}=n,i=Gn(r.target);super(n,Nb,i)}}Oa.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:i}=n;return!r.isPrimary||r.button!==0?!1:(i==null||i({event:r}),!0)}}];const Tb={move:{name:"mousemove"},end:{name:"mouseup"}};var Ks;(function(e){e[e.RightClick=2]="RightClick"})(Ks||(Ks={}));class Rb extends Ia{constructor(n){super(n,Tb,Gn(n.event.target))}}Rb.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:i}=n;return r.button===Ks.RightClick?!1:(i==null||i({event:r}),!0)}}];const fs={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Eb extends Ia{constructor(n){super(n,fs)}static setup(){return window.addEventListener(fs.move.name,n,{capture:!1,passive:!1}),function(){window.removeEventListener(fs.move.name,n)};function n(){}}}Eb.activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:i}=n;const{touches:s}=r;return s.length>1?!1:(i==null||i({event:r}),!0)}}];var yr;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(yr||(yr={}));var Ri;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ri||(Ri={}));function Mb(e){let{acceleration:n,activator:r=yr.Pointer,canScroll:i,draggingRect:s,enabled:a,interval:o=5,order:l=Ri.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:h,delta:f,threshold:p}=e;const g=Ab({delta:f,disabled:!a}),[m,b]=$v(),x=v.useRef({x:0,y:0}),y=v.useRef({x:0,y:0}),w=v.useMemo(()=>{switch(r){case yr.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case yr.DraggableRect:return s}},[r,s,u]),N=v.useRef(null),k=v.useCallback(()=>{const _=N.current;if(!_)return;const j=x.current.x*y.current.x,S=x.current.y*y.current.y;_.scrollBy(j,S)},[]),C=v.useMemo(()=>l===Ri.TreeOrder?[...d].reverse():d,[l,d]);v.useEffect(()=>{if(!a||!d.length||!w){b();return}for(const _ of C){if((i==null?void 0:i(_))===!1)continue;const j=d.indexOf(_),S=h[j];if(!S)continue;const{direction:T,speed:P}=xb(_,S,w,n,p);for(const I of["x","y"])g[I][T[I]]||(P[I]=0,T[I]=0);if(P.x>0||P.y>0){b(),N.current=_,m(k,o),x.current=P,y.current=T;return}}x.current={x:0,y:0},y.current={x:0,y:0},b()},[n,k,i,b,a,o,JSON.stringify(w),JSON.stringify(g),m,d,C,h,JSON.stringify(p)])}const Pb={x:{[Fe.Backward]:!1,[Fe.Forward]:!1},y:{[Fe.Backward]:!1,[Fe.Forward]:!1}};function Ab(e){let{delta:n,disabled:r}=e;const i=Qs(n);return Lr(s=>{if(r||!i||!s)return Pb;const a={x:Math.sign(n.x-i.x),y:Math.sign(n.y-i.y)};return{x:{[Fe.Backward]:s.x[Fe.Backward]||a.x===-1,[Fe.Forward]:s.x[Fe.Forward]||a.x===1},y:{[Fe.Backward]:s.y[Fe.Backward]||a.y===-1,[Fe.Forward]:s.y[Fe.Forward]||a.y===1}}},[r,n,i])}function Ib(e,n){const r=n!=null?e.get(n):void 0,i=r?r.node.current:null;return Lr(s=>{var a;return n==null?null:(a=i??s)!=null?a:null},[i,n])}function Ob(e,n){return v.useMemo(()=>e.reduce((r,i)=>{const{sensor:s}=i,a=s.activators.map(o=>({eventName:o.eventName,handler:n(o.handler,i)}));return[...r,...a]},[]),[e,n])}var Nr;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Nr||(Nr={}));var Js;(function(e){e.Optimized="optimized"})(Js||(Js={}));const pl=new Map;function Db(e,n){let{dragging:r,dependencies:i,config:s}=n;const[a,o]=v.useState(null),{frequency:l,measure:u,strategy:d}=s,h=v.useRef(e),f=x(),p=Sr(f),g=v.useCallback(function(y){y===void 0&&(y=[]),!p.current&&o(w=>w===null?y:w.concat(y.filter(N=>!w.includes(N))))},[p]),m=v.useRef(null),b=Lr(y=>{if(f&&!r)return pl;if(!y||y===pl||h.current!==e||a!=null){const w=new Map;for(let N of e){if(!N)continue;if(a&&a.length>0&&!a.includes(N.id)&&N.rect.current){w.set(N.id,N.rect.current);continue}const k=N.node.current,C=k?new Aa(u(k),k):null;N.rect.current=C,C&&w.set(N.id,C)}return w}return y},[e,a,r,f,u]);return v.useEffect(()=>{h.current=e},[e]),v.useEffect(()=>{f||g()},[r,f]),v.useEffect(()=>{a&&a.length>0&&o(null)},[JSON.stringify(a)]),v.useEffect(()=>{f||typeof l!="number"||m.current!==null||(m.current=setTimeout(()=>{g(),m.current=null},l))},[l,f,g,...i]),{droppableRects:b,measureDroppableContainers:g,measuringScheduled:a!=null};function x(){switch(d){case Nr.Always:return!1;case Nr.BeforeDragging:return r;default:return!r}}}function gu(e,n){return Lr(r=>e?r||(typeof n=="function"?n(e):e):null,[n,e])}function Fb(e,n){return gu(e,n)}function Lb(e){let{callback:n,disabled:r}=e;const i=Ma(n),s=v.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(i)},[i,r]);return v.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Wi(e){let{callback:n,disabled:r}=e;const i=Ma(n),s=v.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(i)},[r]);return v.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function zb(e){return new Aa(zr(e),e)}function gl(e,n,r){n===void 0&&(n=zb);const[i,s]=v.useState(null);function a(){s(u=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=u??r)!=null?d:null}const h=n(e);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const o=Lb({callback(u){if(e)for(const d of u){const{type:h,target:f}=d;if(h==="childList"&&f instanceof HTMLElement&&f.contains(e)){a();break}}}}),l=Wi({callback:a});return hn(()=>{a(),e?(l==null||l.observe(e),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),o==null||o.disconnect())},[e]),i}function $b(e){const n=gu(e);return au(e,n)}const ml=[];function qb(e){const n=v.useRef(e),r=Lr(i=>e?i&&i!==ml&&e&&n.current&&e.parentNode===n.current.parentNode?i:Pa(e):ml,[e]);return v.useEffect(()=>{n.current=e},[e]),r}function Hb(e){const[n,r]=v.useState(null),i=v.useRef(e),s=v.useCallback(a=>{const o=cs(a.target);o&&r(l=>l?(l.set(o,Ys(o)),new Map(l)):null)},[]);return v.useEffect(()=>{const a=i.current;if(e!==a){o(a);const l=e.map(u=>{const d=cs(u);return d?(d.addEventListener("scroll",s,{passive:!0}),[d,Ys(d)]):null}).filter(u=>u!=null);r(l.length?new Map(l):null),i.current=e}return()=>{o(e),o(a)};function o(l){l.forEach(u=>{const d=cs(u);d==null||d.removeEventListener("scroll",s)})}},[s,e]),v.useMemo(()=>e.length?n?Array.from(n.values()).reduce((a,o)=>Dn(a,o),Rt):du(e):Rt,[e,n])}function yl(e,n){n===void 0&&(n=[]);const r=v.useRef(null);return v.useEffect(()=>{r.current=null},n),v.useEffect(()=>{const i=e!==Rt;i&&!r.current&&(r.current=e),!i&&r.current&&(r.current=null)},[e]),r.current?Si(e,r.current):Rt}function Bb(e){v.useEffect(()=>{if(!Hi)return;const n=e.map(r=>{let{sensor:i}=r;return i.setup==null?void 0:i.setup()});return()=>{for(const r of n)r==null||r()}},e.map(n=>{let{sensor:r}=n;return r}))}function Wb(e,n){return v.useMemo(()=>e.reduce((r,i)=>{let{eventName:s,handler:a}=i;return r[s]=o=>{a(o,n)},r},{}),[e,n])}function mu(e){return v.useMemo(()=>e?pb(e):null,[e])}const xl=[];function Ub(e,n){n===void 0&&(n=zr);const[r]=e,i=mu(r?st(r):null),[s,a]=v.useState(xl);function o(){a(()=>e.length?e.map(u=>uu(u)?i:new Aa(n(u),u)):xl)}const l=Wi({callback:o});return hn(()=>{l==null||l.disconnect(),o(),e.forEach(u=>l==null?void 0:l.observe(u))},[e]),s}function Vb(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return Fr(n)?n:e}function Gb(e){let{measure:n}=e;const[r,i]=v.useState(null),s=v.useCallback(d=>{for(const{target:h}of d)if(Fr(h)){i(f=>{const p=n(h);return f?{...f,width:p.width,height:p.height}:p});break}},[n]),a=Wi({callback:s}),o=v.useCallback(d=>{const h=Vb(d);a==null||a.disconnect(),h&&(a==null||a.observe(h)),i(h?n(h):null)},[n,a]),[l,u]=ji(o);return v.useMemo(()=>({nodeRef:l,rect:r,setRef:u}),[r,l,u])}const Qb=[{sensor:Oa,options:{}},{sensor:pu,options:{}}],Xb={current:{}},si={draggable:{measure:ul},droppable:{measure:ul,strategy:Nr.WhileDragging,frequency:Js.Optimized},dragOverlay:{measure:zr}};class xr extends Map{get(n){var r;return n!=null&&(r=super.get(n))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(n=>{let{disabled:r}=n;return!r})}getNodeFor(n){var r,i;return(r=(i=this.get(n))==null?void 0:i.node.current)!=null?r:void 0}}const Yb={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new xr,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ti},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:si,measureDroppableContainers:Ti,windowRect:null,measuringScheduled:!1},Kb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ti,draggableNodes:new Map,over:null,measureDroppableContainers:Ti},Ui=v.createContext(Kb),Jb=v.createContext(Yb);function Zb(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new xr}}}function ew(e,n){switch(n.type){case Oe.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case Oe.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case Oe.DragEnd:case Oe.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Oe.RegisterDroppable:{const{element:r}=n,{id:i}=r,s=new xr(e.droppable.containers);return s.set(i,r),{...e,droppable:{...e.droppable,containers:s}}}case Oe.SetDroppableDisabled:{const{id:r,key:i,disabled:s}=n,a=e.droppable.containers.get(r);if(!a||i!==a.key)return e;const o=new xr(e.droppable.containers);return o.set(r,{...a,disabled:s}),{...e,droppable:{...e.droppable,containers:o}}}case Oe.UnregisterDroppable:{const{id:r,key:i}=n,s=e.droppable.containers.get(r);if(!s||i!==s.key)return e;const a=new xr(e.droppable.containers);return a.delete(r),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function tw(e){let{disabled:n}=e;const{active:r,activatorEvent:i,draggableNodes:s}=v.useContext(Ui),a=Qs(i),o=Qs(r==null?void 0:r.id);return v.useEffect(()=>{if(!n&&!i&&a&&o!=null){if(!iu(a)||document.activeElement===a.target)return;const l=s.get(o);if(!l)return;const{activatorNode:u,node:d}=l;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const h of[u.current,d.current]){if(!h)continue;const f=Bv(h);if(f){f.focus();break}}})}},[i,n,s,o,a]),null}function nw(e,n){let{transform:r,...i}=n;return e!=null&&e.length?e.reduce((s,a)=>a({transform:s,...i}),r):r}function rw(e){return v.useMemo(()=>({draggable:{...si.draggable,...e==null?void 0:e.draggable},droppable:{...si.droppable,...e==null?void 0:e.droppable},dragOverlay:{...si.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function iw(e){let{activeNode:n,measure:r,initialRect:i,config:s=!0}=e;const a=v.useRef(!1),{x:o,y:l}=typeof s=="boolean"?{x:s,y:s}:s;hn(()=>{if(!o&&!l||!n){a.current=!1;return}if(a.current||!i)return;const d=n==null?void 0:n.node.current;if(!d||d.isConnected===!1)return;const h=r(d),f=au(h,i);if(o||(f.x=0),l||(f.y=0),a.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=ou(d);p&&p.scrollBy({top:f.y,left:f.x})}},[n,o,l,i,r])}const yu=v.createContext({...Rt,scaleX:1,scaleY:1});var an;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(an||(an={}));const xu=v.memo(function(n){var r,i,s,a;let{id:o,accessibility:l,autoScroll:u=!0,children:d,sensors:h=Qb,collisionDetection:f=ob,measuring:p,modifiers:g,...m}=n;const b=v.useReducer(ew,void 0,Zb),[x,y]=b,[w,N]=Xv(),[k,C]=v.useState(an.Uninitialized),_=k===an.Initialized,{draggable:{active:j,nodes:S,translate:T},droppable:{containers:P}}=x,I=j!=null?S.get(j):null,L=v.useRef({initial:null,translated:null}),V=v.useMemo(()=>{var Se;return j!=null?{id:j,data:(Se=I==null?void 0:I.data)!=null?Se:Xb,rect:L}:null},[j,I]),R=v.useRef(null),[A,O]=v.useState(null),[M,q]=v.useState(null),D=Sr(m,Object.values(m)),F=Bi("DndDescribedBy",o),z=v.useMemo(()=>P.getEnabled(),[P]),H=rw(p),{droppableRects:Y,measureDroppableContainers:B,measuringScheduled:Q}=Db(z,{dragging:_,dependencies:[T.x,T.y],config:H.droppable}),W=Ib(S,j),X=v.useMemo(()=>M?Xs(M):null,[M]),Z=tn(),te=Fb(W,H.draggable.measure);iw({activeNode:j!=null?S.get(j):null,config:Z.layoutShiftCompensation,initialRect:te,measure:H.draggable.measure});const ne=gl(W,H.draggable.measure,te),ue=gl(W?W.parentElement:null),de=v.useRef({activatorEvent:null,active:null,activeNode:W,collisionRect:null,collisions:null,droppableRects:Y,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),je=P.getNodeFor((r=de.current.over)==null?void 0:r.id),se=Gb({measure:H.dragOverlay.measure}),le=(i=se.nodeRef.current)!=null?i:W,Pe=_?(s=se.rect)!=null?s:ne:null,Lt=!!(se.nodeRef.current&&se.rect),xt=$b(Lt?null:ne),vt=mu(le?st(le):null),Ve=qb(_?je??W:null),He=Ub(Ve),Je=nw(g,{transform:{x:T.x-xt.x,y:T.y-xt.y,scaleX:1,scaleY:1},activatorEvent:M,active:V,activeNodeRect:ne,containerNodeRect:ue,draggingNodeRect:Pe,over:de.current.over,overlayNodeRect:se.rect,scrollableAncestors:Ve,scrollableAncestorRects:He,windowRect:vt}),ut=X?Dn(X,T):null,Mt=Hb(Ve),Zt=yl(Mt),Le=yl(Mt,[ne]),J=Dn(Je,Zt),oe=Pe?ub(Pe,Je):null,xe=V&&oe?f({active:V,collisionRect:oe,droppableRects:Y,droppableContainers:z,pointerCoordinates:ut}):null,Be=ib(xe,"id"),[Ae,Ze]=v.useState(null),Re=Lt?Je:Dn(Je,Le),bt=lb(Re,(a=Ae==null?void 0:Ae.rect)!=null?a:null,ne),en=v.useRef(null),wt=v.useCallback((Se,Ie)=>{let{sensor:K,options:ae}=Ie;if(R.current==null)return;const ie=S.get(R.current);if(!ie)return;const fe=Se.nativeEvent,we=new K({active:R.current,activeNode:ie,event:fe,options:ae,context:de,onAbort(_e){if(!S.get(_e))return;const{onDragAbort:Ge}=D.current,$={id:_e};Ge==null||Ge($),w({type:"onDragAbort",event:$})},onPending(_e,at,Ge,$){if(!S.get(_e))return;const{onDragPending:Ee}=D.current,he={id:_e,constraint:at,initialCoordinates:Ge,offset:$};Ee==null||Ee(he),w({type:"onDragPending",event:he})},onStart(_e){const at=R.current;if(at==null)return;const Ge=S.get(at);if(!Ge)return;const{onDragStart:$}=D.current,re={activatorEvent:fe,active:{id:at,data:Ge.data,rect:L}};sr.unstable_batchedUpdates(()=>{$==null||$(re),C(an.Initializing),y({type:Oe.DragStart,initialCoordinates:_e,active:at}),w({type:"onDragStart",event:re}),O(en.current),q(fe)})},onMove(_e){y({type:Oe.DragMove,coordinates:_e})},onEnd:et(Oe.DragEnd),onCancel:et(Oe.DragCancel)});en.current=we;function et(_e){return async function(){const{active:Ge,collisions:$,over:re,scrollAdjustedTranslate:Ee}=de.current;let he=null;if(Ge&&Ee){const{cancelDrop:ot}=D.current;he={activatorEvent:fe,active:Ge,collisions:$,delta:Ee,over:re},_e===Oe.DragEnd&&typeof ot=="function"&&await Promise.resolve(ot(he))&&(_e=Oe.DragCancel)}R.current=null,sr.unstable_batchedUpdates(()=>{y({type:_e}),C(an.Uninitialized),Ze(null),O(null),q(null),en.current=null;const ot=_e===Oe.DragEnd?"onDragEnd":"onDragCancel";if(he){const Rn=D.current[ot];Rn==null||Rn(he),w({type:ot,event:he})}})}}},[S]),Qn=v.useCallback((Se,Ie)=>(K,ae)=>{const ie=K.nativeEvent,fe=S.get(ae);if(R.current!==null||!fe||ie.dndKit||ie.defaultPrevented)return;const we={active:fe};Se(K,Ie.options,we)===!0&&(ie.dndKit={capturedBy:Ie.sensor},R.current=ae,wt(K,Ie))},[S,wt]),zt=Ob(h,Qn);Bb(h),hn(()=>{ne&&k===an.Initializing&&C(an.Initialized)},[ne,k]),v.useEffect(()=>{const{onDragMove:Se}=D.current,{active:Ie,activatorEvent:K,collisions:ae,over:ie}=de.current;if(!Ie||!K)return;const fe={active:Ie,activatorEvent:K,collisions:ae,delta:{x:J.x,y:J.y},over:ie};sr.unstable_batchedUpdates(()=>{Se==null||Se(fe),w({type:"onDragMove",event:fe})})},[J.x,J.y]),v.useEffect(()=>{const{active:Se,activatorEvent:Ie,collisions:K,droppableContainers:ae,scrollAdjustedTranslate:ie}=de.current;if(!Se||R.current==null||!Ie||!ie)return;const{onDragOver:fe}=D.current,we=ae.get(Be),et=we&&we.rect.current?{id:we.id,rect:we.rect.current,data:we.data,disabled:we.disabled}:null,_e={active:Se,activatorEvent:Ie,collisions:K,delta:{x:ie.x,y:ie.y},over:et};sr.unstable_batchedUpdates(()=>{Ze(et),fe==null||fe(_e),w({type:"onDragOver",event:_e})})},[Be]),hn(()=>{de.current={activatorEvent:M,active:V,activeNode:W,collisionRect:oe,collisions:xe,droppableRects:Y,draggableNodes:S,draggingNode:le,draggingNodeRect:Pe,droppableContainers:P,over:Ae,scrollableAncestors:Ve,scrollAdjustedTranslate:J},L.current={initial:Pe,translated:oe}},[V,W,xe,oe,S,le,Pe,Y,P,Ae,Ve,J]),Mb({...Z,delta:T,draggingRect:oe,pointerCoordinates:ut,scrollableAncestors:Ve,scrollableAncestorRects:He});const pn=v.useMemo(()=>({active:V,activeNode:W,activeNodeRect:ne,activatorEvent:M,collisions:xe,containerNodeRect:ue,dragOverlay:se,draggableNodes:S,droppableContainers:P,droppableRects:Y,over:Ae,measureDroppableContainers:B,scrollableAncestors:Ve,scrollableAncestorRects:He,measuringConfiguration:H,measuringScheduled:Q,windowRect:vt}),[V,W,ne,M,xe,ue,se,S,P,Y,Ae,B,Ve,He,H,Q,vt]),ft=v.useMemo(()=>({activatorEvent:M,activators:zt,active:V,activeNodeRect:ne,ariaDescribedById:{draggable:F},dispatch:y,draggableNodes:S,over:Ae,measureDroppableContainers:B}),[M,zt,V,ne,y,F,S,Ae,B]);return Xe.createElement(su.Provider,{value:N},Xe.createElement(Ui.Provider,{value:ft},Xe.createElement(Jb.Provider,{value:pn},Xe.createElement(yu.Provider,{value:bt},d)),Xe.createElement(tw,{disabled:(l==null?void 0:l.restoreFocus)===!1})),Xe.createElement(Jv,{...l,hiddenTextDescribedById:F}));function tn(){const Se=(A==null?void 0:A.autoScrollEnabled)===!1,Ie=typeof u=="object"?u.enabled===!1:u===!1,K=_&&!Se&&!Ie;return typeof u=="object"?{...u,enabled:K}:{enabled:K}}}),sw=v.createContext(null),vl="button",aw="Draggable";function ai(e){let{id:n,data:r,disabled:i=!1,attributes:s}=e;const a=Bi(aw),{activators:o,activatorEvent:l,active:u,activeNodeRect:d,ariaDescribedById:h,draggableNodes:f,over:p}=v.useContext(Ui),{role:g=vl,roleDescription:m="draggable",tabIndex:b=0}=s??{},x=(u==null?void 0:u.id)===n,y=v.useContext(x?yu:sw),[w,N]=ji(),[k,C]=ji(),_=Wb(o,n),j=Sr(r);hn(()=>(f.set(n,{id:n,key:a,node:w,activatorNode:k,data:j}),()=>{const T=f.get(n);T&&T.key===a&&f.delete(n)}),[f,n]);const S=v.useMemo(()=>({role:g,tabIndex:b,"aria-disabled":i,"aria-pressed":x&&g===vl?!0:void 0,"aria-roledescription":m,"aria-describedby":h.draggable}),[i,g,b,x,m,h.draggable]);return{active:u,activatorEvent:l,activeNodeRect:d,attributes:S,isDragging:x,listeners:i?void 0:_,node:w,over:p,setNodeRef:N,setActivatorNodeRef:C,transform:y}}const ow="Droppable",lw={timeout:25};function vu(e){let{data:n,disabled:r=!1,id:i,resizeObserverConfig:s}=e;const a=Bi(ow),{active:o,dispatch:l,over:u,measureDroppableContainers:d}=v.useContext(Ui),h=v.useRef({disabled:r}),f=v.useRef(!1),p=v.useRef(null),g=v.useRef(null),{disabled:m,updateMeasurementsFor:b,timeout:x}={...lw,...s},y=Sr(b??i),w=v.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{d(Array.isArray(y.current)?y.current:[y.current]),g.current=null},x)},[x]),N=Wi({callback:w,disabled:m||!o}),k=v.useCallback((S,T)=>{N&&(T&&(N.unobserve(T),f.current=!1),S&&N.observe(S))},[N]),[C,_]=ji(k),j=Sr(n);return v.useEffect(()=>{!N||!C.current||(N.disconnect(),f.current=!1,N.observe(C.current))},[C,N]),v.useEffect(()=>(l({type:Oe.RegisterDroppable,element:{id:i,key:a,disabled:r,node:C,rect:p,data:j}}),()=>l({type:Oe.UnregisterDroppable,key:a,id:i})),[i]),v.useEffect(()=>{r!==h.current.disabled&&(l({type:Oe.SetDroppableDisabled,id:i,key:a,disabled:r}),h.current.disabled=r)},[i,a,r,l]),{active:o,rect:p,isOver:(u==null?void 0:u.id)===i,node:C,over:u,setNodeRef:_}}const Wn=({markdown:e})=>c.jsx("div",{className:"border rounded bg-gray-50 dark:bg-gray-800 p-2 text-sm overflow-x-auto",children:c.jsx(yn,{content:e})}),bu=({post:e,onCancel:n,onUpdated:r})=>{const[i,s]=v.useState(e.type),[a,o]=v.useState(e.status||"To Do"),[l,u]=v.useState(e.title||""),[d,h]=v.useState(e.content||""),[f,p]=v.useState(e.details||""),[g,m]=v.useState(e.collaborators||[]),[b,x]=v.useState(e.linkedItems||[]),[y]=v.useState(e.repostedFrom||null),[w,N]=v.useState(!1),[k,C]=v.useState(!1),{selectedBoard:_,updateBoardItem:j}=Tn()||{},S=async T=>{if(T.preventDefault(),w)return;if(N(!0),i==="quest"&&b.length===0){alert("Please link at least one quest."),N(!1);return}const P={type:i,title:i==="task"?d:l||void 0,content:d,...i==="task"&&f?{details:f}:{},...i==="quest"&&{collaborators:g},...i==="task"||i==="issue"?{status:a}:{},linkedItems:b,repostedFrom:y||null};try{const I=await Tt(e.id,P);_&&j(_,I),r&&r(I)}catch(I){console.error("[EditPost] Failed to update post:",I),alert("Failed to update post. Please try again later.")}finally{N(!1)}};return c.jsxs("form",{onSubmit:S,className:"space-y-6",children:[c.jsxs(gt,{title:"Post Details",children:[c.jsx(De,{htmlFor:"post-type",children:"Post Type"}),c.jsx(Ue,{id:"post-type",value:i,onChange:T=>{const P=T.target.value;s(P),["task","issue"].includes(P)&&o("To Do")},options:Jr.map(({value:T,label:P})=>({value:T,label:P}))}),["task","issue"].includes(i)&&c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"task-status",children:"Status"}),c.jsx(Ue,{id:"task-status",value:a,onChange:T=>o(T.target.value),options:Kt.map(({value:T,label:P})=>({value:T,label:P}))})]}),i!=="task"&&c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"title",children:"Title"}),c.jsx(Nt,{id:"title",value:l,onChange:T=>u(T.target.value),required:i!=="free_speech"})]}),i==="task"?c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"content",children:"Task Title"}),c.jsx(Nt,{id:"content",value:d,onChange:T=>h(T.target.value),placeholder:"Short task summary",required:!0}),c.jsx(De,{htmlFor:"details",children:"Details"}),c.jsx(fi,{id:"details",value:f,onChange:p,placeholder:"Additional information"})]}):c.jsxs(c.Fragment,{children:[c.jsx(De,{htmlFor:"content",children:"Content"}),c.jsx(fi,{id:"content",value:d,onChange:h,placeholder:"Write your post..."})]}),c.jsxs("div",{className:"mt-4",children:[c.jsx("button",{type:"button",onClick:()=>C(T=>!T),className:"text-accent text-sm underline",children:k?"Hide Markdown Preview":"Show Markdown Preview"}),k&&c.jsx("div",{className:"mt-2 border rounded p-3 bg-background text-sm prose max-w-none",children:c.jsx(yn,{content:d})})]})]}),i==="quest"&&c.jsx(gt,{title:"Assigned Roles",children:c.jsx(Pi,{value:g,onChange:m})}),c.jsxs(gt,{title:"Linked Items",children:[c.jsx(Ai,{label:"Item",value:b,onChange:T=>x(T),allowCreateNew:!1,itemTypes:["quest","post"]}),b.length>0&&c.jsx("ul",{className:"list-disc pl-6 mt-2 text-sm text-accent",children:b.map((T,P)=>c.jsxs("li",{children:[T.itemType,": ",T.title||T.nodeId,c.jsx("button",{type:"button",className:"text-error ml-2 text-xs hover:underline",onClick:()=>x(b.filter((I,L)=>L!==P)),children:"Remove"})]},P))})]}),y&&c.jsx(gt,{title:"Reposted From",children:c.jsxs("div",{className:"text-sm text-secondary italic",children:["Originally posted by ",c.jsxs("strong",{children:["@",y.username]})]})}),c.jsxs("div",{className:"flex justify-end gap-3",children:[c.jsx($e,{type:"button",variant:"ghost",onClick:n,children:"Cancel"}),c.jsx($e,{type:"submit",variant:"primary",disabled:w,children:w?"Saving...":"Save Changes"})]})]})},cw=5,Zs=({node:e,depth:n=0,edge:r,user:i,compact:s=!1,condensed:a=!1,showStatus:o=!0,focusedNodeId:l,onFocus:u,selectedNode:d,onSelect:h,onNodeClick:f,diffData:p,diffLoading:g,registerNode:m,onRemoveEdge:b,boardId:x})=>{const w=e.type==="quest"||e.tags.includes("quest")?"📁":"📄",{attributes:N,listeners:k,setNodeRef:C,transform:_,isDragging:j}=ai({id:e.id}),{attributes:S,listeners:T,setNodeRef:P}=ai({id:`anchor-${e.id}`}),{attributes:I,listeners:L,setNodeRef:V}=ai({id:`move-${e.id}`}),{setNodeRef:R,isOver:A}=vu({id:e.id}),O=_?{transform:Ni.Translate.toString(_)}:void 0,[M,q]=v.useState(!1),D=v.useRef(null),[F,z]=v.useState(!1),[H,Y]=v.useState(!1);v.useEffect(()=>(A?D.current=setTimeout(()=>q(!0),500):(D.current&&(clearTimeout(D.current),D.current=null),q(!1)),()=>{D.current&&(clearTimeout(D.current),D.current=null)}),[A]);const B=!l&&e.children&&e.children.length>cw;if(H)return c.jsx("div",{ref:Q=>{R(Q),m==null||m(e.id,Q)},className:`relative ${A?"ring-2 ring-blue-400":""} ${M?"animate-pulse":""}`,children:c.jsx("div",{ref:C,style:O,className:j?"opacity-50":"",...N,...k,children:c.jsx("div",{style:{marginLeft:n*16},className:"mb-6",children:c.jsx(bu,{post:e,onCancel:()=>{Y(!1),z(!1),h(e)},onUpdated:Q=>{Y(!1),z(!1),h(Q)}})})})});if(a&&!F){const Q=(e.content||"").slice(0,30);return c.jsxs("div",{className:`relative ${A?"ring-2 ring-blue-400":""} ${M?"animate-pulse":""}`,ref:W=>{R(W),m==null||m(e.id,W)},children:[c.jsx("div",{ref:C,style:O,className:j?"opacity-50":"",...N,...k,children:c.jsxs("div",{className:"flex items-center text-xs cursor-pointer py-0.5 px-1 truncate",style:{marginLeft:n*16},onClick:()=>{z(!0),h(e),u==null||u(e.id)},title:Q,children:[c.jsx("span",{className:"mr-1 select-none",children:w}),c.jsxs("span",{className:"truncate",children:[Q,e.content&&e.content.length>30?"…":""]}),r&&c.jsxs("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 ml-1 flex items-center",children:[r.label||r.type,b&&c.jsx("button",{"data-testid":`remove-edge-${r.from}-${r.to}`,className:"ml-1 text-red-500",onClick:W=>{W.stopPropagation(),b(r)},children:"×"})]})]})}),(d==null?void 0:d.id)===e.id&&c.jsx("div",{className:"ml-8 mb-4",children:g?c.jsx(St,{}):(p==null?void 0:p.diffMarkdown)&&c.jsx(Wn,{markdown:p.diffMarkdown})}),e.children&&e.children.length>0&&c.jsx("div",{className:"ml-8 border-l border-gray-300 dark:border-gray-600 pl-4",children:e.children.map(W=>c.jsx(Zs,{node:W.node,depth:n+1,edge:W.edge,user:i,compact:s,condensed:a||B&&W.node.id!==l,showStatus:o,focusedNodeId:l,onFocus:u,selectedNode:d,onSelect:h,onRemoveEdge:b,diffData:p,diffLoading:g},W.node.id))})]})}return c.jsx("div",{ref:Q=>{R(Q),m==null||m(e.id,Q)},className:`relative ${A?"ring-2 ring-blue-400":""} ${M?"animate-pulse":""}`,children:c.jsxs("div",{ref:C,style:O,className:j?"opacity-50":"",children:[c.jsxs("div",{style:{marginLeft:n*16},className:"mb-6 flex items-start space-x-2 cursor-pointer",onClick:()=>{h(e),f?f(e):window.dispatchEvent(new CustomEvent("questTaskOpen",{detail:{taskId:e.id}}))},onDoubleClick:()=>{h(e),f?f(e):window.dispatchEvent(new CustomEvent("questTaskOpen",{detail:{taskId:e.id}}))},children:[c.jsx("span",{className:"text-xl select-none cursor-grab",...N,...k,onDoubleClick:()=>{h(e),f?f(e):window.dispatchEvent(new CustomEvent("questTaskOpen",{detail:{taskId:e.id}}))},children:w}),c.jsx(An,{contribution:e,user:i,compact:s,showStatusControl:o,boardId:x}),c.jsx("span",{"data-testid":`move-${e.id}`,ref:V,...I,...L,className:"cursor-move text-xs ml-1",title:"Move subtree",children:"↕"}),c.jsx("span",{"data-testid":`anchor-${e.id}`,ref:P,...S,...T,className:"ml-1 w-3 h-3 bg-blue-400 rounded-full inline-block cursor-grab",title:"Create child"}),F&&!H&&c.jsx("button",{className:"text-xs underline ml-1",onClick:Q=>{Q.stopPropagation(),Y(!0)},children:"Edit"}),a&&c.jsx("button",{className:"text-xs underline ml-1",onClick:Q=>{Q.stopPropagation(),z(!1)},title:"Collapse",children:"Collapse"}),r&&c.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1 flex items-center",children:[r.label||r.type,b&&c.jsx("button",{"data-testid":`remove-edge-${r.from}-${r.to}`,className:"ml-1 text-red-500",onClick:Q=>{Q.stopPropagation(),b(r)},children:"×"})]})]}),(d==null?void 0:d.id)===e.id&&c.jsx("div",{className:"ml-8 mb-4",children:g?c.jsx(St,{}):(p==null?void 0:p.diffMarkdown)&&c.jsx(Wn,{markdown:p.diffMarkdown})}),e.children&&e.children.length>0&&c.jsx("div",{className:"ml-8 border-l border-gray-300 dark:border-gray-600 pl-4",children:e.children.map(Q=>c.jsx(Zs,{node:Q.node,depth:n+1,edge:Q.edge,user:i,compact:s,condensed:a||B&&Q.node.id!==l,focusedNodeId:l,onFocus:u,selectedNode:d,onSelect:h,onNodeClick:f,diffData:p,diffLoading:g},Q.node.id))})]})})},wu=({postId:e,user:n})=>{const[r,i]=v.useState([]),[s,a]=v.useState(!1);return v.useEffect(()=>{Yr(e).then(i).finally(()=>a(!0))},[e]),s?r.length===0?null:c.jsx("div",{className:"mt-2 space-y-2 border-l-2 border-blue-200 pl-4",children:r.map(o=>c.jsx(Un,{post:o,user:n,compact:!0},o.id))}):c.jsx(St,{})},_u=({questId:e,node:n,user:r})=>{var g;const[i,s]=v.useState([]),[a,o]=v.useState(!1),[l,u]=v.useState({}),[d,h]=v.useState(!1),f=!!r&&(r.id===(n==null?void 0:n.authorId)||((g=n==null?void 0:n.collaborators)==null?void 0:g.some(m=>m.userId===r.id))),p=()=>{h(!0)};return v.useEffect(()=>{n&&(o(!0),Mr(e).then(m=>{const b=m.filter(x=>["log","quest_log","task","issue","commit"].includes(x.type)&&x.replyTo===n.id);b.sort((x,y)=>{const w=x.createdAt||x.timestamp,N=y.createdAt||y.timestamp;return w.localeCompare(N)}),s(b)}).catch(m=>console.error("[LogThreadPanel] load failed",m)).finally(()=>o(!1)))},[e,n]),n?a?c.jsx(St,{}):i.length===0?c.jsxs("div",{className:"space-y-2",children:[d&&c.jsx(kn,{onSave:m=>{s(b=>[...b,m]),h(!1)},onCancel:()=>h(!1),initialType:f?"log":"free_speech",questId:e,replyTo:n,boardId:`log-${e}`}),c.jsx("div",{className:"text-right",children:c.jsx("button",{onClick:p,className:"text-xs text-accent underline",children:f?"+ Add Log":"+ Add Comment"})}),c.jsx("div",{className:"text-sm text-secondary",children:"No posts yet."})]}):c.jsxs("div",{className:"space-y-2",children:[d&&c.jsx(kn,{onSave:m=>{s(b=>[...b,m]),h(!1)},onCancel:()=>h(!1),initialType:f?"log":"free_speech",questId:e,replyTo:n,boardId:`log-${e}`}),c.jsx("div",{className:"text-right",children:c.jsx("button",{onClick:p,className:"text-xs text-accent underline",children:f?"+ Add Log":"+ Add Comment"})}),i.map(m=>{const b=!!l[m.id];return c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer bg-background",onClick:()=>{u(x=>({...x,[m.id]:!b}))},children:[c.jsx("span",{className:"font-semibold text-sm",children:m.content.slice(0,40)}),c.jsx("span",{className:"text-xs",children:b?"▲":"▼"})]}),b&&c.jsxs("div",{className:"p-2 space-y-2 overflow-auto max-h-60",children:[c.jsx(Un,{post:m,user:r,questId:e}),c.jsx(wu,{postId:m.id,user:r})]})]},m.id)})]}):null},uw=({questId:e,filePath:n,lineNumber:r,onClose:i})=>{const[s,a]=v.useState([]),[o,l]=v.useState(!0);return v.useEffect(()=>{(async()=>{try{const h=(await Mr(e)).filter(f=>f.type==="commit"&&f.gitFilePath===n);a(h)}catch(d){console.error("[LineVersionThread] Failed to fetch posts",d)}finally{l(!1)}})()},[e,n]),c.jsxs("div",{className:"bg-surface border border-secondary rounded p-2 mt-1 space-y-3 shadow-sm",children:[c.jsxs("div",{className:"flex justify-between text-xs text-secondary",children:[c.jsxs("span",{children:["History for line ",r]}),i&&c.jsx("button",{onClick:i,className:"underline",children:"Close"})]}),o?c.jsx(St,{}):s.length===0?c.jsx("div",{className:"text-xs",children:"No history found."}):s.map(u=>{var d;return c.jsxs("div",{className:"text-sm border-t border-secondary pt-2",children:[c.jsxs("div",{className:"flex justify-between text-xs text-secondary mb-1",children:[c.jsxs("span",{children:["@",((d=u.author)==null?void 0:d.username)||u.authorId]}),c.jsx("span",{children:Bl(new Date(u.timestamp),{addSuffix:!0})})]}),u.commitSummary&&c.jsx("div",{className:"font-semibold mb-1",children:u.commitSummary}),u.gitDiff&&c.jsx(Wn,{markdown:u.gitDiff}),c.jsx(wu,{postId:u.id})]},u.id)})]})},Da=({questId:e,filePath:n,content:r})=>{const[i,s]=v.useState(null),[a,o]=v.useState(!1),[l,u]=v.useState(r+`
`),[d,h]=v.useState("Update file"),f=r.split(`
`),p=()=>{window.confirm("Commit these changes?")&&(console.log("Save file",n,d,l),o(!1))};return a?c.jsxs("div",{className:"space-y-2",children:[c.jsx("textarea",{value:l,onChange:g=>u(g.target.value),className:"w-full border border-secondary rounded p-2 font-mono text-sm",rows:Math.max(8,l.split(`
`).length+2)}),c.jsx("input",{type:"text",value:d,onChange:g=>h(g.target.value),className:"w-full border border-secondary rounded px-2 py-1 text-sm",placeholder:"Commit message"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:p,className:"bg-accent text-white text-xs px-2 py-1 rounded",children:"Save"}),c.jsx("button",{onClick:()=>o(!1),className:"text-xs underline",children:"Cancel"})]})]}):c.jsxs("div",{children:[c.jsx("pre",{className:"relative bg-background p-2 rounded border border-secondary text-sm font-mono overflow-x-auto",children:f.map((g,m)=>c.jsxs("div",{className:"relative pl-8",children:[c.jsx("span",{className:"absolute left-0 w-6 text-right pr-1 text-secondary select-none",children:m+1}),g,c.jsx("button",{className:"ml-2 text-accent underline text-xs",onClick:()=>s(i===m+1?null:m+1),children:i===m+1?"Hide":"History"}),c.jsx("button",{className:"ml-1 text-accent underline text-xs",onClick:()=>{o(!0),u(f.join(`
`)+`
`)},children:"Edit"}),i===m+1&&c.jsx("div",{className:"mt-1",children:c.jsx(uw,{questId:e,filePath:n,lineNumber:m+1,onClose:()=>s(null)})})]},m))}),c.jsx("button",{onClick:()=>{o(!0),u(r+`
`)},className:"mt-2 text-accent underline text-sm",children:"Edit File"})]})},ku=({questId:e,node:n,canEdit:r=!0})=>{const[i,s]=v.useState(null),[a,o]=v.useState(n.collaborators||[]),[l,u]=v.useState(!1),d=i?i.headPostId===n.id:!1;v.useEffect(()=>{Pr(e).then(s).catch(()=>{})},[e]),v.useEffect(()=>{o(d?(i==null?void 0:i.collaborators)||[]:n.collaborators||[])},[d,i==null?void 0:i.collaborators,n.collaborators]);const h=async()=>{u(!0);try{d&&i?await Ol(i.id,{collaborators:a}):await Tt(n.id,{collaborators:a});for(const f of a)if(!f.userId){const p=f.roles&&f.roles.length?`Open Role: ${f.roles.join(", ")}`:"Open Role";try{const g=await Mi({type:"task",content:p,visibility:"public",questId:e,status:"To Do"});await dr(e,{postId:g.id,parentId:n.id,title:g.content.slice(0,50)}),await Al(g.id,"task")}catch(g){console.error("[TeamPanel] Failed to create open role task",g)}}}catch(f){console.error("[TeamPanel] Failed to save roles",f)}finally{u(!1)}};return c.jsxs("div",{className:"space-y-2",children:[i&&c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx(Mf,{users:(i.collaborators||[]).filter(f=>f.userId).map(f=>({avatarUrl:f.avatarUrl,username:f.username}))}),c.jsx(Vt,{to:ye.TEAM_BOARD(i.id),className:"text-xs text-blue-600 underline",children:"View All"})]}),r?c.jsxs(c.Fragment,{children:[c.jsx(Pi,{value:a,onChange:o}),c.jsx("button",{onClick:h,className:"text-xs text-accent underline",children:l?"Saving...":"Save Roles"})]}):c.jsxs("div",{className:"text-sm",children:[c.jsx("p",{className:"font-semibold",children:"Team Members:"}),c.jsx("ul",{className:"list-disc ml-4 space-y-1",children:a.map((f,p)=>c.jsxs("li",{children:[f.username?`@${f.username}`:"Open Role",f.roles&&f.roles.length?` - ${f.roles.join(", ")}`:""]},p))})]})]})},Vi=({questId:e,nodeId:n,indent:r=0})=>{const{nodes:i,edges:s,loadGraph:a}=ia();v.useEffect(()=>{e&&a(e)},[e,a]);const o=s.filter(u=>u.from===n).map(u=>i.find(d=>d.id===u.to)).filter(u=>!!u),l=async u=>{const d=u.status==="Done"?"To Do":"Done";try{await Tt(u.id,{status:d}),await a(e)}catch(h){console.error("[SubtaskChecklist] failed to update status",h)}};return o.length===0?null:c.jsx("ul",{className:"space-y-1",style:{marginLeft:r*12},children:o.map(u=>c.jsxs("li",{children:[c.jsxs("label",{className:"inline-flex items-center gap-1 text-sm",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:u.status==="Done",onChange:()=>l(u)}),c.jsx("span",{className:u.status==="Done"?"line-through":"",children:u.content})]}),c.jsx(Vi,{questId:e,nodeId:u.id,indent:r+1})]},u.id))})},Cu=({questId:e,node:n,user:r,showPost:i=!0,showLogs:s=!0,status:a,onStatusChange:o,onUpdate:l,hideSelects:u=!1})=>{const[d,h]=v.useState((n==null?void 0:n.taskType)||"abstract"),[f,p]=v.useState("file"),[g,m]=v.useState(a||(n==null?void 0:n.status)||"To Do"),{data:b,isLoading:x}=Ii({questId:e,filePath:n==null?void 0:n.gitFilePath,commitId:n==null?void 0:n.gitCommitSha});v.useEffect(()=>{h((n==null?void 0:n.taskType)||"abstract"),m(a||(n==null?void 0:n.status)||"To Do")},[n==null?void 0:n.taskType,n==null?void 0:n.status,a]),v.useEffect(()=>{p("file")},[n==null?void 0:n.id]);const y=async _=>{const j=_.target.value;if(h(j),p("file"),n){const S={...n,taskType:j};l==null||l(S),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:S},bubbles:!0}));try{const T=await Tt(n.id,{taskType:j});l==null||l(T),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:T},bubbles:!0}))}catch(T){console.error("[QuestNodeInspector] Failed to update task type",T)}}},w=async _=>{const j=_.target.value;if(m(j),o==null||o(_),n){const S={...n,status:j};l==null||l(S),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:S},bubbles:!0}));try{const T=await Tt(n.id,{status:j});l==null||l(T),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:T},bubbles:!0}))}catch(T){console.error("[QuestNodeInspector] Failed to update status",T)}}};if(!n)return c.jsx("div",{className:"p-2 text-sm",children:"Select a task"});const N=(r==null?void 0:r.id)===n.authorId||(n.collaborators||[]).some(_=>_.userId===(r==null?void 0:r.id)),k=[{value:"file",label:d==="file"?"File":d==="folder"?"Folder":"Planner"},...s?[{value:"logs",label:"Logs"}]:[],{value:"options",label:N?"Options":"Team"}];let C=null;switch(f){case"logs":C=c.jsx(_u,{questId:e,node:n,user:r});break;case"file":C=c.jsx("div",{className:"space-y-2",children:d==="file"?c.jsxs(c.Fragment,{children:[x?null:(b==null?void 0:b.diffMarkdown)&&c.jsx(Wn,{markdown:b.diffMarkdown}),c.jsx(Da,{questId:e,filePath:n.gitFilePath||"file.txt",content:n.content})]}):c.jsx(Vi,{questId:e,nodeId:n.id})});break;case"options":C=c.jsx(ku,{questId:e,node:n,canEdit:N});break;default:C=null}return c.jsx("div",{className:"flex flex-col h-full",children:c.jsxs("div",{className:"p-2 space-y-2 flex-1 overflow-auto",children:[i&&c.jsx(Un,{post:n,user:r,questId:e}),n.type==="task"&&!u&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(Ue,{id:"task-type",value:d,onChange:y,options:di}),c.jsx(Ue,{id:"task-status",value:g,onChange:w,options:Kt})]}),c.jsx("div",{className:"border-b border-secondary flex items-center text-sm overflow-x-auto whitespace-nowrap",children:k.map(_=>c.jsx("button",{onClick:()=>p(_.value),className:`px-3 py-1 -mb-px border-b-2 ${f===_.value?"border-primary text-primary":"border-transparent text-secondary hover:text-primary"}`,children:_.label},_.value))}),c.jsx("div",{className:"mt-2",children:C})]})})},fw=(e,n)=>{let r=null;return(...i)=>{r&&clearTimeout(r),r=setTimeout(()=>e(...i),n)}},ju=({items:e,edges:n,user:r,questId:i,compact:s=!1,condensed:a=!1,showStatus:o=!0,showInspector:l=!0,onSelectNode:u,onNodeClick:d,onEdgesChange:h,onScrollEnd:f,loadingMore:p=!1,boardId:g})=>{const m=v.useRef(null),b=v.useRef({}),[x,y]=v.useState([]),[w,N]=v.useState(e),[k,C]=v.useState([]),[_,j]=v.useState(n||[]),[S,T]=v.useState(null),[P,I]=v.useState(null),[L,V]=v.useState(null),R=L&&w.find(B=>B.id===L)||null;v.useEffect(()=>{N(e)},[e]);const{data:A,isLoading:O}=Ii({questId:i,filePath:S==null?void 0:S.gitFilePath,commitId:S==null?void 0:S.gitCommitSha}),M=v.useCallback(()=>{const B=m.current;if(!B)return;const Q=B.getBoundingClientRect(),W=[];_.forEach(X=>{const Z=b.current[X.from],te=b.current[X.to];if(Z&&te){const ne=Z.getBoundingClientRect(),ue=te.getBoundingClientRect(),de=ne.left+ne.width/2-Q.left+B.scrollLeft,je=ne.bottom-Q.top+B.scrollTop,se=ue.left+ue.width/2-Q.left+B.scrollLeft,le=ue.top-Q.top+B.scrollTop;W.push({key:`${X.from}-${X.to}`,d:`M ${de} ${je} L ${se} ${le}`,type:X.type})}}),y(W)},[_]),q=v.useRef(()=>{});v.useEffect(()=>{q.current=fw(M,50)},[M]),v.useLayoutEffect(()=>{M()},[k,_,M]),v.useEffect(()=>(window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)),[M]),v.useEffect(()=>{const B={},Q=[];if(w.forEach(W=>{B[W.id]={...W,children:[]}}),_&&_.length>0){const W=_.filter(Z=>Z.type!=="abstract"),X=new Set(W.map(Z=>Z.to));W.forEach(Z=>{const te=B[Z.from],ne=B[Z.to];te&&ne&&te.children.push({node:ne,edge:Z})}),Object.values(B).forEach(Z=>{X.has(Z.id)||Q.push(Z)})}else w.forEach(W=>{var Z;const X=W.replyTo||((Z=W.repostedFrom)==null?void 0:Z.originalPostId);X&&B[X]?B[X].children.push({node:B[W.id]}):Q.push(B[W.id])});C(Q)},[w,_]),v.useEffect(()=>{j(n||[])},[n]),v.useEffect(()=>{const B=m.current;if(!B)return;const Q=()=>{if(q.current(),!f)return;const{scrollTop:W,scrollHeight:X,clientHeight:Z}=B;W+Z>=X-100&&f()};return B.addEventListener("scroll",Q),()=>B.removeEventListener("scroll",Q)},[f]);const D=B=>{T(B),V(Q=>Q===B.id?null:B.id),u==null||u(B),window.dispatchEvent(new CustomEvent("questTaskSelect",{detail:{taskId:B.id}}))},F=B=>{I(B)},z=(B,Q)=>{const W=new Set,X=[B];for(;X.length>0;){const Z=X.pop();if(Z===Q)return!0;_.filter(te=>te.from===Z&&te.type!=="abstract").forEach(te=>{W.has(te.to)||(W.add(te.to),X.push(te.to))})}return!1},H=B=>{j(Q=>{const W=Q.filter(X=>!(X.from===B.from&&X.to===B.to));return W!==Q&&(h==null||h(W)),W})},Y=async B=>{const{active:Q,over:W}=B,X=Q.id;if(X.startsWith("anchor-")){const ne=X.slice(7),ue=`new-${Date.now()}`,de={id:ue,type:"task",content:"New Task",authorId:"",visibility:"public",timestamp:"",tags:[],collaborators:[],linkedItems:[]};N(je=>[...je,de]),j(je=>{const se={from:ne,to:ue},le=[...je,se];return h==null||h(le),le});return}const Z=W?W.id:null,te=X.startsWith("move-")?X.slice(5):X;if(!Z){j(ne=>{const ue=ne.filter(de=>de.to!==te);return ue!==ne&&(h==null||h(ue)),ue});return}if(te!==Z){if(z(te,Z)){j(ne=>{if(ne.some(se=>se.from===Z&&se.to===te&&se.type==="abstract"))return ne;const de={from:Z,to:te,type:"abstract"},je=[...ne,de];return h==null||h(je),je});return}j(ne=>{const ue=ne.filter(le=>le.to!==te),de=ue.some(le=>le.from===Z&&le.to===te),je={from:Z,to:te},se=de?ue:[...ue,je];return se!==ne&&(h==null||h(se)),se})}};return c.jsxs(xu,{onDragEnd:Y,children:[c.jsxs("div",{ref:m,className:"overflow-auto w-full h-full p-4 max-w-7xl mx-auto "+(k.length===1?"flex justify-center":""),style:{minHeight:"24vh",maxHeight:"40vh",position:"relative"},children:[c.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",xmlns:"http://www.w3.org/2000/svg",children:[c.jsx("defs",{children:c.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:c.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#aaa"})})}),x.map(B=>c.jsx("path",{d:B.d,stroke:B.type==="abstract"?"#f97316":"#aaa",strokeDasharray:B.type==="abstract"?"4 2":void 0,fill:"none",markerEnd:"url(#arrow)"},B.key))]}),k.map(B=>c.jsx(Zs,{node:B,depth:0,user:r,compact:s,condensed:a,showStatus:o,focusedNodeId:P,onFocus:F,selectedNode:S,onSelect:D,onNodeClick:d,onRemoveEdge:H,diffData:A,diffLoading:O,registerNode:(Q,W)=>{b.current[Q]=W},boardId:g},B.id)),p&&c.jsx("div",{className:"flex justify-center py-4",children:c.jsx(St,{})})]}),l&&c.jsx("div",{className:"fixed top-0 right-0 h-full w-80 bg-surface dark:bg-background shadow-lg transform transition-transform duration-300 "+(L?"translate-x-0":"translate-x-full"),"data-testid":"quest-node-inspector",children:R&&c.jsx(Cu,{questId:i,node:R,user:r})})]})},dw=e=>{const n=e.trim();return n.length<=50?n:n.slice(0,50)+"…"},Su=({post:e,onUpdate:n,summaryOnly:r=!1,hideSummaryTag:i=!1})=>{var L,V,R;const[s,a]=v.useState(e.status||"To Do"),[o,l]=v.useState(e.taskType||"abstract"),[u,d]=v.useState(!1),[h,f]=v.useState(!1),[p,g]=v.useState(""),m=(L=e.tags)==null?void 0:L.find(A=>A.toLowerCase().startsWith("difficulty:")),b=(V=e.tags)==null?void 0:V.find(A=>A.toLowerCase().startsWith("role:")),x=(R=e.tags)==null?void 0:R.find(A=>A.toLowerCase().startsWith("min_rank:")),y=m?m.split(":")[1]:void 0,w=b?b.split(":")[1]:void 0,N=x?x.split(":")[1]:void 0,k=e.questNodeTitle||dw(e.content),C=async A=>{const O=A.target.value;a(O);const M={...e,status:O};n==null||n(M),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:M},bubbles:!0}));try{const q=await Tt(e.id,{status:O});n==null||n(q),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:q},bubbles:!0}))}catch(q){console.error("[TaskPreviewCard] Failed to update status",q)}},_=async A=>{const O=A.target.value;l(O);const M={...e,taskType:O};n==null||n(M),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:M},bubbles:!0}));try{const q=await Tt(e.id,{taskType:O});n==null||n(q),document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:q},bubbles:!0}))}catch(q){console.error("[TaskPreviewCard] Failed to update task type",q)}},j=async A=>{if(d(A),A){const O=e.content.trim().split(/\s+/)[0].replace(/[^a-z0-9_-]/gi,"_").toLowerCase();if(g(O||"folder"),e.questId)try{await ms(e.questId,O||"folder")}catch(M){console.error("[TaskPreviewCard] Failed to create folder",M)}}},S=async()=>{if(!(!e.questId||!p))try{await ms(e.questId,p)}catch(A){console.error("[TaskPreviewCard] Failed to create folder",A)}};let P=sa(e).find(A=>A.type==="task");P?P={...P,label:e.nodeId?e.nodeId.replace(/^Q:[^:]+:/,""):P.label.replace(/^Task\s*[-:]\s*/,""),username:void 0,usernameLink:void 0,link:ye.POST(e.id)}:P={type:"task",label:e.nodeId?e.nodeId.replace(/^Q:[^:]+:/,""):"Task",detailLink:ye.POST(e.id),link:ye.POST(e.id)};const I=!i&&P?c.jsx("div",{className:"flex flex-wrap gap-1",children:c.jsx(Sn,{...P})}):null;return r?c.jsxs("div",{className:"border border-secondary rounded bg-surface p-2 text-xs space-y-1",children:[I,c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xs,{status:s}),c.jsx(Ue,{value:s,onChange:C,options:Kt,className:"text-xs"})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx(Ue,{value:o,onChange:_,options:di,className:"text-xs"})}),o==="file"&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:u,onChange:A=>j(A.target.checked)}),"Organize File"]}),u&&c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"text",value:p,onChange:A=>g(A.target.value),className:"border rounded px-1 py-0.5 text-xs"}),c.jsx("button",{type:"button",onClick:S,className:"text-xs underline",children:"Save"})]})]}),o==="folder"&&c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:h,onChange:A=>f(A.target.checked)}),"Make Planner File"]}),o==="abstract"&&c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:h,onChange:A=>f(A.target.checked)}),"Make Planner File"]})]}):c.jsxs("div",{className:"border border-secondary rounded bg-surface p-2 text-xs space-y-1",children:[I,c.jsx("div",{className:"font-semibold text-sm truncate",children:c.jsx(Vt,{to:ye.POST(e.id),className:"hover:underline",children:k})}),e.gitFilePath&&c.jsx("div",{className:"text-secondary",children:e.gitFilePath}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xs,{status:s}),c.jsx(Ue,{value:s,onChange:C,options:Kt,className:"text-xs"})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx(Ue,{value:o,onChange:_,options:di,className:"text-xs"})}),o==="file"&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:u,onChange:A=>j(A.target.checked)}),"Organize File"]}),u&&c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"text",value:p,onChange:A=>g(A.target.value),className:"border rounded px-1 py-0.5 text-xs"}),c.jsx("button",{type:"button",onClick:S,className:"text-xs underline",children:"Save"})]})]}),o==="folder"&&c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:h,onChange:A=>f(A.target.checked)}),"Make Planner File"]}),o==="abstract"&&c.jsxs("label",{className:"inline-flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"checkbox",className:"form-checkbox",checked:h,onChange:A=>f(A.target.checked)}),"Make Planner File"]}),(w||N||y)&&c.jsxs("div",{className:"space-y-0.5",children:[w&&c.jsxs("div",{children:["Role: ",w]}),N&&c.jsxs("div",{children:["Min Rank: ",N]}),y&&c.jsxs("div",{children:["Difficulty: ",y]})]})]})},Fa=({questId:e,status:n,boardId:r,parentId:i,onSave:s,onCancel:a,allowIssue:o=!1})=>{const[l,u]=v.useState(""),[d,h]=v.useState("file"),[f,p]=v.useState(n||"To Do"),[g,m]=v.useState(!1),[b,x]=v.useState("task"),{appendToBoard:y}=Tn()||{},w=async N=>{if(N.preventDefault(),!!l&&!g){m(!0);try{const k=await Mi({type:b,content:l,visibility:"public",questId:e,status:f,taskType:d,...r?{boardId:r}:{},...i?{replyTo:i,linkedNodeId:i}:{}});if(r&&(y==null||y(r,k)),i)try{const C=_=>{const j=_.trim();return j.length<=50?j:j.slice(0,50)+"…"};await dr(e,{postId:k.id,parentId:i,title:k.questNodeTitle||C(k.content)})}catch(C){console.error("[QuickTaskForm] Failed to link task to quest:",C)}s==null||s(k)}catch(k){console.error("[QuickTaskForm] Failed to create task:",k)}finally{m(!1)}}};return c.jsxs("form",{onSubmit:w,className:"space-y-2 border border-secondary rounded p-2 bg-background",children:[c.jsx(Nt,{value:l,onChange:N=>u(N.target.value),placeholder:"Item name",required:!0}),o&&c.jsx(Ue,{value:b,onChange:N=>x(N.target.value),options:[{value:"task",label:"Task"},{value:"issue",label:"Issue"}]}),c.jsx(Ue,{value:d,onChange:N=>h(N.target.value),options:di}),!n&&c.jsx(Ue,{value:f,onChange:N=>p(N.target.value),options:Kt.map(({value:N,label:k})=>({value:N,label:k}))}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx($e,{type:"button",size:"sm",variant:"ghost",onClick:a,children:"Cancel"}),c.jsx($e,{type:"submit",size:"sm",variant:"contrast",disabled:g,children:g?"Adding...":"Add"})]})]})},hw={"To Do":"🟦","In Progress":"⏳",Blocked:"⛔",Done:"✅"},Nu=({questId:e,linkedNodeId:n,initialOpen:r=!1})=>{var b;const[i,s]=v.useState([]),[a,o]=v.useState("all"),[l,u]=v.useState(!1),[d,h]=v.useState(r);v.useEffect(()=>{e&&Mr(e).then(x=>{s(x.filter(y=>y.type==="issue"&&y.linkedNodeId===n||y.type==="task"&&y.replyTo===n))}).catch(x=>{console.error("[StatusBoardPanel] failed to load issues",x)})},[e,n]);const f=i.filter(x=>a==="issues"?x.type==="issue":a==="tasks"?x.type==="task":!0),p=Kt.reduce((x,y)=>(x[y.value]=f.filter(w=>w.status===y.value),x),{}),g=((b=p.Done)==null?void 0:b.length)??0,m=f.length;return c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 bg-soft cursor-pointer",onClick:()=>h(x=>!x),children:[c.jsx("span",{className:"font-semibold text-sm",children:"Status Board"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-xs",children:[g,"/",m," Done"]}),c.jsx("span",{className:"text-xs",children:d?"▲":"▼"})]})]}),d&&c.jsxs("div",{className:"p-2 space-y-2",children:[c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{className:"flex gap-2 text-xs",children:[c.jsx("button",{className:`px-2 py-0.5 rounded border ${a==="all"?"bg-accent text-white border-accent":"border-secondary"}`,onClick:()=>o("all"),children:"All"}),c.jsx("button",{className:`px-2 py-0.5 rounded border ${a==="issues"?"bg-accent text-white border-accent":"border-secondary"}`,onClick:()=>o("issues"),children:"Issues"}),c.jsx("button",{className:`px-2 py-0.5 rounded border ${a==="tasks"?"bg-accent text-white border-accent":"border-secondary"}`,onClick:()=>o("tasks"),children:"Tasks"})]}),c.jsx("button",{className:"text-xs text-accent underline",onClick:()=>u(x=>!x),children:l?"- Cancel":"+ Add Item"})]}),l&&c.jsx("div",{className:"mb-2",children:c.jsx(Fa,{questId:e,boardId:`log-${e}`,parentId:n,allowIssue:!0,onSave:x=>{s(y=>[...y,x]),u(!1)},onCancel:()=>u(!1)})}),c.jsx("div",{className:"flex overflow-auto space-x-2",children:Kt.map(({value:x})=>c.jsxs("div",{className:"min-w-[80px] w-28 flex-shrink-0 bg-surface border border-secondary rounded-lg p-2 space-y-2",children:[c.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-1",children:[c.jsx("span",{children:hw[x]||"➡️"}),x,c.jsx("span",{className:"ml-auto text-xs text-secondary",children:p[x].length})]}),p[x].length===0?c.jsx("div",{className:"text-xs text-secondary",children:"No items"}):p[x].map(y=>c.jsxs("div",{className:"text-xs border border-secondary rounded p-1 bg-background space-y-1",children:[c.jsx("span",{title:y.title||y.content,className:"block truncate",children:c.jsx(Sn,{type:y.type,label:zl(y,"",!1),link:ye.POST(y.id)})}),y.status&&c.jsx(xs,{status:y.status})]},y.id))]},x))})]})]})},bl={E:0,D:1,C:2,B:3,A:4,S:5},Tu=({quest:e,user:n,onJoinToggle:r,onDelete:i,onEdit:s,onCancel:a,defaultExpanded:o=!1,hideToggle:l=!1,expanded:u,onToggleExpand:d})=>{var zt,pn,ft,tn,Se,Ie;const[h,f]=v.useState("file"),[p,g]=v.useState(o),[m,b]=v.useState(e),[x,y]=v.useState([]),[w,N]=v.useState(null),[k,C]=v.useState(null),[_,j]=v.useState(240),[S,T]=v.useState(!1),[P,I]=v.useState(!1),[L,V]=v.useState(!1),[R,A]=v.useState(e.linkedPosts||[]),[O,M]=v.useState(!1),[q,D]=v.useState(!1),[F,z]=v.useState(!1),[H,Y]=v.useState(!!n&&(e.followers||[]).includes(n.id)),[B,Q]=v.useState(((zt=e.followers)==null?void 0:zt.length)||0),W=Er(),{data:X,isLoading:Z}=Ii({questId:e.id,filePath:w==null?void 0:w.gitFilePath,commitId:w==null?void 0:w.gitCommitSha}),te=u!==void 0?u:p,ne=(pn=m.tags)==null?void 0:pn.find(K=>K.toLowerCase().startsWith("rank:")),ue=(ft=m.tags)==null?void 0:ft.find(K=>K.toLowerCase().startsWith("difficulty:")),de=(tn=m.tags)==null?void 0:tn.find(K=>K.toLowerCase().startsWith("reward:")),je=((Se=m.tags)==null?void 0:Se.filter(K=>K.toLowerCase().startsWith("role:")))||[],se=ne?ne.split(":")[1]:"Unrated",le=ue?ue.split(":")[1]:"Unknown",Pe=de?de.split(":")[1]:"Unknown",Lt=je.map(K=>K.split(":")[1]).join(", "),xt=m.description||"",vt=xt.length>120?xt.slice(0,117)+"…":xt,Ve=Af((n==null?void 0:n.xp)??0),He=(n==null?void 0:n.id)===m.authorId,Je=(Ie=m.collaborators)==null?void 0:Ie.some(K=>K.userId===(n==null?void 0:n.id)),ut=He||Je,Mt=He||Je,Zt=[{value:"file",label:(w==null?void 0:w.taskType)==="file"?"File":(w==null?void 0:w.taskType)==="folder"?"Folder":"Planner"},{value:"logs",label:"Logs"},{value:"options",label:ut?"Options":"Team"}],Le=v.useMemo(()=>{if(!w)return new Set;const K=new Set;if(k&&w.id===k.id)return x.forEach(ie=>K.add(ie.id)),K;const ae=ie=>{K.add(ie),(m.taskGraph||[]).filter(fe=>fe.from===ie).forEach(fe=>ae(fe.to))};return ae(w.id),K},[w,m.taskGraph,k,x]),J=v.useMemo(()=>x.filter(K=>Le.has(K.id)),[x,Le]),oe=v.useMemo(()=>(m.taskGraph||[]).filter(K=>Le.has(K.from)&&Le.has(K.to)),[m.taskGraph,Le]),xe=()=>{if(!(n!=null&&n.id)){W(ye.LOGIN);return}if(Mt){alert("You are already part of this quest.");return}if(O){alert("Request already sent. Awaiting approval.");return}r==null||r(m),M(!0),alert("Join request sent.")},Be=async()=>{if(n)try{if(H){const K=await kf(e.id);Q(K.followers.length),Y(!1)}else{const K=await Cf(e.id);Q(K.followers.length),Y(!0)}}catch(K){console.error("[QuestCard] Failed to toggle follow",K)}},Ae=async()=>{try{await Ol(e.id,{linkedPosts:R}),b({...m,linkedPosts:R}),V(!1)}catch(K){console.error("[QuestCard] Failed to save links:",K)}},Ze=K=>{N(K),y(ae=>ae.map(ie=>ie.id===K.id?{...ie,...K}:ie)),(k==null?void 0:k.id)===K.id&&C(K)},Re=K=>{const ae=K.clientX,ie=_,fe=et=>{const _e=Math.min(400,Math.max(240,ie+et.clientX-ae));j(_e)},we=()=>{document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",we)};document.addEventListener("mousemove",fe),document.addEventListener("mouseup",we)};v.useEffect(()=>{if(!te)return;(async()=>{try{const[ae,ie]=await Promise.all([Pr(e.id),Mr(e.id)]);b(ae),y(ie);const we=ie.filter(et=>!(ae.taskGraph||[]).some(_e=>_e.to===et.id))[0]||ie[0]||null;C(we),N(we),A(ae.linkedPosts||[])}catch(ae){console.error("[QuestCard] Failed to fetch quest data:",ae)}})()},[e.id,te]),v.useEffect(()=>{const K=ae=>{const ie=ae,fe=x.find(we=>we.id===ie.detail.taskId);fe&&(N(fe),f("file"))};return window.addEventListener("questTaskOpen",K),()=>window.removeEventListener("questTaskOpen",K)},[x,k]),v.useEffect(()=>{const K=ae=>{const{task:ie}=ae.detail;y(fe=>fe.map(we=>we.id===ie.id?{...we,...ie}:we)),(w==null?void 0:w.id)===ie.id&&N({...w,...ie}),(k==null?void 0:k.id)===ie.id&&C({...k,...ie})};return window.addEventListener("taskUpdated",K),()=>window.removeEventListener("taskUpdated",K)},[w,k]);const bt=()=>{var K,ae;return c.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Sn,{type:"quest",label:Ef.quest}),c.jsx(Vt,{to:ye.QUEST(e.id),className:"text-xl font-bold text-primary underline",children:Ll(m.title)})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[c.jsx("span",{children:(K=m.createdAt)==null?void 0:K.slice(0,10)}),((ae=m.gitRepo)==null?void 0:ae.repoUrl)&&c.jsx("a",{href:m.gitRepo.repoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"Git Repo"})]})]}),c.jsxs("div",{className:"flex gap-2 mt-2 md:mt-0 items-center flex-wrap",children:[!l&&c.jsx($e,{variant:"ghost",onClick:()=>{d?d():g(ie=>!ie),te||f("file")},children:te?"▲ Collapse":"▼ Expand"}),c.jsxs($e,{variant:"ghost",onClick:Be,disabled:!n,children:[c.jsx(Pl,{className:"mr-1"})," ",H?"Following":"Follow"," ",B]}),c.jsx(ys,{type:"quest",id:e.id,canEdit:He,onEdit:He?()=>s==null?void 0:s(m):void 0,onEditLinks:He?()=>V(!0):void 0,onDelete:He?()=>i==null?void 0:i(m):void 0,onArchived:He?()=>{console.log(`[QuestCard] Quest ${e.id} archived`)}:void 0,onJoin:Mt?void 0:xe,joinLabel:"Request to Join",permalink:`${window.location.origin}${ye.QUEST(e.id)}`}),a&&c.jsx($e,{onClick:a,variant:"secondary",children:"Cancel"})]})]})},en=()=>{if(!te)return null;const K=c.jsx(tu,{items:x,edges:m.taskGraph});return c.jsxs("div",{className:"space-y-2",children:[w&&c.jsx("div",{className:"space-y-2",children:c.jsx(Su,{post:w,onUpdate:Ze,summaryOnly:!0})}),c.jsx("div",{className:"h-48 overflow-auto border-b border-secondary","data-testid":"quest-map-canvas",children:K}),c.jsx("div",{className:"text-right text-xs",children:c.jsx(Vt,{to:ye.BOARD(`map-${e.id}`),className:"underline text-accent",children:"Open Canvas"})})]})},wt=()=>{if(!w)return c.jsx("div",{className:"p-2 text-sm",children:"Select a task"});const K=(m.taskGraph||[]).filter($=>$.from===w.id).map($=>$.to),ae=x.filter($=>K.includes($.id)),ie=w.taskType==="folder"||w.id===(k==null?void 0:k.id)||ae.length>0,fe=!!w.planner,we=c.jsx(Nu,{questId:e.id,linkedNodeId:w.id,initialOpen:!1}),et=async $=>{const Ee=[...(m.taskGraph||[]).filter(he=>!(Le.has(he.from)&&Le.has(he.to))),...$];try{await Dl(e.id,Ee),b(he=>({...he,taskGraph:Ee}))}catch(he){console.error("[QuestCard] Failed to save folder graph",he)}},_e=c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 bg-soft cursor-pointer",onClick:()=>D($=>!$),children:[c.jsx("span",{className:"font-semibold text-sm",children:"Checklist"}),c.jsx("span",{className:"text-xs",children:q?"▲":"▼"})]}),q&&c.jsx("div",{className:"p-2",children:c.jsx(Vi,{questId:e.id,nodeId:w.id})})]}),at=(ie||fe)&&c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 bg-soft cursor-pointer",onClick:()=>z($=>!$),children:[c.jsx("span",{className:"font-semibold text-sm",children:"Folder Structure"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:$=>{$.stopPropagation(),I(re=>!re)},className:"text-xs text-accent underline",children:P?"- Cancel":"+ Add Item"}),c.jsx("span",{className:"text-xs",children:F?"▲":"▼"})]})]}),P&&c.jsx("div",{className:"p-2",children:c.jsx(Fa,{questId:e.id,parentId:w.id,boardId:`task-${w.id}`,allowIssue:!0,onSave:$=>{y(re=>[...re,$]),I(!1)},onCancel:()=>I(!1)})}),F&&c.jsx("div",{className:"p-2 space-y-2",children:c.jsx("div",{className:"h-64 overflow-auto",children:c.jsx(ju,{items:J,edges:oe,questId:e.id,condensed:!0,showInspector:!1,showStatus:!1,onEdgesChange:et,onNodeClick:$=>{$.id!==w.id&&W(ye.POST($.id))}})})})]}),Ge=c.jsxs("div",{className:"space-y-2",children:[w.taskType==="file"&&(Z?null:(X==null?void 0:X.diffMarkdown)&&c.jsx(Wn,{markdown:X.diffMarkdown})),c.jsx(Da,{questId:e.id,filePath:w.gitFilePath||"file.txt",content:w.content})]});return c.jsxs("div",{className:"space-y-2 p-2",children:[we,_e,at,w.taskType!=="abstract"&&Ge]})},Qn=()=>{if(!te)return null;let K=null;switch(h){case"logs":w?K=c.jsx(_u,{questId:e.id,node:w,user:n}):K=c.jsxs(c.Fragment,{children:[S&&c.jsx("div",{className:"mb-4",children:c.jsx(kn,{initialType:"log",questId:e.id,boardId:`log-${e.id}`,onSave:ae=>{y(ie=>[...ie,ae]),T(!1)},onCancel:()=>T(!1)})}),c.jsx(kw,{questId:e.id,items:x,user:n,layout:"vertical",editable:ut,boardId:`log-${e.id}`}),c.jsx("div",{className:"text-right mt-2",children:ut?c.jsx($e,{size:"sm",variant:"contrast",onClick:()=>T(!0),children:"+ Add Item"}):c.jsx($e,{size:"sm",variant:"contrast",onClick:xe,children:"Request to Join"})})]});break;case"file":K=wt();break;case"options":K=w||k?c.jsx(ku,{questId:e.id,node:w||k,canEdit:ut}):c.jsx("div",{className:"p-2 text-sm",children:"Select a task"});break;default:K=null}return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"border-b border-secondary flex text-sm overflow-x-auto whitespace-nowrap",children:Zt.map(ae=>c.jsx("button",{onClick:()=>f(ae.value),className:`px-3 py-1 -mb-px border-b-2 ${h===ae.value?"border-primary text-primary":"border-transparent text-secondary hover:text-primary"}`,children:ae.label},ae.value))}),K]})};return c.jsxs("div",{className:"border border-secondary rounded-lg shadow bg-surface p-6 text-primary",children:[bt(),!te&&c.jsxs("div",{className:"text-sm text-secondary space-y-1 mb-2",children:[vt&&c.jsx("p",{children:vt}),c.jsxs("div",{className:"text-xs space-y-0.5",children:[c.jsxs("div",{children:["Rank: ",se]}),c.jsxs("div",{children:["Difficulty: ",le]}),c.jsxs("div",{children:["Reward: ",Pe]}),Lt&&c.jsxs("div",{children:["Roles Needed: ",Lt]})]}),n&&bl[Ve]<(bl[se]??0)&&c.jsxs("div",{className:"text-red-500 text-xs",children:["Requires ",se," rank. Your rank: ",Ve,". Level up to join."]})]}),c.jsx("div",{className:"text-xs text-secondary space-y-1 mb-2",children:L&&c.jsxs("div",{className:"mt-2",children:[c.jsx(Ai,{value:R,onChange:A,allowCreateNew:!1,itemTypes:["quest","post"]}),c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsx("button",{type:"button",className:"text-xs bg-indigo-600 text-white px-2 py-1 rounded",onClick:Ae,children:"Save"}),c.jsx("button",{type:"button",className:"text-xs underline",onClick:()=>{A(m.linkedPosts||[]),V(!1)},children:"Cancel"})]})]})}),te&&c.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-h-[420px] overflow-y-auto",children:[c.jsx("div",{className:"overflow-auto md:pl-4 max-h-[420px]",style:{width:_},children:en()}),c.jsx("div",{className:"hidden md:block w-1.5 bg-gray-200 dark:bg-gray-600 cursor-ew-resize",onMouseDown:Re}),c.jsx("div",{className:"flex-1 md:pr-4 md:border-r md:border-gray-300 dark:md:border-gray-700 overflow-auto max-h-[420px]",children:Qn()})]})]})},pw=({task:e,questId:n,user:r,onUpdate:i})=>{var M,q;const{nodes:s,edges:a,loadGraph:o}=ia(),[l,u]=v.useState(e),[d,h]=v.useState(400),[f,p]=v.useState(!1),[g,m]=v.useState(!1),[b,x]=v.useState(!1),y=Er(),w=(M=e.nodeId)==null?void 0:M.endsWith("T00"),N=(q=l.nodeId)==null?void 0:q.endsWith("T00"),k=D=>{u(D),i==null||i(D)};v.useEffect(()=>{u(e)},[e]),v.useEffect(()=>{n&&o(n)},[n,o]),v.useEffect(()=>{if(!w)return;const D=F=>{const{taskId:z}=F.detail,H=s.find(Y=>Y.id===z);H&&u(H)};return window.addEventListener("questTaskOpen",D),()=>window.removeEventListener("questTaskOpen",D)},[w,s]),v.useEffect(()=>{const D=F=>{const{task:z}=F.detail;l.id===z.id&&u({...l,...z})};return window.addEventListener("taskUpdated",D),()=>window.removeEventListener("taskUpdated",D)},[l]);const C=async D=>{try{await Dl(n,D),await o(n)}catch(F){console.error("[TaskCard] Failed to save task graph",F)}},_=v.useMemo(()=>{const D=new Set,F=z=>{D.has(z)||(D.add(z),a.filter(H=>H.from===z).forEach(H=>F(H.to)))};return F(e.id),D},[e.id,a]),j=v.useMemo(()=>s.filter(D=>_.has(D.id)),[s,_]),S=v.useMemo(()=>a.filter(D=>_.has(D.from)&&_.has(D.to)),[a,_]),T=a.find(D=>D.to===l.id),P=T?s.find(D=>D.id===T.from):void 0,I=!N&&P?sa(P).find(D=>D.type==="task"):void 0,L=l.taskType||"abstract",V=l.status,{data:R,isLoading:A}=Ii({questId:n,filePath:l.gitFilePath,commitId:l.gitCommitSha}),O=D=>{const F=D.clientX,z=d,H=B=>{const Q=Math.min(600,Math.max(260,z-(B.clientX-F)));h(Q)},Y=()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",Y)};document.addEventListener("mousemove",H),document.addEventListener("mouseup",Y)};return c.jsx("div",{className:"border border-secondary rounded-lg bg-surface p-4 space-y-2",children:c.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[c.jsxs("div",{className:"flex-1 space-y-2 md:pr-4",style:{minWidth:240},children:[c.jsx(Su,{post:l,summaryOnly:!0,hideSummaryTag:!N}),c.jsx("div",{className:"flex items-center justify-between gap-1",children:P&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-px h-4 border-l-2 border-dotted border-secondary cursor-pointer",title:`Parent: ${P.content.slice(0,50)}`,onClick:()=>y(ye.POST(P.id))}),I&&c.jsx(Sn,{...I})]})}),c.jsx("div",{className:"h-64 overflow-auto","data-testid":"task-map-inline",children:c.jsx(tu,{items:j,edges:S,...!w&&{onNodeClick:D=>{D.id!==e.id&&y(ye.POST(D.id))}}})}),w&&c.jsx("div",{className:"text-right text-xs",children:c.jsx(Vt,{to:ye.BOARD(`map-${n}`),className:"underline text-accent",children:"Open Canvas"})})]}),c.jsx("div",{className:"hidden md:block w-1.5 bg-gray-200 dark:bg-gray-600 cursor-ew-resize",onMouseDown:O}),c.jsxs("div",{className:"overflow-auto",style:{width:d},children:[c.jsx(Cu,{questId:n,node:l,user:r,showPost:!1,onUpdate:k,status:V,hideSelects:!0}),c.jsxs("div",{className:"space-y-2 p-2 mt-2",children:[c.jsx(Nu,{questId:n,linkedNodeId:l.id,initialOpen:!1}),c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 bg-soft cursor-pointer",onClick:()=>x(D=>!D),children:[c.jsx("span",{className:"font-semibold text-sm",children:"Checklist"}),c.jsx("span",{className:"text-xs",children:b?"▲":"▼"})]}),b&&c.jsx("div",{className:"p-2",children:c.jsx(Vi,{questId:n,nodeId:l.id})})]}),(L==="folder"||l.id===e.id||S.some(D=>D.from===l.id))&&c.jsxs("div",{className:"border border-secondary rounded",children:[c.jsxs("div",{className:"flex justify-between items-center p-2 bg-soft cursor-pointer",onClick:()=>m(D=>!D),children:[c.jsx("span",{className:"font-semibold text-sm",children:"Folder Structure"}),c.jsx("span",{className:"text-xs",children:g?"▲":"▼"})]}),g&&c.jsxs("div",{className:"p-2 space-y-2",children:[f&&c.jsx(Fa,{questId:n,parentId:l.id,boardId:`task-${l.id}`,allowIssue:!0,onSave:()=>p(!1),onCancel:()=>p(!1)}),c.jsx("div",{className:"text-right",children:c.jsx("button",{onClick:()=>p(D=>!D),className:"text-xs text-accent underline",children:f?"- Cancel":"+ Add Item"})}),c.jsx("div",{className:"h-64 overflow-auto",children:c.jsx(ju,{items:j,edges:S,questId:n,condensed:!0,showInspector:!1,showStatus:!1,onEdgesChange:C,onNodeClick:D=>{D.id!==e.id&&y(ye.POST(D.id))}})})]})]}),L!=="abstract"&&c.jsxs("div",{className:"space-y-2",children:[L==="file"&&(A?null:(R==null?void 0:R.diffMarkdown)&&c.jsx(Wn,{markdown:R.diffMarkdown})),c.jsx(Da,{questId:n,filePath:l.gitFilePath||"file.txt",content:l.content})]})]})]})]})})},wl=({post:e,user:n,onUpdate:r,replyOverride:i,isTimeline:s,boardId:a,onReplyToggle:o,timestamp:l,expanded:u,onToggleExpand:d})=>{var Je,ut,Mt,Zt,Le;const[h,f]=v.useState({like:!1,heart:!1}),[p,g]=v.useState({like:0,heart:0,repost:0}),[m,b]=v.useState(!0),[x,y]=v.useState(null),[w,N]=v.useState(!1),[k,C]=v.useState(!1),[_,j]=v.useState(e.type==="task"),[S,T]=v.useState(((Je=e.tags)==null?void 0:Je.includes("archived"))??!1),[P,I]=v.useState(!1),L=!!n&&(e.authorId===n.id||((ut=e.tags)==null?void 0:ut.includes(`pending:${n.id}`))||(e.collaborators||[]).some(J=>J.userId===n.id)),[V,R]=v.useState(L),[A,O]=v.useState(!!n&&(e.followers||[]).includes(n.id)),[M,q]=v.useState(((Mt=e.followers)==null?void 0:Mt.length)||0),[D,F]=v.useState(null),z=Er(),{selectedBoard:H,appendToBoard:Y,boards:B}=Tn()||{},Q=a||H,W=Q?(Zt=B==null?void 0:B[Q])==null?void 0:Zt.boardType:void 0,X=s??Q==="timeline-board",te=Q==="my-posts"||W==="post",ne=Q==="quest-board"&&e.type==="request",ue=e.type==="request"&&Q==="quest-board",de=(Le=e.tags)==null?void 0:Le.find(J=>J.toLowerCase().startsWith("role:")),[je,se]=v.useState(e.helpRequest===!0),le=u!==void 0?u:_;v.useEffect(()=>{(async()=>{if(e!=null&&e.id)try{const[oe,xe,Be]=await Promise.all([lf(e.id),cf(e.id),n!=null&&n.id?uf(e.id):Promise.resolve(null)]),Ae=oe.filter(Re=>Re.userId===(n==null?void 0:n.id)),Ze={like:0,heart:0,repost:0};oe.forEach(Re=>{(Re.type==="like"||Re.type==="heart")&&(Ze[Re.type]+=1)}),Ze.repost=(xe==null?void 0:xe.count)??0,g(Ze),f({like:Ae.some(Re=>Re.type==="like"),heart:Ae.some(Re=>Re.type==="heart")}),y((Be==null?void 0:Be.id)||null)}catch(oe){console.error("[ReactionControls] Failed to fetch data:",oe)}finally{b(!1)}})()},[e.id,n==null?void 0:n.id]);const Pe=async J=>{if(!(n!=null&&n.id))return;const oe=!h[J];f(xe=>({...xe,[J]:oe})),g(xe=>({...xe,[J]:xe[J]+(oe?1:-1)}));try{await ff(e.id,J,oe)}catch(xe){console.error(`[ReactionControls] Failed to toggle ${J}:`,xe),f(Be=>({...Be,[J]:!oe})),g(Be=>({...Be,[J]:Be[J]-(oe?1:-1)}))}},Lt=async()=>{if(!(!(n!=null&&n.id)||k)){C(!0);try{if(x)await df(x),g(J=>({...J,repost:J.repost-1})),y(null),r==null||r({id:x,removed:!0});else{const J=await hf(e);J!=null&&J.id&&(g(oe=>({...oe,repost:oe.repost+1})),y(J.id),r==null||r(J))}}catch(J){console.error("[ReactionControls] Failed to toggle repost:",J)}finally{C(!1)}}},xt=async()=>{if(n!=null&&n.id)if(je)try{await pf(e.id),se(!1),r==null||r({...e,helpRequest:!1,needsHelp:!1})}catch(J){console.error("[ReactionControls] Failed to cancel help request:",J)}else try{const{request:J,subRequests:oe}=await Al(e.id,e.type);Y==null||Y("quest-board",J),Y==null||Y("timeline-board",J),oe.forEach(xe=>{Y==null||Y("quest-board",xe),Y==null||Y("timeline-board",xe),r==null||r(xe)}),se(!0),r==null||r(J)}catch(J){console.error("[ReactionControls] Failed to request help:",J)}},vt=async()=>{if(!(!n||n.id!==e.authorId))try{S?(await gf(e.id),T(!1)):(await ra(e.id),T(!0))}catch(J){console.error("[ReactionControls] Failed to toggle request completion:",J)}},Ve=async()=>{if(!n)return;if(Q==="my-posts"&&e.type==="request"&&e.questId&&de){const xe=e.visibility==="private"||(D==null?void 0:D.visibility)==="private"?"request":"log";z(ye.POST(e.id)+`?reply=1&initialType=${xe}&intro=1`);return}try{I(!0),V?(await mf(e.id),R(!1)):(await yf(e.id),R(!0))}catch(oe){console.error("[ReactionControls] Failed to join request:",oe)}finally{I(!1)}},He=async()=>{if(n)try{if(A){const J=await xf(e.id);q(J.followers.length),O(!1)}else{const J=await vf(e.id);q(J.followers.length),O(!0)}}catch(J){console.error("[ReactionControls] Failed to toggle follow",J)}};return v.useEffect(()=>{le&&e.type==="quest"&&e.questId&&!D&&Pr(e.questId).then(F).catch(J=>console.error("[ReactionControls] Failed to fetch quest:",J))},[le,e.type,e.questId,D]),c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex gap-4 items-center text-sm text-gray-500 dark:text-gray-400 w-full",children:[c.jsxs("button",{className:ze("flex items-center gap-1",h.like&&"text-blue-600"),onClick:()=>Pe("like"),disabled:m||!n,children:[h.like?c.jsx(Ku,{}):c.jsx(Ju,{})," ",p.like||""]}),c.jsxs("button",{className:ze("flex items-center gap-1",h.heart&&"text-red-500"),onClick:()=>Pe("heart"),disabled:m||!n,children:[h.heart?c.jsx(Zu,{}):c.jsx(ef,{})," ",p.heart||""]}),!ne&&e.type==="free_speech"&&c.jsxs("button",{className:ze("flex items-center gap-1",x&&"text-indigo-600"),onClick:Lt,disabled:m||k||!n,children:[c.jsx(tf,{})," ",p.repost||""]}),!ne&&["quest","task","issue"].includes(e.type)&&c.jsxs("button",{className:ze("flex items-center gap-1",je&&"text-indigo-600"),onClick:xt,disabled:m||!n,children:[c.jsx(Nl,{})," ",je?"Cancel Help":"Request Help"]}),ue&&((n==null?void 0:n.id)===e.authorId?c.jsxs("button",{className:ze("flex items-center gap-1",S&&"text-green-600"),onClick:vt,disabled:!n,children:[S?c.jsx(nf,{}):c.jsx(rf,{})," Complete"]}):V?c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(hs,{})," Joined"]}):c.jsx("button",{className:"flex items-center gap-1",onClick:Ve,disabled:P||!n,children:P?"...":c.jsxs(c.Fragment,{children:[c.jsx(Sl,{})," ",e.questId&&de?"Join":"Accept"]})})),["task","request","quest"].includes(e.type)&&!ue&&!V&&c.jsxs("button",{className:"flex items-center gap-1",onClick:He,disabled:!n,children:[c.jsx(Pl,{})," ",A?"Following":"Follow"," ",M]}),V&&!ue&&c.jsxs("span",{className:"flex items-center gap-1",children:[c.jsx(hs,{})," Joined"]}),(e.type==="task"||e.type==="quest")&&!d&&c.jsxs("button",{className:"flex items-center gap-1",onClick:()=>j(J=>!J),children:[le?c.jsx(ci,{}):c.jsx(ui,{})," ",le?"Collapse View":"Expand View"]}),e.type!=="task"&&!ue&&c.jsxs("button",{className:ze("flex items-center gap-1",e.type!=="commit"&&w&&"text-green-600"),onClick:()=>{i?i.onClick():e.type==="commit"?z(ye.POST(e.id)):e.type==="request"||X||te?z(ye.POST(e.id)+"?reply=1"):N(J=>{const oe=!J;return o==null||o(oe),oe})},children:[c.jsx(sf,{})," ",i?i.label:e.type==="commit"?"File Change View":w?"Cancel":"Reply"]}),l&&c.jsx("span",{className:"ml-auto text-xs text-secondary",children:l})]}),w&&!i&&!o&&c.jsx("div",{className:"mt-3",children:c.jsx(kn,{replyTo:e,onSave:J=>{r==null||r(J),N(!1)},onCancel:()=>N(!1)})}),le&&e.type==="task"&&e.questId&&c.jsx("div",{className:"mt-3",children:c.jsx(pw,{task:e,questId:e.questId,user:n,onUpdate:r})}),le&&e.type==="quest"&&e.questId&&c.jsx("div",{className:"mt-3",children:D?c.jsx(na,{children:c.jsx(Tu,{quest:D,user:n,defaultExpanded:!0,hideToggle:!0})}):c.jsx("div",{className:"text-sm",children:"Loading..."})})]})},gw=({media:e})=>!e||e.length===0?null:c.jsx("div",{className:"space-y-2",children:e.map((n,r)=>n.type==="image"?c.jsx("img",{src:n.url,alt:n.title||"",className:"max-w-full rounded"},r):n.type==="video"?c.jsx("video",{src:n.url,controls:!0,className:"w-full rounded"},r):n.type==="embed"?c.jsx("iframe",{src:n.url,title:n.title||"embed",className:"w-full h-64 rounded"},r):c.jsx("a",{href:n.url,className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:n.title||n.url},r))}),mw=({items:e,post:n,showReplyChain:r,open:i,onToggle:s})=>{const[a,o]=v.useState(!1),l=i!==void 0,u=l?i:a,[d,h]=v.useState(e),[f,p]=v.useState([]),[g,m]=v.useState(""),[b,x]=v.useState("all");if(v.useEffect(()=>{(async()=>{const j=await Promise.all(e.map(async S=>{var T;try{if(!S.itemId)return S;if(S.itemType==="quest"){const P=await Pr(S.itemId);return{...S,title:P.title}}if(S.itemType==="post"){const P=await gs(S.itemId);return{...S,title:P.nodeId||((T=P.content)==null?void 0:T.slice(0,30))}}}catch{}return S}));h(j)})()},[e]),v.useEffect(()=>{(async()=>{if(!r||!(n!=null&&n.replyTo)){p([]);return}const j=new Set,S=[];let T=n.replyTo??void 0;for(;T&&!j.has(T);)try{const P=await gs(T);S.push(P),j.add(T),T=P.replyTo??void 0}catch{break}p(S)})()},[n,r]),d.length===0&&f.length===0)return null;const w=d.filter(_=>{const j=g.toLowerCase(),S=!j||_.title&&_.title.toLowerCase().includes(j)||_.linkType&&_.linkType.toLowerCase().includes(j)||_.itemType&&_.itemType.toLowerCase().includes(j),T=b==="all"||_.linkType===b;return S&&T}).reduce((_,j)=>{const S=j.linkType||"other";return _[S]=_[S]||[],_[S].push(j),_},{}),N=_=>_.type==="quest_log"?"log":_.type||"type",k=f.reduce((_,j)=>{var T;const S=zl(j);if(!_.some(P=>P.label===S)){const P=((T=j.author)==null?void 0:T.username)||j.authorId;_.push({post:j,label:S,username:P})}return _},[]),C=Array.from(new Set(d.map(_=>_.linkType||"other")));return c.jsxs("div",{className:"text-xs text-primary dark:text-primary",children:[c.jsxs("button",{onClick:()=>{l?s==null||s():o(_=>!_)},className:"flex items-center gap-1 text-blue-600 underline",children:[u?c.jsx(ci,{}):c.jsx(ui,{})," ",u?"Hide Links":"View Links"]}),u&&c.jsxs("div",{className:"mt-2 border rounded bg-background dark:bg-surface p-2 space-y-1",children:[c.jsxs("div",{className:"flex gap-2 mb-2",children:[c.jsx("input",{type:"text",value:g,onChange:_=>m(_.target.value),placeholder:"Search links...",className:"border px-1 py-0.5 text-xs rounded w-full"}),c.jsxs("select",{value:b,onChange:_=>x(_.target.value),className:"border px-1 py-0.5 text-xs rounded",children:[c.jsx("option",{value:"all",children:"All"}),C.map(_=>c.jsx("option",{value:_,children:_},_))]})]}),c.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-2",children:[Object.entries(w).map(([_,j])=>c.jsxs("div",{children:[c.jsx("div",{className:"font-semibold capitalize mb-1",children:_}),c.jsx("ul",{className:"pl-4 list-disc space-y-1",children:j.map(S=>c.jsxs("li",{children:[S.title||S.itemId,S.nodeId&&`:${S.nodeId}`]},S.itemId))})]},_)),k.length>0&&c.jsxs("div",{children:[c.jsx("div",{className:"font-semibold capitalize mb-1",children:"reply chain"}),c.jsx("div",{className:"flex flex-wrap gap-1",children:k.map(({post:_,label:j,username:S})=>c.jsx(Sn,{type:N(_),label:j,detailLink:ye.POST(_.id),username:S,usernameLink:ye.PUBLIC_PROFILE(_.authorId)},_.id))})]})]})]})]})},yw=({questId:e,onClose:n})=>{const{data:r,isLoading:i}=ed(e),[s,a]=v.useState(""),[o,l]=v.useState(null),[u,d]=v.useState(""),[h,f]=v.useState("Commit change"),[p,g]=v.useState(""),[m,b]=v.useState(!1),[x,y]=v.useState(!1),[w,N]=v.useState(""),C=(r||[]).filter(T=>T.path.startsWith(s)).filter(T=>T.path.slice(s.length).split("/").filter(Boolean).length===1).sort((T,P)=>T.path.localeCompare(P.path)),_=T=>{T.type==="folder"?a(T.path.endsWith("/")?T.path:T.path+"/"):(l(T),d(""),f("Commit change"))},j=async()=>{if(o){b(!0);try{(r==null?void 0:r.some(L=>L.path===o.path))?await Nf(e,o.path,u):await Tf(e,o.path,u);const P=await Fl(e,o.path),I=h||`Update ${o.path}`;await Mi({type:"commit",questId:e,content:p?`${I} (Issue #${p})`:I,commitSummary:p?`${I} (Issue #${p})`:I,gitDiff:P.diffMarkdown,linkedNodeId:o.path,...p?{issueId:p}:{},visibility:"public",tags:[],collaborators:[],linkedItems:[]}),l(null)}catch(T){console.error("[GitFileBrowserInline] save error",T)}finally{b(!1)}}},S=async()=>{if(w)try{await ms(e,s+w),N(""),y(!1)}catch(T){console.error("[GitFileBrowserInline] create folder error",T)}};return c.jsx("div",{className:"border border-secondary rounded p-2 space-y-2",children:o?c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"font-semibold",children:o.path}),c.jsx(Nt,{value:p,onChange:T=>g(T.target.value),placeholder:"Issue ID"}),c.jsx(Nt,{value:h,onChange:T=>f(T.target.value),placeholder:"Commit message"}),c.jsx(oa,{rows:10,value:u,onChange:T=>d(T.target.value)}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx($e,{onClick:j,disabled:m,children:m?"Saving...":"Commit Change"}),c.jsx($e,{variant:"ghost",onClick:()=>l(null),children:"Cancel"})]})]}):c.jsxs("div",{children:[c.jsxs("div",{className:"mb-2 flex justify-between items-center",children:[c.jsx("div",{className:"font-semibold",children:s||"root"}),c.jsxs("div",{className:"space-x-2",children:[s&&c.jsx("button",{className:"text-accent underline text-xs",onClick:()=>a(s.replace(/[^/]+\/?$/,"")),children:"Back"}),n&&c.jsx("button",{className:"text-accent underline text-xs",onClick:n,children:"Close"})]})]}),x&&c.jsxs("div",{className:"flex gap-2 mb-2",children:[c.jsx(Nt,{value:w,onChange:T=>N(T.target.value),placeholder:"Folder name"}),c.jsx($e,{size:"sm",onClick:S,children:"Create"}),c.jsx($e,{size:"sm",variant:"ghost",onClick:()=>y(!1),children:"Cancel"})]}),i?c.jsx("div",{children:"Loading..."}):c.jsxs(c.Fragment,{children:[c.jsx("ul",{className:"space-y-1",children:C.map(T=>c.jsx("li",{children:c.jsxs("button",{className:"text-accent underline text-sm",onClick:()=>_(T),children:[T.type==="folder"?"📁":"📄"," ",T.name]})},T.path))}),c.jsx("div",{className:"mt-2 text-right",children:c.jsx("button",{className:"text-xs underline",onClick:()=>y(!0),children:"+ New Folder"})})]})]})})},xw=240,vw=64,bw=({post:e,user:n,depth:r=0,onUpdate:i,onDelete:s})=>{const[a,o]=v.useState(!1),d=(e.renderedContent||e.content).length>xw,h=Math.min(r*16,vw);return c.jsxs("div",{className:"border-l border-accent pl-4",style:{marginLeft:h,maxWidth:`calc(100% - ${h}px)`},children:[c.jsx(Un,{post:e,user:n,compact:!a,onUpdate:i,onDelete:s,depth:r,className:"mx-0"}),d&&c.jsx("button",{className:"text-accent underline text-xs mt-1",onClick:()=>o(f=>!f),children:a?"Show less":"…See more"})]})},ds=240,Qr=e=>{const n=e.trim();return n.length<=50?n:n.slice(0,50)+"…"},_l=e=>c.jsx("span",{"aria-label":`Rating: ${e}`,className:"text-yellow-500 flex",children:[1,2,3,4,5].map(n=>{const r=e>=n,i=!r&&e>=n-.5;return c.jsx("span",{className:"mr-0.5",children:r?c.jsx(ea,{}):i?c.jsx(El,{}):c.jsx(Ml,{})},n)})}),Un=({post:e,user:n,onUpdate:r,onDelete:i,compact:s=!1,questId:a,questTitle:o,showStatusControl:l=!0,replyOverride:u,headerOnly:d=!1,depth:h=0,className:f="",initialShowReplies:p=!1,showDetails:g=!1,boardId:m,expanded:b,onToggleExpand:x})=>{var at,Ge;const[y,w]=v.useState(!1),[N,k]=v.useState([]),[C,_]=v.useState(p),[j,S]=v.useState(!1),[T,P]=v.useState(!1),[I,L]=v.useState(""),[V,R]=v.useState(!1),[A,O]=v.useState(!1),[M,q]=v.useState(e.linkedItems||[]),[D,F]=v.useState(0),[z,H]=v.useState(""),[Y,B]=v.useState("sub_problem"),[Q,W]=v.useState(""),[X,Z]=v.useState([]),[te,ne]=v.useState(null),[ue,de]=v.useState(!1),[je,se]=v.useState(!1),[le,Pe]=v.useState(!1),[Lt,xt]=v.useState(!1),[vt,Ve]=v.useState(null),[He,Je]=v.useState(!1),[ut,Mt]=v.useState(!1),[Zt,Le]=v.useState(e.type==="task"),{loadGraph:J}=ia(),oe=Er(),{selectedBoard:xe,updateBoardItem:Be,appendToBoard:Ae}=Tn()||{},Ze=$=>{$.type==="task"&&document.dispatchEvent(new CustomEvent("taskUpdated",{detail:{task:$},bubbles:!0}))},Re=m||xe,bt=e.type==="request"&&Re==="quest-board",en=Re==="timeline-board"||Re==="my-posts"?"max-w-3xl":bt?"w-72":"max-w-prose",wt=b!==void 0?b:Zt,Qn=async $=>{const re=$.target.value,Ee={...e,status:re};Re&&Be(Re,Ee),r==null||r(Ee),Ze(Ee);try{const he=await Tt(e.id,{status:re});Re&&Be(Re,he),r==null||r(he),Ze(he)}catch(he){console.error("[PostCard] Failed to update status:",he)}},zt=(n==null?void 0:n.id)===e.authorId||((at=e.collaborators)==null?void 0:at.some($=>$.userId===(n==null?void 0:n.id))),pn=e.timestamp||e.createdAt,ft=pn?Bl(new Date(pn),{addSuffix:!0}):"Unknown time",tn=e.renderedContent||e.content,Se=e.title||Qr(e.content);let Ie=sa(e,o,a);const K=tn.length>ds,ae=!vt||e.id!==vt;v.useEffect(()=>{e.replyTo||Yr(e.id).then($=>F($.length)).catch(()=>{})},[e.id,e.replyTo]),v.useEffect(()=>{p&&!j&&(_(!0),P(!0),L(""),Yr(e.id).then($=>{k($||[]),S(!0)}).catch($=>{console.error("[PostCard] Load replies failed:",$),L("Could not load replies.")}).finally(()=>P(!1)))},[p,e.id,j]),v.useEffect(()=>{const $=a||e.questId;A&&$&&Mr($).then(Z).catch(re=>console.error("[PostCard] Failed to fetch quest posts:",re))},[A,a,e.questId]),v.useEffect(()=>{const $=a||e.questId;$&&Pr($).then(re=>Ve(re.headPostId)).catch(()=>{})},[a,e.questId]);const ie=async()=>{if(!j){P(!0),L("");try{const $=await Yr(e.id);k($||[]),S(!0)}catch($){console.error("[PostCard] Load replies failed:",$),L("Could not load replies.")}finally{P(!1)}}_($=>!$)},fe=async($,re)=>{const Ee=/- \[[ xX]\]/g;let he=-1;const ot=e.content.replace(Ee,En=>(he+=1,he===$?`- [${re?"x":" "}]`:En)),Rn={...e,content:ot};r==null||r(Rn),Ze(Rn);try{const En=await Tt(e.id,{content:ot});r==null||r(En),Ze(En)}catch(En){console.error("[PostCard] Failed to toggle task:",En)}},we=()=>{const $=e.repostedFrom;return $!=null&&$.originalContent?c.jsxs("blockquote",{className:"border-l-4 pl-4 text-secondary italic bg-background rounded",children:["“",$.originalContent.length>180?$.originalContent.slice(0,180)+"…":$.originalContent,"”",c.jsxs("div",{className:"text-xs mt-1 text-secondary",children:["— @",$.username||"unknown"]})]}):null},et=()=>e.type==="request"||!g&&(!e.linkedItems||e.linkedItems.length===0)?null:c.jsx(mw,{items:e.linkedItems||[],post:e,showReplyChain:g,open:ut,onToggle:()=>Mt($=>!$)}),_e=()=>{if(!e.gitDiff)return null;const $=e.gitDiff.split(`
`);let re=$;if(!V){re=[];let Ee=[],he=!1;$.forEach(ot=>{ot.startsWith("+")||ot.startsWith("-")?(he||(Ee.length&&re.push("..."),he=!0),re.push(ot)):he?Ee=[]:Ee.push(ot)})}return c.jsxs("div",{className:"text-sm bg-background rounded p-2 font-mono border border-secondary",children:[e.commitSummary&&c.jsx("div",{className:"mb-1 text-primary italic",children:e.commitSummary}),!V&&c.jsx("div",{className:"mb-2",children:c.jsx("button",{onClick:()=>R(!0),className:"text-accent text-xs underline",children:"View full diff"})}),c.jsx("pre",{className:"overflow-x-auto whitespace-pre-wrap",children:re.map((Ee,he)=>c.jsx("div",{className:Ee.startsWith("+")?"text-success":Ee.startsWith("-")?"text-error":"text-primary",children:Ee},he))}),!V&&c.jsx("div",{className:"mt-1",children:c.jsx("button",{onClick:()=>oe(ye.POST(e.id)),className:"text-accent text-xs underline",children:"View full file with replies"})})]})};return y?c.jsx(bu,{post:e,onCancel:()=>w(!1),onUpdated:$=>{r==null||r($),w(!1)}}):d?c.jsxs("div",{id:e.id,className:ze("relative border border-secondary rounded bg-surface shadow-sm p-4 space-y-3 text-primary",en,h===0?"mx-auto":"",e.highlight&&"border-accent bg-infoBackground",f),children:[c.jsxs("div",{className:"flex justify-between text-sm text-secondary",children:[c.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Ie.map(($,re)=>c.jsx(Xe.Fragment,{children:c.jsx(Sn,{...$,className:$.type==="quest"?"truncate max-w-[8rem]":void 0})},re)),e.type==="review"&&e.rating&&_l(e.rating)]}),c.jsxs("div",{className:"flex items-center gap-2",children:[["task","quest"].includes(e.type)&&c.jsxs("button",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",onClick:()=>x?x():Le($=>!$),children:[wt?c.jsx(ci,{}):c.jsx(ui,{})," ",wt?"Collapse View":"Expand View"]}),c.jsx(ys,{id:e.id,type:"post",canEdit:zt,onEdit:()=>w(!0),onEditLinks:()=>O(!0),onDelete:()=>i==null?void 0:i(e.id),allowDelete:ae,content:e.content,permalink:`${window.location.origin}${ye.POST(e.id)}`})]})]}),bt&&ft&&c.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:ft}),Se&&c.jsx("h3",{className:"font-semibold text-lg mt-1 cursor-pointer truncate",onClick:()=>oe(ye.POST(e.id)),children:Se}),c.jsx(wl,{post:e,user:n,onUpdate:r,timestamp:bt?void 0:ft,replyOverride:u,boardId:Re||void 0,expanded:wt,onToggleExpand:()=>x?x():Le($=>!$)})]}):c.jsxs("div",{id:e.id,className:ze("relative border border-secondary rounded bg-surface shadow-sm p-4 space-y-3 text-primary",en,h===0?"mx-auto":"",e.highlight&&"border-accent bg-infoBackground",f),children:[c.jsxs("div",{className:"flex justify-between text-sm text-secondary",children:[c.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[Ie.map(($,re)=>c.jsx(Xe.Fragment,{children:c.jsx(Sn,{...$,className:$.type==="quest"?"truncate max-w-[8rem]":void 0})},re)),e.type==="review"&&e.rating&&_l(e.rating),!bt&&zt&&["task","request","issue"].includes(e.type)&&l&&c.jsx("div",{className:"ml-1 w-28",children:c.jsx(Ue,{value:e.status||"To Do",onChange:Qn,options:Kt.map(({value:$,label:re})=>({value:$,label:re}))})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[["task","quest"].includes(e.type)&&c.jsxs("button",{className:"flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400",onClick:()=>x?x():Le($=>!$),children:[wt?c.jsx(ci,{}):c.jsx(ui,{})," ",wt?"Collapse View":"Expand View"]}),c.jsx(ys,{id:e.id,type:"post",canEdit:zt,onEdit:()=>w(!0),onEditLinks:()=>O(!0),onDelete:()=>i==null?void 0:i(e.id),allowDelete:ae,content:e.content,permalink:`${window.location.origin}${ye.POST(e.id)}`})]})]}),bt&&ft&&c.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:ft}),e.linkedNodeId&&((Ge=e.author)==null?void 0:Ge.username)&&!bt&&c.jsxs("div",{className:"text-xs text-secondary italic",children:["@",e.author.username," committed changes to ",c.jsx("strong",{children:e.linkedNodeId})," ",ft]}),we(),Se&&c.jsx("h3",{className:"font-semibold text-lg mt-1 truncate",children:Se}),c.jsxs("div",{className:"text-sm text-primary",children:[e.type==="task"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"font-semibold cursor-pointer",onClick:()=>{a?window.dispatchEvent(new CustomEvent("questTaskOpen",{detail:{taskId:e.id}})):oe(ye.POST(e.id))},children:e.content}),e.details&&(K?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:s?"clamp-3":"",children:c.jsx(yn,{content:e.details.slice(0,ds)+"…",onToggleTask:fe})}),c.jsx("button",{onClick:()=>oe(ye.POST(e.id)),className:"text-accent underline text-xs ml-1",children:"See more"})]}):c.jsx("div",{className:s?"clamp-3":"",children:c.jsx(yn,{content:e.details,onToggleTask:fe})}))]}):K?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:s?"clamp-3":"",children:c.jsx(yn,{content:tn.slice(0,ds)+"…",onToggleTask:fe})}),c.jsx("button",{onClick:()=>oe(ye.POST(e.id)),className:"text-accent underline text-xs ml-1",children:"See more"})]}):c.jsx("div",{className:s?"clamp-3":"",children:c.jsx(yn,{content:tn,onToggleTask:fe})}),c.jsx(gw,{media:e.mediaPreviews}),e.tags&&e.tags.length>0&&c.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.from(new Set(e.tags)).map($=>c.jsxs("span",{className:aa,children:["#",$]},$))})]}),_e(),c.jsx(wl,{post:e,user:n,onUpdate:r,replyOverride:u,boardId:Re||void 0,timestamp:bt?void 0:ft,expanded:wt,onToggleExpand:()=>x?x():Le($=>!$),onReplyToggle:e.linkedItems&&e.linkedItems.length>0?Je:void 0}),et(),He&&c.jsx("div",{className:"mt-2",children:c.jsx(kn,{replyTo:e,onSave:$=>{r==null||r($),Je(!1)},onCancel:()=>Je(!1)})}),["request","quest","task","log","commit","issue","meta_system"].includes(e.type)&&c.jsxs("div",{className:"text-xs text-secondary space-y-1",children:[A&&c.jsxs("div",{className:"mt-2",children:[c.jsx(Ai,{value:M,onChange:q,allowCreateNew:!1,itemTypes:["quest","post"]}),M.some($=>$.linkType==="task_edge")&&(a||e.questId)&&c.jsxs("div",{className:"mt-2 space-y-1",children:[c.jsx("label",{className:"text-xs text-secondary",children:"Parent Post"}),c.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs w-full",value:z,onChange:$=>H($.target.value),children:[c.jsx("option",{value:"",children:"-- select parent --"}),X.map($=>c.jsx("option",{value:$.id,children:$.content.slice(0,30)},$.id))]}),c.jsx("label",{className:"text-xs text-secondary",children:"Edge Type"}),c.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs w-full",value:Y,onChange:$=>B($.target.value),children:[c.jsx("option",{value:"sub_problem",children:"sub_problem"}),c.jsx("option",{value:"solution_branch",children:"solution_branch"}),c.jsx("option",{value:"folder_split",children:"folder_split"}),c.jsx("option",{value:"abstract",children:"abstract"})]}),c.jsx("label",{className:"text-xs text-secondary",children:"Edge Label"}),c.jsx("input",{type:"text",className:"border rounded px-1 py-0.5 text-xs w-full",value:Q,onChange:$=>W($.target.value)})]}),c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsx("button",{className:"text-xs bg-indigo-600 text-white px-2 py-1 rounded",onClick:async()=>{try{const $=await Tt(e.id,{linkedItems:M});M.some(re=>re.linkType==="task_edge")&&(a||e.questId)&&(await dr(a||e.questId,{postId:e.id,parentId:z||void 0,edgeType:Y,edgeLabel:Q||void 0,title:e.questNodeTitle||Qr(e.content)}),J(a||e.questId)),O(!1),r==null||r($),Ze($)}catch($){console.error("[PostCard] Failed to update links:",$)}},children:"Save"}),c.jsx("button",{className:"text-xs underline",onClick:()=>{q(e.linkedItems||[]),O(!1)},children:"Cancel"})]})]}),e.questId&&e.nodeId&&c.jsxs("div",{children:["🧭 Linked to Quest: ",e.nodeId]})]}),e.type==="task"&&e.linkedNodeId&&e.questId&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{onClick:()=>xt(!0),className:"text-accent underline text-xs mt-1",children:["View ",e.taskType==="file"?"File":e.taskType==="folder"?"Folder":"Planner"]}),Lt&&c.jsx("div",{className:"mt-2",children:c.jsx(yw,{questId:e.questId,onClose:()=>xt(!1)})})]}),e.type==="task"&&c.jsxs("div",{className:"relative mt-1",children:[c.jsx("button",{className:"text-accent underline text-xs",onClick:()=>de($=>!$),children:"+ Add Item"}),ue&&c.jsxs("div",{className:"absolute z-10 mt-1 bg-surface border border-secondary rounded shadow text-xs",children:[c.jsx("button",{onClick:()=>{ne("log"),de(!1)},className:"block w-full text-left px-2 py-1 hover:bg-background",children:"Log"}),c.jsx("button",{onClick:()=>{ne("issue"),de(!1)},className:"block w-full text-left px-2 py-1 hover:bg-background",children:"Issue"}),c.jsx("button",{onClick:()=>{se(!0),de(!1)},className:"block w-full text-left px-2 py-1 hover:bg-background",children:"Subtask"})]})]}),te&&c.jsxs("div",{className:"mt-2 space-y-1",children:[c.jsxs("label",{className:"text-xs flex items-center gap-1",children:[c.jsx("input",{type:"checkbox",checked:le,onChange:$=>Pe($.target.checked)}),"Create commit entry"]}),c.jsx(kn,{initialType:le?"commit":te,questId:e.questId||void 0,boardId:e.questId?`log-${e.questId}`:void 0,initialGitFilePath:le?e.gitFilePath:void 0,initialLinkedNodeId:le?e.nodeId:void 0,onSave:async $=>{if(e.questId)try{const re=$;await dr(e.questId,{postId:re.id,parentId:e.id,title:re.questNodeTitle||Qr(re.content)}),Ae==null||Ae(`log-${e.questId}`,re),J(e.questId)}catch(re){console.error("[PostCard] Failed to link new post:",re)}ne(null),Pe(!1)},onCancel:()=>{ne(null),Pe(!1)}})]}),je&&c.jsx("div",{className:"mt-2",children:c.jsx(kn,{initialType:"task",questId:e.questId||void 0,boardId:e.questId?`map-${e.questId}`:void 0,replyTo:e,onSave:async $=>{if(e.questId)try{const re=$;await dr(e.questId,{postId:re.id,parentId:e.id,title:re.questNodeTitle||Qr(re.content)}),Ae==null||Ae(`map-${e.questId}`,re),J(e.questId)}catch(re){console.error("[PostCard] Failed to link new subtask:",re)}se(!1)},onCancel:()=>se(!1)})}),(D>0||N.length>0)&&c.jsx("button",{onClick:ie,className:"text-accent underline text-xs",children:C?"Hide Replies":`💬 See Replies (${D||N.length})`}),!K&&!s&&c.jsx("div",{children:c.jsx("button",{onClick:()=>oe(ye.POST(e.id)),className:"text-accent underline text-xs",children:"See more"})}),N.length>0&&C&&c.jsxs("div",{className:"mt-2 space-y-2",children:[T&&c.jsx("div",{className:"flex justify-center",children:c.jsx(St,{})}),I&&c.jsx("p",{className:"text-xs text-error",children:I}),N.map($=>c.jsx(bw,{post:$,user:n,onUpdate:r,onDelete:i,depth:h+1},$.id))]})]})},An=({contribution:e,user:n,compact:r=!1,onEdit:i,onDelete:s,questId:a,showStatusControl:o=!0,headerOnly:l=!1,initialShowReplies:u=!1,boardId:d,expanded:h,onToggleExpand:f})=>{if(!e)return null;const{id:p}=e;if(!p)return console.warn("[ContributionCard] Missing `id` on contribution:",e),null;const g={user:n,compact:r,onEdit:i,onDelete:s,showStatusControl:o,headerOnly:l,initialShowReplies:u,boardId:d,expanded:h,onToggleExpand:f};if("type"in e){const m=e;return c.jsx(Un,{post:m,questId:a,...g,headerOnly:l||m.type==="request",boardId:d})}if("headPostId"in e){const m=e;if(d==="timeline-board"||d==="my-posts"){const b=m.headPost,y=(b?{...b,author:b.author||(m.author?{id:m.author.id,username:m.author.username}:void 0)}:void 0)??{id:m.headPostId,type:"quest",authorId:m.authorId,author:m.author?{id:m.author.id,username:m.author.username}:void 0,content:m.title,visibility:"public",timestamp:m.createdAt||"",tags:[],collaborators:[],linkedItems:[],questId:m.id};return c.jsx(Un,{post:y,questId:m.id,questTitle:m.title,...g})}return c.jsx(na,{children:c.jsx(Tu,{quest:m,user:n,compact:r,expanded:h,onToggleExpand:f,onEdit:i?()=>i(m.id):void 0,onDelete:s?b=>s(b.id):void 0})})}return console.warn("[ContributionCard] Unknown contribution type:",e),c.jsx("div",{className:"p-4 border border-secondary rounded text-sm text-secondary bg-background",children:"Unknown contribution type"})},kl=["To Do","In Progress","Blocked","Done"],ww=({item:e,user:n,compact:r,onEdit:i,onDelete:s,initialExpanded:a,expandedId:o,onExpand:l,boardId:u})=>{const{attributes:d,listeners:h,setNodeRef:f,transform:p,isDragging:g}=ai({id:e.id,data:{item:e}}),m=p?{transform:Ni.Translate.toString(p)}:void 0;return c.jsx("div",{ref:f,style:m,className:g?"dragging":"",...d,...h,children:c.jsx(An,{contribution:e,user:n,compact:r,onEdit:i,onDelete:s,initialShowReplies:a,boardId:u,expanded:o===e.id,onToggleExpand:()=>l==null?void 0:l(o===e.id?null:e.id)})})},_w=({id:e,children:n})=>{const{setNodeRef:r,isOver:i}=vu({id:e});return c.jsx("div",{ref:r,className:`flex flex-col gap-4 ${i?"droppable-over":""}`,children:n})},kw=({items:e,user:n,layout:r="vertical",compact:i=!1,editable:s=!1,onEdit:a,onDelete:o,loadingMore:l=!1,initialExpanded:u=!1,boardId:d,expandedId:h,onExpand:f})=>{const p=v.useRef(null),g=v.useRef(0),[m,b]=v.useState(0),[x,y]=v.useState(0),w=eb(Zv(Oa,{activationConstraint:{distance:5}})),N=v.useCallback(F=>{const z=p.current;if(!z)return;const H=z.firstElementChild,Y=(H==null?void 0:H.offsetWidth)||0;z.scrollTo({left:F*Y,behavior:"smooth"})},[]),k=v.useCallback(()=>{b(F=>{const z=Math.max(0,F-1);return N(z),g.current=z,z})},[]),C=v.useCallback(()=>{b(F=>{const z=Math.min(e.length-1,F+1);return N(z),g.current=z,z})},[e.length]),{selectedBoard:_,updateBoardItem:j,removeItemFromBoard:S}=Tn();v.useEffect(()=>{g.current=m},[m]),v.useEffect(()=>{r==="horizontal"&&e.length>0&&N(g.current)},[r,e.length,N]),v.useEffect(()=>{r!=="paged"&&y(0)},[r,e.length]),v.useEffect(()=>{b(F=>Math.min(F,e.length-1))},[e.length]),v.useEffect(()=>{const F=z=>{const{detail:H}=z,Y=H==null?void 0:H.taskId;if(!Y)return;const B=document.getElementById(Y);B&&(B.scrollIntoView({behavior:"smooth",block:"center"}),B.classList.add("ring-2","ring-accent"),setTimeout(()=>B.classList.remove("ring-2","ring-accent"),2e3))};return window.addEventListener("questTaskSelect",F),()=>window.removeEventListener("questTaskSelect",F)},[]),v.useEffect(()=>{if(r!=="horizontal")return;const F=p.current;if(!F)return;const z=()=>{const{scrollLeft:H,clientWidth:Y}=F;let B=0,Q=1/0;Array.from(F.children).forEach((W,X)=>{const Z=W,te=Z.offsetLeft+Z.clientWidth/2,ne=Math.abs(te-H-Y/2);ne<Q&&(Q=ne,B=X)}),B!==g.current&&(g.current=B,b(B))};return F.addEventListener("scroll",z,{passive:!0}),()=>F.removeEventListener("scroll",z)},[r,e.length]);const T=v.useRef(null),P=v.useMemo(()=>{if(e.length<=6)return[e];const H=Math.ceil((e.length-6)/2)+1;return Array.from({length:H},(Y,B)=>e.slice(B*2,B*2+6))},[e]),I=P.length;v.useEffect(()=>{x>=I&&y(0)},[I,x]);const L=v.useCallback(()=>{const F=T.current;if(!F)return;const z=Math.round(F.scrollLeft/F.clientWidth);z!==x&&y(z)},[x]),V=v.useCallback(()=>{const F=T.current;if(!F)return;const z=(x-1+I)%I;y(z),F.scrollTo({left:z*F.clientWidth,behavior:"smooth"})},[x,I]),R=v.useCallback(()=>{const F=T.current;if(!F)return;const z=(x+1)%I;y(z),F.scrollTo({left:z*F.clientWidth,behavior:"smooth"})},[x,I]),A=v.useMemo(()=>{const F=Math.min(I,5),z=Math.min(Math.max(0,x-Math.floor(F/2)),Math.max(0,I-F));return Array.from({length:F},(H,Y)=>z+Y)},[x,I]);if(!e||e.length===0)return c.jsx("div",{className:"text-center text-secondary py-12 text-sm",children:"No contributions found."});const O=kl.reduce((F,z)=>(F[z]=e.filter(H=>"status"in H&&H.status===z),F),{}),M=async F=>{var W;const{active:z,over:H}=F;if(!H)return;const Y=H.id,B=(W=z.data.current)==null?void 0:W.item;if(!B||B.status===Y)return;const Q={...B,status:Y};_&&j(_,Q);try{const X=await Tt(B.id,{status:Y});_&&j(_,X),Y==="Done"&&(await ra(B.id),_&&S(_,B.id))}catch(X){console.error("[GridLayout] Failed to update post status:",X)}};if(r==="kanban")return c.jsx(xu,{onDragEnd:M,sensors:w,collisionDetection:sb,children:c.jsxs("div",{className:"flex overflow-auto space-x-4 pb-4 px-2",children:[kl.map(F=>c.jsxs("div",{className:"min-w-[280px] w-[320px] flex-shrink-0 bg-surface border border-secondary rounded-lg p-4 shadow-sm",children:[c.jsxs("h3",{className:"text-sm font-bold text-secondary mb-2",children:[F," (",O[F].length,")"]}),c.jsx(_w,{id:F,children:O[F].map(z=>c.jsx(na,{children:c.jsx(ww,{item:z,user:n,compact:!0,onEdit:a,onDelete:o,boardId:d})},z.id))})]},F)),s&&c.jsx("div",{className:"min-w-[280px] w-[320px] flex items-center justify-center text-accent hover:text-accent font-medium border border-secondary rounded-lg shadow-sm bg-surface cursor-pointer",children:"+ Add Column"})]})});if(r==="horizontal")return c.jsxs("div",{className:"relative",children:[c.jsx("div",{ref:p,className:"flex overflow-x-auto gap-4 snap-x snap-mandatory px-2 pb-4 scroll-smooth",children:e.map((F,z)=>c.jsx("div",{className:"snap-center flex-shrink-0 w-64 sm:w-[300px] transition-transform duration-300 "+(z===m?"scale-100":Math.abs(z-m)===1?"scale-95 opacity-80":"scale-90 opacity-50"),children:c.jsx(An,{contribution:F,user:n,compact:i||z!==m,onEdit:a,onDelete:o,initialShowReplies:u,boardId:d,expanded:h===F.id,onToggleExpand:()=>f==null?void 0:f(h===F.id?null:F.id)})},F.id))}),e.length>1&&c.jsxs(c.Fragment,{children:[c.jsx("button",{type:"button",onClick:k,className:"absolute left-0 top-1/2 -translate-y-1/2 bg-surface hover:bg-background rounded-full shadow p-1 transition-colors",children:"◀"}),c.jsx("button",{type:"button",onClick:C,className:"absolute right-0 top-1/2 -translate-y-1/2 bg-surface hover:bg-background rounded-full shadow p-1 transition-colors",children:"▶"}),c.jsx("div",{className:"flex justify-center mt-2",children:(()=>{const F=e.length>3?[m-1,m,m+1]:e.map((z,H)=>H);return F.map((z,H)=>{const Y=(z%e.length+e.length)%e.length,B=Y===m,Q=H===0||H===F.length-1;return c.jsx("button",{type:"button",onClick:()=>b(Y),className:"mx-1 w-2 h-2 rounded-full transition-all "+(B?"bg-accent opacity-100":"bg-secondary/40 opacity-70")+(Q&&!B?" scale-75":"")},H)})})()})]}),l&&c.jsx(St,{})]});if(r==="paged")return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{ref:T,onScroll:L,className:"flex overflow-x-auto snap-x snap-mandatory scroll-smooth",children:P.map((F,z)=>c.jsx("div",{className:"grid grid-cols-3 gap-6 px-2 flex-shrink-0 w-full snap-center",children:F.map(H=>c.jsx(An,{contribution:H,user:n,compact:i,onEdit:a,onDelete:o,initialShowReplies:u,boardId:d,expanded:h===H.id,onToggleExpand:()=>f==null?void 0:f(h===H.id?null:H.id)},H.id))},z))}),I>1&&c.jsxs(c.Fragment,{children:[c.jsx("button",{type:"button",onClick:V,className:"absolute left-0 top-1/2 -translate-y-1/2 bg-surface hover:bg-background rounded-full shadow p-1",children:"◀"}),c.jsx("button",{type:"button",onClick:R,className:"absolute right-0 top-1/2 -translate-y-1/2 bg-surface hover:bg-background rounded-full shadow p-1",children:"▶"})]})]}),I>1&&c.jsx("div",{className:"flex justify-center mt-2 gap-2",children:A.map(F=>c.jsx("button",{type:"button",onClick:()=>{const z=T.current;z&&(y(F),z.scrollTo({left:F*z.clientWidth,behavior:"smooth"}))},className:`w-3 h-1 rounded-sm transition-colors ${x===F?"bg-accent":"bg-background"}`},F))})]});const q=e.length===1,D=e.length===2;if(r==="vertical"&&e.length>6){const F=()=>{var H;return(H=p.current)==null?void 0:H.scrollBy({top:-200,behavior:"smooth"})},z=()=>{var H;return(H=p.current)==null?void 0:H.scrollBy({top:200,behavior:"smooth"})};return c.jsxs("div",{className:"relative",children:[c.jsxs("div",{ref:p,className:"max-h-96 overflow-y-auto space-y-4 px-2 pb-4 scroll-smooth",children:[e.map(H=>c.jsx(An,{contribution:H,user:n,compact:i,onEdit:a,onDelete:o,initialShowReplies:u,boardId:d,expanded:h===H.id,onToggleExpand:()=>f==null?void 0:f(h===H.id?null:H.id)},H.id)),l&&c.jsx(St,{})]}),c.jsx("button",{type:"button",onClick:F,className:"absolute left-1/2 -translate-x-1/2 -top-2 bg-surface hover:bg-background rounded-full shadow p-1 transition-colors",children:"▲"}),c.jsx("button",{type:"button",onClick:z,className:"absolute left-1/2 -translate-x-1/2 bottom-0 bg-surface hover:bg-background rounded-full shadow p-1 transition-colors",children:"▼"})]})}return c.jsxs("div",{ref:p,className:q?"flex justify-center items-start p-2":D?"grid grid-cols-1 sm:grid-cols-2 gap-6 px-2":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-2",children:[e.map(F=>c.jsx("div",{className:q?"max-w-prose w-full":"",children:c.jsx(An,{contribution:F,user:n,compact:i,onEdit:a,onDelete:o,initialShowReplies:u,boardId:d,expanded:h===F.id,onToggleExpand:()=>f==null?void 0:f(h===F.id?null:F.id)})},F.id)),l&&c.jsx(St,{})]})};export{Iw as B,td as C,gt as F,ju as G,De as L,tu as M,Un as P,Tu as Q,Ow as R,Pw as S,oa as T,Aw as V,kn as a,Jr as b,An as c,aa as d,kw as e,Af as g};
