import{j as e,x as E,h as I,c as T,u as k,r as n,I as y,y as C,R as U}from"./index-CxzMjhE-.js";import{a as B}from"./useSocket-B9IG26Ws.js";import{u as q}from"./useTimeline-Bxu8jN54.js";import{B as A}from"./Button-BBg8DJkg.js";import"./post-BFgSlzkn.js";const j=({type:r,message:l,children:s,className:m=""})=>{const p="rounded px-4 py-3 text-sm font-medium shadow-sm border-l-4",t={success:"bg-success text-success border-success",error:"bg-error text-error border-error",warning:"bg-warning text-warning border-warning",info:"bg-accent/10 text-accent border-accent"};return e.jsx("div",{className:E(p,t[r],m),children:s||l})},V=()=>{const{token:r}=I(),l=T(),{socket:s}=B(),{setUser:m}=k(),{addTimelineEvent:p}=q(),[t,N]=n.useState({password:"",confirm:""}),[h,c]=n.useState(""),[v,P]=n.useState(!1),[f,d]=n.useState(!1);n.useEffect(()=>{r&&(s==null||s.emit("auth:reset-page-visited",{token:r}))},[s,r]);const b=w=>{const{name:i,value:u}=w.target;N(a=>({...a,[i]:u}))},R=async w=>{var i,u;if(w.preventDefault(),c(""),d(!0),t.password!==t.confirm){d(!1),c("Passwords do not match.");return}if(!r){d(!1),c("Invalid or missing reset token.");return}try{const a=["user","admin","moderator"],o=await C(r,t.password);if(o!=null&&o.user&&o.user.id){const x=o.user,S=a.includes(x.role)?x.role:void 0,g={...x,role:S};m(g),s==null||s.emit("auth:password-reset-success",{userId:g.id}),p({userId:g.id,type:"account",content:"🔐 Password reset successful"}),P(!0),setTimeout(()=>l(U.LOGIN),2e3)}else throw new Error("Unexpected response format")}catch(a){console.error("[ResetPassword] Reset failed:",a),c(((u=(i=a.response)==null?void 0:i.data)==null?void 0:u.error)||"Failed to reset password.")}finally{d(!1)}};return e.jsx("main",{className:"min-h-screen flex items-center justify-center bg-soft dark:bg-soft-dark px-4",children:e.jsxs("section",{className:"w-full max-w-md bg-surface dark:bg-surface p-8 rounded-lg shadow-lg text-primary",children:[e.jsxs("header",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Reset Your Password"}),e.jsx("p",{className:"text-sm text-secondary mt-1",children:"Enter and confirm your new password."})]}),h&&e.jsx(j,{type:"error",message:h,className:"mb-4"}),v&&e.jsx(j,{type:"success",message:"Password reset successful. Redirecting to login...",className:"mb-4"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsx(y,{name:"password",type:"password",placeholder:"New Password",value:t.password,onChange:b,required:!0}),e.jsx(y,{name:"confirm",type:"password",placeholder:"Confirm New Password",value:t.confirm,onChange:b,required:!0}),e.jsx(A,{type:"submit",disabled:f,full:!0,variant:f?"disabled":"primary",children:f?"Resetting...":"Reset Password"})]})]})})};export{V as default};
