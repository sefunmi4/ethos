import{j as e,S as E,u as v,r as o,f as y,D as N,a as R,b as I,B as j,L as b,R as S}from"./index-CxzMjhE-.js";import{B as A,g as w}from"./Board-DvHUsBFG.js";import{u as L}from"./useBoard-BWIqxM7N.js";import{u as P}from"./useSocket-B9IG26Ws.js";import"./usePermissions-alxmqwVa.js";import"./displayUtils-C2lD-HWY.js";import"./Button-BBg8DJkg.js";import"./GridLayout-DEWRpfJd.js";import"./post-BFgSlzkn.js";import"./quest-3nETprwz.js";import"./useGraph-Br1XlEWj.js";import"./AvatarStack-DgfcvvW3.js";const T=[{value:"",label:"All Posts"},{value:"request",label:"Requests"},{value:"review",label:"Reviews"},{value:"issue",label:"Issues"}],k=({value:n,onChange:s})=>e.jsx("div",{className:"max-w-xs",children:e.jsx(E,{value:n,onChange:i=>s(i.target.value),options:T})}),B=({boardId:n="timeline-board"})=>{const{user:s}=v(),{board:i,setBoard:l}=L(n),[h,t]=o.useState(1),[c,x]=o.useState(!1),[p,g]=o.useState(!0),u=o.useCallback(async()=>{var r;if(!(!n||c||!p)){x(!0);try{const a=h+1,m=await y(n,{page:a,limit:N,enrich:!0,userId:s==null?void 0:s.id});(r=m.items)!=null&&r.length?(l(d=>d?{...d,items:[...d.items,...m.items],enrichedItems:[...d.enrichedItems||[],...m.enrichedItems||[]]}:m),t(a)):g(!1)}catch(a){console.warn("[RecentActivityBoard] Pagination error:",a)}finally{x(!1)}}},[n,h,c,p,s==null?void 0:s.id,l]);P("board:update",r=>{!n||r.id!==n||y(n,{enrich:!0,userId:s==null?void 0:s.id}).then(l)});const f=o.useRef(null);return o.useEffect(()=>{const r=f.current;if(!r)return;const a=()=>{r.scrollHeight-r.scrollTop<=r.clientHeight+150&&u()};return r.addEventListener("scroll",a),()=>r.removeEventListener("scroll",a)},[u]),i?e.jsx(A,{boardId:n,board:i,layout:"list",compact:!0,hideControls:!0,onScrollEnd:u,loading:c,user:s,headerOnly:!0}):e.jsx(R,{})},V=()=>{var f,r,a;const{user:n,loading:s}=v(),{boards:i}=I(),[l,h]=o.useState(""),t=i["quest-board"],c=i["timeline-board"],x=(((f=t==null?void 0:t.enrichedItems)==null?void 0:f.length)||0)>j,p=(((r=c==null?void 0:c.enrichedItems)==null?void 0:r.length)||0)>=j,u=o.useMemo(()=>{if(!(t!=null&&t.enrichedItems))return[];const m=new Set;return w(t.enrichedItems).forEach(d=>{"type"in d&&m.add(d.type)}),Array.from(m)},[t==null?void 0:t.enrichedItems]).length>1&&(((a=t==null?void 0:t.enrichedItems)==null?void 0:a.length)||0)>0;return s?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(R,{})}):e.jsxs("main",{className:"container mx-auto px-4 py-8 max-w-6xl space-y-12 bg-soft dark:bg-soft-dark text-primary",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight text-primary mb-2",children:"Welcome to Ethos"}),e.jsx("p",{className:"text-lg text-secondary",children:"A place to explore ideas, share quests, and collaborate."})]}),e.jsxs("section",{className:"space-y-4",children:[u&&e.jsx(k,{value:l,onChange:h}),e.jsx(A,{boardId:"quest-board",title:"üó∫Ô∏è Quest Board",layout:"grid",gridLayout:"horizontal",compact:!0,user:n,hideControls:!0,filter:l?{postType:l}:{}}),x&&e.jsx("div",{className:"text-right",children:e.jsx(b,{to:S.BOARD("quest-board"),className:"text-blue-600 underline text-sm",children:"‚Üí See all"})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"‚è≥ Recent Activity"}),e.jsx(B,{}),p&&e.jsx("div",{className:"text-right",children:e.jsx(b,{to:S.BOARD("timeline-board"),className:"text-blue-600 underline text-sm",children:"‚Üí See all"})})]})]})};export{V as default};
