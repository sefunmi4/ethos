import{r as i,u as I,c as T,j as e,d as D,e as G,l as Q,g as W}from"./index-CxzMjhE-.js";import{a as J}from"./useSocket-B9IG26Ws.js";import{u as M}from"./useBoard-BWIqxM7N.js";import{u as V}from"./usePermissions-alxmqwVa.js";import{u as _}from"./usePost-cu-m9d1_.js";import{u as $}from"./useQuest-BW7Znkqp.js";import{u as z}from"./useTimeline-Bxu8jN54.js";import{u as H}from"./useGraph-Br1XlEWj.js";import"./quest-3nETprwz.js";import"./post-BFgSlzkn.js";const K=r=>!!r&&typeof r=="object"&&"id"in r&&typeof r.id=="string"&&"email"in r&&typeof r.email=="string",ne=()=>{const[r,f]=i.useState({email:"",password:"",confirm:""}),[o,u]=i.useState(!1),[s,g]=i.useState(!1),[k,h]=i.useState(!1),[b,n]=i.useState(""),[m,x]=i.useState(!1),{setUser:v}=I(),{socket:N,connect:S}=J(),{setSelectedBoard:R,fetchBoards:C}=M(),{loadPermissions:P}=V(),{fetchPostsForBoard:B}=_(),{fetchQuestsForBoard:L}=$(),{loadTimeline:A}=z(),{loadGraph:q}=H(),E=T(),p=l=>{f({...r,[l.target.name]:l.target.value})},F=async l=>{var y,w;l.preventDefault(),n(""),x(!0);try{if(s){await D(r.email),h(!0);return}if(o){if(r.password!==r.confirm)return n("Passwords do not match");await G(r.email,r.password)}await Q(r.email,r.password);const t=await W();if(K(t)){v(t),S(),N.emit("user_connected",{userId:t.id});const d=await C(t.id),a=d.find(c=>c.defaultFor==="home")||d[0];if(a){R(a.id);const c=a.id.startsWith("map-")?a.id.replace("map-",""):null,j=[P(a.id),B(a.id,t.id),L(a.id,t.id),A(a.id,t.id)];c&&j.push(q(c)),await Promise.all(j)}E("/")}else throw new Error("Invalid user response from fetchCurrentUser")}catch(t){console.error("Auth failed:",t);const d=(w=(y=t.response)==null?void 0:y.data)==null?void 0:w.error;n(d||"An error occurred. Please try again.")}finally{x(!1)}},U=()=>{g(!1),u(!1),h(!1),n(""),f({email:"",password:"",confirm:""})};return e.jsx("main",{className:"min-h-screen flex items-center justify-center bg-soft dark:bg-soft-dark px-4 text-primary",children:e.jsxs("section",{className:"w-full max-w-md bg-surface dark:bg-surface p-8 rounded-lg shadow-lg",children:[e.jsxs("header",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:s?"Reset Password":o?"Create an Account":"Welcome Back"}),e.jsx("p",{className:"text-sm text-secondary mt-1",children:s?"Enter your email to receive a reset link.":o?"Join the platform today.":"Login to continue your quest."})]}),b&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-300 rounded p-2 mb-4",children:b}),k&&s&&e.jsx("div",{className:"text-sm text-green-600 bg-green-50 border border-green-300 rounded p-2 mb-4",children:"Password reset instructions sent to your email."}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("input",{name:"email",type:"email",placeholder:"Email",value:r.email,onChange:p,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-600 dark:placeholder-gray-300",required:!0}),!s&&e.jsx("input",{name:"password",type:"password",placeholder:"Password",value:r.password,onChange:p,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-600 dark:placeholder-gray-300",required:!0}),o&&!s&&e.jsx("input",{name:"confirm",type:"password",placeholder:"Confirm Password",value:r.confirm,onChange:p,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-600 dark:placeholder-gray-300",required:!0}),e.jsx("button",{type:"submit",disabled:m,className:`w-full py-3 rounded font-semibold text-white transition ${m?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:m?s?"Sending...":o?"Registering...":"Logging in...":s?"Send Reset Link":o?"Register":"Login"})]}),!s&&!o&&e.jsx("div",{className:"text-right mt-2",children:e.jsx("button",{type:"button",className:"text-blue-500 text-sm hover:underline",onClick:()=>{g(!0),n("")},children:"Forgot password?"})}),e.jsx("footer",{className:"mt-6 text-center text-sm text-secondary",children:s?e.jsx("button",{type:"button",className:"text-blue-600 hover:underline",onClick:U,children:"Back to login"}):o?e.jsxs("p",{children:["Already have an account?"," ",e.jsx("button",{type:"button",className:"text-blue-600 hover:underline",onClick:()=>{u(!1),n("")},children:"Log in"})]}):e.jsxs("p",{children:["Donâ€™t have an account?"," ",e.jsx("button",{type:"button",className:"text-blue-600 hover:underline",onClick:()=>{u(!0),n("")},children:"Register"})]})})]})})};export{ne as default};
