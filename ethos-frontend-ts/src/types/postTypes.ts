import type { Visibility } from './common';

/**
 * Types of posts supported across the app.
 * Determines layout, routing, and system behavior.
 */
export type PostType =
  | 'free_speech'
  | 'request'
  | 'quest'
  | 'meta_system'       // ðŸ§  Internal system post
  | 'meta_announcement'; // ðŸ“£ Public system broadcast

/**
 * Tags used to describe and filter posts.
 */
export type PostTag =
  | 'ai'
  | 'feedback'
  | 'story'
  | 'system'
  | 'bug'
  | 'progress'
  | 'event'
  | 'release'
  | 'repost'
  | 'quest'              // ðŸ”– Indicates a quest-related post
  | string;              // fallback for custom tags

/**
 * Optional Kanban-style status used in quest tasks.
 * Posts with a `quest` tag + `status` are treated as actionable tasks.
 */
export type QuestTaskStatus = 'To Do' | 'In Progress' | 'Blocked' | 'Done' | string;

/**
 * Main post structure.
 * Posts may represent speech, requests, quest logs, or tasks.
 */
export interface Post {
  id: string;

  /** Author of the post */
  authorId: string;

  /** Type of post, used for routing/layout */
  type: PostType;

  /** Markdown or plain text content */
  content: string;

  /** Who can view this post */
  visibility: Visibility;

  /** ISO timestamp */
  timestamp: string;

  /** Optional: Sortable ISO date */
  createdAt?: string;

  /** Optional: Quest context */
  questId?: string | null;
  questName?: string;
  nodeId?: string;

  /** Hashtags and topic labels */
  tags: PostTag[];

  /** Optional: Kanban-style task status for quest posts */
  status?: QuestTaskStatus;

  /** Collaborators on the post */
  collaborators: string[];

  /** Reply chain support */
  replyTo?: string | null;

  /** If reposted, metadata about the original */
  repostedFrom?: RepostMeta | null;

  /** Links to other objects */
  linkedItems: LinkedItem[];

  /** Reaction summary */
  reactions?: ReactionSet;

  /** System-generated or auto-populated */
  systemGenerated?: boolean;
  autoGeneratedReason?: string;
}

/**
 * If a post links to another quest/post/board.
 */
export interface LinkedItem {
  itemId: string;
  itemType: 'quest' | 'post' | 'board';
  nodeId?: string;
}

/**
 * Metadata when reposting another post.
 */
export interface RepostMeta {
  originalPostId: string;
  username: string;
  originalContent: string;
  originalTimestamp: string;
}

/**
 * Map of user reactions by type.
 */
export interface ReactionSet {
  like?: Record<string, string>;
  love?: Record<string, string>;
  repost?: Record<string, string>;
}